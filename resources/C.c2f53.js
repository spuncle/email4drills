(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{640:function(e,t,a){e.exports=a(469)('<div class="attachContainer"></div> <div class="attach-summary j-attach-summary"> <div class="attach-more"> <span class="j-attach-info info"></span> <span class="j-attach-expand f-dn"> <a href="javascript:void(0)" class="link j-attach-toggle"></a> <span class="j-attach-expand-desc expand-desc"></span> </span> </div> </div> <div class="u-alert u-alert-warning u-alert-dismissible attach-tips j-attach-tips f-dn"> <span class="close iconfont icondelword j-close"></span> <span class="cnt j-cnt"></span> </div>',{uploadTpl:'<div class="u-fileupload"> <div class="icon j-icon"><i class="iconfont {{icon}}"></i></div> <div class="name j-name">{{name}}</div> <div class="info j-info">{{info}}</div> <div class="size j-size">{{#if size}}{{loaded}} / {{total}}{{/if}}</div> <div class="trs-expire j-trs-expire f-dn"></div> <div class="preparing j-preparing f-dn"></div> <div class="btns j-btns"></div> </div>',menuTpl:'<a data-type=attach class=f-csp><i class="iconfont icondrop"></i></a>',pluginInstallTpl:'<p style="font-size:16px"> {{{title}}} </p> {{{i18n "mail/attach_error_tips"}}}',progressTpl:'<div class="pgr j-pgr"> <div class="u-progress"> <div class="u-progress-bar" style="width: {{width}};">{{text}}</div> </div> </div>'})},641:function(e,t,a){(function(t){var i=t,n=i.iter,s=i.pick,o=i.isSTR,l=i.create,r=a(513),c=a(506),d=a(482),p={upload:f,inlined:f,netfolder:h,trs:h,internal:f,dealing:function(e,t){e.type='internal',u(e,t,['mid']),e.part=t.part}};function u(e,t,a){n(a,(function(a){var i=t[a]||t['_'+a];i&&(e[a]=i)}))}function f(e,t){e.name=t.name||'',e.size=t.size||t.actualSize||0,e.contentType=t.contentType||'',e.setId(t.id),e.setDeleted(t.deleted),e.dsize=+e.size;var a=r.basename(e.name);if(d.enabled){var i,n=t.securityLevel,s=d.deTagSender(a);a=s[0],i=s[1],(n='0'!==n&&n||i)&&(e.securityLevel=n),e.lockSecurityLevel=!!i&&i===n}e.basename=a}var m=f.prototype={setId:function(e){this.id=c.decimalInt(e,null)},setDeleted:function(e){this.deleted=!0===e},setMid:function(e){o(e)&&(this.mid=e)},displayName:function(){return d.tagSender(this.securityLevel,this.basename)},exportToCompose:function(){var e,t,a=s(this,['id','type','name','size','deleted','securityLevel']);return e=a,t=this,n(['mid','part','enfUid'],(function(a){a in t&&(e['_'+a]=t[a])})),a.displayName=this.displayName(),a},migrateToTrs:function(e){return v('trs',t.assign({mid:e},s(this,['name','size','contentType'])))}};function h(e,t){u(e,t,['enfUid','mid'])}function v(e,t){var a=p[e='compose'===e?'upload':e];if(a){var i=l(m);return i.type=e,f(i,t),f===a||a(i,t),i}}e.exports={initFileInstance:v,isUploadOrInlinedType:function(e){return'inlined'===e||'upload'===e}}}).call(this,a(464))},659:function(e,t,a){var i=a(465),n=a(473);t.validate=function(e,t,a,s){var o,l=e.tagName?e.value:e;if(l=l.trim()){if(function(e){for(var t=0,a=0;a<e.length;a++)e.charCodeAt(a)>255?t+=2:t++;return t}(l)>24)o=i('pab/c_new_addprg_name_length');else if(function(e,t){for(var a=0;a<e.length;a++)if(t.indexOf(e.charAt(a))>=0)return!0;return!1}(l,'%\'"\\/:*?<>|=,^'))o=n(i('contact/msg_grpNameContainIllegalCharacter'),'%\'"\\/:*?<>|=,^');else if(t.push({name:i('pab/c_allgrp')},{name:i('pab/c_others')}),'addnew'==a){for(var r=0;r<t.length&&l!=t[r].name;r++);r!=t.length&&(o=i('contact/msg_grpNameExist'))}else if('update'==a){for(var c=0;c<t.length&&(l!=t[c].name||l==s);c++);c!=t.length&&(o=i('contact/msg_grpNameExist'))}}else o=i('pab/c_new_addprg_name_empty');return o?{state:!1,errMsg:o}:{state:!0}}},800:function(e,t,a){a(505).prototype.attrs.hasMask=!1;var i=a(470).alert,n=a(463),s=a(464),o=a(466),l=a(475),r=a(473),c=a(465);function d(e){if(e.name!=n('[name=name]').val())return!0;if(e.start.date!=n('[name=startTime_date]').val().trim())return!0;if(e.start.hour!=n('[name=startHour]').val().trim())return!0;if(e.start.minute!=n('[name=startMinute]').val().trim())return!0;if(e.end.date!=n('[name=endTime_date]').val().trim())return!0;if(e.end.hour!=n('[name=endHour]').val().trim())return!0;if(e.end.minute!=n('[name=endMinute]').val().trim())return!0;if(e.isAllDay!=n('#isAllDay')[0].checked)return!0;if(e.description!=n('[name=description]').val().trim())return!0;if(e.recurrence.type!=n('[name=recurrence_type]').val())return!0;if(1==e.recurrence.type){var t=getDetailWeekDays(+e.recurrence.typeValue);if(s.map(n('[name=recur_typeValue]:checked'),'value').join(',')!==t)return!0}if(-1!=e.recurrence.type){if(e.recurrence.repeat!=n('[name="recurrence_repeat_until"]').val().trim())return!0;if(formatDate(e.recurrence.until)!=n('[name="recurrence_until"]').val().trim())return!0}return!s.isEqUnordered(s.map(l.parse(e.eventAttendees),'address'),s.map(l.parse(n('[name=attendees]').val()),'address'))}o.resolve(init(n,{initCalendarForm:function(){var e=n('.j-cal-fid').change(s.ary(t,0));function t(t){t=t||e.val();var a=function(e,a){return a.replace(/(fid=)(\d+)/,(function(e,a){return a+t}))};n('[name=fid]').val(t),n('[name=urlfrom]').val(a),n('#evteditorForm').attr('action',a)}window.isElementModify=d,window.changeTargetCalFolder=t,n('#evteditorForm').submit(s.stop((function(t){var a=n(':submit')[0];a.disabled=!0,null==checkEvteditorForm(!!EMBEDDED_CONST.isOrganizer,eventObject,(function(){var s,d;s=function(){'add'===func&&triggerCal('changeFolder',{fid:e.val()}),n('[name=action]').val(n('[name=func]').val()),t.target.submit()},d=n('#location').val().split(','),function p(){var e=d.shift(),t=l.parseAddress(e);e&&t&&l.test(t)?o.wmCall('cal:getUserFreeBusyStatus',{user_id:t,event_uid:EMBEDDED_CONST.eventUid,toweb:!0,m:!0,fromdate:n('#startTime_date').val()+' '+n('input[name=startHour]').val()+':'+n('input[name=startMinute]').val(),todate:n('#endTime_date').val()+' '+n('input[name=endHour]').val()+':'+n('input[name=endMinute]').val()}).then((function(t){if(t[0])return a.disabled=!1,void i(r(c('cal/fail_location_occupy'),[e,t[0][2]]));p()})):(d.length?p:s)()}()}))||(a.disabled=!1)})))},initEventView:function(){n('.scrollNav, .gMain, .layout').scroll((function(){adjustAddinfos()})),n('div[name="action:goback"]').click((function(){window.location=n('input[name=urlfrom]').val()})),n('div[name="action:resp"]').click((function(){var e=+n('input[name=resp]:checked').val();e&&o.wmCall('cal:replyMeetingRequest',{userAttendeeStatus:e,eventId:+n('input[name=id]').val(),fid:EMBEDDED_CONST.calFolderId}).then((function(){var t=n('.event_response_desc').show();t.find('i').attr('class','ico attendee_'+[,,'indeterminacy','attend','reject'][e]),t.find('span').html(c('cal/resp_'+e)),t.find('a').toggle(4!==e),n('.event_response').hide()})).catchCode('FA_INVALID_REQUEST',s.ary(i,1,c('cal/event_participation_illegal'))).catchCode('FA_INVALID_ATTENDEE',s.ary(i,1,c('cal/event_participation_cancel')))}))}})).then((function(){parent.postMessage('{"type":"calendarLoaded"}','*')}))},848:function(e,t,a){(function(e){a(849),a(532),a(636);var t=a(856);a(583);var i=a(534),n=a(479),s=a(515),o=a(477).go,l=a(472),r=a(471),c=a(498),d=a(470),p=d.alert,u=d.confirm,f=d.prompt,m=a(614),h=a(522),v=a(547),g=a(468),b=g.detachMode,_=g.get,y=a(475),w=a(473),k=a(488).bytesToSize,T=a(483),x=T.text2html,C=T.html2text,j=T.encode,S=a(482),$=a(466),D=a(465),E=a(513).basename,M=a(529),I=a(485),F=a(581),R=a(464),P=a(504),L=a(467),A=a(887),z=a(649),N=a(474),U=a(487),O=a(476),H=a(888),q=a(889),W=a(578),G=a(893),B=a(635),Y=a(896),V=a(897),K=a(570),X=a(899),Q=X.plgTpl,Z=X.toolbarTpl,J=X.sidebarTpl,ee=X.frmTpl,te=X.timesendtpl,ae=X.mailciphertpl,ie=X.autodeltpl,ne=X.forwarddtpl,se=X.successtpl,oe=X.searchResultItem,le=X.autosaveContactListTpl,re=X.deliverystatustpl,ce=X.contactsTpl,de=X.CAattachTpl,pe=X.CApluginInjectTpl,ue=e(window),fe=l.Auto.extend({},(function(l,r){var d,g,T,V=P.getBoolean('compose_sidebar_toggle_mode',!1);var X,fe,we=L.getCurrentState().param,De=this;De.events={'click .u-btn:not(.disabled)[data-type]':[De.cmd={aside:wt,send:xt,preview:kt,save:St,cancel:$t,forward:Et,forwardCancel:Mt,back:jt,'continue':et}],'click .j-form-toolbar input[data-type]':[yt],'click #searchResultContainer li a[data-addr]':[function(e){var t=y.of(e),a=t.address,i=t.trueName;pt(a,i)}],'click .j-trigger-contactdg':[function(e,t,a){R.stop(a),De.$('.j-form-tt').find('a[contact="'+(e||De.cType)+'"]').click()},'{{data.type}}']};var Ee,Me=[],Ie=e(),Fe=a(545).compose(),Re={len:_('user.mailCipherPassLen')},Pe={content:''},Le=we.embed,Ae=we.id||'',ze='compose'+(Ae&&':')+Ae;l()(R.assign({},r,{name:'mail.'+ze,tabId:ze,composeId:Ae,className:Le?'m-mlcompose-embed':''}));var Ne,Ue={config:Fe},Oe=De._params={composeInfo:Ue,intervalTimer:0,refreshedFolder:!1,notify:null,destroyed:!1,prevTags:[],sendMailWithSms:{},useCASign:!1,useCAEncrypt:!1,varList:null},He=[],qe=we.ctype||'',We='forwardd'===qe;if(!$e(Fe,qe))return De.offEvents(),Ve(),void p(D(M(qe,[[/forwardd/i,'mail.compose_forbidden_forwardd'],[/reply.*/i,'mail.compose_forbidden_reply'],[/forward.*/i,'mail.compose_forbidden_forward']],'mail.compose_forbidden')));function Ge(){ue.off('beforeunload',mt).off('resize',gt),Oe.notify&&Oe.notify.close(),d&&d.remove(),g&&g.activeFiles()&&$t(),d=g=T=null,nt&&clearTimeout(nt),Oe.destroyed=!0,fe&&fe.destroy(),Me.forEach((function(e){e.destroy()})),Me.length=0,De.$('> div').remove(),a(533).wmReset(Ue.composeId)}function Be(){Je.toggleClass('z-aside-hide',V),De.$('span[data-type=aside]').html('<i class="iconfont '+(V?'iconprevious':'iconnext')+'" />')}function Ye(e){De.$('li.j-edit-source > a').text(D('mail/'+(e?'close_':'')+'source_edit')),De.$('li.j-close-source-mode').toggleClass('f-dn'),d&&(d.clickToolbar('source'),oa(d.designMode))}function Ve(){De.sendMessage('mail','view:close',{id:ze})}De.after('render',(function(){We?ga('input[name=bcc]',{contactac:{container:De.$()},onClick:function(e,t){t.addClass('z-active')},onBlur:function(e,t){t.removeClass('z-active')},enableSecurityLevel:!1}).focus():(De.$().mask(),Fe.supportPab&&$.when(U.getPabHitCounterWithDetails(),U.getPabGroupsAndItsMembers()).then((function(t,a){e.each(a,(function(e,t){'OTHER'===t.id&&(t.name=D('contact/gp_other')),t.title=w(D('contact/lbl_grpNameWithCount'),[t.name,t.count])})),0!==t.length&&a.unshift({name:D('main/pab_recent_contact'),count:t.length,title:w(D('contact/lbl_grpNameWithCount'),[D('main/pab_recent_contact'),t.length]),children:t,expand:!0,flag:'j-recent'});var i=e(ce({groups:a})).on('click','a[data-toggled]',(function(t){R.stop(t,0);var a=e(this).parents('.aWrapper').next();a.hasClass('toggled')?a.slideUp(300):a.slideDown(300),e(this).find('.iconfont').toggleClass('icondown iconright'),a.toggleClass('toggled')})).on('click','li, a[data-trigger]',(function(t){R.stop(t,0),('A'===this.tagName?e(this).parents('.aWrapper').next().find('li'):e(this)).each((function(){pt(e(this).attr('data-addr'),e(this).attr('data-name'))})),gt()}));De.$('#mptree').html(i)})),new F({element:Ze,activeTriggerClass:'z-current',triggerType:'click'}).on('switch',(function(e){[R.noop,sa,na][e]()})),at().either((function(){De.$().mask('hide')})),fe=new h({element:De.$('.j-select-wrapper'),placeholder:D('contact/lbl_quickSearchContacts'),containerClassName:'u-input-round'}).on('keyup clear',ia)),Be(),De.subscribe('dispatcher','url:changed',(function(e){'mail.compose'===e.message.oldState.module&&Ut()})),De.resubscribe('setting.account.signature','signs:refresh',(function(){!lt()&&rt(1)})),De.rebindMessage('cmd',(function(e){De.cmd[e.message]()}))})),ue.on('beforeunload',mt).resize(gt),De.before('destroy',Ge),De.confirmbeforedestroy=function(){return $e(Fe,qe)},De.beforedestroy=function(t){if(Oe.notify||Oe.destroyed||We)t();else{var a=va();a?Fe.enableSaveDraft?u(D(a.scheduleDate?'mail/msg_schedule_before_cancel':'mail/msg_save_before_cancel'),{onConfirm:function(){A.sendMail({action:'save',id:Ue.composeId,attrs:a}).then((function(){e.notify.success(D('mail/compose_draft_success')),ta(),t()}))},confirmTpl:D(a.scheduleDate?'common/save':'mail/compose_leave_save'),uncertainTpl:D(a.scheduleDate?'common/unsave':'mail/compose_leave_unsave'),onUncertain:t}):u(D('mail/msg_before_cancel'),t):t()}};var Ke=e(Q()),Xe=e(Z(Fe)),Qe=e('<form action="" method=post class="u-form mn-form" />'),Ze=e(J(Fe)),Je=e('<div class=main />').html([Ze,Qe]);function et(){N.getInitCompose().then((function(e){var t;e&&e.id&&(t=e.id,o('mail.compose',{id:t,replaceId:ze}))}))}De.$().html(We?ne():[Ke,Xe,Je]);var tt,at=function(){return A.getInitComposeInfo(we).then((function(t){t.accounts.forEach((function(e){var t=N.cachedMboxaTreeBy('name',e.addr);t&&(e.mboxa=t.id)})),e.extend(Ue,t),Ue._subject=Ue.subject||'',Ue.isHtml=null!=t.isHtml?!0===t.isHtml:1===L.getUser().edit_mode,Ue.draftId&&(Ue.config.encryptedCheckedDefault=!1);var n,s,o=(t.ctrls||{})['CM-SECURITY'],l=Fe.enableSecurityLevel;o&&(Ue.senderSecurityLevel.value=o,l=l||S.enabledEditFwd||![6,7,8].includes(Ue.deliveryMsgType)),Ue.enableChangeSecurityLevel=l,ke(Qe.html(ee(Ue))),Ie=De.$('.j-form-toolbar'),Ut(),it(),function(){var e,t=De.$('input[name=subject]');function a(a){return function(){e&&clearInterval(e),a&&(e=setInterval((function(){var e=t.val();e!==Oe.composeInfo.subject&&_t(e)}),500))}}t.on({focus:a(!0),blur:a(!1)}),De.sendMessage('mail','tab:change',{id:ze,title:Oe.composeInfo.subject||D('compose/lb_compose')})}(),(n=De.$('.j-ft-contact')).on('click','a[data-type]',(function(t){R.stop(t,0);var a,i,s,o,l=e(this),r=l.attr('data-type'),c=!l.hasClass('z-active'),d=De.$('.j-form-item-cc'),p=De.$('.j-form-item-bcc'),f=De.$('.j-form-item-to'),m=[];switch(r){case'cc':c?(l.html(D('mail/mail_uncc')).addClass('z-active'),d.removeClass('f-dn')):(o=function(){l.html(D('mail/mail_cc')).removeClass('z-active'),d.addClass('f-dn'),d.find('input[name=cc]').tagEditor('updateTags',[],!0)},d.find('.tag-editor-li').length>0?u(D('mail/msg_confirm_remove_cc_addr'),(function(){d.find('.tag-editor-li').remove().end().find('.tag-editor-hidden-src').val(''),o()})):o());break;case'bcc':c?(l.html(D('mail/mail_unbcc')).addClass('z-active'),p.removeClass('f-dn')):(o=function(){l.html(D('mail/mail_bcc')).removeClass('z-active'),p.addClass('f-dn'),p.find('input[name=bcc]').tagEditor('updateTags',[],!0)},p.find('.tag-editor-li').length>0?u(D('mail/msg_confirm_remove_bcc_addr'),(function(){p.find('.tag-editor-li').remove().end().find('.tag-editor-hidden-src').val(''),o()})):o());break;case'onercpt':var h=f.find('input[role=contact]'),v=p.find('input[role=contact]'),g=d.find('input[role=contact]');a=n.find('a[data-type=cc]'),i=n.find('a[data-type=bcc]'),c?(l.html(D('mail/mail_unonercpt')).addClass('z-active'),De.$('a[contact=to]').html(D('mail/mail_onercpt_short')),d.addClass('f-dn'),p.addClass('f-dn'),a.closest('li').hide().next('li').hide(),i.closest('li').hide().next('li').hide(),Oe.prevTags=h.val().split(','),s=e.unique(e.merge(v.val().split(','),g.val().split(','))),h.tagEditor('addTags',s,!0),f.click()):(l.html(D('mail/mail_onercpt')).removeClass('z-active'),De.$('a[contact=to]').html(D('compose/lbt_to')),a.hasClass('z-active')&&d.removeClass('f-dn'),i.hasClass('z-active')&&p.removeClass('f-dn'),a.closest('li').show().next('li').show(),i.closest('li').show().next('li').show(),s=h.tagEditor('getTags')[0].tags,e.each(s,(function(t,a){-1===e.inArray(a,Oe.prevTags)&&m.push(a)})),h.tagEditor('removeTags',m))}})),function(){var e=De.$('.j-accounts');if(e.length<1)return!1;c({parentNode:e.closest('.u-form-item'),trigger:e}).on('change',rt.bind(0,2))}(),ga('input[role=contact]',{contactac:{container:De.$()},onClick:function(e){De.cType=e.attr('name')}}),(Fe.supportPab||Fe.supportOab)&&(s=De.$('.j-form-tt'),i(s,{selectTitle:D('mail/mail_to_address'),types:[{to:D('mail/mail_to')},{cc:D('mail/mail_cc')},{bcc:D('mail/mail_bcc')}],init:aa,onSelect:dt,trigger:['a[contact]',function(e){var t=e.attr('contact');return Jt(),{type:t,input:s.find('input[name='+t+']'),onClose:Zt}}]})),v([De,function(t){e((d=t).cmd.doc.body).keydown((function(e){var t=e.which;Ue.isHtml&&e.ctrlKey&&1===L.getUser().shortcut&&(83===t?(R.stop(e),St()):13===t&&xt())}))},ft],'.editor',Ue.isHtml,g),$.resolve(_('user.enableDefaultFont')?O.getFaces():[,,0]).then((function(e){var t=e[2];d.setDefaultFontType(t.family,t.size||14)})),Nt(Ue.content),Rt(Ue.isHtml),function(){Ue.isHtml||(De.$('.j-text-menu').show(),De.$('.j-html-menu').hide());oa(Ue.isHtml),a(481).LE9&&!g._valid()&&(De.$().addClass('z-notify'),Ke.show().find('.j-close').on('click',(function(){Ke.hide(),De.$().removeClass('z-notify'),Zt()}))),t=De.$('a[data-type=more]'),i=[{name:D('mail/source_edit'),value:'source',icon:'iconcode1',classNames:'j-edit-source'}],t.dropdown({data:i,callback:function(e){'source'===e.value&&Ue.isHtml&&Ye(d.designMode)}}),rt(),De.$('.j-ft-menu').on('click','[data-type]',(function(t){var a=e(this),i=a.attr('data-type');switch('upload'!==i&&R.stop(t,0),i){case'etbr':Rt(a);break;case'link':d.clickToolbar('link');break;case'screencapture':!function(e){e.hasClass('disabled')||d.capture()}(a);break;case'image':d.clickToolbar('image');break;case'html':case'text':At('html'===i);break;case'source':Ye(!1);break;case'expand':Ut(!De.$().hasClass('z-expand')),bt(),ue.trigger('layoutResize');break;case'typo':!function(e){var t=e.data('mode');'mode_checkspelling'===t?(d.clickToolbar('spellcheck'),e.data('mode','mode_re_checkspelling').text(D('compose/htmltool_re_spellcheck'))):'mode_re_checkspelling'===t&&d.clickToolbar('spellrecheck')}(a)}}));var t,i}(),function(){var e=L.getUser(),t=Fe.supportSMIMEClient&&Ue.useCacompose;R.iter({savesent:[e.save_sent,1],smimeSign:[Ue.smimeSign,1],smimeEncrypt:[Ue.smimeEncrypt,1],timesend:[Ue.scheduleDate],urgent:[1===Ue.priority],rrr:[Ue.requestReadReceipt],queryreadstatus:[Fe.enableQueryReadStatus&&e.query_read_status],forbidDownload:[Ue.forbidDownload],useCASign:[t&&Ue.isSigned],useCAEncrypt:[t&&Ue.isEncrypted]},(function(e,t){var a=e[0],i=e[1];if(a){var n=xe(Ie.find('input[data-type='+t+']'));i||yt(t,n)}})),t&&(He=I.getItem(Ue.attachId,!1)||[],Xt());Se(Ie,!0)}(),ct(),Ue.to&&Ue.to.length>0?(d.focus(),Ue.isHtml||e(d.getTextarea()).caret(0)):De.$('.j-form-item-to').find('.tag-editor').trigger('click'),function(){var t=De.$('.j-securityLevel');if(!Fe.enableSecurityLevel)return!1;Ne=c({parentNode:t.closest('.u-form-item'),trigger:t,disabled:t.is(':disabled')}),De.$('.j-form-tt').on('click','.j-editSecurityLevel',(function(t){R.stop(t,0);var a=e(this).closest('.j-btns'),i=a.data('file').cmMeta,n=i.basename;m(i.securityLevel,n,(function(e){i.securityLevel=e,a.siblings('.j-name').text(S.tagSender(e,n)),ut()}))}))}()})).catchCode('FA_FORBIDDEN',(function(){return $.wmCall('mbox:compose',{id:Ae}).catchCode('FA_ID_NOT_FOUND',et).onFail((function(){Oe.notify=e.notify.error(D('mail/FA_MBOX_TARGET_READ_ONLY'),{forever:!0})}))})).catchCode('FA_ID_NOT_FOUND',et).onFail((function(){Oe.notify=e.notify.error(D('mail/compose_init_fail'),{forever:!0})}))};function it(){var e,a,i;(g=t(T=De.$('[data-type=upload]'),{composeId:Ue.composeId,$wrapper:tt=De.$('.j-attaches'),editor:function(){return d}}))._ON(ot),(e=Ue.attachments)&&e.length>0&&(a=e,(i=R.map(a,(function(e){return R.assign({},e,{},'internal'===e.type&&{composeId:Ue.composeId})})))[0]&&g.mergeFiles(i,!1))}var nt,st,ot={addstart:function(e,t){var a,i=t.files[0].name||'';Ue.subject||(a=(i=E(i)).lastIndexOf('.'),i=a>-1?i.substring(0,a):i,De.$('input[name=subject]').val(i),_t(i))},'start mergestart':Jt,'progress pluginprogress':function(){g.fails()&&(De.$('.j-disable-edit,.j-enable-edit').remove(),ht=!1),Jt()},completed:It,done:function(e,t){'trs'===t.uploadType&&De.sendMessage('file.transitcenter','trsUpload')},plugindone:function(e,t){'trs'===t.uploadType&&De.sendMessage('file.transitcenter','trsUpload')},destroy:function(e,t){'trs'===t.uploadType&&De.sendMessage('file.transitcenter','trsDestroy')},stop:function(){ea(),Ft()},mergestop:ea,destroyed:It,destroyfailed:function(e,t){ye(t)},resize:bt};function lt(){var e=y.parseAddress(De.$('.j-accounts').val()||''),t=Ue.accounts.find((function(t){return t.addr===e}));return t?t.mboxa:''}function rt(e){var t=lt();z.getSignatures(1!==e,t).then((function(t){if(Ee=R.objBy(t,'id'),!e){var a=Ue.isHtml,i=ve(d.html(),a);Pe=R.find(t,i?function(e){return he(e,a)===i}:'isDefault')||{isHtml:a,content:i},i||(Le&&(Pe.content+=D('compose/msg_from_lunkr')),Nt(la(Pe)))}})).either((function(){var e=R.map(Ee,(function(e){return{name:e.name,value:'sign-'+e.id,'default':e===Pe}}));zt(e,t),De.$('.j-sign-menu').toggle(!!(t?e[0]:_('user.supportSignature')))}))}function ct(){var e=Fe.autoSaveDraftInterval;nt=e>0&&setTimeout((function(){clearTimeout(nt),$.resolve(va()&&Qt(!0)&&St()).either(ct)}),e)}function dt(e){var t=De.$('.j-ft-contact');R.iter(e,(function(e,a){var i=De.$('input[name="'+a+'"]');!i.closest('.u-form-item').is(':visible')&&e.length&&t.find('a[data-type="'+a+'"]').click();var n=R.map(e,(function(e){return''+(Fe.enableSecurityLevel&&e.isOab?S.tag(e.securityLevel):'')+y(e.name,e.addr)}));i.tagEditor('updateTags',n,!0)}))}function pt(e,t){var a=aa(),i=a[De.cType]||a[De.cType='to'];R.map(i,'addr').includes(e)||(i.push({addr:e,name:t}),dt(a))}function ut(){var t=De.$('.j-securityLevel').val(),a=g.notInlinedFiles(),i=-1;return!(a.length>0&&(e.each(a,(function(e,t){t.cmMeta.securityLevel&&t.cmMeta.securityLevel>i&&(i=t.cmMeta.securityLevel)})),i>t))||(u(D('mail/msg_level_exceed_tip_desc'),{onConfirm:function(){Ne.setValue(i)},title:D('mail/msg_level_exceed_tip_title'),confirmTpl:D('mail/lbl_level_exceed_tip_confirm'),cancelTpl:D('mail/lbl_level_exceed_tip_cancel')}),!1)}function ft(){gt(),Ot()}function mt(t){if(!(st||e(document.activeElement).is('a')||g.options.pluginBrowsing))return va()?(t&&(t.returnValue=D('mail/msg_save_onbeforeunload')),D('mail/msg_save_onbeforeunload')):void 0}var ht,vt=0;function gt(){Se(Ie),function(){var e=De.$('.j-form-tt'),t=De.$('.j-form-edr'),a=Je.data('size')||{},i={mainHeight:Je.height(),formttHeight:e.outerHeight(!0),formedrWidth:t.width(),formtblHeight:Ie.outerHeight(!0)};if(Object.keys(i).some((function(e){return a[e]!==i[e]}))){var n=Math.max(300,i.mainHeight-i.formttHeight-i.formtblHeight),s=i.formttHeight+i.formtblHeight+n;t.css('height',n),Ze.css('height',s).end().data('size',i),Qe.css('height',s)}d&&d.resize('100%',t.outerHeight(!0)-20,!0)}()}function bt(){setTimeout(gt,400)}function _t(e){null!=e&&(Ue.subject=e),e=e||D('compose/lb_compose'),De.sendMessage('mail','tab:change',{id:ze,title:e})}function yt(e,t){var a={timesend:Ht,mailcipher:qt,autodel:Bt,savesent:Vt,useCASign:Kt,useCAEncrypt:Kt,smimeSign:Wt,smimeEncrypt:Wt,queryreadstatus:Gt};a[e]&&a[e](t,e),bt()}function wt(){P.set('compose_sidebar_toggle_mode',V=!V),Be(),bt()}function kt(){G(R.assign({},_a(),{attachments:g.notInlinedFiles().toCompose()}))}function Tt(e,t){var a=_a(!1),i=a.scheduleDate;A.sendMail({action:i?'schedule':'deliver',id:Ue.composeId,attrs:a,returnInfo:!0,autosaveHitCounter:!0,verifyCode:t}).then((function(t,a){Ct(a),e.trigger('cancel')})).onFail((function(t){e.trigger('failedSend',t.code||'')}))}function xt(){var t;if(!De.$('.j-tbl-send').hasClass('disabled')){var a,i,n,s,o=_a();if(Dt(o,'to',Qe.find('input[data-type=timesend]').is(':checked')||!o._contacts.length)&&Dt(o,'cc')&&Dt(o,'bcc'))if(!(Qe.find('input[data-type=mailcipher]').is(':checked')&&(i=e('#bt-mailcipher-password',Qe),n=i.val(),0===(s=n.length)?a=D('mail/msg_cipher_password_invalid_empty'):n.trim()!==n?a=D('mail/msg_cipher_password_invalid_no_space_heading_tailing'):s!==Re.len&&(a=D('mail/msg_cipher_password_invalid',Re)),a&&(p(a,(function(){i.focus()})),1))))if(Qt(!1)){Qe.find('[data-type=more] a').text()===D('mail/close_source_edit')&&d.clickToolbar('source'),'mode_checkspelling'!==Qe.find('a[data-type=typo]').data('mode')&&d.clickToolbar('finishcheck');var l=o,r=l.subject,c=l.content,f=function(e,t){return u(e||D('mail/compose_confirm_empty',{type:D(t?'mail/mail_subject':'mail/mail_content')}),{title:D('mail/prompt')}).truthy().onFail((function(){(t?Qe.find('input[name=subject]'):d).focus()}))};$.resolve(r||f('',!0)).then((function(){return c||f()})).then((function(){if(_('mail.supportAttachDetect')&&!g.notInlinedFiles()[0]&&!He[0]&&/\battachments?\b|\u9644\u4ef6/i.test(r+' '+(o.isHtml?e('<div>').html(c).find('blockquote.ReferenceQuote').remove().end().text():c)))return f(D('mail/send_without_attach'))})).then((function(){g.activeFiles()?(ht=!0,De.$().append(e('<div/>',{'class':'compose-disable-edit j-disable-edit'})),De.$().append(e('<div/>',{'class':'compose-enable-edit u-alert u-alert-warning j-enable-edit'})),De.$('.j-enable-edit').append('<span>'+D('mail/compose_send_after_uploaded')+'</span><a href="javascript:void(0)">'+D('mail/compose_back_edit')+'</a>'),De.$('.j-enable-edit a').off('click').on('click',(function(e){R.stop(e,0),ht=!1,De.$('.j-disable-edit,.j-enable-edit').remove()})),$.abort()):(De.$('.j-disable-edit,.j-enable-edit').remove(),ht=!1)})).then((function(){if(Qe.find('input[data-type=sendMailWithSms]').is(':checked')){var e=Oe.sendMailWithSms={};return Y.initSmsNumber(De).then((function(t){R.assign(e,t)}))}})).then((function(){o=_a();var e=L.getConfig('user.uid'),t=y.parseAddress(o.account);if(e!==t)return O.popAccounts.get((function(e){e.find((function(e){if(e.username===t)return o.accountSettings={smtpHost:e.smtpHost,smtpPort:e.smtpPort,useSSL:'boolean'==typeof e.smtpUseSSL&&e.smtpUseSSL,popWebId:e.id},!0}))}))})).then((function(){var e;if(Oe.useCASign||Oe.useCAEncrypt){if(e=X.initCertificate(Fe.domainName),X.setBaseMailInfo(o,He),Oe.useCASign)if(e&&X.signMail(e)){if(!Oe.useCAEncrypt)return void(o.lettercontent=X.mimeNode.build())}else $.abort();Oe.useCAEncrypt&&A.getReceiverCerts(o).then((function(t){X.encryptMail(e,t,Oe.useCASign)?o.lettercontent=X.mimeNode.build():$.abort()}))}})).then((function(){(o.varList||[])[0]&&!R.isEqUnordered(R.map(o.varList,Oe.varListRcptsName),o.to)&&(p(D('mail/msg_rcpts_not_the_same')),$.abort())})).then((function(){if(Fe.enableMultiRcptsAlert&&o._contacts&&o._contacts.length>1)return u(D('mail/msg_multiple_rcpts')).truthy()})).then((function(){e.extend(!0,Ue,o),Fe.enableSecurityLevel&&!ut()||(t=o.scheduleDate,De.$().mask(),Jt(),A.sendMail({action:t?'schedule':'deliver',id:Ue.composeId,attrs:o,returnInfo:!0,autosaveHitCounter:!0}).then((function(e,a){t&&(Oe.refreshedFolder=!0),Ct(a)})).onFail((function(e){var t=e['var'];t&&t.attachments&&g.lookupAttachId(t.attachments),ye(e,D('mail/compose_send_fail'),Tt),delete Ue.to,delete Ue.cc,delete Ue.bcc})).either((function(){De.$().mask('hide'),ea()})))}))}}}function Ct(t){Oe.refreshedFolder&&ta();var a=Ue.scheduleDate,i=a?n(a).format('lll'):'';a&&Ue.scheduleTimeZone&&(i='('+De.$('select[name=target_time_zone]').find('option:checked').text().split(' ')[1]+')'+i);var s,l,r,c,d=1===L.getUser().aftersend_saveaddr,p=Ue._contacts,u='true'===Ue.sendMailWithSms&&Oe.sendMailWithSms,f=[],m=[],h=N.getFoldersMap();Ge();var v=Ue.encryptPassword;v&&(v='<span class="pass">'+j(v)+'</span>');var g=t&&t.savedSent||{},b=g.mid&&g.msid+':'+g.mid;De.$().append(se({aftersend_saveaddr:d,scheduletime:i,status:!!b,encryptPassword:v,smsAddrs:u,config:Fe})),U.pabContactsByEmail().then((function(t){d?(p.forEach((function(e){var a=t(e.addr);a?m.push({id:a[0].id,name:e.name,addr:e.addr,isExist:!0,securityLevel:e.securityLevel}):f.push({FN:e.name,'EMAIL;PREF':e.addr})})),U.createPabContacts(f,!0).then((function(t){f=m,e.each(t,(function(t,a){if('added'===a.action){var i='',n=a.item['EMAIL;PREF'];Fe.enableSecurityLevel&&e.each(p,(function(e,t){if(t.addr===n)return i=t.securityLevel,!1})),f.push({name:a.item.FN,addr:n,id:a.item.id,isAutoSave:!0,securityLevel:i})}})),De.$('.j-contactlist').html(le({contacts:f,aftersend_saveaddr:d})),De.$('.j-autosave-desc').removeClass('f-dn')}))):(p.forEach((function(e){var a=t(e.addr);a&&(e.id=a[0].id,e.isExist=!0)})),De.$('.j-contactlist').html(le({contacts:p,aftersend_saveaddr:d})),De.$('.j-autosave-desc').removeClass('f-dn'))})),De.$('.j-contactlist').on('click','a',(function(t){R.stop(t,0);var a=e(this).data('name'),i=e(this).data('addr'),n=''+e(this).data('id'),s=e(this);n?o('contact.pab',{type:'edit',id:n}):U.createPabContacts([{FN:a,'EMAIL;PREF':i}]).then((function(t){e.notify.success(w(D('common/added_user_address'),i)),s.text(D('main/bt_edit')),s.data({id:t[0]})}))})),s=De.$('.j-autosave-desc'),r=De.$('.j-contactlist'),d&&s.addClass('toggled'),s.on('click','a',(function(t){if(R.stop(t,0),!d){var a=[],i=[];r.find('a').each((function(t,n){var s=''+e(n).data('id');s?i.push({FN:e(n).data('name'),'EMAIL;PREF':e(n).data('addr'),id:s,isExist:!0}):a.push({FN:e(n).data('name'),'EMAIL;PREF':e(n).data('addr')})})),0!==a.length&&U.createPabContacts(a,!0).then((function(t){e.each(t,(function(t,a){if('added'===a.action){var n=a.item['EMAIL;PREF'],s='';Fe.enableSecurityLevel&&e.each(p,(function(e,t){if(t.addr===n)return s=t.securityLevel,!1})),i.push({name:a.item.FN,addr:n,id:a.item.id,isExist:!0,securityLevel:s})}})),r.html(le({contacts:i}))}))}L.updateUser({aftersend_saveaddr:d?0:1}).then((function(){e.notify.success(D('mail/msg_params_update_success')),s.hasClass('toggled')?s.removeClass('toggled'):s.addClass('toggled'),d=!d}))})),l=De.$('.j-suc-title'),c=De.$('.j-status-detail'),b&&l.on('click','a',(function(t){R.stop(t,0);var a=e(this),i=a.attr('action'),s=g.mboxa||'';switch(i){case'status':a.hasClass('z-active')?(a.removeClass('z-active'),a.text(D('mail/compose_show_status')),c.html('')):(a.text(D('mail/compose_hide_status')),a.addClass('z-active'),N.listDeliveryHistory({mid:b,mboxa:s}).then((function(e){e.forEach((function(e){var t=N.getDSInfoHtml(e);e.dsHtml=t[0];var a=n(e.modtime);e.time=a.format('LL')+' '+a.format('HH:mm')})),c.html(e[0]?re({result:e}):D('mail/msg_no_delivery_status'))})));break;case'recall':W({mid:b,mboxa:s});break;case'checkSent':De.sendMessage('mail','view:change',{module:'mail.read',param:{fid:h.sent,id:b,mid:b,tabTitle:Ue.subject,mboxa:s}})}}))}function jt(){b?window.close():(Ut(),Ve())}function St(){var t=De.$('.j-tbl-draft'),a=_a(!0);if(e.extend(!0,Ue,a),!t.hasClass('disabled')&&!g.activeFiles())return Jt(),A.sendMail({action:'save',id:Ue.composeId,attrs:a,returnInfo:!0}).then((function(t,i){var n=i.draftId;e.notify.success(D('mail/compose_draft_success')),Ue.draftId=n,Ue._subject=a.subject||'';var s=t.attachments;s&&g.lookupAttachId(s),ta()})).onFail((function(e){ye(e,D('mail/compose_draft_fail'))})).either(ea)}function $t(){if(b){var t=D('mail/msg_save_onbeforeunload')+'<br />'+D('mail/compose_confirm_before_leave');u(t).then((function(e){st=e,e&&(window.open('','_parent',''),window.close())}))}else De.beforedestroy((function(){Ut(),$.wmCall('mbox:cancelComposes',{ids:Ue.composeId}).then(Ve).onFail((function(){e.notify.error(D('mail/compose_cancel_fail'))}))}))}function Dt(e,t,a){var i=e[t]||[],n=!a||i.length;if(n&&i.every(y.test))return i;p(D(n?'mail/msg_validRcpt':'mail/compose_need_rcpt'),(function(){De.$('input[name='+t+']').focus()}))}function Et(){var t=Dt(ba(),'bcc',!0);t&&(De.$().mask(),$.wmCall('mbox:forwardMessages',{mboxa:we.mboxa||'',ids:R.array(we.mid),mode:'transmit',attrs:{bcc:t}}).then((function(){Ct()})).onFail((function(){e.notify.error(D('mail/compose_send_fail'))})).either((function(){De.$().mask('hide')})))}function Mt(){Ve()}function It(){var e=g.mFiles('completed').size();De.$('.j-html-menu span[data-type=attachuploaded]').html(e>0?D('mail/compose_attach_uploaded')+k(e,2):'')}function Ft(){ht&&(R.mapFind(g.notInlinedFiles(),'cmMeta',(function(e){return'trs'===e.type&&e.id&&!e.mid}))?setTimeout(Ft,500):g.fails()?u(D('mail/compose_upload_failed'),{parentNode:De.$(),confirmTpl:D('mail/compose_ingore_and_send'),cancelTpl:D('mail/compose_back_edit')}).then((function(e){De.$('.j-disable-edit,.j-enable-edit').remove(),ht=!1,e&&xt()})):(De.$('.j-disable-edit,.j-enable-edit').remove(),xt()))}function Rt(e){var t={section:'mail.compose',key:'hideEditorToolbar'},a=!e;e&&(e.hasClass?(a=e.hasClass('active'),P.set(t,a)):a=P.getBoolean(t)),De.$('a[data-type=etbr]').toggleClass('active',!a),d.toolbar.div[a?'hide':'show'](''),gt()}function Pt(e){var t=e.value,a=e.isSame;if('edit'===t)L.go('setting.account.signature');else if(!a){var i=+(/sign-(.*)/.exec(t)||[])[1],n=i?Ee[i]:{content:''};n&&(la(n),Pe=n)}}function Lt(e){var t=De.$('ul.j-'+(e?'html':'text')+'-menu a[data-type=signature]'),a=Pe.content?null!=Pe.id&&'sign-'+Pe.id:'none';t.dropdown('clear'),a&&t.find('li[value="'+a+'"]').dropdown('check')}function At(e,t){if((e=!!e)===d.designMode)Lt(e);else{if(!e)return $.resolve(d.isEmpty()&&!t||u(t||D('common/editor_html_source'))).then((function(e){if(e)return a(),t=De.$('input[data-type=queryreadstatus]'),Fe.enableQueryReadStatus&&t.prop('checked')&&t.trigger('click'),d.blur(),e;var t}));a()}function a(){var t=d.html(),a=ve(t,!e);he(Pe,!e)!==a&&(Pe={id:Pe.id,isHtml:!e,content:a});var i=(e?x:C)(la());d.clickToolbar('source'),d.html(i),Ue.isHtml=e,la(Pe),Lt(e),De.$('.j-html-menu,.j-text-menu').toggle(),Rt(e),oa(e)}return $.resolve(!0)}De.$().mousemove((function(e){De.$('input[role=contact]').tagEditor('getTags').forEach((function(t){t.editor.trigger('containerMouseMove',[e,De.$()])}))})).on('tagMouseDragged',(function(e,t,a){var i=a.clientY-vt;(i<0&&t.offset().top<Je.offset().top||i>0&&t.offset().top+t.height()>ue.height())&&Je.scrollTop(Je.scrollTop()+i),vt=a.clientY}));var zt=function(e,t){var a=[[{name:D('mail/cancel_signature'),value:'none','default':!Pe.content}],e,t||b?[]:[{name:D('mail/edit_signature'),value:'edit',type:''}]];De.$('a[data-type=signature]').dropdown('destroy').dropdown({type:'radio',maxWidth:400,data:a,callback:Pt})};function Nt(e){d.html(e),Ue.content=d.html(),d.sync()}function Ut(e){De.$().toggleClass('z-expand',e=!!e).parents().toggleClass('u-fullscreen',e),De.$('[data-type=expand]').html('<i class="iconfont '+(e?'iconnarrow':'iconenlarge')+'" />'),e||Ot()}function Ot(){De.$('.u-select').each((function(t,a){return e(a).data().self.syncModel()}))}function Ht(t){var a=Ue.scheduleDate?n(Ue.scheduleDate).toDate():new Date((new Date).getTime()+864e5),i=Ue.scheduleTimeZone,s=Ie.find('.bt-cnt .j-tb-timesend'),o=t.is(':checked');if(!ha(ra))return!1;De.$('.j-tbl-send').text(D(o?'compose/lbt_compose_timesend_set':'compose/lbt_send')),s.toggleClass('f-dn',!o);var l={scheduleDate:D('mail/timesend_desc_short',{sched:n(a).format('lll')}),scheduleDateSelect:_e(a)},r=i||Fe.supportTimeZone;r&&R.assign(l,{supportTimeZone:!0,timeZoneId:i||L.getConfig('setting.timezoneid'),scheduleDate:''}),s.html(te(l)),s.off('change','select').on('change','select',(function(){Yt(a,e(this).data('type'),e(this).val());var t,i={sched:n(a).format('lll')},s=$.resolve();if(r){var o=De.$('select[name=target_time_zone]').val(),l=Fe.timeZoneId;i.tz=Fe.timeZoneValues[l].split(' ')[1],l!==o?s=L.convertTime({value:n(a).format('YYYY-MM-DD HH:mm:ss'),timezone:o,output:l}).then((function(e){t=D('mail/timesend_desc_long',R.assign(i,{ttz:Fe.timeZoneValues[o].split(' ')[1],tsched:i.sched,sched:n(e).format('lll')}))})):t=D('mail/timesend_desc_partial',i)}s.either((function(){De.$('.j-timesend-desc').html(t||D('mail/timesend_desc_short',i)),De.$('.j-time-select').html(_e(a))}))})),r&&s.find('select[name=target_time_zone]').trigger('change'),o&&setTimeout((function(){Je.scrollTo(Ie)}),0)}function qt(t){var a,i=Ie.find('[data-type="savesent"]'),n=Ie.find('.bt-cnt .mailcipher'),s=t.is(':checked');if(!ha(ca))return!1;n.toggleClass('f-dn',!s),s&&(n.hasClass('rendered')||(ke(n.html(ae(Re)).addClass('rendered')),a=e('#bt-mailcipher-savePassword',n),i[0]?a.click((function(){ha(fa)})):a.parent().remove())),s&&setTimeout((function(){Je.scrollTo(Ie)}))}function Wt(e,t){var a='<div>'+D('mail/msg_signed_tip')+'</div><div><input type="password" size="40" autocomplete="off" tabindex="1"></div>';ha(ua),e.is(':checked')&&Fe.openSMIMEKeyPass&&'smimeSign'===t&&f(a,(function(e){return $.wmCall('user:authenticateSmimeKeyPass',{smimeKeyPass:e}).onFail((function(){p(D('pref/smime_pwd_err'))})).ignoreCode('FA_UNAUTHORIZED')})).then((function(t){t||Ce(e)}))}function Gt(e){e.prop('checked')&&!d.designMode&&At(1)}function Bt(t){var a,i=new Date((new Date).getTime()+864e5),n=Ie.find('.bt-cnt .j-tb-autodel'),s=t.is(':checked');(s?At(0):$.resolve(!0)).then((function(o){o&&ha(da)?(De.$('.j-attachment-menu').toggleClass('attach-disabled',s),n.toggleClass('f-dn',!s),De.$('.j-text-menu').find('[data-type=html]').toggle(!s),s&&(a=ie({autoDelDateSelect:_e(i,['year','month','day'])}),n.html(a),n.off('change','select').on('change','select',(function(){Yt(i,e(this).data('type'),e(this).val()),De.$('.j-autodel-time-select').html(_e(i,['year','month','day']))})),setTimeout((function(){Je.scrollTo(Ie)})))):Ce(t)}))}function Yt(e,t,a){switch(t){case'year':e.setFullYear(a);break;case'month':e.setMonth(a-1);break;case'day':e.setDate(a);break;case'hour':e.setHours(a);break;case'minute':e.setMinutes(a)}}function Vt(){ha(ma)}function Kt(t,a){var i,n=pa,s=De.$('a[data-type=onercpt]'),o='useCAEncrypt'===a?Oe.useCASign:Oe.useCAEncrypt;if(0===e('[role=CAcomposePlugin]').length&&e('body').append(pe()),t.is(':checked')){if(!ha(n))return!1;if(!X&&(i=e('[role=CAcomposePlugin]').find('object')[1],(X=new B(i)).invaild))return X=null,Ce(t),void ha(n);if(o)return void(Oe[a]=!0);At(0,g.allFiles()[0]&&D('mail/msg_switch_to_cacompose')).then((function(i){i?(De.$('.j-text-menu').find('[data-type=html]').hide(),De.$('.j-attachItem').hide(),tt.empty(),Oe[a]=!0,T.off().click((function(){He=X.dealWithAddResult(He,Fe.smimeUploadAttachSizeLimit),Xt()})),De.$('[data-type=attach]').hide(),De.$('.j-attachLimit').html(w(D('compose/lbt_limit'),k(Fe.smimeUploadAttachSizeLimit))),De.$('.j-attachItem').on('click','.j-delete-caattach',(function(t){R.stop(t,0);var a=e(t.target).data('index');He.splice(a,1),Xt()})),s.hasClass('z-active')&&s.click(),s.hide()):(Ce(t),ha(n))}))}else{if(Oe[a]=!1,o)return;$.resolve(!He[0]||u(D('mail/ca_attachment_lost_notify'))).then((function(e){e?(ha(n),At(1),De.$('[data-type=attach]').show(),He=[],it(),De.$('.j-text-menu [data-type=html]').show(),De.$('.u-fileupload').remove(),s.show()):(Oe[a]=!0,xe(t),ha(n))}))}}function Xt(){tt.html(de({items:He})),De.$('.j-attachItem').toggle(!!He[0])}function Qt(e){var t,a,i,n,s,o,l=Ie.find('input[data-type=autodel]'),r=Ie.find('.bt-cnt .j-tb-autodel');return l.length<0||!l.is(':checked')||(n=+r.find('.j-read-limit').val(),/^(0?[1-9]|[1-9][0-9])/.test(n)?g.allFiles()[0]?(e||p(D('mail/msg_autodel_attachment_unsuppoerted'),(function(){r.find('.j-read-limit').focus()})),!1):(t=r.find('select[data-type=year]').val(),a=r.find('select[data-type=month]').val(),i=r.find('select[data-type=day]').val(),s=new Date(+t,+a-1,+i,23,59,59),o=new Date,!(s.getTime()<o.getTime())||(e||p(D('mail/msg_autodel_limit_wronttime')),!1)):(e||p(D('mail/msg_autodel_limit_require')),!1))}function Zt(){ea(),gt()}function Jt(){Xe.find('.u-btn[data-type!=aside]').each((function(){var t=e(this);if(g.activeFiles()&&'send'===t.data('type'))return t.removeClass('disabled'),!0;t.addClass('disabled')})).end().addClass('disabled')}function ea(){if(g&&g.activeFiles())return!1;Xe.find('.u-btn[data-type!=aside]').each((function(){e(this).removeClass('disabled')})).end().removeClass('disabled')}function ta(){N.flush(),Oe.refreshedFolder=!0}function aa(){var t={};return De.$('.j-form-tt input[role=contact]').each((function(a,i){var n=(i=e(i)).attr('name'),s=i.data('xTags');t[n]=s.map((function(e){var t=y.of(e.tag),a=Fe.enableSecurityLevel&&S.levelOf(e.prefix);return R.assign({name:t.trueName,addr:t.address},a&&{securityLevel:a,isOab:!0})}))})),t}function ia(e){Fe.supportPab&&e?(De.$('#mptree').children(':not(".j-recent")').addClass('f-dn'),De.$('#searchResultContainer').removeClass('f-dn'),U.matchPabContacts(e).then((function(e){var t=e.map(oe).join('');De.$('#searchResultContainer ul').html(t)}))):(De.$('#mptree').children().removeClass('f-dn'),De.$('#searchResultContainer').addClass('f-dn'))}function na(){Ze.find('.template-list')[0]||new q({editor:d,container:De.$('div.j-template-box'),pagination:De.$('.j-template-pagination'),parent:De}).render()}function sa(){Ze.find('.j-stationery-box')[0]||new H({editor:d,prefixCls:'stationery-content',container:Ze,pagination:De.$('.j-stationery-pagination')}).render()}function oa(e){De.$('.stationery-wrapper').toggleClass('disabled',!e).find('.stationery-thumb').removeClass(e?'':'stationery-selected')}De.replaceCurrentSign=function(){Pe.content&&la(Pe)};var la=function(t){return d.html(function(t,a,i,n){if(t=me(t),i=function(e,t){var a=he(e,t);return a&&(t?'<span id=spnEditorSign><hr class="signature-separator" align="left" style="margin:0.5em 0;width:10em;height:1px;background-color:#999;border:none;"/>'+a+'</span>':'------------------------------\n'+a)}(i,n),n){var s=be(t);if(s.replaceWith(i)[0])t=s.end().html();else if(i){var o=e('<div>').html(t.replace(/(<br\s*\/?>\s*)*$/i,'<br><br><br>'));_('setting.signatureRelated')&&o.find('.ReferenceQuote:first').before(i)[0]||e(o.find('td#tdRidBody')[0]||o).append(i),t=o.html()}}else t=t.replace(RegExp('\n{1,3}-{2,30}\n'+(l=he(a,n),R.escapeRegExp(l).replace(/\r?\n/g,'\\r?\\n')+'\\s*$')),''),i&&(t=t.replace(/\s*$/,'\n\n\n')+i);var l;return t}(d.html(),Pe,t,Ue.isHtml)).html()},ra=['timesend'],ca=['mailcipher'],da=['autodel'],pa=['[data-type^=useCA]'],ua=['[data-category=xSM9]'],fa=['savePassword'],ma=['savesent',[[da,D('mail/msg_autodel_save_local')],[fa]]];function ha(e){var t=[ra,ca,da,pa,ua],a=[ma],i=function(e){var t=e[0];return Ie.find('['===t[0]?t:'[data-type='+t+']')},n=i(e).is(':checked');if(n)a.forEach((function(t){t!==e&&(t[1]||[]).map(R.prop(0)).includes(e)&&xe(i(t))}));else if((e[1]||[]).some((function(t){var a=t[0],n=t[1];if(i(a).is(':checked')){if(n)return p(n,xe.bind(0,i(e))),!0;Ce(i(a))}})))return!1;return t.includes(e)&&t.forEach((function(t){t!==e&&(n?je:Te)(i(t))})),!0}function va(){var t=Ue,a=_a(!0),i=function(e){return[y.parseAddress(e.account),e.to||[],e.cc||[],e.bcc||[],e.content,e.priority||1,e.requestReadReceipt||!1,e.saveSentCopy||1===L.getUser().save_sent,e.smimeSign||!1,e.smimeEncrypt||L.getConfig('mail.encryptedcheckeddefault')]};return(!s(i(a),i(t))||a.subject!==t._subject||function(t,a){a=a||[];var i=0,n=0,s=0,o=0,l=0,r=0;if(t.length!==a.length)return!0;return e.each(t,(function(e,t){switch(t.type){case'upload':i++;break;case'trs':n++;break;case'netfolder':s++;break;case'internal':o++}})),e.each(a,(function(e,t){'upload'===t.type&&l++,'trs'===t.type&&r++})),i!==l||n!==r||o>0||s>0}(a.attachments,t.attachments))&&a}var ga=function(e,t){return De.$(e).tagEditor(R.assign({enableSecurityLevel:Fe.enableSecurityLevel,tagTipSetup:function(e,t){var a=Me.find((function(t){return e.is(t.get('trigger'))})),i=y.strict(t);return i&&!a&&(a=new K({trigger:e,parent:De,email:i,noFooter:!0}),Me.push(a)),a},onChange:bt},t))};function ba(){var e={};e.account=Oe.composeInfo.account;var t=Qe.find('.j-accounts');t[0]&&(e.account=t.val());var a=e._contacts=[],i=[];return['to','cc','bcc'].forEach((function(t){var n=De.$('input[name='+t+']'),s=[];if(!n.closest('.u-form-item').hasClass('f-dn')){var o=n.data('xTags'),l=n.val(),r=o?o.map((function(e){return R.assign(y.of(e.tag),{securityLevel:e.prefix})})):l?y.parse(l):[];s=r.map((function(e){return e.trueName?''+e:e.address})),r.forEach((function(e){i.includes(e.address)||(i.push(e.address),a.push({name:e.trueName,addr:e.address,securityLevel:e.securityLevel||''}))}))}e[t]=s})),Oe.composeInfo._contacts=a,e}function _a(t){var a=ba();if(a.showOneRcpt=Qe.find('a[data-type=onercpt]').hasClass('z-active'),Qe.find('input[data-type=urgent]').is(':checked')&&(a.priority=1),a.smimeSign=!1,a.smimeEncrypt=!1,a.smimeEnvelopId='',Fe.supportSMIME&&(Qe.find('input[data-type=smimeSign]').is(':checked')&&(a.smimeSign=!0),Qe.find('input[data-type=smimeEncrypt]').is(':checked')&&(a.smimeEncrypt=!0)),a.saveSentCopy=Qe.find('input[data-type=savesent]').is(':checked'),a.requestReadReceipt=Qe.find('input[data-type=rrr]').is(':checked'),a.scheduleDate=null,Qe.find('input[data-type=timesend]').is(':checked')){var i=Qe.find('.timesend select[data-type=year]').val(),s=Qe.find('.timesend select[data-type=month]').val(),o=Qe.find('.timesend select[data-type=day]').val(),l=Qe.find('.timesend select[data-type=hour]').val(),r=Qe.find('.timesend select[data-type=minute]').val();a.scheduleTimeZone=Qe.find('.timesend select[name=target_time_zone]').val(),a.scheduleDate=n(new Date(+i,+s-1,+o,+l,+r)).format('YYYY-MM-DD HH:mm:ss')}if(Qe.find('input[data-type=autodel]').is(':checked')){var c=Qe.find('.autodel select[data-type=year]').val(),p=Qe.find('.autodel select[data-type=month]').val(),u=Qe.find('.autodel select[data-type=day]').val(),f=Qe.find('.autodel .j-read-limit').val();a.autoDel={expiryDate:new Date(+c,+p-1,+u,23,59,59),readLimit:+f}}if(a.encryptPassword='',Qe.find('input[data-type=mailcipher]').is(':checked')&&(a.encryptPassword=e('#bt-mailcipher-password',Qe).val(),a.savePassword=e('#bt-mailcipher-savePassword',Qe).is(':checked')),0!==Qe.find('.j-securityLevel').length&&(a.ctrls={'CM-SECURITY':Qe.find('.j-securityLevel').val()}),a.forbidDownload=Qe.find('input[data-type=forbidDownload]').is(':checked'),Qe.find('input[data-type=sendMailWithSms]').is(':checked')&&!e.isEmptyObject(Oe.sendMailWithSms)){var m=[];e.each(Oe.sendMailWithSms,(function(e,t){m.push([e,t].join('='))})),a.sendMailWithSms='true',a.smsAddrs=m.join(',')}return a.subject=Qe.find('input[name=subject]').val(),a.isHtml=Oe.composeInfo.isHtml,a.content=d.html()||De.$('.editor').val(),Oe.varList&&(a.varList=Oe.varList,a.varKeyForRcpt=Oe.varListRcptsName,a.showOneRcpt=!0),a.isHtml&&!t&&(a.content=ge(a.content).html(),Fe.enableQueryReadStatus&&Qe.find('input[data-type=queryreadstatus]').prop('checked')&&(a.content+='<div class="read_status_hook" style="background:url(\'$tracelink$\');"></div>',a.queryReadStatus=!0)),a.attachments=g.composeFiles().toCompose(),a}}));var me=function(e){return e.replace(/[\u2028\u2029]/g,'').replace(/\r\n/g,'\n')};var he=function(e,t){var a=void 0===e?{}:e,i=a.content,n=void 0===i?'':i,s=a.isHtml;return me(t?(s?n:x(n)).trim():s?C(n):n)},ve=function(e,t){return t?(be(e).find('.signature-separator').remove().end().html()||'').trim():R.last(me(e).split(/\n-{2,30}\n/).slice(1))||''},ge=function(t){return e('<div>').html(t).find('#spnEditorSign').removeAttr('id').addClass('spnEditorSign').end()},be=function(e){return ge(e).find('.spnEditorSign:not(blockquote .spnEditorSign)')};function _e(t,a){var i=t.getFullYear(),n=t.getMonth()+1,s=t.getDate(),o=t.getHours(),l=t.getMinutes(),r=a||['year','month','day','hour','minute'],c=e(document.createDocumentFragment());return e.each(r,(function(t,a){var r=e('<select data-type="'+a+'"'+('hour'===a||'minute'===a?' class="sel sel-small"/>':'year'===a?' class="sel sel-first"/>':' class="sel"/>')),d=e('<label>',{text:D('compose/lb_timesend_'+a)});function p(t,a,i){for(var n=t;n<=a;n++)r.append(e('<option/>',{value:n,text:n,selected:n===i}))}switch(a){case'year':var u=(new Date).getFullYear();p(u,u+2,i);break;case'month':p(1,12,n);break;case'day':p(1,new Date(i,n,0).getDate(),s);break;case'hour':p(0,23,o);break;case'minute':p(0,59,l)}c.append(r),c.append(d)})),e('<p/>').append(c).html()}function ye(t,a,i){var n,s,o,l=(t||{}).code||'',r='mail/'+l,c=D(r),d=!0;if('FA_OVERFLOW'===l)n=t.overflowReason,c=D(r='mail/'+l+'.'+n);else if('FA_MTA_RCPT_ERROR'===l){for(var p in t.errorRcpts){s=p,o=t.errorRcpts[p];break}switch(o){case'MTA5101':case'MTA5102':case'MTA5103':case'MTA5104':case'MTA5105':case'MTA5106':case'MTA5107':c=D('mail/'+l+'.'+o),'MTA5104'!==o&&'MTA5105'!==o&&'MTA5106'!==o&&'MTA5107'!==o||(c=c.replace('{0}',s));break;default:c=D('mail/FA_MTA_RCPT_ERROR.MTA_OTHER').replace('{0}',s)}}else if('FA_NEED_VERIFY_CODE'===l)d=!1,new V({callback:i}).render();else if('FA_MTA_REJECTED_BY_KEYWORD'===l){var u=(/rulename: (.*)/.exec(t.mtaMessage)||[])[1];u&&(c=w(D('mail/FA_MTA_REJECTED_BY_KEYWORD.rulename'),u))}d&&(c!==r?e.notify.error(c):a&&e.notify.error(a))}var we=a(489),ke=we['default'],Te=we.rcEnable,xe=we.rcCheck,Ce=we.rcUncheck,je=we.rcOff;function Se(e,t){var a=e.find('.bt-hd-more-show'),i=e.find('.bt-hd-more-hide');function n(t){var n=a.height(),s=e.find('.bt-hd').height();i.toggle(s>n&&!!t),a.toggle(s>n&&!t),e.find('.bt-hd-wrap').css('height',t?s:n)}t?(a.click(n.bind(0,1)),i.click(n.bind(0,0)),n()):n(i.is(':visible'))}function $e(e,t){return e[M(t,[[/forwardd/i,'enableForwardd'],[/reply.*/i,'enableReply'],[/forward.*/i,'enableForward']],'enableCompose')]}r.module({name:'mail.compose',template:'<div class=m-mlcompose>'},fe)}).call(this,a(463))},856:function(e,t,a){(function(t,i,n){a(857),a(858);var s=a(463),o=a(526),l=a(640),r=l.menuTpl,c=l.progressTpl,d=l.uploadTpl,p=a(488).bytesToSize,u=a(473),f=a(513).basename,m=a(539),h=a(468).get,v=a(521),g=v.xnfTokens,b=v.xnfPreferAttachURL,_=a(481).IE,y=a(868),w=a(582).select,k=a(641);s.widget('cm.attachupload',s.cm.fileupload,{options:{enableDnd:!0},_create:function(){var e=this,a=e.options,v=e.element.html(s('<input type=file multiple tabindex=-1/>').click((function(t,a){e._customForceComposeToTrs=a&&!0===a.forceToTrs}))),T=v.closest('.main'),x=a.$wrapper.html(l()),C=x.children(':first'),j=T.find('.j-attachItem').hide(),S=x.find('.j-attach-summary'),$=S.find('.j-attach-toggle').click(t.stop(W)),D=x.find('.j-attach-tips');D.find('.j-close').click(t.stop((function(){D.slideUp(),e._trigger('resize')})));var E=T.find('.j-securityLevel'),M=h('file.ispermittrs'),I=M&&h('user.enableAutoToTrs');e._checkComposeAutoToTrs=function(e){return'compose'===e.uploadType&&I};C.on('click','.j-continue',(function(a){t.stop(a,0);var i=s(this).closest('.j-fileupload').data('data');i.context.find('.j-btns').html(U('pause')),e.startUpload(a,i)})).on('click','.j-pause',(function(a){t.stop(a,0);var i=s(this).closest('.j-fileupload').data('data');i.context.find('.j-btns').html([U('continue'),U('delete')]),e.cancelUpload(a,i)})).on('click','.j-delete',(function(a){t.stop(a,0);var i=s(this).closest('.j-fileupload').data('data');e.deleteUpload(a,i)}));var F=M&&(e._valid()||s.support.xhrFileUpload)?h('user.trsMaxFileSize'):0,R=h('user.maxAttachmentSize'),P=p(Math.max(F,R),2);function L(e,t,a,i){var n=Math.floor(t/a*100)+'%';e.find('.j-info,.j-pgr').replaceWith(c({width:n,text:i||n}))}function A(e,t,a){null!=t&&null!=a&&e.find('.j-size').text(t>=a?p(t,2):p(t,2)+' / '+p(a,2)).show()}function z(t){var n,o,l;t.context=(n=t.files,o=!e._valid()&&!e._isXHRUpload(a),l=n[0].cmMeta,!l.securityLevel&&E[0]&&(l.securityLevel=E.val()),s(d({icon:'iconacc',name:l.displayName(),info:i('common/upload_prepare'),size:!o&&l.dsize,loaded:!o&&0,total:!o&&p(l.dsize||0,2)}))).data('data',t).addClass('j-fileupload'),t.context.find('.j-btns').append(U('pause')),C.append(t.context)}var N,U=function(e,a){return s('<a>',{'class':'link j-'+e,target:'preview'===e?'_blank':'',text:i('common/'+e),href:(t.isSTR(a)?a:'')||'javascript:void(0);',click:t.isFUN(a)?a:t.noop})},O=e.uiFileNewHandle=function(e,t){var a=t.files[0];a.inlined||a.cmMeta.deleted?t.context=s():(z(t),'trs'===a.cmMeta.type&&H(t),W(!0),'new'===e&&(N&&clearTimeout(N),N=setTimeout((function(){C.animate({scrollTop:C[0].scrollHeight-C.height()})}),400)))};e.uiFileDestroy=function(e,t){null!=e?e.context.remove():t&&t.file&&C.find('.j-fileupload').each((function(){if(s(this).data('data').files[0]===t.file)return s(this).remove(),!1})),W(!0),'trs'===e.uploadType&&q()},e.uiUploadIframe=function(e){L(e.context,1,1,i('common/upload_uploading'))},e.uiUploadProcessing=function(e){e.context.addClass('processing')},e.uiUploadProcessed=function(e){e.context.removeClass('processing')},e.uiUploadPreparing=function(e,t){t=s.isPlainObject(t)?t:{};var a=e.context.find('.j-preparing'),n=t.percentage,o=null==t.total?e.total:t.total,l=t.composeToTrs?i('common/upload_plugin_state_prepare_trs'):i('common/upload_plugin_state_prepare');a.removeClass('f-dn').text(u(l,n)),100===n&&setTimeout((function(){a.addClass('f-dn'),a.text('')}),20),A(e.context,0,o)},e.uiUploadProgress=function(e,t){var a=null==(t=s.isPlainObject(t)?t:{}).loaded?e.loaded:t.loaded,i=null==t.total?e.total:t.total;L(e.context,a,i),A(e.context,a,i)};var H=e.uiUploadToTrs=function(e){var t=e.context,a=t.find('.j-trs-expire');t.addClass('u-fileupload-trs'),a.removeClass('f-dn').text(' ('+i('file/msg_trs_file_alive',{count:h('file.trsfileexpiry')})+')')};function q(){var a=t.mapFilter(C.find('.u-fileupload-trs'),(function(e){var t=s(e).data().data.files[0];return t.composeToTrs&&t.cmMeta.basename}));D.find('.j-cnt').html(a[0]?i('mail/compose_attach_auto_to_trs',{limit:R,names:a.slice(0,2).join(', '),num:a.length,alive:h('file.trsfileexpiry')}):''),a[0]?D.slideDown():D.slideUp(),e._trigger('resize')}function W(a){var n=C.find('.j-fileupload'),s=n.length,o=e.fails(),l=t.sumBy(e.notInlinedFiles(),(function(e){return e.size||e.actualSize})),r=S.find('.j-attach-expand-desc'),c=S.find('.j-attach-expand');S.toggle(!!s).find('.j-attach-info').html(i('mail/compose_attach_more',{total:s,size:p(l,2),failed:o>0?i('mail/compose_attach_more_failed',{fail:o}):''})),c.toggle(s>4),s>4?(r.html(i('mail/compose_attach_expand_desc',{all:s-4})),null!=a&&(a.type&&(a=!r.is(':hidden')),a?n.filter(':hidden').slideDown():n.filter(':gt(3)').slideUp(),r.toggle(!a),$.html(i(a?'mail/compose_attach_hide':'mail/compose_attach_expand')))):n.filter(':hidden').slideDown(),j[s?'slideDown':'slideUp'](),e._trigger('resize')}e.uiUploadDone=function(t){var a,i=t.files[0];t.context.addClass('u-fileupload-success').find('.j-info,.j-pgr').replaceWith('<div class="info j-info">'+(a||'<i class="iconfont iconchoose"></i>')+'</div>'),A(t.context,i.cmMeta.size,i.cmMeta.size),t.context.find('.j-btns').data('file',t.files[0]).find('.j-pause').remove().end().append(U('delete')).append(function(t){var a=e._generateDownloadUrl(t);return a&&U('download',a)}(t)).append(function(t){var a=t.files[0],i=m.checkFile(a.name,a.cmMeta.size);if(i.permitted){var n='IMG'===i.type?function(){var t=e.notInlinedFiles().filter((function(e){return e.completed&&'IMG'===m.checkFile(e.cmMeta.name).type}));return o(t.map((function(e){return{src:e.downloadUrl,alt:e.name}})),t.indexOf(a)),!1}:e._generatePreviewUrl(t);return n&&U('preview',n)}}(t)).append(function(e){return E[0]&&!e.files[0].cmMeta.lockSecurityLevel?U('editSecurityLevel'):''}(t)),W(),'trs'===t.uploadType&&q()},e.uiUploadFail=function(e){var t,a;t=e.context,a=e.files[0].error,L(t,1,1,a),t.addClass('u-fileupload-error').find('.j-pgr').addClass('u-progress-error').find('.u-progress-bar').end().end().find('.j-btns').html(U('delete')),W()};var G=[0,n.resolve()];function B(){(e._valid()?v:v.find(':file').focus()).trigger('click',{forceToTrs:!0})}e.mergeFiles=function(a,s){var o=!1!==s?'new':'restore';function l(a){var s,l=a.cmMeta=k.initFileInstance(a.type,a),r=(s=a,e.mFiles(t.not(['cmMeta.type','trs'])).add(s).size()>R);return r&&(a.error=i('mail/FA_OVERFLOW.pref_smtp_max_send_mail_size')),'netfolder'===l.type&&r&&I?n.wmCall({func:'nf:copyFileToTrs',uid:l.enfUid||''},{id:l.mid}).fin(c):c();function c(t,i){t&&(a={name:l.name,size:l.size,contentType:l.contentType,type:'trs',composeToTrs:!0,cmMeta:l.migrateToTrs(i[l.mid])}),e._addUploadFiles(a),i={_widgetName:e.widgetFullName||e.widgetName,files:[a]},e._initUploadMeta(i,t?'trs':'compose'),O(o,i),e._trigger(r&&!t?'fail':'done',null,i)}}G[0]++||e._trigger('mergestart'),t.array(a).forEach((function(e){G[1]=G[1].fin(e).then(l)})),G[1]=G[1].fin((function(){--G[0]||e._trigger('mergestop')}))},e.allFiles=function(){return e._uploadFiles.slice()},e._super(),v.append('<i class="iconfont iconacc"></i>'+i('compose/lbt_addAttach')+' <span class="j-attachLimit">'+u(i('compose/lbt_limit'),P)+'</span>').after((Y={acc:h('file.ispermitattmgr'),pnf:h('file.ispermitnf'),enf:h('file.ispermitenf'),trs:M},(V=t.filter([t.some(Y)&&{name:i('mail/compose_attach_add_from_filecenter'),icon:'iconfiler',cb:function(){y((function(t){t&&t[0]&&e.mergeFiles(t)}),Y,'pnf')}},g[0]&&{name:u(i('mail/compose_attach_add_from_external_nf'),g[0].name),icon:'iconfiler',cb:function(){var o=a.editor();if(o.designMode){var l=a.composeId;w((function(a,r,c){n.all([r[0]?n.wmCall({url:'/XT5/jsp/file.jsp',func:'xnf:attachToCompose',token:a,ids:r,composeId:l}).then((function(a){var i=a.attachments,n=a.urlArray;return i[0]&&e.mergeFiles(i),t.flatten(n.map(t.prop('url')))})):[],c[0]?n.wmCall('xnf:getShareableUrl',{token:a,id:c}):[]]).then((function(e){(e=t.flatten(e))[0]&&(b||s.notify.warning(i('mail/tips_xnf_url')),o.appendHtml(s('<p>').html(e.map((function(e){return s('<div>').append(s('<a>',{target:'_blank',href:e,text:f(e)}))}))).html()))}))}))}else s.notify.error(i('file/msg_xnfbox_fail_editor_plaintext'))}},(e._valid()||s.support.xhrFileUpload)&&M&&{name:i('compose/lbt_uploadattach_trs'),icon:'iconyin',cb:B},_&&h('mail.supportVoiceMail')&&{name:i('compose/lbt_addattach_voice'),icon:'iconmusic',cb:e.video.bind(e,'audio')},_&&h('mail.supportVideoMail')&&{name:i('compose/lbt_addattach_video'),icon:'iconvideo',cb:e.video.bind(e,'video')}]))[0]&&s(r()).dropdown({data:V,callback:function(e){e.cb(e)}}))),function(){var n,o=T.find('.j-form-dnd').hide(),l=o.find('.j-dnd-info').html(u(i('mail/compose_dnd'),P));o.find('.j-dnd-close').click((function(){o.hide()}));var r=function(e,t,i){return function(s){return!!(a.enableDnd&&h('mail.enableDnDUpload')&&T.is(':visible'))&&(clearTimeout(n),n=setTimeout((function(){o.toggle(e)}),i||0),t&&t(s))}};e._ON({'dragenter dragover':r(!0),dragleave:r(!1,t.stop(0),300),drop:r(!1,(function(e){var t=e.originalEvent.delegatedEvent.target;return!!o.has(t)[0]})),plugindragenter:r(!0,(function(){l.html(u(i('mail/compose_dnd_ie'),P))})),'plugindragleave plugindrop':r()}),(e.setDropZone=function(){e.option('dropZone',s('body').add(s('iframe').contents().find('body')))})()}();var Y,V}}),e.exports=function(e,t){return e.attachupload(t).attachupload('instance')}}).call(this,a(464),a(465),a(466))},858:function(e,t,a){(function(e){a(859);var t=a(463),i=a(464),n=a(490),s=n.addUrlParams,o=n.removeUrlParam,l=a(466),r=a(641),c=a(533).wm;function d(e,t,a,n,s){var r=e.options.composeId,c=a.cmMeta;if(n&&a.inlined)return p(c,r,{rd:+new Date});switch(c.type){case'trs':case'netfolder':return l.wmURL(i.assign({uid:c.enfUid||''},s?{fileId:c.mid}:{func:'nf:getFileData',mid:c.mid},{},t));case'internal':case'upload':return o(p(c,r,t),s?'func':'')}}function p(e,t,a){return l.wmURL(i.assign(e.mid?{func:'mbox:getMessageData',mid:e.mid,part:e.part}:{func:'mbox:getComposeData',composeId:t,attachId:e.id},a))}function u(e,t){e._uploadFiles=i.difference(e._uploadFiles,t)}function f(){var e=m([i.not('error'),i.not('processFail')].concat(i.array(arguments))),t=this._uploadFiles.filter(e);return t.add=function(a){return e(a)&&t.push(a),t},t.size=i.fn(i.sumBy,t,'cmMeta.size'),t.toCompose=function(){return i.mapFilter(t,(function(e){var t=e.cmMeta.exportToCompose();return['upload','internal','trs','netfolder'].includes(t.type)&&t}))},t}t.widget('cm.fileupload',t.cm.fileupload,{options:{maxChunkSize:2097152,forceIframeTransport:!1,singleFileUploads:!0,sequentialUploads:!0,dataType:'text',formData:{},uploadUrl:'XT5/jsp/upload.jsp?func=directData',messages:{uploadedBytes:e('mail/compose_attach_error_exceed_file_size')},add:function(a,i){if(a&&a.isDefaultPrevented())return!1;var n=t(this).data(i._widgetName),s=n.options,o=i.files;return!(!o||!o.length)&&(!!function(){var a,o,l,c=i.files;return n._initUploadMeta(i,n._customForceComposeToTrs&&'trs'),!1!==n._trigger('addstart',null,i)&&(c.forEach((function(e){e.cmMeta=r.initFileInstance(i.uploadType,e)})),('compose'!==i.uploadType||!function(a,i){var n=new Set(a.notInlinedFiles().map((function(e){return e.cmMeta.name})));if(i.map((function(e){return e.cmMeta.name})).some((function(e){return n.has(e)||void n.add(e)})))return setTimeout((function(){t.notify.error(e('mail/lbl_attachment_add_repeated'))}),50),!0}(n,c))&&(a=c.length,o=!0,(l=s._fileAddedCount||[0,0])[0]+=a,!0===o&&(l[1]+=a),!(l[0]>=i.originalFiles.length)||(l[1]<=0&&n._trigger('stop'),s._fileAddedCount=[0,0]),c.forEach((function(){n.uiFileNewHandle('new',i)})),c.length>0))}()&&(i.disablePrepare=!0===i.usePlugin,n._addUploadFiles(o),void i.process((function(){return n.process(i)})).done((function(){n.uiUploadProgress(i,{loaded:0,total:1}),!1!==n._trigger('added',a,i)&&(s.autoUpload||i.autoUpload)&&!1!==i.autoUpload&&i.submit()}))))},process:function(e,a){t(this).data(a._widgetName).uiUploadProcessing(a)},processfail:function(e,a){var i=t(this).data(a._widgetName),n=a.files[a.index],s=n.error,o=n.errorThrown;if(s&&'overflow'===o&&i._checkComposeAutoToTrs(a)&&t.isFunction(a.composeToTrsAdd))return a.composeToTrsAdd();n.processFail=!0,i._trigger('fail',e,a)},processdone:function(e,t){t.files[t.index].processFail=!1},processalways:function(e,a){var i=t(this).data(a._widgetName),n=i.options;i.uiUploadProcessed(a),function(e,t){var s=n._fileProcessedCount||[0,0];s[0]+=e,!0!==t&&(s[1]+=e);!(s[0]>=a.originalFiles.lenth)||(s[1]<=0&&i._trigger('stop'),n._fileProcessedCount=[0,0])}(1,a.files[0].processFail)},submit:function(e,t){t.initSubmitUrl()},send:function(e,a){if(e.isDefaultPrevented())return!1;var i=t(this).data(a._widgetName);return a.context&&a.dataType&&'iframe'===a.dataType.substr(0,6)&&i.uiUploadIframe(a),i._trigger('sent',e,a)},progress:function(e,a){if(e.isDefaultPrevented())return!1;var i=t(this).data(a._widgetName),n=a.context&&a.context.data('data');n&&(n.uploadedBytes=a.loaded),i.uiUploadProgress(a)},chunksend:function(e,t){t.url=s(t.url,{offset:t.uploadedBytes||0})},done:function(e,a){if(e.isDefaultPrevented())return!1;var i=t(this).data(a._widgetName);i._generatePreviewUrl(a);var n=a.files[0];n.completed=!0,n.failed=!1,n.inlined||n.cmMeta.deleted||i.uiUploadDone(a),i._trigger('completed',e,a),i._trigger('finished',e,a)},fail:function(a,i){if(a.isDefaultPrevented())return!1;var n,s=t(this).data(i._widgetName),o=s.options;'abort'!==i.errorThrown?(n=i.files[0],s._valid()||o.forceIframeTransport||s._isXHRUpload(o)||s.requirePlugin(),n.error=n.error||i.errorThrown||e('common/upload_'+(!s._valid()&&i.jqXHR&&i.jqXHR.readyState<4?'plugin_error5':'unknown')),n.inlined||n.cmMeta.deleted||s.uiUploadFail(i)):(n=i.files[0]).error='abort',i.files[0].completed=!1,i.files[0].failed=!0,s._trigger('failed',a,i),s._trigger('finished',a,i)},beforedestroyed:function(e,a){var i=t(this).data(a._widgetName);a.files[0].cmMeta.setDeleted(!0),i.uiFileDestroy(a)},pluginprogress:function(e,a){var i=t(this).data(a._widgetName),n=a.files[0].size,s=Math.floor(n*a.uploadedPercent/100);i.uiUploadProgress(a,{loaded:s,total:n})},plugindone:function(e,a){var i=t(this).data(a._widgetName);i._generatePreviewUrl(a),i._trigger('done',e,a)},destroy:function(e,a){if(e.isDefaultPrevented())return!1;var i,n=t(this).data(a._widgetName),s=n.options,o=a.files[0];(i=o.cmMeta.id,a.error||null==i?l.resolve():(o.cmMeta.deleted=!0,c('mbox:compose',{id:s.composeId,attrs:{attachments:[{id:i,deleted:!0}]}}))).then((function(){if(!(a.error||r.isUploadOrInlinedType(o.cmMeta.type)||'compose'===s.uploadType&&(a.usePlugin?4===a.uploadedState&&5===a.uploadedState:a.uploadedBytes>=o.cmMeta.size)))return a.usePlugin?c('nf:deleteFiles',{ids:[o.cmMeta.mid]}):c('upload:deleteTasks',{composeId:a._cid||s.composeId,items:[o.cmMeta.name]})})).then((function(){u(n,o),n._trigger('beforedestroyed',e,a),n._trigger('destroyed',e,a)})).onFail((function(){n._trigger('destroyfailed',e,a)}))}},_onDrop:function(e){if(i.get(e,'originalEvent.dataTransfer.files.length'))return this._super(e),!1},startUpload:function(e,t){t.carryon()},cancelUpload:function(e,t){t.abort()},deleteUpload:function(e,a){a.error?(u(this,a.files),this._trigger('destroyed',e,a)):this._trigger('destroy',e,t.extend({type:'POST'},a))},_addConvenienceMethods:function(a,i){var n=this,s=this.options;function o(e){var t=i.files[0];t.inlined=!1,delete t.partId,t.cmMeta.setId(null),t.cmMeta.setMid(e.fileId),i.setResponse.apply(i,arguments),n._trigger('done',null,i)}function r(){var t=i.files[0];t.error=e('mail/compose_attach_error_movetonf'),t.errorThrown='moveToNFError',i.setResponse.apply(i,arguments),n._trigger('fail',null,this)}this._super(a,i),i.composeToTrsAdd=function(){var e=i.files[0];delete i.error,delete i.errorThrown,delete e.skipProcess,n._removeFileState(i),n.uiUploadToTrs(i),n._initUploadMeta(i,'trs'),e.cmMeta=e.cmMeta.migrateToTrs(),e.composeToTrs=!0,i.process(!1,(function(){return n.process(i)})).done((function(){n.uiUploadProgress(i,{loaded:0,total:1}),i.submit()}))},i.netfolderUploadDone=function(){var e=this._progress.total;'compose'!==this.uploadType?(this._progress.loaded<e&&n._onProgress(t.Event('progress',{lengthComputable:!0,loaded:e,total:e}),this),this.moveToNetFolder()):n._trigger('done',null,this)},i.moveToNetFolder=function(){var e=i.files[0];c('upload:moveToNetFolder',{composeId:i._cid,attachmentId:e.attachmentId}).then(o).onFail(r)},i.initSubmitUrl=function(){i.url=l.wmFullURL({url:n.options.uploadUrl,composeId:i._cid||s.composeId,attachmentId:i.files[0].cmMeta.id||-1,offset:t.support.xhrFileUpload&&!s.forceIframeTransport&&i.uploadedBytes||0})},i.carryon=function(){var e=i.files[0];n._removeFileState(i),this.uploadedBytes&&this.uploadedBytes>=e.cmMeta.size?n._trigger('done',null,this):this.submit&&this.submit()},i.setResponse=function(e,t,a){var n=i._response;n.result=i.result=e,n.textStatus=i.textStatus=a,n.jqXHR=i.jqXHR=t}},_create:function(){this._super(),this._resetUploadFiles()},_onAdd:function(e,t){var a=this;t._widgetName=a.widgetFullName||a.widgetName;var i=a._super;a.saveSession().then((function(){i.call(a,e,t)}))},saveSession:function(){var e=this;return c('mbox:compose',{id:e.options.composeId,attrs:{attachments:e.composeFiles().toCompose()},returnInfo:!0}).then((function(t){var a=t.attachments;e.lookupAttachId(a||[])}))},_onDone:function(a,n,s,o){var l,c=o._response;try{a=JSON.parse(a)}catch(u){}var d=void 0===a,p=d?{}:a['var'];if(l=o.files[0],!this._valid()&&!this._isXHRUpload(o)&&d&&'success'===n)return o.error=l.error=e('common/upload_unknown'),this.requirePlugin(),void this._trigger('fail',null,o);if(d||'S_OK'!==a.code){switch(c.result=o.result=a,c.textStatus=o.textStatus=n,c.jqXHR=o.jqXHR=s,a.code){case'FA_UPLOAD_SIZE_EXCEEDED':o.error=l.error=e('common/upload_overflow_size'),o.errorThrown=l.errorThrown='overflow'}this._trigger('fail',null,o)}else{if(delete p.size,t.extend(l,p),this._isXHRUpload(o)||(l.cmMeta=r.initFileInstance(o.uploadType,i.assign({},l.cmMeta,{},l,{id:p.attachmentId}))),'compose'!==o.uploadType)return o.setResponse(p,n,s),o.netfolderUploadDone();this._super(p,n,s,o)}},_resetUploadFiles:function(){this._uploadFiles=[]},_addUploadFiles:function(e){this._uploadFiles=this._uploadFiles.concat(e)},fails:function(){return i.filter(this._uploadFiles,(function(e){return e.error||!0===e.failed})).length},composeFiles:f,mFiles:i.fn(f,i.not('cmMeta.deleted')),notInlinedFiles:i.fn(f,i.not('cmMeta.deleted'),i.not('inlined')),activeFiles:function(){return(this._valid()?this._pluginActive:0)+this.active()},lookupAttachId:function(e){var t=i.mapFilter(this._uploadFiles,(function(e){return e.cmMeta.id})),a=e.filter((function(e){var a=e.id,i=e.deleted,n=void 0!==i&&i;return!t.includes(a)&&!n})),n=0;this.composeFiles().forEach((function(e){!e.cmMeta.id&&e.cmMeta.setId(a[n++].id)}))},getUploadFileByName:function(e){return i.reversed(this._uploadFiles).find((function(t){return t.cmMeta.name===e}))},removeUploadFileByName:function(e){var t=this.getUploadFileByName(e);return!!t&&(u(this,t),!0)},_generateDownloadUrl:function(e){var t=e.files[0];return t.downloadUrl=d(this,{mode:'download'},t)},_generatePreviewUrl:function(e){var t=e.files[0],a=e.usePlugin;return t.previewUrl=d(this,{url:'common/preview/preview.jsp'},t,a,!0)}});var m=function(e){return function(t){return i.every(e,i.fn(i.is,t,i))}}}).call(this,a(465))},859:function(e,t,a){(function(e){a(533);var t=a(463),i=a(466),n=a(862).isv6,s=a(465),o=a(640).pluginInstallTpl,l=a(470),r=l.alert,c=l.confirm;function d(t){c(o({title:t||s('mail/attach_error_tips_need_feature')}),{onConfirm:e.fun(open,['/cab/cmplugin_setup.exe']),title:s('main/tip_title'),confirmTpl:s('mail/attach_error_tips_install')})}t.cmpluginMeta={downloadUrl:'/cab/cmplugin_setup.exe'},t.widget('cm.fileupload',t.cm.fileupload,{options:{forcePlugin:!1,pluginBrowsing:!1},_onPluginDone:function(e,a){this._trigger('plugindone',t.Event('plugindone',{delegatedEvent:e}),a)},_onPluginFail:function(e,a){!function(e){var t=e.files[0].errorThrown||e.errorThrown;t&&'abort'!==t&&r(s('mail/compose_attach_error'),{title:s('mail/compose_attach_upload_title')})}(a),this._trigger('fail',t.Event(0,{delegatedEvent:e}),a)},_onPluginProgress:function(e,a){if(1===a.uploadedState||2===a.uploadedState){this._trigger('pluginprepare',t.Event('pluginprepare',{delegatedEvent:e}),a);var i=!!a.files[0].composeToTrs,o={loaded:0,total:a.files[0].size,percentage:a.uploadedPercent,composeToTrs:i};this.uiUploadPreparing(a,o)}else if(3===a.uploadedState)this._trigger('pluginprogress',t.Event('pluginprogress',{delegatedEvent:e}),a);else if(4===a.uploadedState||5===a.uploadedState)a.dfd.resolve();else if(6===a.uploadedState){if(this._checkComposeAutoToTrs(a)&&(7===a.lastErrorNum||8===a.lastErrorNum))return void a.composeToTrsAdd();2===a.lastErrorNum?a.files[0].error='abort':0===a.lastErrorNum&&n()?a.files[0].error=s('common/upload_plugin_error_ipv6'):a.files[0].error=s('common/upload_plugin_error'+a.lastErrorNum),a.dfd.reject()}},_onPluginSend:function(e,a){var i,n=this;return n._pluginActive++,i=function(){return a.dfd=t.Deferred(),a.dfd.done((function(){n._onPluginDone(e,a)})).fail((function(){n._onPluginFail(e,a)})).always((function(){n._pluginActive--,0===n._pluginActive&&n._trigger('stop')})),a.aborted||!1===n._trigger('pluginsend',t.Event('pluginsend',{delegateEvent:e},a))?a.dfd.rejectWith(n,[a]):n.plugin.upload().item(a.index).start(),a.dfd},a.sequentialUploads?(this._pluginSequence=this._pluginSequence.then(i,i),this._pluginSequence):i()},_onPluginAdd:function(e,a){var i=this,n=!0;return a.originalFiles=a.files,a._widgetName=this.widgetFullName||this.widgetName,t.each(a.files,(function(s,o){var l=t.extend({},i.options,a);return l.files=[o],l.index=o.index,l.skipPrepareProcess=!0,i._addPluginConvenienceMethods(e,l),n=i._trigger('add',t.Event('add',{delegatedEvent:e}),l)})),n},_onPluginChange:function(e,a,i){for(var n,s,o={files:[],usePlugin:!0},l=0;l<a.length;l++)s='unknown'==typeof(n=this.plugin.upload().item(a[l])).size?parseInt(n.size_str):parseInt(n.size),o.files.push(t.extend({index:a[l],name:n.name,size:s},i));this._onPluginAdd(e,o)},_onPluginDropIn:null,_onPluginDropMove:null,_onPluginDropOut:null,_onPluginDropFiles:null,_addPluginConvenienceMethods:function(e,a){var n=this,s=function(e){return t.Deferred().resolveWith(n,e).promise()};a.process=function(e,i){return(e||i)&&(a._processQueue=this._processQueue=(this._processQueue||s([this])).pipe((function(){return a.errorThrown?t.Deferred().rejectWith(n,[a]).promise():s(arguments)})).pipe(e,i)),this._processQueue||s([this])},a.submit=function(){'pending'!==this.state()&&(a.init(),n._onPluginSend(e,a))},a.state=function(){return this.dfd?this.dfd.state():this._processQueue?this._processQueue.state():void 0},a.init=function(){var t=n.plugin.upload().item(a.index);t.init(function(e){var t={url:'comupload.jsp'},n={url:'/s?func=upload:directData'};'compose'===a.uploadType?t.composeId=n.composeId=a._cid:(t.fid=a.fid,t.trs=!0,a.uid&&(t.uid=n.uid=a.uid),n.url='/s?func=upload:directDataNF');a.files[0].inlined&&(t.inlined=!0,n.inlined=!0);a.files[0].cmMeta.securityLevel&&(t.securityLevel=a.files[0].cmMeta.securityLevel);return{netfolder:'compose'!==a.uploadType,blocksize:a.maxChunkSize,query:i.wmFullURL(t),upload:i.wmFullURL(n),notify:e}}((function(i,s){a.uploadedPercent=s,a.uploadedState=i,a.lastErrorNum=t.lastErrorNum,i>=3&&('compose'===a.uploadType?a.files[0].cmMeta.setId(t.attachmentId):a.files[0].cmMeta.setMid(t.attachmentId)),n._onPluginProgress(e,a)})))},a.abort=function(){a.errorThrown='abort',a.dfd?(n.plugin.upload().item(a.index).stop(),a.dfd.reject()):(a.aborted=!0,n._onPluginFail(e,a))},a.carryon=function(){a.aborted=!1,n._removeFileState(a),a.dfd?n._onPluginSend(e,a):a.submit()},a.composeToTrsAdd=function(){var e=a.files[0];n.uiUploadToTrs(a),n._initUploadMeta(a,'trs'),e.cmMeta=e.cmMeta.migrateToTrs(),e.composeToTrs=!0,e.inlined=!1,delete e.cmMeta.part,a.init(),n.plugin.upload().item(a.index).start()}},_initEventHandlers:function(){var e=this;this._super(),this._valid()&&(this.options.fileInput.css({position:'absolute',left:'-9999px',top:'-9999px'}),this.element.on('click',(function(t,a){e._customForceComposeToTrs=a&&!0===a.forceToTrs;var i=e.options.enableDnd;e.options.enableDnd=!1,e.options.pluginBrowsing=!0;var n=e.plugin.upload().browser();e.options.enableDnd=i,e._onPluginChange(t,n),setTimeout((function(){e.options.pluginBrowsing=!1}),10)})),this._isXHRUpload(this.options)||(this.plugin.EnableDropFiles=!0,this.plugin.supportDropFiles&&(this._onPluginDropIn=function(){e._trigger('plugindragenter',t.Event({type:'dragenter'}))},this._onPluginDropMove=function(a,i){e._trigger('plugindropmove',t.Event({type:'dragmove'}),{x:a,y:i})},this._onPluginDropOut=function(){e._trigger('plugindragleave',t.Event({type:'dragleave'}))},this._onPluginDropFiles=function(a){var i=t.Event('drop');!1!==e._trigger('plugindrop',i,a)&&e._onPluginChange(i,a)},this.plugin.attachEvent('onDropIn',this._onPluginDropIn),this.plugin.attachEvent('onDropMove',this._onPluginDropMove),this.plugin.attachEvent('onDropOut',this._onPluginDropOut),this.plugin.attachEvent('onDropFiles',this._onPluginDropFiles))))},_destroyEventHandlers:function(){var e=this.plugin,t=this._onPluginDropIn,a=this._onPluginDropMove,i=this._onPluginDropOut,n=this._onPluginDropFiles;this._super(),this._valid()&&(this.element.off('click'),t&&e.detachEvent('onDropIn',t),a&&e.detachEvent('onDropMove',a),i&&e.detachEvent('onDropOut',i),n&&e.detachEvent('onDropFiles',n))},_valid:function(){if(a(481).IE){var e=t(this.options.pluginContainer||'body'),i=e.data('cmPlugin');return i||e.append(i=t('<object type=application/x-cmplugin width=0 height=0><param name=onload value=pluginLoaded></object>')[0]).data('cmPlugin',i),this.plugin=i,i.valid}},_create:function(){this._super(),this._pluginActive=0,this._pluginSequence=this._getXHRPromise(!0),this._valid()},_destroy:function(){this._destroyEventHandlers(),this._super()},pluginAdd:function(e,a){e&&this._onPluginChange(t.Event('pluginAdd'),e,a)},plugin:0,video:function(e){var t=this._v=this._v||{},i=a('audio'===e?863:866);this._valid()?(t[e]=t[e]||new i({uploader:this})).show():d()},_capture:d,requirePlugin:e.fn(d,s('mail/attach_error_tips_need_plugin'))})}).call(this,a(464))},862:function(e,t){var a=function(e,t,a){return void 0===a&&(a=t),''+e.repeat(t)+('(?:'+e+')?').repeat(a-t)},i='25[0-5]|(?:2[0-4]|1?[0-9])?[0-9]',n=a('('+i+')\\.',3)+'('+i+')',s='[0-9a-f]{1,4}',o=document.domain.replace(/^\[(.*)]$/g,'$1'),l=function(e){return function(t){return void 0===t&&(t=o),e.some((function(e){return new RegExp('^'+e+'$','i').exec(t)}))}};e.exports={isv4:l([n]),isv6:l([a('('+s+'):',7)+'('+s+')',a('('+s+'):',1,7)+':',a('('+s+'):',1,6)+':('+s+')',''+a('('+s+'):',1,5)+a(':('+s+')',1,2),''+a('('+s+'):',1,4)+a(':('+s+')',1,3),''+a('('+s+'):',1,3)+a(':('+s+')',1,4),''+a('('+s+'):',1,2)+a(':('+s+')',1,5),'('+s+'):'+a(':('+s+')',1,6),':'+a(':('+s+')',1,7),'::','(fe80):'+a(':('+s+')',0,4)+'%([0-9a-z]+)','::(?:(ffff)(?::(0{1,4}))?:)?'+n,a('('+s+'):',1,4)+':'+n])}},863:function(e,t,a){(function(t){a(864);var i=a(480),n=a(865),s=a(463),o=a(465),l=a(470).alert,r=a(500).extend({Implements:i,attrs:{width:'auto',title:o('compose/snd_title'),message:'',confirmTpl:o('common/confirm'),cancelTpl:o('common/cancel'),dnd:!0},events:{'click [data-role=confirm]':function(e){t.stop(e,0),this._checkDevice()&&this._handleUpload(),this.hide()},'click [data-role=cancel]':function(e){t.stop(e,0),this._handleCancel(),this.hide()}},setup:function(){this._params={},r.superclass.setup.call(this)},render:function(){this._params.voiceState={Initializing:0,Ready:1,Recording:2,Stopping:3,Finish:4},this._params.soundRecord=this.get('uploader').plugin.soundRecord(),r.superclass.render.call(this),this._checkDevice()?(this.set('message',i.compile(n,{})),this.$('.u-dialog-wrap').addClass('u-voiceupload'),this.show(),this._initVoice()):this._checkDevice()},destroy:function(){r.superclass.destroy.call(this)},_initVoice:function(){var e=this,t=e.$('.voice-upload');return e._initDevice(),e._changeState('ready'),t.off('click','.btnSpan'),t.on('click','.btnSpan',(function(){var t=s(this);e._dispatcher(t)})),!0},_checkDevice:function(){return 0!==this._params.soundRecord.wavDeviceNum||(this.set({message:o('compose/nosnddev')},i.compile(n,{})),this.$('.u-dialog-wrap').addClass('u-videoAlert'),this.show(),!1)},_initDevice:function(){var e=this.$('.select_snd_dev')[0],t=this._params.soundRecord.wavDeviceNum;this.$('.default_snd_dev').text(o('compose/default_dev')+'-'+this._params.soundRecord.wavDeviceDesc(0));for(var a=1;a<t;++a)e.options[a]=new Option(this._params.soundRecord.wavDeviceDesc(a),a)},_handleStart:function(){var e=this.$('.select_snd_dev');this._params.soundRecord.init({size:0,recordtime:60,wavidx:parseInt(e.val())}),this._params.soundRecord.start(),this._changeState('recording')},_handleStop:function(){this._params.soundRecord.stop(),this._changeState('ready')},_handleReplay:function(){var e=this,t=e.$('.voice-upload'),a=t.find('.sndStateID'),i=t.find('.sndReplayPos').find('.MediaRePlayer');if('replaying'!==a.val())return e._params.soundRecord.stop(),e._params.soundRecord.state===e._params.voiceState.Initializing?(l(o('compose/no_file_record')),!1):e._params.soundRecord.state===e._params.voiceState.Finish?(e._changeState('replaying'),setTimeout((function(){e._funReplay(i[0],e._params.soundRecord.filename)}),100),!0):l(o('compose/msg_opsTooFrequent'));e._changeState('ready'),i.stop()},_handleUpload:function(){if(this._params.soundRecord.state===this._params.voiceState.Initializing)return l(o('compose/no_file_record')),!1;if(this._params.soundRecord.state!==this._params.voiceState.Finish)return l(o('compose/msg_opsTooFrequent')),this._params.soundRecord.closeAll(),!1;if(this._params.soundRecord.filename){var e=this._params.soundRecord.upload();this.get('uploader').pluginAdd(e)}},_handleCancel:function(){this._params.soundRecord.closeAll()},_funReplay:function(e,t){e.valid?e.play1(t):l('Browser not support replay!')},_changeState:function(e){var t=this.$('.voice-upload'),a=t.find('.sndStartRec'),i=t.find('.sndStopRec'),n=t.find('.sndReplayInfo'),s=t.find('.sndUploadRec'),l=t.find('.sndCancelRec'),r=t.find('.sndStateID'),c=t.find('.sndReplayPos'),d=this.$('.sndStateDesc');r.val(e),a.attr('disabled','recording'===e||'replaying'===e),i.attr('disabled','ready'===e||'replaying'===e),n.attr('disabled','recording'===e),n.val(o('replaying'===e?'compose/btn_cancel_play':'compose/btn_play')),c[0].style.display='replaying'===e?'':'none',s.attr('disabled','recording'===e||'replaying'===e),l.attr('disabled','recording'===e||'replaying'===e),d.html(o('compose/'+e))},_dispatcher:function(e){switch(e.data('action')){case'rec':this._handleStart();break;case'stop':this._handleStop();break;case'play':this._handleReplay()}}});e.exports=r}).call(this,a(464))},865:function(e,t){e.exports='\x3c!----\x3e\r\n<div class="voice-upload">\r\n    <div class="u-alert-warning">\r\n        <span class="sndStateDesc">{{i18n \'compose/ready\'}}</span>\r\n    </div>\r\n    <div class="u-voice-cont">\r\n        <select name="select_snd_dev" class="select_snd_dev">\r\n            <option value="0" class="default_snd_dev" selected></option>\r\n        </select>\r\n        <div class="btnDiv">\r\n            <span class="btnSpan" data-action="rec">\r\n                <input type="button" class="u-btn u-btn-default sndStartRec" value="{{i18n \'compose/btn_rec\'}}" disabled="true"/>\r\n            </span>\r\n            <span class="btnSpan" data-action="stop">\r\n                <input type="button" class="u-btn u-btn-default sndStopRec" value="{{i18n \'compose/btn_stop\'}}" disabled="true"/>\r\n            </span>\r\n            <span class="btnSpan" data-action="play">\r\n                <input type="button" class="u-btn u-btn-default sndReplayInfo" value="{{i18n \'compose/btn_play\'}}" disabled="true" />\r\n            </span>\r\n            <input type="hidden" class="sndStateID">\r\n        </div>\r\n        <div class="sndReplayPos" style="display:none;">\r\n            <object class="MediaRePlayer" type="application/x-vnd.FBBasicMediaPlayer"></object>\r\n        </div>\r\n    </div>\r\n<div>'},866:function(e,t,a){(function(t,i){var n=a(480),s=a(867),o=a(463),l=a(470).alert,r=a(500).extend({Implements:n,widget:{tabs:null},pubSub:null,attrs:{width:'auto',title:t('compose/vdo_title'),confirmTpl:t('common/confirm'),cancelTpl:t('common/cancel'),dnd:!0},events:{'click [data-role=confirm]':function(e){i.stop(e,0),this._checkDevice()&&this._vdoUpload(),this.hide()},'click [data-role=cancel]':function(e){i.stop(e,0),this._vdoCancel(),this.hide()}},setup:function(){this._params={},r.superclass.setup.call(this)},render:function(){this._params.videoState={Initializing:0,Ready:1,Recording:2,RecFinish:3,Compassing:4,ComFinish:5},this._params.vdoRecorder=this.get('uploader').plugin.videoRecord(),r.superclass.render.call(this),this._checkDevice()?(this.set('message',n.compile(s,{})),this.$('.u-dialog-wrap').addClass('u-videoupload'),this._initVideo(),this.show()):this._checkDevice()},destroy:function(){r.superclass.destroy.call(this)},_initVideo:function(){var e=this,t=e.$('.video-upload');return e._initVdoDevice(),e._changeVdoState('ready'),t.off('click','.btnSpan').on('click','.btnSpan',(function(){var t=o(this);e._dispatcher(t)})),!0},_checkDevice:function(){var e=this._params.vdoRecorder.wavDeviceNum,a=this._params.vdoRecorder.capDeviceNum;return 0===e?0===a?(this.set({message:t('compose/novdodev_and_nosnddev')},n.compile(s,{})),this.$('.u-dialog-wrap').addClass('u-videoAlert'),this.show(),!1):(this.set({message:t('compose/nosnddev')},n.compile(s,{})),this.$('.u-dialog-wrap').addClass('u-videoAlert'),this.show(),!1):0!==a||(this.set({message:t('compose/novdodev')},n.compile(s,{})),this.$('.u-dialog-wrap').addClass('u-videoAlert'),this.show(),!1)},_initVdoDevice:function(){var e=this.$('.select_vdo_snd_dev')[0],a=this.$('.select_vdo_dev')[0],i=this._params.vdoRecorder.wavDeviceNum,n=this._params.vdoRecorder.capDeviceNum;this.$('.default_vdo_snd_dev').text(t('compose/default_dev')+'-'+this._params.vdoRecorder.wavDeviceDesc(0));for(var s=1;s<i;++s)e.options[s]=new Option(this._params.vdoRecorder.wavDeviceDesc(s),s);this.$('.default_vdo_dev').text(this._params.vdoRecorder.capDeviceDesc(0));for(var o=1;o<n;++o)a.options[o]=new Option(this._params.vdoRecorder.capDeviceDesc(o),o)},_vdoStart:function(){var e=this.$('.select_vdo_snd_dev'),t=this.$('.select_vdo_dev');this._params.vdoRecorder.init({size:2,recordtime:40,wavidx:parseInt(e.val()),capidx:parseInt(t.val())}),this._params.vdoRecorder.start(),this._changeVdoState('recording')},_vdoStop:function(){var e=this;e._params.vdoRecorder.stop(),setTimeout((function t(){e._params.vdoRecorder.state===e._params.videoState.RecFinish?(e._params.vdoRecorder.compress(!0),e._changeVdoState('ready')):setTimeout(t,100)}),100)},_vdoReplay:function(){var e=this,a=e.$('.video-upload'),i=a.find('.vdoStateID'),n=a.find('.MediaRePlayer1');if('replaying'!==i.val())return e._params.vdoRecorder.stop(),e._params.vdoRecorder.state===e._params.videoState.Initializing?(l(t('compose/no_file_record')),!1):e._params.vdoRecorder.state===e._params.videoState.ComFinish?(e._changeVdoState('replaying'),setTimeout((function(){e._funReplay(n[0],e._params.vdoRecorder.filename)}),100),!0):(l(t('compose/msg_opsTooFrequent')),!1);e._changeVdoState('ready'),n.stop()},_vdoUpload:function(){if(this._params.vdoRecorder.state===this._params.videoState.Initializing)return l(t('compose/no_file_record')),!1;if(this._params.vdoRecorder.state===this._params.videoState.ComFinish){if(this._params.vdoRecorder.filename){var e=this._params.vdoRecorder.upload();this.get('uploader').pluginAdd(e),this.hide()}return!0}l(t('compose/msg_opsTooFrequent')),this._vdoCancel()},_vdoCancel:function(){this._params.vdoRecorder.closeAll(),this.hide()},_changeVdoState:function(e){var a=this.$('.video-upload'),i=a.find('.vdoStartRec'),n=a.find('.vdoStopRec'),s=a.find('.vdoReplayInfo'),o=a.find('.vdoUploadRec'),l=a.find('.vdoCancelRec'),r=a.find('.vdoStateID'),c=a.find('.vdoReplayPos'),d=this.$('.vdoStateDesc');r.val(e),i.attr('disabled','recording'===e||'replaying'===e),n.attr('disabled','ready'===e||'replaying'===e),s.attr('disabled','recording'===e),s.val(t('replaying'===e?'compose/btn_cancel_play':'compose/btn_play')),c[0].style.display='replaying'===e?'':'none',o.attr('disabled','recording'===e||'replaying'===e),l.attr('disabled','recording'===e||'replaying'===e),d.html(t('compose/'+e))},_funReplay:function(e,t){e.valid?e.play1(t):l('Browser not support replay!')},_dispatcher:function(e){switch(e.data('action')){case'rec':this._vdoStart();break;case'stop':this._vdoStop();break;case'play':this._vdoReplay()}}});e.exports=r}).call(this,a(465),a(464))},867:function(e,t){e.exports='<div class="video-upload">\r\n    <div class="u-alert-warning">\r\n        <span class="vdoStateDesc">{{i18n \'compose/ready\'}}</span>\r\n    </div>\r\n    <div class="u-video-cont">\r\n        <div class="u-select">\r\n            <select class="select_vdo_dev">\r\n                <option value="0" class="default_vdo_dev" selected></option>\r\n            </select>\r\n        </div>\r\n        <div class="u-select">\r\n            <select class="select_vdo_snd_dev">\r\n                <option value="0" class="default_vdo_snd_dev" selected></option>\r\n            </select>\r\n        </div>\r\n        <div class="btnDiv">\r\n            <span class="btnSpan" data-action="rec">\r\n                <input type="button" class="u-btn u-btn-default vdoStartRec" value="{{i18n \'compose/btn_rec\'}}" disabled="true"/>\r\n            </span>\r\n            <span class="btnSpan" data-action="stop">\r\n                <input type="button" class="u-btn u-btn-default vdoStopRec" value="{{i18n \'compose/btn_stop\'}}" disabled="true"/>\r\n            </span>\r\n            <span class="btnSpan" data-action="play">\r\n                <input type="button" class="u-btn u-btn-default vdoReplayInfo" value="{{i18n \'compose/btn_play\'}}" disabled="true"/>\r\n            </span>\r\n            <input type="hidden" class="vdoStateID">\r\n        </div>\r\n        <div class="vdoReplayPos" style="display:none;">\r\n            <object class="MediaRePlayer1" type="application/x-vnd.FBBasicMediaPlayer"></object>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'},868:function(e,t,a){(function(t){a(869);var i=a(463),n=a(479),s=a(494),o=a(470).confirm,l=a(581),r=a(525),c=a(472),d=a(465),p=a(482),u=a(468).get,f=a(467),m=a(521),h=a(507),v=a(493).init,g=new r,b=a(870).helpers({GetDateMD:function(e){if(e)return new s.SafeString(n(e).format('MM-DD'))},GetFileIco:function(e,t){return e&&t?t+h.formatFileType(e):''},DepartSLFromName:function(e){return p.deTagSender(e)[2]},GetRemainDH:function(e){var t=n.duration(e);if(e)return new s.SafeString(t.humanize())},TranslateSL:function(e){return e?p.i18n(e,'sender_security_level'):''}}),_=c.extend({},(function(e){var a,n=0;this.events={'click .j-filelist-func .page a':t.stop((function(e,t){var a=i(t).attr('href');a&&(r.empty(),n=parseInt(a.slice(1)),p(),g.trigger('selectNumUpdate'))}),0)},e()({template:b.accessoryTpl(),afterRender:p});var s=this.element,o=this.$('.j-file-list-tip'),l=this.$('.j-filelist-func'),r=this.$('.u-table tbody');function c(){10*(n+1)<a&&(n+1)%3>0&&(++n,p())}function p(){u(!0,!1,!1),m.getAccList({start:10*n,limit:10,returnTotal:!0}).then((function(e,l){var p;u(),a=l.total||0,p={fileList:e,enableSecurityLevel:y},null?o.html(i(d('file/msg_list_att_fail'))):p.fileList.length<=0?o.html(i(d('file/msg_list_att_blank'))):(r.append(b.accessoryItemTpl(p)).customRadioCheckbox(),u(),10*(n+1)>=a?n+1>3&&(u(!1,!0,!1),f(Math.max(0,n-n%3-3),!1)):(n+1)%3==0?(u(!1,!0,!1),f(n+1-6,n+1)):s.on('scroll',(function(){var e=t.once(c);s[0].scrollHeight-s.scrollTop()-s.outerHeight()<20&&(s.off('scroll'),e())})))}))}function u(e,t,a){l.toggleClass('f-dn',!e&&!t&&!a),l.find('.loading').toggleClass('f-dbi',e),l.find('.page').toggleClass('f-dbi',t),l.find('.retry').toggleClass('f-dbi',a)}function f(e,a){var i=l.find('.page .u-page'),n=t.isNUM(e)&&e>=0,s=t.isNUM(a)&&a>=0;i.find('[rel=prev]').toggleClass('z-current',!n).attr('href',n?'#'+e:''),i.find('[rel=next]').toggleClass('z-current',!s).attr('href',s?'#'+a:'')}})),y=p.enabled;e.exports=function(e,a,n){var s,r,c,p,h=i('<span class="u-filebox-selectedSum"/>');function w(){var e=function(){x(!1,m.getPNfFolderStructure,d('file/msg_list_pnf_blank'),d('file/msg_list_pnf_fail'))};if(f.getFolderLockedStatus(!0).isAuth)e();else{var t=i('<div class="c-filebox-auth2lock"><div class="c-filebox-auth2lock-wrap"></div></div>');r.find('.u-tab-content [data-type=pnf]').html(t),v(t.find('.c-filebox-auth2lock-wrap'),e)}}function k(){x(!0,m.getENfFolderStructure,d('file/msg_list_enf_blank'),d('file/msg_list_enf_fail'))}function T(){var e=r.find('.u-tab-content [data-type=trs]');if(e.attr('data-rendered'))return!1;m.getTrsFiles().then((function(t){e.html(t[0]?b.trsListTpl({fileList:t,enableSecurityLevel:y}):d('file/msg_list_trs_blank')).customRadioCheckbox(),e.attr('data-rendered',!0)})).onFail((function(){e.html(d('file/msg_list_trs_fail'))}))}function x(e,a,s,o,l){var c=r.find('.u-tab-content [data-type="'+n+'"]');if('true'===c.attr('data-rendered'))return!1;c.html(d('file/msg_filebox_loading')),a(l,!0,!0,!0).then((function(n){var l=n.folderTree,r=n.folderInfo,d=n.folders,p=n.files,u={parentFolders:l.reverse(),subFolders:d,nfFiles:p,folderInfo:r,isEnf:e,blankMsg:s,isBlank:!d[0]&&!p[0],enableSecurityLevel:y},f=function(){if(m[0].scrollHeight>m.outerHeight()+3){var e=m.find('.j-parentPath'),t=e.data('fid');e.remove();var a=m.find('.j-hiddenPath');a.removeClass('f-dn'),a.data('fid',t),a.find('a').data('fid',t),f()}};c.html(b.nfListTpl(u)).customRadioCheckbox();var m=c.find('.u-crumb');f(),c.find('a[data-action="enterFolder"]').on('click',(function(n){var l=i(n.target).data('fid');t.stop(n,0),c.attr('data-rendered','false'),x(e,a,s,o,l)})),c.attr('data-rendered','true'),g.trigger('selectNumUpdate')})).onFail((function(){c.html(o)}))}function C(){var e=s.$('.u-tab-content');if(!a[n])return i('[data-type="'+n+'"]',e).html(b.forbiddenTpl()),!1;({acc:function(){p||((p=new _).render(),e.find('.u-switchable-panel[data-type='+n+']').html(p.element))},pnf:w,enf:k,trs:T})[n]()}function j(){var e=$().length;h.html(e<=0?'':d('file/msg_filebox_slected_sum',{num:e}))}o(b.filelistTpl(),{events:{'change.crc .j-item-chk':j},title:d('file/lbl_att_from_file_center'),closeTpl:!0,height:464,width:0===u('context.locale').toLowerCase().indexOf('en')?650:526,onConfirm:function(){e(S())},beforeDestroy:function(){c&&c.destroy(),p&&p.destroy(),g.off('selectNumUpdate')},afterShow:function(){(s=this).$('.'+s.get('classPrefix')+'-operation').eq(0).append(h),r=s.$('.'+s.get('classPrefix')+'-content'),s.$('.c-filebox-tab').html(b.utabTpl(a)),s.$('.u-dialog-close').addClass('u-filebox-close'),r.parent('.u-dialog-wrap').addClass('c-filebox-dialog'),function(){a[n]||(n=Object.keys(a).find((function(e){return a[e]}))||'acc');var e=s.$('.j-filebox-content-warp .j-filebox-tab'),t=e.find('[data-role=trigger]').get().map((function(e){return i(e).data('type')}));c=new l({element:e,activeTriggerClass:'z-current',activeIndex:t.indexOf(n),triggerType:'click'}).on('switch',(function(e){C(n=t[e])})).on('switched',(function(){g.trigger('selectNumUpdate')})),C()}(),g.on('selectNumUpdate',j)}});var S=function(){return $().map((function(e){var t=i(e),a={acc:function(e){return{mid:e.data('accid'),part:e.attr('data-accpartid'),type:'dealing',name:e.data('name'),size:e.data('size'),contentType:e.data('contenttype')}},pnf:function(e){return{mid:e.data('id'),type:'netfolder',name:e.data('name'),size:e.data('size'),contentType:e.data('contenttype')}},enf:function(e){return{mid:e.data('id'),type:'netfolder',name:e.data('name'),size:e.data('size'),contentType:e.data('contenttype'),enfUid:u('file.enfuid')}},trs:function(e){return{mid:e.data('id'),type:'trs',name:e.data('name'),size:e.data('size'),contentType:e.data('contenttype')}}}[n](t),s=t.attr('data-securitylevel');return y&&null!=s&&(a.securityLevel=s),a}))},$=function(){return c?c.$('[data-role=panel]:visible').find('.j-filelist input.j-item-chk[type="checkbox"]:checked').closest('.file-item').get():[]}}}).call(this,a(464))},870:function(e,t,a){e.exports=a(469)('',{filelistTpl:'<div class="c-filebox-content j-filebox-content-warp"> <div class="c-filebox-tab j-filebox-tab"> </div> </div>',forbiddenTpl:'{{{i18n "file/msg_filebox_forbidden"}}}',utabTpl:'<div class="u-tab u-tab-highlight-down"> <ul data-role="nav"> {{#if trs}} <li data-role="trigger" data-type="trs"> <span class="bar"></span> <a href="javascript:void(0);" >{{i18n "main/appname_BNF"}}</a> </li> {{/if}} {{#if pnf}} <li data-role="trigger" data-type="pnf"> <span class="bar"></span> <a href="javascript:void(0);">{{i18n "main/appname_NF"}}</a> </li> {{/if}} {{#if enf}} <li data-role="trigger" data-type="enf"> <span class="bar"></span> <a href="javascript:void(0);" >{{i18n "main/appname_ENF"}}</a> </li> {{/if}} {{#if acc}} <li data-role="trigger" data-type="acc"> <span class="bar"></span> <a href="javascript:void(0);" >{{i18n "file/lbl_accessory_dealings"}}</a> </li> {{/if}} </ul> </div> <div class="u-tab-content u-scroll" data-role="content"> {{#if trs}} <div class="f-dn" data-type="trs" data-role="panel">{{{i18n "file/msg_filebox_loading"}}}</div> {{/if}} {{#if pnf}} <div class="f-dn" data-type="pnf" data-role="panel">{{{i18n "file/msg_filebox_loading"}}}</div> {{/if}} {{#if enf}} <div class="f-dn" data-type="enf" data-role="panel">{{{i18n "file/msg_filebox_loading"}}}</div> {{/if}} {{#if acc}} <div class="f-dn" data-type="acc" data-role="panel">{{{i18n "file/msg_filebox_loading"}}}</div> {{/if}} </div>',accessoryTpl:'<div class="c-filebox-list onlyFile accessory-list j-filelist u-scroll"> <table class="u-table u-table-row"> <tbody> </tbody> </table> <div class="j-file-list-tip"></div> <div class="c-filebox-list-func j-filelist-func"> <div class="loading">{{{i18n "file/msg_filebox_loading"}}}</div> <div class="page"> <div class="u-page u-page-round"> <a class="u-page-prev z-current" rel="prev"><span class="iconfont iconprevious"></span></a> <a class="u-page-next z-current" rel="next"><span class="iconfont iconnext"></span></a> </div> </div> <div class="retry">{{i18n "file/msg_filebox_retry"}}</div> </div> </div>',accessoryItemTpl:'{{#each fileList}} <tr class="file-item" data-accid="{{id}}" data-accpartid="{{partId}}" data-contenttype="{{contentType}}" data-size="{{attsize}}" data-name="{{attn}}"> <td class="col-chk"> <span> <input type="checkbox" class="u-input j-item-chk" /> </span> </td> <td class="col-name"> <i class="file-small-icon {{GetFileIco attn \'icon-small-\'}}"></i> <span>{{attn}}</span> </td> {{#if ../enableSecurityLevel}} <td class="col-date">{{DepartSLFromName attn}}</td> {{/if}} <td class="col-date">{{GetDateMD sentDate}}</td> </tr> {{/each}}',trsListTpl:'<div class="c-filebox-list onlyFile j-filelist"> <table class="u-table u-table-row"> <tbody> {{#each fileList}} <tr class="file-item" data-id="{{id}}" data-fid="{{fid}}" data-size="{{size}}" data-name="{{name}}" data-contenttype="{{contentType}}" data-securitylevel="{{#if ../enableSecurityLevel}}{{misc.securityLevel}}{{/if}}"> <td class="col-chk"> <span> <input type="checkbox" class="u-input j-item-chk" /> </span> </td> <td class="col-name"> <i class="file-small-icon {{GetFileIco name \'icon-small-\'}}"></i> <span>{{name}}</span> </td> {{#if ../enableSecurityLevel}} <td class="col-securityLevel"> {{TranslateSL misc.securityLevel}} </td> {{/if}} <td class="col-date"> {{#if misc.remaintime}} {{GetRemainDH misc.remaintime}} {{else}} {{GetDateMD creationDate}} {{/if}} </td> </tr> {{/each}} </tbody> </table> </div>',nfListTpl:'<ul class="c-filebox-crumb u-crumb"> <li>{{i18n "nf/bf_path"}}&nbsp;</li> <li class="j-hiddenPath f-dn"> <a href="javascript:void(0);" data-action="enterFolder" title="">..</a> </li> {{#each parentFolders}} <li class="j-parentPath" data-fid="{{fid}}"> {{#unless isRoot}} <i>&gt;</i> {{/unless}} <a href="javascript:void(0);" data-action="enterFolder" data-fid="{{fid}}"> {{#if isRoot}} {{#if ../isEnf}} {{i18n "main/efdr_root"}} {{^}} {{i18n "main/pfdr_root"}} {{/if}} {{^}} {{name}} {{/if}} </a> </li> {{/each}} <li> {{#if folderInfo.isRoot}} {{#if isEnf}} {{i18n "main/efdr_root"}} {{^}} {{i18n "main/pfdr_root"}} {{/if}} {{^}} <i>&gt;</i> {{folderInfo.name}} {{/if}} </li> </ul> {{#if isBlank}} {{{blankMsg}}} {{else}} <div class="c-filebox-list j-filelist"> <table class="u-table u-table-row"> <tbody> {{#each subFolders}} <tr class="file-item"> <td class="col-chk"> </td> <td class="col-name"> <i class="file-small-icon icon-small-folder"></i> <a href="javascript:void(0);" data-action="enterFolder" data-fid="{{id}}">{{name}}</a> </td> {{#if ../enableSecurityLevel}} <td class="col-securityLevel"></td> {{/if}} <td class="col-date"></td> </tr> {{/each}} {{#each nfFiles}} <tr class="file-item" data-id="{{id}}" data-fid="{{fid}}" data-size="{{size}}" data-name="{{name}}" data-contenttype="{{contentType}}" data-securitylevel="{{#if ../enableSecurityLevel}}{{misc.securityLevel}}{{/if}}"> <td class="col-chk"> <span> <input type="checkbox" class="u-input j-item-chk" /> </span> </td> <td class="col-name"> <i class="file-small-icon {{GetFileIco name \'icon-small-\'}}"></i> <span>{{name}}</span> </td> {{#if ../enableSecurityLevel}} <td class="col-securityLevel">{{TranslateSL misc.securityLevel}}</td> {{/if}} <td class="col-date">{{GetDateMD creationDate}}</td> </tr> {{/each}} </tbody> </table> </div> {{/if}}'})},887:function(e,t,a){(function(t){var i=a(467),n=a(474),s=a(475),o=a(466),l=a(479),r=a(463),c=t.assign;function d(e){var a=function(e,t){return'_'!==t[0]};(e=t.pickBy(e,a)).attrs=t.pickBy(e.attrs,a),e.attrs.hasOwnProperty('encryptPassword')&&(e.encryptPassword=e.attrs.encryptPassword,delete e.attrs.encryptPassword),e.attrs.hasOwnProperty('savePassword')&&(e.savePassword=e.attrs.savePassword,delete e.attrs.savePassword);var i=!!e.stringifyScheduleDate||null;if(delete e.stringifyScheduleDate,e.attrs.lettercontent){var n=c({uploadMode:'preEncodedData',returnInfo:!0},e.attrs);return o.mFormData({func:'mbox:composeF',uploadMode:'preEncodedData',stringifyScheduleDate:i},{data:n,merge:!0})}return o.wmCall({url:'/common/mbox/compose.jsp',isUserConfirmed:!0,stringifyScheduleDate:i},e)}function p(e){var t=[];return r.each(e._contacts,(function(e,a){s.test(a.addr)&&-1===t.indexOf(a.addr)&&t.push(a.addr)})),t}e.exports={getInitComposeInfo:function(e){var t=i.getUser(),o=a(482).forSend();e=e||{};var p=1!==t.displaysender,u=i.getConfig('user.allemails').map((function(e){return e.email=p&&e.name?''+s(e.name,e.addr):e.addr,e})),f={account:u[0].email,accounts:u,senderSecurityLevel:o};e.mid&&(f.draftId=e.mid);var m={stringifyScheduleDate:!0};return(e.mid||e.id?n.getInitCompose(c(m,e,{returnInfo:!0})):d(m)).then((function(t){return'string'===r.type(t)&&(t={id:t}),c(f,t,{composeId:t.id},function(e){var t=i.getUser(),a={};e.subject&&(a.subject=e.subject);e.attachments&&(a.attachments='array'===r.type(e.attachments)?e.attachments:[e.attachments]);e.scheduledate&&(a.scheduledate=l(e.scheduledate).toDate());return a.defaultAccount=e.defaultAccount||t.default_sender_address||t.email||'',a}(e))}))},sendMail:d,getReceiverCerts:function(e){return o.wmCall('pab:getDefaultKeyByEmails',{emails:p(e)})}}}).call(this,a(464))},888:function(e,t,a){(function(t,i){var n=a(465),s=a(463),o=a(518),l=a(469)('<div class="j-stationery-box"><div class="{{prefixCls}}">{{#each array}}<div class="stationery-item"><a href="javascript:void(0)" title="{{title}}" class="stationery-thumb" index="{{index}}"><img src="{{imgSrc}}"><span class="bg"></span></a></div>{{/each}}</div></div>'),r=function(e,a){var r=a.editor.cmd.doc,c=a.prefixCls,d=a.container,p=a.pagination;function u(t){var a,s=[{title:n('compose/stationery_type0'),imgSrc:(a='none_zh.png',i.path('common/stationery/thumbnail/'+a+'?pv='+i.pv())),index:-1}].concat(e.names.map((function(t,a){return{title:n('compose/stationery_type'+(a+1))||t,imgSrc:e.getThumbnail(a),index:a}})).splice(13*t,13));d.find('.j-stationery-box').remove(),d.find('.j-stationery').append(l({array:s,prefixCls:c})).show()}function f(){var t,a=s(this);t=parseInt(a.attr('index')),e.applyDocument(t,r),function(e){/firefox/i.test(o.browser.name)&&(e.execCommand('enableInlineTableEditing',!1,'false'),e.execCommand('enableObjectResizing',!1,'false'))}(r),d.find('.stationery-thumb').removeClass('stationery-selected'),a.addClass('stationery-selected')}u(0),p.pagination({total:e.names.length,limit:13,currentPage:0,menu:!1,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:u}),d.on('click','.stationery-thumb:not(.stationery-disable)',t.stop(f,0))},c=s.ajax({url:i.commonAssetPath('js/stationery.js'),type:'get',dataType:'script',cache:!0,crossDomain:!0});e.exports=function(e){this.render=function(){c.then((function(){r(self.Stationery,e)}))}}}).call(this,a(464),a(478))},889:function(e,t,a){(function(t){a(486);var i=a(465),n=a(497),s=a(463),o=a(469),l=a(467),r=a(468),c=r.detachMode,d=r.get,p=a(504),u=a(470).confirm,f=a(484),m=a(890),h=a(650),v=o('<ul class=template-list>{{#each list}}{{#if (eq type "remove")}}<li class="f-csp no-use-tpl" data-action="removeTpl"><i class="iconfont iconchoose"></i></li>{{/if}}{{#if (eq type "add")}}<li class="f-csp create-mail-tpl"><span data-action="createNewTpl" class="iconfont iconadd"></span></li>{{/if}}{{#if (not type)}}<li data-action="addToCompose" data-id="{{id}}" class="f-csp{{if$ (eq id ../selectedID) \' selected\'}}"><span class="wrapper">{{name}} <i class="iconfont iconchoose"></i></span></li>{{/if}}{{/each}}<ul>'),g=o('<div class="u-poptip j-source-pop-tip"><div class="u-poptip-container"><div class="u-poptip-arrow u-poptip-arrow-11"><em></em><span></span></div><div class="u-poptip-content"> {{{i18n "mail/msg_tpl_guidance"}}}</div></div></div>');e.exports=function(e){var a,o,r,b,_=e.editor,y=e.container,w=e.pagination,k=e.parent,T='source_tip_hide'+d('user.uid');function x(){var e=n.cache.getItem('compose_tpl_map')||{},t=k.get('composeId');h.listMailTpl().then((function(i){a=[].concat(i[0]?{type:'remove'}:[],i.reverse(),c?[]:{type:'add'}),o=e[t],C(0),w.pagination({total:a.length,limit:8,currentPage:0,menu:!1,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:C})}))}function C(e){var t=8*e,i=a.slice(t,t+8),n=s(v({list:i,selectedID:o}));y.html(n),n.on('click','[data-action]:not(.selected)',j),b&&(n.find('li:eq(1)').click(),b=!1)}function j(){var e=s(this);({addToCompose:$,createNewTpl:D,removeTpl:E})[e.data('action')](e)}function S(e){var t=s(e.target),a=k._params.composeInfo.composeId;h.uploadTplSourceFile(t).then((function(e){h.parseTplSource(e.attachmentId,a).then((function(e){m(e,(function(e){var t=e.varList,a=e.rcptsKey,i=e.tagList;k._params.varList=t,k._params.varListRcptsName=a,k.$('.j-form-item-to input').tagEditor('updateTags',i,!0)}))}))})).either(t.replaceWith.bind(t,t.clone(!0)))}function $(e){if(!e.hasClass('selected')){var l=''+e.data().id,c=a.find((function(e){return e.id===l})),d=T,f=t.get(c,'opt.variables.length'),m=s(g()).on('click','a',(function(){m.remove(),p.set(d,1)}));_.isEmpty()?h():u(i('mail/msg_remove_original_content'),{confirmTpl:i('mail/lbl_replace_and_save'),cancelTpl:i('mail/lbl_replace_without_save'),onConfirm:k.cmd.save}).then(h)}function h(){_.designMode?c.isHtml?_.html(c.content):_.html(n.html.text2html(c.content)):c.isHtml?_.text(n.html.html2text(c.content)):_.text(c.content),k.replaceCurrentSign(),e.siblings().removeClass('selected').end().addClass('selected'),o=c.id,r||p.getInt(d,0)||!f||(_.designMode||m.css({left:'280px'}),k.$('.j-form-edr').append(m),r=!0),f?k.$('.j-import-source-file').show().off('change').on('change',S):(k.$('.j-import-source-file').hide(),k.$('.j-source-pop-tip').remove(),r=!1),k._params.varList=null,k._params.varListRcptsName=null}}function D(){var e=k.get('composeId');l.go('setting.delivery.template',{type:'create',id:e})}function E(e){k.$('.j-import-source-file').hide(),k.$('.j-source-pop-tip').remove(),k._params.varList=null,k._params.varListRcptsName=null,e.siblings().removeClass('selected').end().addClass('selected'),_.html(''),k.replaceCurrentSign(),o=null,r=!1}new f('component.mailTemplate').onMessage('list:refresh',x).onMessage('switch.template',(function(e){k.get('composeId')===e.message.composeId&&(b=!0)})),this.render=x}}).call(this,a(464))},890:function(e,t,a){a(891);var i=a(464),n=a(463),s=a(465),o=a(500),l=a(892),r=a(473);e.exports=o.define({title:s('mail/lbl_template_file_upload'),closeTpl:'<span class="iconfont icontabclose"></span>',confirmTpl:s('common/confirm'),cancelTpl:s('common/cancel'),width:'800',height:'700'},(function(e,t,a){var o=Object.keys(t[0]),c=t.length,d=[],p=this;function u(e){var a=10*e;p.$('.u-variable-list').html(p.compile(p.$('#variableTpl').html(),{keys:o,items:t.slice(a,a+10)})).customRadioCheckbox();var l=p.$('.j-chk-all'),u=p.$('.j-select-single');function f(e){var t=d.length,a=t===c;e.prop('checked',a).next('.checkbox').toggleClass('checkbox-checked',a),p.$('.j-list-desc').html(r.h(s('mail/lbl_template_resolve_result'),[c,t]))}f(l),l.on('change.crc',(function(){d=this.checked?i.array(t.keys()):[],f(u)})),u.each((function(e,t){var s=a+e;t.checked=d.includes(s),n(t).on('change.crc',(function(){t.checked?d.push(s):d=i.difference(d,s),f(l)}))}))}e()({message:p.compile(l),afterRender:function(){p.element.addClass('u-source-preview')},onConfirm:function(){var e=p.$('.j-rcpt-name').val(),i=d.map((function(e){return t[e]}));a({rcptsKey:e,varList:i,tagList:i.map((function(t){return t[e]}))})}}),p.render=function(){e('render')(),p.$('.j-list-header').html(p.compile(p.$('#variableHeaderTpl').html(),{keys:o})),u(0),p.$('.j-source-pagination').pagination({total:c,limit:10,currentPage:0,menu:!0,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:u})}}))},892:function(e,t){e.exports='<div class="m-tpl-variable">\r\n  <div class="j-list-header"></div>\r\n  <div class="u-variable-list"></div>\r\n\r\n  {{#raw}}\r\n  <script type="text/x-handlebars-template" id="variableHeaderTpl">\r\n    <div class="var-list-header j-list-desc"></div>\r\n    <div class="var-list-rcpts">\r\n      <label>[[i18n \'mail/lbl_chose_source_rcps_column\']]</label>\r\n      <select name="rcpt_column_name" class="j-rcpt-name">\r\n        [[#each keys]]\r\n        <option value="[[this]]">[[this]]</option>\r\n        [[/each]]\r\n      </select>\r\n    </div>\r\n    <div class="j-source-pagination pagination"></div>\r\n  <\/script>\r\n\r\n  <script type="text/x-handlebars-template" id="variableTpl">\r\n    <div class="preview-wrapper">\r\n      <table class="u-table u-table-row j-var-table">\r\n        <thead>\r\n        <tr>\r\n          <th class="chk"><input class="j-chk-all" type="checkbox" /></th>\r\n          [[#each keys]]\r\n          <th>[[this]]</th>\r\n          [[/each]]\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n        [[#each items]]\r\n        <tr>\r\n          <td>\r\n            <input class="j-select-single" type="checkbox" />\r\n          </td>\r\n          [[#each ../keys]]\r\n          <td>[[lookup ../this this]]</td>\r\n          [[/each]]\r\n        </tr>\r\n        [[/each]]\r\n        </tbody>\r\n      </table>\r\n      <br>\r\n    </div>\r\n  <\/script>\r\n  {{/raw}}\r\n</div>'},893:function(e,t,a){(function(t,i,n,s){a(894),a(630),a(628),a(486);var o=a(507).formatFileType,l=a(488).bytesToSize,r=a(470).alert,c=a(895),d=a(479);function p(e,r){e.after('hide',(function(){p[0].iFrameResizer.close()}));var p=a(632)(e.$(),{},(function(p){!function(e,r,p){var u=p.account,f=p.to,m=p.cc,h=p.bcc,v=p.subject,g=p.isHtml,b=p.content,_=p.attachments,y=p.showOneRcpt,w=p.varKeyForRcpt,k=p.varList;function T(e){var t=e.displayName;return i.assign({},e,{filename:t,fileType:o(t),formatSize:l(e.size,2)})}function x(t){var o=k[t||0]||{};n.wmCall('mbox:tplComposePreview',{filterLinks:!1,filterImages:!1,isHtml:g,template:b,'var':o}).then((function(t){C.previewTo=o[w],function(t){e.$('.j-mail-headers').html(c.previewTpl(C)),e.$('.j-toggle-info').click((function(){e.$('.j-short-info,.j-full-info').toggle(),s('i',this).toggleClass('icondown iconup')})),e.$('.j-preview-container').scroll((function(t){e.$('.j-mail-headers').css({left:s(t.target).scrollLeft()})}));var n=i.groupBy(_,(function(e){return'trs'!==e.type?0:1}),[[],[]]),o=n[0],l=n[1];a(633)(e.$('.j-attachments'),{attachments:o.map(T),trsAttachments:l.map(T)}),r(g?t:s('<pre style=word-wrap:break-word wrap=soft>').text(t)[0].outerHTML)}(t)}))}k=(k||[]).filter((function(e){return f.includes(e[w])}));var C={subject:v,from:u,to:f,cc:m,bcc:h,attachments:_,date:d().format('YYYY-MM-DD, HH:mm:ss'),showOneRcpt:y,isHtml:g};x(),j=k.length||1,e.$('.j-preview-total').html(t('mail/lbl_preview_total',{total:j})),e.$('.j-toolbar-pagination').pagination({total:j,limit:1,currentPage:0,round:!0,prevText:t('common/op_prevmail'),nextText:t('common/op_nextmail'),menu:!0,callback:x});var j}(e,p,r)}))}e.exports=function(e){r(c(),{title:t('mail/lbl_template_preview'),closeTpl:!0,width:800,height:600,subClass:'u-preview-box',afterShow:function(){p(this,e)}})}}).call(this,a(465),a(464),a(466),a(463))},895:function(e,t,a){e.exports=a(469)('<div class="m-mail-preview"> <div class="preview-header"> <div class="preview-status"> <span class="j-preview-total"></span> <div class="preview-btns j-toolbar-pagination"></div> </div> </div> <div class="preview-wrapper m-read j-preview-container"> <div class="j-mail-headers f-pr"></div> <div class="mail-content"></div> <div class="j-attachments"></div> </div> </div>',{previewTpl:'<div class="mail-top"> <div class="top-bar"> <div class="f-tar f-vh"> <span class="mail-flagged f-pr f-csp" > <i class="iconfont iconflat" title="{{i18n \'mbox/mail_flag_flagged_true\'}}"></i> <i class="iconfont icondown"></i> </span> <span class="f-pr f-csp"> <i class="iconfont iconclock"></i> </span> <a class="iconfont iconemailcontacts" href="#" title=\'{{i18n "mbox/mail_dealings"}}\'></a> <a class="iconfont iconnewtab" href="#" title=\'{{i18n "mbox/mail_blank"}}\'></a> </div> <div class="f-tar"> <span>{{date}}</span> </div> </div> <div class="mail-top-info"> <h3 class="mail-subject "> <span class="icon"><i class="iconfont" ></i></span> {{subject}} </h3> <div class="short-info j-short-info f-ellipsis" style="display: block;"> <a href="javascript:void(0);">{{from}}</a> <span>{{i18n "mbox/send_to"}}</span> <a href="javascript:void(0)">{{#unless previewTo}} {{to}} {{else}} {{previewTo}} {{/unless}}</a> </div> <div class="full-info j-full-info f-dn"> <table class="u-table u-table-row"> <tr> <td class="info-item">{{i18n "mbox/mail_from"}} :</td> <td> <span class="u-email j-u-email"> <span class="name">{{hemail from \'nameOnly\'}}</span> <span class="address">{{hemail from \'addrWithQuote\'}}</span> </span> </td> </tr> <tr> <td class="info-item">{{#if showOneRcpt}} {{i18n "mail/mail_onercpt"}} {{else}} {{i18n "mbox/mail_to"}} {{/if}} :</td> <td> {{#unless previewTo}} {{#each to}} <span class="u-email j-u-email"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{/each}} {{else}} <span class="u-email j-u-email"> <span class="name">{{hemail previewTo \'nameOnly\'}}</span> <span class="address">{{hemail previewTo \'addrWithQuote\'}}</span> </span> {{/unless}} </td> </tr> {{#if cc.length}} <tr> <td class="info-item">{{i18n "mbox/mail_cc"}} :</td> <td> {{#each cc}} <span class="u-email j-u-email"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{/each}} </td> </tr> {{/if}} {{#if bcc.length}} <tr> <td class="info-item">{{i18n "mbox/mail_bcc"}} :</td> <td> {{#each bcc}} <span class="u-email j-u-email"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{/each}} </td> </tr> {{/if}} </table> </div> </div> <div class="mail-divider"> <a href="javascript:void(0)" class="u-btn u-btn-default u-btn-round f-fr j-toggle-info"><i class="iconfont icondown"></i></a> </div> </div>'})},896:function(e,t,a){var i=a(463),n=a(469),s=a(527),o=a(464),l=a(466),r=a(475),c=a(465),d=a(468),p=a(487),u=a(514),f=a(470).confirm,m=s.deserialize(d.get('user.sendmailwithsmsmode')||''),h=m.mobilenumbertip,v=m.scope,g='0'!==h,b=(v||'').split(',');var _=function(e){return w((function(t){return p.pabContactsByEmail().then((function(a){return o.iter(e,(function(e){t(e,o.mapFind(a(e)||[],o.prop('TEL;CELL;VOICE')))}))}))}))},y=function(e){return w((function(t){return u.lookup({uid:e,returnAttrs:['email','mobile_number']}).then((function(e){return o.iter(e,(function(e,a){t(a,e&&e.mobile_number)}))}))}))};function w(e){var t={};return(e||l.resolve)((function(e,a){a&&(t[e]=a)})).fin(t)}function k(e,t){var a,s=-1,o=n('<div class="j-sms-list" style="position:relative;"><div class="tableHead"><table class="u-table" style="font-size:13px;"><thead style="background-color:#f0f0f0;"><tr><th style="padding:6px;border: none;"><span>{{i18n "setting/lbl_emailAddress"}}</span></th><th style="padding:6px;border: none;"><span>{{i18n "setting/lbl_cellphone"}}</span></th></tr></thead></table></div><div class="j-list u-list u-scroll" style="max-height:290px;margin-bottom:6px;"><table class="u-table" style="font-size:13px;text-align:center;"><tbody>{{#each smsMaps}}<tr><td style="padding:6px;border:1px solid #ddd;border-width:0 0 1px;">{{@key}}</td><td style="padding:6px;border:1px solid #ddd;border-width:0 0 1px;"><input value="{{this}}" data-email="{{@key}}" class="j-input" style="text-align: center;" /></td> </tr>{{/each}}{{#each unMatchAddress}}<tr><td style="padding:6px;border:1px solid #ddd;border-width:0 0 1px;">{{this}}</td><td style="padding:6px;border:1px solid #ddd;border-width:0 0 1px;"><input value="" data-email="{{this}}" class="j-input" style="text-align: center;" /></td> </tr>{{/each}}</tbody></table></div><p class="error j-error" style="font-size:14px;color:#E15051;line-height:1.5;"></p></div>')({smsMaps:e,unMatchAddress:t});return f(o,{title:c('mail/msg_sendMailWithSms_to'),onConfirm:function(){var e=this.$('[data-role="message"] .j-sms-list').eq(0),t=e.find('.j-input'),n=e.find('.j-error'),o=c('mail/msg_sendMailWithSms_error'),r=function(e){var t=/^[0-9]+$/,a=!0,n={maps:{},blank:[]};return e.each((function(){var e=i(this),s=e.val(),o=e.data('email');if(s.length<=0)n.blank.push(o);else{if(!t.test(s))return a=!1,!1;n.maps[o]=s}})),!!a&&n}(t);return r?(clearTimeout(s),void(a=l.resolve(r.maps,r.blank))):(n.html(o),clearTimeout(s),s=setTimeout((function(){n.html('')}),3e3),!1)}}).then((function(){return a})).truthy()}t.initSmsNumber=function(e){return function(e){var t=[_,y],a={};return function i(n){var s=t[n];return s&&e.length?s(e).then((function(t){return o.assign(a,t),e=e.filter((function(e){return!t.hasOwnProperty(e)})),i(n+1)})):l.resolve(a,e)}(0)}(o.unique(function(e){var t=o.mapFilter(e.$('.j-form-tt input').get(),(function(e){var t=e.name,a=e.value;return t&&b.includes(t)&&a})).join(',');return o.mapFilter(r.parse(t),(function(e){return e.address}))}(e))).then((function(e,t){if(!g||!t.length&&o.isEmpty(e)){var a=/^[0-9]+$/,i={},n=[].concat(t);return o.iter(e,(function(e,t){a.test(e)?i[t]=e:n.push(t)})),l.resolve(i,n)}return k(e,t)}))}},897:function(e,t,a){a(898);var i=a(465),n=a(473),s=a(500),o=a(467),l=s.extend({attrs:{callback:function(){}},Statics:{FAILED_CODE_PROPERTIES:{FA_NEED_VERIFY_CODE:'mail/lbl_antispam_needVerifyCode',FA_INVALID_VERIFY_CODE:'mail/lbl_antispam_wrongVerifyCode'}},events:{'click .j-vc-refresh':'_doUpdateVerifyCode'},setup:function(){var e=this;e.set('title',i('main/sys_info')),e.set('message',e.compile('<div class="u-verifycode"><form class="u-form j-vc-form" onsubmit="return false"><p class="j-vc-tip">{{msgTip}}</p><div><label>{{label}}</label><input type="text" name="verifyCode" class="u-input j-vc-input"/><img alt="image" class="j-vc-image"/><a href="javascript:;" class="j-vc-refresh">{{refreshTxt}}</a></div></form></div>',{msgTip:i('mail/lbl_antispam_needVerifyCode'),label:i('mail/lbl_antispam_hint'),refreshTxt:i('mail/lbl_antispam_refreshTxt')})),l.superclass.setup.call(this),e.on('confirm',(function(){var t=e.$('input[name="verifyCode"]').val();t.length>0?e.get('callback')(e,t):e.$('.j-vc-tip').html(r('FA_INVALID_VERIFY_CODE'))})),e.on('cancel',(function(){e.destroy()})),e.on('failedSend',(function(t){e.$('.j-vc-tip').html(r(t)),e.$('.j-vc-input').val(''),e._doUpdateVerifyCode()}))},render:function(){l.superclass.render.call(this),this.show(),this._doUpdateVerifyCode()},destroy:function(){l.superclass.destroy.call(this)},_doUpdateVerifyCode:function(){var e=parseInt(1e10*Math.random());this.$('.j-vc-image').attr('src',n('/coremail/displayVerifyCode.jsp?category=compose&sid={0}&random={1}',[o.getSid(),e]))}});function r(e){var t=l.FAILED_CODE_PROPERTIES[e];return t?i(t):e}e.exports=l},899:function(e,t,a){e.exports=a(469)('',{plgTpl:'<div class="u-alert u-alert-warning u-alert-dismissible plgTip" style="display: none;"> <span class="close iconfont icondelword j-close"></span> <span class="cnt j-cnt">{{{i18n \'prop:common/upload_plugin_install\' 0=@global.$.cmpluginMeta.downloadUrl}}}</span> </div>',toolbarTpl:'<div class="toolbar"> <span class="u-btn u-btn-default f-fr aside-toggle" data-type=aside></span> <span class="u-btn u-btn-primary f-mgr j-tbl-send" data-type="send">{{i18n \'compose/lbt_send\'}}</span> <span class="u-btn u-btn-default" data-type="preview">{{i18n \'compose/htmltool_preview\'}}</span> {{#if enableSaveDraft}} <span class="u-btn u-btn-default j-tbl-draft" data-type="save">{{i18n \'compose/lbt_compose_save\'}}</span> {{/if}} <span class="u-btn u-btn-default j-tbl-cancel" data-type="cancel">{{i18n \'compose/lbt_compose_cancel\'}}</span> </div>',sidebarTpl:'<div class="mn-aside"> <div class="u-tab u-tab-highlight-down {{#if enableMailTemplate}} u-tab-three-items {{/if}}"> <ul data-role="nav"> <li class="z-current"><span class="bar"></span><a href="javascript:void(0);">{{i18n \'contact/tab_pab\'}}</a></li> <li class="stationery"><span class="bar"></span><a href="javascript:void(0);">{{i18n \'main/stationery\'}}</a></li> {{#if enableMailTemplate}} <li class="template"><span class="bar"></span><a href="javascript:void(0);">{{i18n \'mail/lbl_template\'}}</a></li> {{/if}} </ul> </div> <div class="content-wrapper"> <div class="sidebar-content" data-role="panel"> <div class="j-select-wrapper"></div> <div class="wrapper-container u-scroll"> <div id="mptree"></div> <div class="contacts-wrapper f-dn" id="searchResultContainer"> <ul class="expand"></ul> <div class="u-divider"></div> </div> <div class="add-contacts-wrapper"> <a class="j-trigger-contactdg link">{{i18n \'compose/add_from_contacts\'}}</a> </div> </div> </div> <div class="sidebar-content j-stationery stationery-wrapper disabled" data-role="panel"> <div class="stationery-disableTxt">{{i18n \'compose/stationery_disable\'}}</div> <div class="stationery-mask"></div> <div class="j-stationery-pagination pagination"></div> </div> {{#if enableMailTemplate}} <div class="sidebar-content j-template template-wrapper disabled" data-role="panel"> <div class="j-template-box"></div> <div class="j-template-pagination pagination"></div> </div> {{/if}} </div> </div>',frmTpl:'<div class="form-tt j-form-tt"> <div class="u-form-item j-all-email"> <ul class="u-list u-list-horizontal color f-fr j-ft-contact"> <li> <a href="javascript:void(0)" data-type="cc" class="z-active">{{i18n \'mail/mail_uncc\'}}</a> </li> <li>|</li> <li> {{#if bcc}} <a href="javascript:void(0);" data-type="bcc" class="z-active">{{i18n \'mail/mail_unbcc\'}}</a> {{^}} <a href="javascript:void(0);" data-type="bcc" title="{{i18n \'mail/mail_bcc_info\'}}">{{i18n \'mail/mail_bcc\'}}</a> {{/if}} </li> {{#if config.enableShowOneRcpt}} <li>|</li> <li class="mgrn"><a href="javascript:void(0);" data-type="onercpt" title="{{i18n \'mail/mail_onercpt_info\'}}">{{i18n \'mail/mail_onercpt\'}}</a></li> {{/if}} </ul> <label class="u-form-label"> <span class="f-pd">{{i18n \'compose/lbt_from\'}}</span> </label> {{#if accounts}} <select class="j-accounts"> {{#each accounts}} {{#if ../draftId}} <option value="{{email}}" {{#if (eq email ../account)}} selected {{/if}}>{{email}} &nbsp;&nbsp;</option> {{^}} <option value="{{email}}" {{#if (eq addr ../defaultAccount)}} selected {{/if}}>{{email}} &nbsp;&nbsp;</option> {{/if}} {{/each}} </select> {{^}} <div class="u-sender"> <span class="name">{{hemail account \'nameOnly\'}}</span> <span class="address">{{hemail account \'addrWithQuote\'}}</span> </div> {{/if}} </div> {{#seq \'to\' \'cc\' \'bcc\'}} <div class="u-form-item border j-form-item-{{.}} {{if$ (or ../bcc (ne . \'bcc\')) \'\' \'f-dn\'}}"> <span class="bar bar-left"></span> <label class=u-form-label><a class=link {{if$ embedCompose \'disabled\'}} contact={{.}}>{{i18n (join \'compose/lbt_\' . )}}</a></label> <input role=contact name="{{.}}" value="{{lookup .. .}}"> <span class="bar bar-right"></span> <a class="f-csp add-contacts j-trigger-contactdg" data-type={{.}}> <i class="iconfont iconaddcontact"></i> </a> </div> {{/seq}} <div class="u-form-item border"> <span class="bar bar-left"></span> <label class="u-form-label"><span class="f-pd">{{i18n \'compose/lbt_subject\'}}</span></label> <input type="text" class="input" name="subject" value="{{subject}}"/> <span class="bar bar-right"></span> </div> {{#if config.enableSecurityLevel}} <div class="u-form-item border"> <span class="bar bar-left"></span> <label class="u-form-label"><span class="f-pd">{{i18n \'mail/compose_security_level\'}}</span></label> <select name="security_level" class="j-securityLevel" {{#unless enableChangeSecurityLevel}}disabled{{/unless}}> {{#with senderSecurityLevel}} {{#each values}} <option value="{{.}}" {{#if (eq . ../value)}} selected {{/if}}>{{lookup ../all .}} &nbsp;&nbsp;</option> {{/each}} {{/with}} </select> <span class="bar bar-right"></span> </div> {{/if}} <div class="u-form-item-att border f-dn j-attachItem"> <label class="u-form-label"> <span class="f-pd">{{i18n \'compose/lb_attach\'}}</span> </label> <div class="j-attaches"></div> </div> <div class="f-cf j-ft-menu f-pr"> <ul class="u-list u-list-horizontal f-fl j-attachment-menu"> <li class="disabled-mask f-dn"></li> <li> <a class="f-csp u-upload" data-type=upload></a> </li> </ul> <ul class="u-list u-list-horizontal f-dn j-text-menu"> <li class="j-sign-menu"> <a class=f-csp data-type=signature>{{i18n \'compose/htmltool_Sign\'}} <i class="iconfont icondrop"></i></a> </li> <li> <label class="link u-import-source j-import-source-file"> {{i18n \'mail/lbl_import_tpl_source\'}} <input type=file name=source style="position: fixed; right: -9999px"> </label> </li> <li class="f-fr mgr"> <a class=f-csp data-type=html>{{i18n \'mail/compose_html\'}}</a> </li> </ul> <ul class="u-list u-list-horizontal j-html-menu"> <li> <a class=f-csp data-type=etbr title="{{i18n \'mail/compose_toolbar\'}}"><i class="iconfont iconword"></i></a> </li> <li> <a class=f-csp data-type=link title="{{i18n \'compose/htmltool_Url\'}}"><i class="iconfont iconlink"></i></a> </li> {{#if @IE}} <li> <a class=f-csp data-type=screencapture title="{{i18n \'compose/lbt_capture\'}}"><i class="iconfont iconpiccut"></i></a> </li> {{/if}} <li> <a class=f-csp data-type=image title="{{i18n \'compose/lbt_picture\'}}"><i class="iconfont iconpicture"></i></a> </li> <li> <a class=f-csp data-type=more>{{i18n \'main/opt_more\'}}<i class="iconfont icondrop"></i></a> </li> <li class="j-sign-menu"> <a class=f-csp data-type=signature>{{i18n \'compose/htmltool_Sign\'}}<i class="iconfont icondrop"></i></a> </li> <li><span data-type="attachuploaded"></span></li> <li> <label class="link u-import-source j-import-source-file"> {{i18n \'mail/lbl_import_tpl_source\'}} <input type=file name=source style="position: fixed; right: -9999px"> </label> </li> <li class="f-fr mgr"> <a class=f-csp data-type=text>{{i18n \'compose/lb_plaintext\'}}</a> </li> <li class="f-fr"> <a class=f-csp data-type=typo data-mode=mode_checkspelling>{{i18n \'compose/htmltool_spellcheck\'}}</a> </li> <li class="f-fr f-dn j-close-source-mode"> <a class=f-csp data-type=source data-mode=source_mode_close>{{i18n \'mail/close_source_edit\'}}</a> </li> </ul> <ul class="u-list u-list-horizontal expand f-ib"> <li class="f-fr mgrn"><a class=f-csp data-type=expand></a></li> </ul> </div> </div> <div class="form-edr j-form-edr"> <textarea name="ml-editor" class="editor"></textarea> <div class="form-edr-dnd j-form-dnd"> <a href="javascript:void(0);" class="j-dnd-close">{{i18n \'compose/lbt_addattach_dnd_close\'}}</a> <div class="j-dnd-info">{{i18n \'mail/compose_dnd\'}}</div> </div> </div> <div class="form-toolbar j-form-toolbar"> {{#if config.supportSMIMEServer}} <div> <ul class="u-list u-list-horizontal bt-hd"> <li> <label title="{{i18n \'compose/lbt_smime_tips\'}}"> <input type="checkbox" data-category=xSM9 data-type=smimeSign /> {{i18n \'compose/lbt_sendMailWithSigned\'}} </label> </li> <li> <label title="{{i18n \'compose/lbt_smime_tips\'}}"> <input data-category=xSM9 {{#if config.encryptedCheckedDefault}}checked{{/if}} type=checkbox data-type=smimeEncrypt /> {{i18n \'compose/lbt_sendMailWithEncrypted\'}} </label> </li> <li> <select data-category=xSM9 id=smimeEnvelopId name=smimeEnvelopId class=j-smime-envelop> <option value="">{{i18n \'compose/lbt_envelope_default\'}}&nbsp;</option> </select> </li> </ul> </div> {{/if}} {{#if config.supportSMIMEClient}} <div> <ul class="u-list u-list-horizontal bt-hd"> <li> <label title="{{i18n \'compose/lbt_smime_tips\'}}"><input type=checkbox data-type=useCASign /> {{i18n \'compose/lbt_sendMailWithSigned\'}}</label> </li> <li> <label title="{{i18n \'compose/lbt_smime_tips\'}}"><input type=checkbox data-type=useCAEncrypt /> {{i18n \'compose/lbt_sendMailWithEncrypted\'}}</label> </li> </ul> </div> {{/if}} <div class="bt-hd-wrap"> <ul class="u-list u-list-horizontal bt-hd"> <li class="bt-hd-more bt-hd-more-show"><a href="javascript:void(0);"><i class="iconfont icondown"></i> {{i18n \'common/more\'}}</a></li> <li class="bt-hd-more bt-hd-more-hide"><a href="javascript:void(0);"><i class="iconfont iconup"></i> {{i18n \'common/hide\'}}</a></li> <li><label><input type="checkbox" data-type="savesent"/> {{i18n \'compose/lb_savetosend\'}}</label></li> <li><label title="{{i18n \'mail/lbl_urgent_info\'}}"><input type="checkbox" data-type="urgent"/> {{i18n \'mail/lbl_urgent\'}}</label></li> <li><label title="{{i18n \'compose/lb_mdn_info\'}}"><input type="checkbox" data-type="rrr"/> {{i18n \'compose/lb_mdn\'}}</label></li> <li><label title="{{i18n \'compose/lbt_compose_timesend_set_info\'}}"><input type="checkbox" data-type="timesend"/> {{i18n \'compose/lbt_compose_timesend_set\'}}</label></li> {{#if config.enableQueryReadStatus}} <li><label title="{{i18n \'compose/lb_query_read_status_info\'}}"><input type="checkbox" data-type="queryreadstatus"/> {{i18n \'compose/lb_query_read_status\'}}</label></li> {{/if}} {{#if config.enableAutoDel}} <li><label title="{{i18n \'compose/autoDelMail_h2\'}}"><input type="checkbox" data-type="autodel"/>{{i18n \'compose/lb_autoDelMail\'}}</label></li> {{/if}} {{#if config.enableMailCipher}} <li><label title="{{i18n \'mail/msg_cipher_h2\'}}"><input {{#if config.encryptedCheckedDefault}}disabled{{/if}} type="checkbox" data-type="mailcipher"/> {{i18n \'compose/lb_mail_cipher\'}}</label></li> {{/if}} {{#if config.forbidDownload}} <li><label><input type="checkbox" data-type="forbidDownload"/> {{i18n \'compose/lb_mail_forbidDownload\'}}</label></li> {{/if}} {{#if config.enableDeliverWithSms}} <li><label><input type="checkbox" data-type="sendMailWithSms"/> {{i18n \'compose/lbt_sendMailWithSms\'}}</label></li> {{/if}} </ul> </div> <div class="bt-cnt"> <div class="timesend j-tb-timesend f-dn"></div> <div class="mailcipher f-dn"></div> <div class="autodel j-tb-autodel f-dn"></div> </div> </div>',timesendtpl:'{{#if supportTimeZone}} <p> <span>{{i18n \'mail/send_time_zone_text\'}}:</span> <select name="target_time_zone">{{{tzOptions timeZoneId}}}</select> </p> {{/if}} <div class="j-time-select">{{{scheduleDateSelect}}}</div> <p class="j-timesend-desc">{{{scheduleDate}}}</p>',mailciphertpl:'<div class="content f-cf"> <label class="f-fl" for="bt-mailcipher-password">{{i18n \'mail/lbl_cipher_password_label\'}}: </label> <div class="f-fl content-form"> <div class="content-form-item"> <input type="text" class="u-input" id="bt-mailcipher-password" maxlength="{{len}}">&nbsp; <span class="others">({{i18n \'prop:mail/msg_cipher_password_hint\' 0=len}})</span> </div> <div class="content-form-item"> <label for="bt-mailcipher-savePassword"> <input type="checkbox" name="bt-mailcipher-savePassword" id="bt-mailcipher-savePassword" data-type="savePassword"/> {{i18n \'mail/msg_cipher_save_password_in_sent\'}} </label> </div> </div> </div>',autodeltpl:'<p class="u-autodel-set"> <label>{{i18n \'compose/autoDelMail_readtimes_label\'}}</label> <input type="text" name="autoDelReadLimit" class="u-input j-read-limit" value="1" maxlength="2" > <span>{{i18n \'compose/autoDelMail_readtimes_hint\'}}</span> </p> <p class="u-autodel-set"> <label>{{i18n \'compose/autoDelMail_deltime_label\'}}</label> <span class="j-autodel-time-select">{{{autoDelDateSelect}}}</span> <span>{{i18n \'compose/autoDelMail_deltime_hint\'}}</span> </p>',forwarddtpl:'<div class="fwd-main"> <div class="fwd-title">{{i18n \'compose/lb_transmit_title\'}}</div> <div class="fwd-content"> <input type="text" class="u-input" name="bcc"/> </div> <div class="fwd-bottom"> <span class="u-btn u-btn-primary" data-type="forward">{{i18n \'compose/lbt_transmit_ok\'}}</span> <span class="u-btn u-btn-default" data-type="forwardCancel">{{i18n \'compose/lbt_compose_cancel\'}}</span> </div> </div>',successtpl:'<div class="suc-main u-scroll"> <div class="suc-title j-suc-title"> <div class="h2"> <i class="iconfont iconpass"></i> {{#if scheduletime}} {{i18n \'mail/compose_scheduled_success\' date=scheduletime}} {{^}} {{i18n \'mail/compose_send_success\'}} {{/if}} </div> {{#if status}} <a class=link action=status>{{i18n \'mail/compose_show_status\'}}</a> {{#if config.supportRecallMail}} <a class=link action=recall>{{i18n \'mail/compose_recall_mail\'}}</a> {{/if}} {{#unless @global.CM.detachMode}} <a class=link action=checkSent>{{i18n \'mail/compose_check_sent\'}}</a> {{/unless}} {{/if}} </div> {{#if encryptPassword}} <div class="suc-content"> <div class="suc-mailcipher"> <p class="icon"><i class="iconfont iconlock"></i></p> <p class="tips"> {{{ i18n \'prop:compose/cipher_msg_send_tip_1\' 0=encryptPassword}}} <br/> {{ i18n \'compose/cipher_msg_send_tip_2\' }} </p> </div> </div> {{/if}} <div class="suc-content"> <div class="j-status-detail"></div> <div class="j-contactlist cont"></div> <div class="desc {{#if aftersend_saveaddr}}toggled{{/if}} j-autosave-desc f-dn"> <p class="autosave"> {{i18n \'mail/compose_save_contact\'}}<a class=link>{{i18n \'compose/msg_send_autoSave\'}}</a> </p> <p class="no-autosave"> {{i18n \'mail/compose_not_save_contact\'}}<a class=link>{{i18n \'compose/msg_send_notautoSave\'}}</a> </p> </div> </div> {{#if smsAddrs}} <div class="suc-content"> <p class="suc-content-title">{{i18n \'mail/compose_sent_smsaddrs_title\'}}</p> <table class="u-table"> <tbody> {{#each smsAddrs}} <tr> <td class="f-ellipsis" title="{{@key}}({{this}})"> <span>{{@key}}</span> <span class="mobile">({{this}})</span> </td> </tr> {{/each}} </tbody> </table> </div> {{/if}} <div class="suc-content"> <div class="more-action u-btns j-more-action"> <a class="u-btn u-btn-default" data-type="back">{{i18n (if$ @global.CM.detachMode \'common/close_window\' \'mail/compose_backtolist\')}}</a> {{#if config.enableCompose}} <a class="u-btn u-btn-primary" data-type="continue">{{i18n \'mail/compose_continue\'}}</a> {{/if}} </div> </div> </div>',searchResultItem:'<li><a href="javascript:void(0)" title="{{matchText}}" data-addr="{{matchText}}">{{{matchPart}}}</a></li>',autosaveContactListTpl:'<p> {{#if (gt contacts.length 1)}}<span>{{i18n \'compose/msg_send_groupmail\'}}</span>{{/if}} {{#if aftersend_saveaddr}}<span>{{i18n \'compose/msg_send_addresslist_title\'}}</span>{{/if}} </p> <table class="u-table"> <tbody> {{#each contacts}} <tr> <td class="f-ellipsis" title="{{name}}{{if$ name (join \'<\' addr \'>\') addr}}"> <span class="name">{{securityLevel}} {{name}}</span> <span class="addr">{{if$ name (join \'<\' addr \'>\') addr}}</span> {{#if isAutoSave}} <span>({{i18n \'compose/msg_send_status_added\'}})</span> {{/if}} {{#if isExist}} <span class="addr">({{i18n \'compose/msg_send_status_exist\'}})</span> {{/if}} </td> <td class="f-tar"> <a class=link data-id="{{id}}" data-addr="{{addr}}" data-name="{{name}}"> {{#if id}}{{i18n \'main/bt_edit\'}}{{^}}{{i18n \'main/bt_add\'}}{{/if}} </a> </td> </tr> {{/each}} </tbody> </table>',deliverystatustpl:'<table class="u-table"> <thead> <tr> <th>{{i18n \'compose/lbt_to\'}}</th> <th>{{i18n \'mail/compose_status\'}}</th> </tr> </thead> <tbody> {{#each result}} <tr> <td class="f-ellipsis" title="{{to_name}}{{#if to_name}}&lt;{{to}}&gt;{{^}}{{to}}{{/if}}"> <span class="name">{{to_name}}</span> {{#if name}} <span class="addr">&lt;{{to}}&gt;</span> {{^}} <span class="addr">{{to}}</span> {{/if}} </td> <td> <span>{{{dsHtml}}}</span> <span class="time">({{time}})</span> </td> </tr> {{/each}} </tbody> </table>',contactsTpl:'{{#each groups}} <div class="contacts-wrapper {{flag}}"> <div class="aWrapper"> <a href="javascript:void(0)" data-toggled title="{{title}}"><i class="iconfont {{#if expand}}icondown{{^}}iconright{{/if}}"></i>{{name}}</a> <a href="javascript:void(0)" class="addToAddrField" data-trigger title="{{i18n \'contact/lbl_addContactsToAddressField\'}}">({{count}})</a> </div> <ul class="{{#if expand}}expand toggled{{/if}}"> {{#each children}} <li data-name="{{name}}" data-addr="{{emailaddr}}" title="{{emailaddr}}"><span>{{name}}</span></li> {{/each}} </ul> {{#or flag @last}} <div class="u-divider"></div> {{/or}} </div> {{/each}}',CAattachTpl:'{{#each items}} <div class="u-fileupload"> <div class="icon j-icon"><i class="iconfont iconacc"></i></div> <div class="name j-name" style="max-width: 600px">{{this.fileName}}</div> <div class="info j-info"><i class="iconfont iconchoose"></i></div> <div class="size j-size">{{this.size}}</div> <div class="btns j-btns"><a class="link j-delete-caattach" data-index="{{@index}}">{{i18n "common/delete"}}</a></div> </div> {{/each}}',CApluginInjectTpl:'<div role="CAcomposePlugin"> <object classid="clsid:A996E48C-D3DC-4244-89F7-AFA33EC60679" id="oCAPICOM"></object> <object type="application/x-cmplugin"> <param name="onload" value="pluginLoaded"> </object> </div>'})},906:function(e,t,a){(function(e,t,i,n){a(907),a(538);var s=a(472),o=a(471),l=a(473).h,r=a(475),c=a(468).get,d=a(467),p=a(908),u=a(651),f=-1,m=s.extend({},(function(s,o){var m=this,v=c('calendar')||{},g=v.enable,b=v.enableCalName;m.events={'click .j-cal-nav[data-fid]':[P]};var _,y=d.getCurrentState(),w=y.module,k=y.param,T=k.newMeeting?f:1,x=[];s()(o),m.$('.cal-main').html(h[g?'contentTpl':'forbiddenTpl']());var C=m.$('.j-cal-content'),j=m.$('iframe');function S(e){u().then((function(a,n){a[0].name=t('main/appname_MYCAL'),x=[{fid:f,name:t('cal/title_addEventOrMeeting')}].concat(a,i.flatMap(i.groupBy(n,'link_uid'),(function(e,a){return e.map((function(e,n){return i.assign({},e,{nm:l(t('main/cal_share_tab'),r(b&&e.link_uname,a).friendlyName())+(n||'')})}))}))),_=i.objBy(x,'fid'),P(T,e)}))}a(554)((function(e,t){switch(e){case'calendarLoaded':C.mask('destroy');break;case'load':R(t.value)}})),m.after('render',(function(){a(477).render(w,k),g&&(m.subscribe('setting.calendar.calendar','calUpdate',L),m.subscribe('dispatcher','locationChanged',(function(t){var a=t.message.newState,i=a.module,n=a.param;'calendar'===i&&n.selectedDate&&(P(1),e.notify.loading('hide'))})),S(),j.on('cal.forward',(function(e,t){var i=t.id;a(477).go('mail.compose',{id:i})})).on('cal.to-setting',(function(){a(477).go('setting.calendar.calendar')})).on('cal.set-time',(function(a,i){d.updateUser({first_week_day:+i}).then((function(){S(),e.notify(t('cal/info_update_success')),m.sendMessage('setting.calendar.calendar','view:refresh',{})}))})).on('cal.mr-bookings',p).on('cal.changeFolder',(function(e,t){P(t.fid,!1)})),m.onMessage('view:refresh',(function(e){T===e.message.fid&&(T=1),S()}))),e.notify.loading('hide')}));var $=m.$('.asideArea').hover((function(){var e=$.is(':hover')&&$.height()<D();I.add(M).toggle(e)})),D=function(e){return(e||x.length)*$.find('.j-cal-li').height()},E=0,M=m.$('.j-to-down').click(i.stop((function(){var e=$.height()-D();if(I.removeClass('u-disable'),!(e>=0))return E-D(1)<=e?($.css('top',e),void M.addClass('u-disable')):void $.css('top',E-=D(1))}))),I=m.$('.j-to-up').click(i.stop((function(){M.removeClass('u-disable'),E?($.css('top',E+=D(1)),E||I.addClass('u-disable')):$.css('top',0)})));function F(){if(m.$().is(':hidden'))m.rebindMessage('view:active',F);else{var e=a(490).getUrlParamValue.bind(0,j[0].contentWindow.location.search),t=+e('fid')||1;R(T===f?n.wmURL({url:'XT5/cal/eventEdit.jsp',fid:_[t].access-2?1:t})+'&func=add&addTime='+e('selectedDate')+'&view='+e('view')+'&calName='+e('calName'):n.wmURL({url:'XT5/cal/index.jsp',fid:T,linkUid:_[T].linkUid||''}))}}function R(e){C.mask(),j.attr('src',e)}function P(e,t){x.current=T=+e,m.$('.content-box').html(h.folderTreeTpl(x)),!1===t||F()}function L(e){var t=e.message,a=t.fid,i=t.updateType;S('UPDATE_ALL'===i||'UPDATE'===i&&a===T||'DELETE'===i&&a===T&&(T=1))}})),h=a(915);o.module({name:'calendar',template:h},m)}).call(this,a(463),a(465),a(464),a(466))},908:function(e,t,a){(function(t,i){a(909),a(910),a(509);var n=a(914),s=n.mrListTpl,o=n.showMRListTpl,l=a(463),r=a(479),c=a(465),d=a(473),p=a(470).alert,u=a(468).get;function f(e){var a=e.bookingsTip,n=e.mrList,p=e.defaultDate,f=this.delegateEvents({'click .mr-item[data-id]':[function(e,t){var a=n[e];a&&m[(a.selected=!t.hasClass('active'))?'add':'delete'](a),_()}],'click .j-cal-action[data-add]':[w],'click .j-mr-action[data-add]':[function(e){var t=h;h=Math.max(0,Math.min(h+ +e,Math.max(0,m.size-4))),t===h||y()}],'change .cal-date-sel':y}),m=new Set(n),h=0,v={},g=r().format('YYYY-MM-DD');p=p||g,f.$('.j-set-today').html(c('calendar/ui_today')+' '+g).click(w.bind(0,0));var b=f.$('.cal-date-sel').val(p).datepicker();function _(){f.$('.j-mr-list').html(s(n)),y()}function y(){(function(){var e=b.val(),a=m.size,n=t.array(m).slice(h,h+4);return i.all(t.map(n,(function(t,a){return t.isEven=!!(a%2),v[t.id]=v[t.id]||{},(t.events=v[t.id][e])||(n=t.email,o=e,i.wmCall('cal:getUserFreeBusyStatus',{m:!0,toweb:!0,user_id:n,fromdate:o+' 0:00',todate:o+' 23:59'})).then((function(a){a.forEach(s),t.events=v[t.id][e]=a}));var n,o}))).onRTN({hideOps:a<=4,isPreDisabled:!h,isNxtDisabled:h===a-4,showList:n});function s(t){var a=r(t[0]).diff(r(e+' 00:00:00'))>0?r(t[0]):r(e+' 00:00:00'),i=r(t[1]).diff(r(e+' 23:59:59'))<0?r(t[1]):r(e+' 23:59:59');t.top=Math.trunc(a.diff(r(e+' 00:00:00'))/36e5*30)+30,t.height=Math.trunc(i.diff(a)/36e5*30),t.name=t[2].match(/"?([^<]+?)"?\s*(?=[<@])/)[1],t.info=d(c('calendar/booking_hover_tip'),[a.format('HH:mm')+' - '+i.format('HH:mm'),t.name])}})().then((function(e){f.$('.j-show-list').html(o(e)),f.$('.u-scroll-wrapper').stop().animate({scrollTop:255},'500','swing'),f.$('.j-booker-name').each((function(){var e=l(this),t=e.width(),a=e.closest('.chip').width();t>a&&e.css({fontSize:a/t+'em'})}))}))}function w(e){b.val(e?r(b.val()).add(+e,'days').format('YYYY-MM-DD'):g).datepicker('update').change()}f.$('[data-role=foot]').append('<div class=u-bookings-tip>'+(a||'')+'</div>'),f.$().tooltip(),i.resolve(n||i.wmCall('oab:searchEx',{dn:u('user.orgid'),conditions:[{field:'@type',operator:'=',operand:'R'}],returnAttrs:['true_name','email'],windowSize:500})).then((function(e){t.iter(e,(function(e,t){e.id=t,e.selected=!!n})),n=e,_()}))}e.exports=function(e,a){p(n(),{width:'auto',title:c('calendar/ui_mr_bookings'),dnd:!0,afterShow:t.ary(f,1,a)})}}).call(this,a(464),a(466))},910:function(e,t,a){var i,n,s;n=[a(463),a(911),a(912),a(913),a(492),a(546)],(s='function'==typeof(i=function(e){return e.widget('ui.tooltip',{version:'1.12.1',options:{classes:{'ui-tooltip':'ui-corner-all ui-widget-shadow'},content:function(){var t=e(this).attr('title')||'';return e('<a>').text(t).html()},hide:!0,items:'[title]:not([disabled])',position:{my:'left top+15',at:'left bottom',collision:'flipfit flip'},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(t,a){var i=(t.attr('aria-describedby')||'').split(/\s+/);i.push(a),t.data('ui-tooltip-id',a).attr('aria-describedby',e.trim(i.join(' ')))},_removeDescribedBy:function(t){var a=t.data('ui-tooltip-id'),i=(t.attr('aria-describedby')||'').split(/\s+/),n=e.inArray(a,i);-1!==n&&i.splice(n,1),t.removeData('ui-tooltip-id'),(i=e.trim(i.join(' ')))?t.attr('aria-describedby',i):t.removeAttr('aria-describedby')},_create:function(){this._on({mouseover:'open',focusin:'open'}),this.tooltips={},this.parents={},this.liveRegion=e('<div>').attr({role:'log','aria-live':'assertive','aria-relevant':'additions'}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,'ui-helper-hidden-accessible'),this.disabledTitles=e([])},_setOption:function(t,a){var i=this;this._super(t,a),'content'===t&&e.each(this.tooltips,(function(e,t){i._updateContent(t.element)}))},_setOptionDisabled:function(e){this[e?'_disable':'_enable']()},_disable:function(){var t=this;e.each(this.tooltips,(function(a,i){var n=e.Event('blur');n.target=n.currentTarget=i.element[0],t.close(n,!0)})),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter((function(){var t=e(this);if(t.is('[title]'))return t.data('ui-tooltip-title',t.attr('title')).removeAttr('title')})))},_enable:function(){this.disabledTitles.each((function(){var t=e(this);t.data('ui-tooltip-title')&&t.attr('title',t.data('ui-tooltip-title'))})),this.disabledTitles=e([])},open:function(t){var a=this,i=e(t?t.target:this.element).closest(this.options.items);i.length&&!i.data('ui-tooltip-id')&&(i.attr('title')&&i.data('ui-tooltip-title',i.attr('title')),i.data('ui-tooltip-open',!0),t&&'mouseover'===t.type&&i.parents().each((function(){var t,i=e(this);i.data('ui-tooltip-open')&&((t=e.Event('blur')).target=t.currentTarget=this,a.close(t,!0)),i.attr('title')&&(i.uniqueId(),a.parents[this.id]={element:this,title:i.attr('title')},i.attr('title',''))})),this._registerCloseHandlers(t,i),this._updateContent(i,t))},_updateContent:function(e,t){var a,i=this.options.content,n=this,s=t?t.type:null;if('string'==typeof i||i.nodeType||i.jquery)return this._open(t,e,i);(a=i.call(e[0],(function(a){n._delay((function(){e.data('ui-tooltip-open')&&(t&&(t.type=s),this._open(t,e,a))}))})))&&this._open(t,e,a)},_open:function(t,a,i){var n,s,o,l,r=e.extend({},this.options.position);function c(e){r.of=e,s.is(':hidden')||s.position(r)}i&&((n=this._find(a))?n.tooltip.find('.ui-tooltip-content').html(i):(a.is('[title]')&&(t&&'mouseover'===t.type?a.attr('title',''):a.removeAttr('title')),n=this._tooltip(a),s=n.tooltip,this._addDescribedBy(a,s.attr('id')),s.find('.ui-tooltip-content').html(i),this.liveRegion.children().hide(),(l=e('<div>').html(s.find('.ui-tooltip-content').html())).removeAttr('name').find('[name]').removeAttr('name'),l.removeAttr('id').find('[id]').removeAttr('id'),l.appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:c}),c(t)):s.position(e.extend({of:a},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(o=this.delayedShow=setInterval((function(){s.is(':visible')&&(c(r.of),clearInterval(o))}),e.fx.interval)),this._trigger('open',t,{tooltip:s})))},_registerCloseHandlers:function(t,a){var i={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=a[0],this.close(i,!0)}}};a[0]!==this.element[0]&&(i.remove=function(){this._removeTooltip(this._find(a).tooltip)}),t&&'mouseover'!==t.type||(i.mouseleave='close'),t&&'focusin'!==t.type||(i.focusout='close'),this._on(!0,a,i)},close:function(t){var a,i=this,n=e(t?t.currentTarget:this.element),s=this._find(n);s?(a=s.tooltip,s.closing||(clearInterval(this.delayedShow),n.data('ui-tooltip-title')&&!n.attr('title')&&n.attr('title',n.data('ui-tooltip-title')),this._removeDescribedBy(n),s.hiding=!0,a.stop(!0),this._hide(a,this.options.hide,(function(){i._removeTooltip(e(this))})),n.removeData('ui-tooltip-open'),this._off(n,'mouseleave focusout keyup'),n[0]!==this.element[0]&&this._off(n,'remove'),this._off(this.document,'mousemove'),t&&'mouseleave'===t.type&&e.each(this.parents,(function(t,a){e(a.element).attr('title',a.title),delete i.parents[t]})),s.closing=!0,this._trigger('close',t,{tooltip:a}),s.hiding||(s.closing=!1))):n.removeData('ui-tooltip-open')},_tooltip:function(t){var a=e('<div>').attr('role','tooltip'),i=e('<div>').appendTo(a),n=a.uniqueId().attr('id');return this._addClass(i,'ui-tooltip-content'),this._addClass(a,'ui-tooltip','ui-widget ui-widget-content'),a.appendTo(this._appendTo(t)),this.tooltips[n]={element:t,tooltip:a}},_find:function(e){var t=e.data('ui-tooltip-id');return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr('id')]},_appendTo:function(e){var t=e.closest('.ui-front, dialog');return t.length||(t=this.document[0].body),t},_destroy:function(){var t=this;e.each(this.tooltips,(function(a,i){var n=e.Event('blur'),s=i.element;n.target=n.currentTarget=s[0],t.close(n,!0),e('#'+a).remove(),s.data('ui-tooltip-title')&&(s.attr('title')||s.attr('title',s.data('ui-tooltip-title')),s.removeData('ui-tooltip-title'))})),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget('ui.tooltip',e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}}),e.ui.tooltip})?i.apply(t,n):i)===undefined||(e.exports=s)},911:function(e,t,a){var i,n,s;n=[a(463),a(492)],(s='function'==typeof(i=function(e){return e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}})?i.apply(t,n):i)===undefined||(e.exports=s)},912:function(e,t,a){var i,n,s;n=[a(463),a(492)],(s='function'==typeof(i=function(e){return function(){var t,a=Math.max,i=Math.abs,n=/left|center|right/,s=/top|center|bottom/,o=/[\+\-]\d+(\.[\d]+)?%?/,l=/^\w+/,r=/%$/,c=e.fn.position;function d(e,t,a){return[parseFloat(e[0])*(r.test(e[0])?t/100:1),parseFloat(e[1])*(r.test(e[1])?a/100:1)]}function p(t,a){return parseInt(e.css(t,a),10)||0}function u(t){var a=t[0];return 9===a.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(a)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:a.preventDefault?{width:0,height:0,offset:{top:a.pageY,left:a.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.position={scrollbarWidth:function(){if(t!==undefined)return t;var a,i,n=e('<div style=\'display:block;position:absolute;width:50px;height:50px;overflow:hidden;\'><div style=\'height:100px;width:auto;\'></div></div>'),s=n.children()[0];return e('body').append(n),a=s.offsetWidth,n.css('overflow','scroll'),a===(i=s.offsetWidth)&&(i=n[0].clientWidth),n.remove(),t=a-i},getScrollInfo:function(t){var a=t.isWindow||t.isDocument?'':t.element.css('overflow-x'),i=t.isWindow||t.isDocument?'':t.element.css('overflow-y'),n='scroll'===a||'auto'===a&&t.width<t.element[0].scrollWidth;return{width:'scroll'===i||'auto'===i&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var a=e(t||window),i=e.isWindow(a[0]),n=!!a[0]&&9===a[0].nodeType;return{element:a,isWindow:i,isDocument:n,offset:i||n?{left:0,top:0}:e(t).offset(),scrollLeft:a.scrollLeft(),scrollTop:a.scrollTop(),width:a.outerWidth(),height:a.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var r,f,m,h,v,g,b=e(t.of),_=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(_),w=(t.collision||'flip').split(' '),k={};return g=u(b),b[0].preventDefault&&(t.at='left top'),f=g.width,m=g.height,h=g.offset,v=e.extend({},h),e.each(['my','at'],(function(){var e,a,i=(t[this]||'').split(' ');1===i.length&&(i=n.test(i[0])?i.concat(['center']):s.test(i[0])?['center'].concat(i):['center','center']),i[0]=n.test(i[0])?i[0]:'center',i[1]=s.test(i[1])?i[1]:'center',e=o.exec(i[0]),a=o.exec(i[1]),k[this]=[e?e[0]:0,a?a[0]:0],t[this]=[l.exec(i[0])[0],l.exec(i[1])[0]]})),1===w.length&&(w[1]=w[0]),'right'===t.at[0]?v.left+=f:'center'===t.at[0]&&(v.left+=f/2),'bottom'===t.at[1]?v.top+=m:'center'===t.at[1]&&(v.top+=m/2),r=d(k.at,f,m),v.left+=r[0],v.top+=r[1],this.each((function(){var n,s,o=e(this),l=o.outerWidth(),c=o.outerHeight(),u=p(this,'marginLeft'),g=p(this,'marginTop'),T=l+u+p(this,'marginRight')+y.width,x=c+g+p(this,'marginBottom')+y.height,C=e.extend({},v),j=d(k.my,o.outerWidth(),o.outerHeight());'right'===t.my[0]?C.left-=l:'center'===t.my[0]&&(C.left-=l/2),'bottom'===t.my[1]?C.top-=c:'center'===t.my[1]&&(C.top-=c/2),C.left+=j[0],C.top+=j[1],n={marginLeft:u,marginTop:g},e.each(['left','top'],(function(a,i){e.ui.position[w[a]]&&e.ui.position[w[a]][i](C,{targetWidth:f,targetHeight:m,elemWidth:l,elemHeight:c,collisionPosition:n,collisionWidth:T,collisionHeight:x,offset:[r[0]+j[0],r[1]+j[1]],my:t.my,at:t.at,within:_,elem:o})})),t.using&&(s=function(e){var n=h.left-C.left,s=n+f-l,r=h.top-C.top,d=r+m-c,p={target:{element:b,left:h.left,top:h.top,width:f,height:m},element:{element:o,left:C.left,top:C.top,width:l,height:c},horizontal:s<0?'left':n>0?'right':'center',vertical:d<0?'top':r>0?'bottom':'middle'};f<l&&i(n+s)<f&&(p.horizontal='center'),m<c&&i(r+d)<m&&(p.vertical='middle'),a(i(n),i(s))>a(i(r),i(d))?p.important='horizontal':p.important='vertical',t.using.call(this,e,p)}),o.offset(e.extend(C,{using:s}))}))},e.ui.position={fit:{left:function(e,t){var i,n=t.within,s=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,l=e.left-t.collisionPosition.marginLeft,r=s-l,c=l+t.collisionWidth-o-s;t.collisionWidth>o?r>0&&c<=0?(i=e.left+r+t.collisionWidth-o-s,e.left+=r-i):e.left=c>0&&r<=0?s:r>c?s+o-t.collisionWidth:s:r>0?e.left+=r:c>0?e.left-=c:e.left=a(e.left-l,e.left)},top:function(e,t){var i,n=t.within,s=n.isWindow?n.scrollTop:n.offset.top,o=t.within.height,l=e.top-t.collisionPosition.marginTop,r=s-l,c=l+t.collisionHeight-o-s;t.collisionHeight>o?r>0&&c<=0?(i=e.top+r+t.collisionHeight-o-s,e.top+=r-i):e.top=c>0&&r<=0?s:r>c?s+o-t.collisionHeight:s:r>0?e.top+=r:c>0?e.top-=c:e.top=a(e.top-l,e.top)}},flip:{left:function(e,t){var a,n,s=t.within,o=s.offset.left+s.scrollLeft,l=s.width,r=s.isWindow?s.scrollLeft:s.offset.left,c=e.left-t.collisionPosition.marginLeft,d=c-r,p=c+t.collisionWidth-l-r,u='left'===t.my[0]?-t.elemWidth:'right'===t.my[0]?t.elemWidth:0,f='left'===t.at[0]?t.targetWidth:'right'===t.at[0]?-t.targetWidth:0,m=-2*t.offset[0];d<0?((a=e.left+u+f+m+t.collisionWidth-l-o)<0||a<i(d))&&(e.left+=u+f+m):p>0&&((n=e.left-t.collisionPosition.marginLeft+u+f+m-r)>0||i(n)<p)&&(e.left+=u+f+m)},top:function(e,t){var a,n,s=t.within,o=s.offset.top+s.scrollTop,l=s.height,r=s.isWindow?s.scrollTop:s.offset.top,c=e.top-t.collisionPosition.marginTop,d=c-r,p=c+t.collisionHeight-l-r,u='top'===t.my[1]?-t.elemHeight:'bottom'===t.my[1]?t.elemHeight:0,f='top'===t.at[1]?t.targetHeight:'bottom'===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];d<0?((n=e.top+u+f+m+t.collisionHeight-l-o)<0||n<i(d))&&(e.top+=u+f+m):p>0&&((a=e.top-t.collisionPosition.marginTop+u+f+m-r)>0||i(a)<p)&&(e.top+=u+f+m)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.ui.position})?i.apply(t,n):i)===undefined||(e.exports=s)},913:function(e,t,a){var i,n,s;n=[a(463),a(492)],(s='function'==typeof(i=function(e){return e.fn.extend({uniqueId:(t=0,function(){return this.each((function(){this.id||(this.id='ui-id-'+ ++t)}))}),removeUniqueId:function(){return this.each((function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr('id')}))}});var t})?i.apply(t,n):i)===undefined||(e.exports=s)},914:function(e,t,a){e.exports=a(469)('<div class="u-mrbookings"> <div class="u-row-part u-bookings-content"> <div class="u-row-part-title"> <div class="f-fl"> <a class="f-csp u-title-today j-set-today"></a> </div> <div class="cal-date"> <a data-add="-1" class="f-csp cal-mi-icon iconfont iconprevious j-cal-action f-fl"></a> <input class="cal-date-sel f-fl" datepicker type="text"> <a data-add=1 class="f-csp cal-mi-icon iconfont iconnext j-cal-action"></a> </div> </div> <div class="j-show-list"></div> </div> <div class="u-row-part u-mr-list"> <div class="u-row-part-title">{{i18n \'calendar/ui_mr_list\'}}</div> <ul class="u-list j-mr-list"></ul> </div> <div class="u-bookings-tip"></div> </div>',{mrListTpl:'{{#each .}} <li class="mr-item {{#if selected}} active{{/if}}" data-id="{{id}}">{{true_name}}</li> {{/each}}',showMRListTpl:'<table class="u-mr-show-list" cellpadding="0" cellspacing="0"> <tbody> <tr> <td style="width:64px;text-align: right;"><a class="f-csp iconfont iconprevious j-mr-action{{if$ isPreDisabled \' disable\'}}{{if$ hideOps \' f-dn\'}}" data-add="-1"></a></td> {{#each showList}} <th style="width: {{math 462 \'/\' ../showList.length}}px"><span title="{{true_name}}">{{true_name}}</span></th> {{else}} <th width="100%">{{i18n \'calendar/msg_select_mr\'}}</th> {{/each}} <td style="width:14px;"><a class="f-csp iconfont iconnext j-mr-action{{if$ isNxtDisabled \' disable\'}}{{if$ hideOps \' f-dn\'}}" data-add=1></a></td> </tr> </tbody> </table> <div class="u-tg-container"> <div class="u-scroll-wrapper"> <table id="tgTable" class="tg-timedevents" cellpadding="0" cellspacing="0"> <tbody> <tr height="1"> <td style="width:64px;"></td> <td colspan="{{showList.length}}"> <div class="tg-spanningwrapper"> <div class="tg-hourmarkers"> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> <div class="tg-markercell"></div> </div> </div> </td> </tr> <tr> <td class="tg-times-pri"> <div class="tg-time-pri tg-time-pri-gmt">GMT+8</div> <div class="tg-time-pri"><span>00:00</span></div> <div class="tg-time-pri"><span>01:00</span></div> <div class="tg-time-pri"><span>02:00</span></div> <div class="tg-time-pri"><span>03:00</span></div> <div class="tg-time-pri"><span>04:00</span></div> <div class="tg-time-pri"><span>05:00</span></div> <div class="tg-time-pri"><span>06:00</span></div> <div class="tg-time-pri"><span>07:00</span></div> <div class="tg-time-pri"><span>08:00</span></div> <div class="tg-time-pri"><span>09:00</span></div> <div class="tg-time-pri"><span>10:00</span></div> <div class="tg-time-pri"><span>11:00</span></div> <div class="tg-time-pri"><span>12:00</span></div> <div class="tg-time-pri"><span>13:00</span></div> <div class="tg-time-pri"><span>14:00</span></div> <div class="tg-time-pri"><span>15:00</span></div> <div class="tg-time-pri"><span>16:00</span></div> <div class="tg-time-pri"><span>17:00</span></div> <div class="tg-time-pri"><span>18:00</span></div> <div class="tg-time-pri"><span>19:00</span></div> <div class="tg-time-pri"><span>20:00</span></div> <div class="tg-time-pri"><span>21:00</span></div> <div class="tg-time-pri"><span>22:00</span></div> <div class="tg-time-pri" style="border-bottom: 0;"><span>23:00</span></div> </td> {{#each showList}} <td class="tg-col"> {{#if isEven}} <div class="tg-even"></div> {{/if}} {{#if events}} {{#each events}} <div class="tg-event-wrapper"> <div class="chip" style="top: {{top}}px;line-height: {{height}}px;" title="{{info}}"><span class="j-booker-name">{{name}} {{i18n \'calendar/piece_booked\'}}</span></div> </div> {{/each}} {{/if}} </td> {{/each}} </tr> </tbody> </table> </div> </div>'})},915:function(e,t,a){e.exports=a(469)('<section class="m-calendar j-calendar"> <div class="nav-main cal-main"> </div> </section>',{forbiddenTpl:'<div class="cal-forbidden">{{ i18n "pref/fa_forbidden" }}</div>',contentTpl:'<aside class="g-sidebar cal-g-sidebar" style="overflow: hidden;"> <div class="asideArea" style="position: absolute;"> <div class="cal-list-wrap"> <div class="cal-list-bg"></div> <div class="u-to-up j-to-up u-unselectable u-disable" ><i class="iconfont iconup" ></i></div> <div class="u-to-down j-to-down u-unselectable" ><i class="iconfont icondown" ></i></div> <div class="content-box"></div> </div> </div> </aside> <article class="cal-g-content j-cal-content u-scroll" style="margin-left: 105px"> <div class="cal-content-bg"></div> <div class="cal-content-wrap"> <iframe src="" frameborder="0" allowtransparency="true" name="calframe"></iframe> </div> </article>',folderTreeTpl:'<ul class="m-nav cal-m-nav"> {{#each .}} <li class="j-cal-li"> <a class="f-csp m-nav-trigger j-cal-nav {{if$ (eq fid ../current) \'nav-sb-current\'}}" data-fid="{{fid}}"> <span><i class="iconfont {{if$ (eq fid -1) \'iconsetevent\' \'iconmyschedule\'}}"></i>{{name}}{{{nm}}}</span> </a> </li> {{/each}} </ul>'})},930:function(e,t,a){(function(e){a(931);var t=a(530);a(584);var i=a(463),n=a(465),s=a(487),o=a(514),l=a(519),r=a(473),c=a(471),d=a(468).get,p=a(467),u=p.getCurrentState,f=p.go,m=a(504),h=l.extend({},(function(l,p){var h,v=this,g=v;function b(l,p,u){var m='contact.'+l,h={id:m,title:n('contact/tab_'+l),module:c.module(m),init:function(c){var p=l+'Tree',g=i('#'+p),b=t(p,u?o.dir:s.getPabGroupsWithCount,u?o.ztFmt:function(t){return[{name:n('contact/gp_all'),id:'',count:t.gcCount}].concat(t.groups,[{name:n('contact/gp_other'),id:'OTHER',count:t.noGroupContactsCount}]).map((function(t){return e.assign({},t,{nm:t.name,name:r(n('contact/lbl_grpNameWithCount'),[t.name||n('common/none'),t.count])})}))},k,0,(function(e,t,a,i){a&&!i||(f(m,{cid:e}),w.setCid(e,t,b))}),{addDiyDom:y}),w=a(472).queryByName(m);function k(){t.select(b,c,u&&o.parentsDN,u?d('user.ou'):'')}function T(e){w.invoke(i(this).data('operation')||e)}(h.show=function(e){_.hide().has(g).show(),e&&'cid'in e&&k(c=e.cid),e&&T(e)})(),_.has(g).on('click','[data-operation]',T),v.subscribe(m,'changed',b.reAsyncChildNodes.bind(b,0,'refresh'))}};c.module({name:m},p);return h}h=e.filter([d('user.supportoab')&&b('oab',a(932),1),d('user.supportpab')&&b('pab',a(935))]),l()(e.assign({element:a(937)(h),classPrefix:'j-contact',activeTabId:'contact.'+u().param.view,activeTriggerClass:'z-current',onlyRenderActive:!0,tabs:h},p)),g.on('render',(function(t){a(477).render(t),setTimeout(e.fn(g.find(t).init,(u().module===t&&u().param).cid))})).on('refresh',a(477).refresh),v.after('render',(function(){var e,t,a,i;e=v.$('.ctsidebar'),t=v.$('.ctmain'),a=v.$().outerWidth(),i=m.get('contact_resize_offset')||216,e.css({width:i}),t.css({left:i}),t.resizable({handles:'w',maxWidth:a-216,minWidth:a-416,stop:function(e,t){m.set('contact_resize_offset',t.position.left)},resize:function(a,i){e.css({width:i.position.left}),t.css({width:'inherit'})}}),t.find('.ui-resizable-handle').addClass('ui-resizable-border-left ui-resizable-border-right').html('<i class="iconfont iconsliderv"/>')})).before('destroy',(function(){i(window).off('resize.contact')})),v.subscribe('dispatcher','url:changed view:changed',(function(e){var t=e.topic,a=e.message.newState,i=a.module,n=a.param,s=g.find(i),o='url:changed'===t;s&&s.show&&s.show(o&&n),s&&o&&g.switchTo(i)})),i(window).off('resize.contact').on('resize.contact',(function(){var e=v.$().outerWidth();e>0&&(v.$('.ctmain').resizable('option','maxWidth',e-216),v.$('.ctmain').resizable('option','minWidth',e-416))}));var _=v.$('.ztree').parent().hide();function y(e,t){var a=v.$('#'+t.tId+'_a'),i=v.$('#'+t.tId+'_switch');a.find('#'+t.tId+'_ico').before(i),t.level=t.level?t.level:0;var n='<span style="display: inline-block;width: '+16*(t.level+1)+'px"></span>';if(i.before(n),!t.isParent){i.css('line-height','14px').html('<i class="iconfont icongroup"></i>')}i.parent().wrap('<div class="node-wrapper"/>')}}));c.module({name:'contact'},h)}).call(this,a(464))},932:function(e,t,a){(function(t,i){a(933),a(486);var n=a(463),s=a(489),o=s['default'],l=s.rcCheck,r=a(465),c=a(466),d=a(571),p=a(472),u=a(514),f=a(473).h,m=a(470),h=m.alert,v=m.prompt,g=a(522),b=a(487),_=a(474),y=a(543),w=a(468).get,k=a(467),T=k.go,x=a(658),C=a(659),j=a(475),S=w('contact.itemperpage')||20;var $=a(934);e.exports=p.extend({element:$()},(function(e,s){var p,m,D,E,M,I=this,F=function(e,t){return I.delegateEvents('click [data-'+e+']',[t])},R=w('context.locale')||'',P=w('contact.oab.normalListAttrs'),L=w('contact.oab.searchListAttrs'),A=w('contact.oab.viewattrs'),z=t.unique(t.map(A,'id').concat('@id @type @list true_name email @ou gender @location duty'.split(' '))),N=new Set;e()(s);var U=I.$('.j-mailListToolbar'),O=I.$('div.listview tbody'),H=I.$('div.thumbview ul'),q=I.$('.j-panel-detail');function W(e){T(I.name,{cid:e})}function G(){Z(t.fn(b.getOabOuUserList,p,P,t,S,E))}I.render(),new y({element:I.$('section.panel'),triggerType:'click'}),b.pabGroups().then((function(e){I.$('.panel .toolbar-wrapper').prepend($.toolbarTpl(e)),U.prepend($.mailListToolbarTpl(e)),I.$('span.j-moreOp').dropdown({callback:function(){var e=n(this),a=J(e),i=a[0],s=a[1],o=a[2],l=o?[o]:i?t.map(i,'uniqueid'):s?[s['@id']]:[],c=o?[o]:i?t.map(i,'emailaddr'):s?[s.email]:[];function d(){var e=t.some(i,'isDir'),a=t.some(i,'isRemote');return e||a?h(r(e?'contact/msg_unableToExportList':'contact/msg_unableToExportRemoteUser')):l.length?void 0:h(r('contact/msg_selContactToAdd'))}switch(e.data().action){case'addToPabContact':d()||function(e,t){u.exportToPab(e,t).then((function(e){e=e||{},n.notify(f(r('contact/msg_exportToPabSuccessful'),[e.added,e.updated,e.ignored]))})).onFail((function(){n.notify(r('contact/msg_exportToPabFail'),{type:'error'})}))}(l,e.attr('data-groupid'));break;case'addGroup':d()||function(e){b.pabGroups().then((function(t){v(r('contact/lbl_newGrpName'),{parentNode:I.$(),onConfirm:function(a){var i=C.validate(a,t,'addnew');if(!i.state)return n.notify.error(i.errMsg),!1;b.savePabGroup({name:a,type:1,uidsForOab:e.join(' ')}).then((function(e){var t=e.summary||{};n.notify(f(r('contact/msg_exportToPabSuccessful'),[t.added,t.updated,t.ignored]))}))}})}))}(l);break;case'listMails':T('mail.search',{fromType:'oab',fromAddress:c.join(',')})}}})})),I.$('section.content').on('click','span.j-selectAll .checkbox',(function(e){e.stopPropagation();var t=n(this).hasClass('checkbox-checked'),a=X(I.$('.content:visible tbody :checkbox:'+(t?'not(:checked)':'checked')));V(!0,t),t?te(a):ae(a)})).on('click','.u-table tbody .checkbox',(function(e){e.stopPropagation();var t=n(this).hasClass('checkbox-checked'),a=X(n(this).prev());V(a,t),t?te(a):ae(a)})),I.before('destroy',(function(){B.destroy()})),I.setCid=function(e,a,i){p=a,m=a.getPath(),ne(),function(e){Y.$('[name=dn]').html(t.flatMap(e.getNodes(),(function(e){return[n('<option>',{value:e.id,text:e.name,selected:e===m[0]})].concat(e!==m[0]?[]:t.map(e.children,(function(t){return n('<option>',{value:t.id,text:e.name+'/'+t.name})})))})))}(i),G()};var B=new g({element:I.$('.j-select-wrapper'),placeholder:r('contact/lbl_quickSearchContacts'),controlClassName:'u-input-control-1'}).on('submit',(function(e){ne({dn:m[0].id,recursive:!0,keyword:e})})),Y=new d({template:$.advanceSearchTpl,trigger:I.$('.j-advanceSearch'),triggerType:'click',parentNode:I.$(),align:{baseXY:['100%',0]}}).render();function V(e,a){var i=I.$('section.content:visible'),s=i.find('tbody :checkbox'),o=!0===e?s:n(t.mapFilter(e,(function(e){return s.filter('[data-uniqueid="'+e.uniqueid+'"][data-cdn="'+e.cdn+'"]')[0]})));l(o,a),o.parents('tr').toggleClass('contact-selected',a),l(i.find('span.j-selectAll :checkbox'),!s.filter(':not(:checked)')[0])}function K(){Q(N.size?'list':'-list'),I.$('[name=toLunkr]').toggle(1===N.size)}function X(e){return e.get().map((function(e,a){return t.assign({uniqueid:a=(e=n(e).closest('[data-uniqueid]')).attr('data-uniqueid'),cdn:e.attr('data-cdn')},e.is('li')?{}:{name:e.attr('data-name'),emailaddr:e.attr('data-emailaddr')||e.val(),isDir:e.is('.j-dir')||a===e.closest('tr').data('dn'),isRemote:e.is('.j-remote-user')||'O'===e.data().usertype})}))}function Q(e){I.$('.main-wrapper').toggleClass('switch-detail','detail'===e).toggleClass('switch-list','list'===e||'-detail'===e&&N.size>0)}function Z(e){var t=se();!function i(n){t.mask(),e(n*S||0).fin((function(e,s,l,c){t.mask('hide'),e&&(function(e,t,i,n){var s=D?L:P;e.find('.u-table thead').html($.listHeadTpl({fields:s,order:E}));var l=e.find('.u-table tbody');e.find('.deptInfo').html(f(r('contact/lbl_deptInfo'+(n>1?1:0)),[D?r('pab/c_search_result'):p.name,i,n,i-n])),t[0]?(l.html(t.map((function(e){return $.listTpl({type:e['@type']||'O',gender:e.gender||0,'class':e['@type']?'L'===e['@type']?'iconmaillist':1==+e.gender?'iconwomen gender-woman':'iconman gender-man':'icongroup',name:e.true_name=e.name||e.true_name,emailaddr:e.email,uniqueid:e.id||e['@id'],cdn:e['@ou'],td:e['@type']&&s.map(b.oabRow(e)),fields:s})}))),V(X(O.find('tr')),!0)):l.html($.contactsEmptyTpl({colspan:s.length+2})),o(I.$()),a(569).byWrapper(I)}(t,s,l,c),n||function(e,t){I.$(D?'.u-search-pagination':'.u-list-pagination').pagination({total:e||1,limit:S,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:t})}(l,i))}))}()}function J(e){var t=U.has(e)[0],a=I.$('.panel-content > div:visible');return[!t&&a.is('.list')&&X(O.find('tr')),!t&&a.is('.detail')&&ee(),t&&I.$('.j-listDetail').find('#maillist_id').text()]}function ee(){return q.data('info')||{}}function te(e){var t='',a='',n=[];e.forEach((function(e){var s=e.uniqueid;N.has(s)||(N.add(s),e.isDir?e.avatar=i.stylePath('img/people.png'):n.push(s),t+=$.selectedContactListTpl(e),a+=$.selectedContactThumbTpl(e))})),H.append(a),O.append(t),n.length&&b.contactAvatars('oab',n.join(' ')).then((function(e){e.forEach((function(e){H.find('[data-uniqueid="'+e.uid+'"] img').attr('src',e.avatarUrl)}))})),K()}function ae(e){!0===e?(O.empty(),H.empty(),N.clear()):e.forEach((function(e){var t=e.uniqueid;N['delete'](t),O.find('[data-uniqueid="'+t+'"]').remove(),H.find('[data-uniqueid="'+t+'"]').remove()})),K()}function ie(e){Q('detail'),I.$('.panel').mask(),c.when(b.oabGet(e,z),b.contactAvatars('oab',e)).then((function(a,i){a=a[0]||{},n.isEmptyObject(a)&&(a.id=e,a.name=e,a.email=e),a.id=a['@id'],a.name=a.true_name?a.true_name:a.nick_name?a.nick_name+r('contact/lbl_nickName'):'',a.avatar=i[0].avatarUrl,a.emailaddr=a.email,a.location=a['@location'],a.ou=a['@ou'],a.genderCls=1==a.gender?'iconwomen gender-woman':'iconman gender-man',a.province&&a.city&&(a.area=x.out(a.province,a.city,R)),a.fields=t.mapFilter(A,(function(e){return!/^(true_name|@location|@ou|duty|emails)$/.test(e.id)&&t.assign({value:b.oabRow(a)('email'===e.id&&a.emails?'emails':e)},e)})),q.html($.contactTpl(a)).data('info',a)})).either((function(){I.$('.panel').mask('hide')}))}function ne(e){e?(D||(M=E),E=0):D&&(E=M),D=e&&b.oabSearch(e,L,S),I.$('.j-search-return').toggleClass('f-dni',!D),se(),D&&Z(D())}function se(e){return I.$('[data-action=up]').toggle(!D&&!!m[1]),I.$('.content-wrapper').attr('class','content-wrapper toggled-'+(e||(D?'searchList':'list'))).find('.content:visible')}(I.invoke=function(e){var t=e.type,a=e.id;switch(t){case'detail':a&&ie(a)}})(k.getCurrentState().param),F('action',{advanceSearch:function(){ne(I.$('[name=advanceSearchForm]').serializeJSON({defaultType:'+B'})),Y.hide()},showO:function(e,t){W(t.data('dn'))},back:t.fun(se),up:function(){W(m.at(-2).id)},show:function(e,t){ie(t.find(':checkbox').data('uniqueid'))},msg:function(e,t){var a=[],i=!t.is('[name=toLunkr]'),s=function(e,t){a.push(i?''+j(t,e):e)},o=J(t),l=o[0],c=o[1],d=o[2];d?s(d):l?l.forEach((function(e){s(e.emailaddr,e.name)})):c&&s(c.email,c.true_name),i?_.compose({to:a}):a[0]?a[1]||n('.m-lunkr').data().self.load({uid:a[0]},'webMailNewChat2'):h(r('contact/msg_empty_email'))},accessToOu:function(){W(ee()['@ou'])},showL:function(e,t){!function(e){var t=e.find(':checkbox').data('uniqueid'),a=se('mailList').mask(),i=a.find('.u-table tbody');b.oabGet(t,z).then((function(e){e=e[0];var t=$.mailListDetailsTpl({name:e.true_name,id:e['@id'],location:e['@location']});I.$('.j-listTableDec').html(f(r('contact/lbl_deptInfo3'),0)),i.html($.contactsEmptyTpl({colspan:P.length+2})),I.$('.j-listDetail').html(t);var a=(e['@list']||'').split(',').filter((function(e){return e}));a[0]&&b.oabGet(a,z).then((function(e){I.$('.j-listTableDec').html(f(r('contact/lbl_deptInfo3'),e.length));var t='';e.forEach((function(e,i){(e=e||{true_name:a[i],email:a[i],'@id':a[i]}).usertype=e['@type']?e['@type']:'O',e.gender=e.gender?e.gender:0,e['class']=1==e.gender?'iconwomen gender-woman':'iconman gender-man',e.emailaddr=e.email,e.uniqueid=e['@id'],e.cdn=e['@ou'],e.td=P.map(b.oabRow(e)),t+=$.listMailListTpl(e)})),i.html(t),V(X(O.find('tr')),!0),o(I.$())}))})).either((function(){a.mask('hide')}))}(t)}}),F('operation',(function(e,t){switch(e){case'remove':var a=X(t);ae(a),V(a,!1);break;case'removeAll':ae(!0),V(!0,!1);break;case'showList':B.trigger('clearKeyword'),ne();break;case'closePopup':Y.hide();break;case'cleanUpText':t.addClass('f-dn'),t.prev('input').val('');break;case'closeDetails':Q('-detail')}})),F('sort',(function(e){E={field:e,desc:E&&E.field===e&&!E.desc},D?Z(D(E)):G()}))}))}).call(this,a(464),a(478))},934:function(e,t,a){e.exports=a(469)('<section class="m-ctoab"> <div class="main-wrapper"> <div class="content-wrapper"> <header class="toolbar"> <button class="u-btn u-btn-primary u-btns-hide u-btn-prev" data-action=up> <i class="iconfont iconupperlayer"></i>{{i18n "contact/op_goPrevLevel"}} </button> <div class="search-toolbar"> <span class="j-search-return u-btn u-btn-default f-dni u-btn-search-return" data-operation="showList"> {{i18n "oab/act_search_back"}} </span> <div class="f-ib j-select-wrapper"></div> {{#if @config.contact.oab.enableAdvancedSearch}} <div class="f-pr f-ib"> <span class="u-btn u-btn-default j-advanceSearch"> {{i18n "contact/op_advanceSearch"}} </span> </div> {{/if}} </div> <div class="u-btns f-fr u-list-pagination"></div> <div class="u-btns f-fr u-search-pagination"></div> </header> <section class="content content-list"> <div class=deptInfo></div> <div class="u-list u-scroll"> <table class="u-table u-table-assign u-table-row"> <thead></thead> <tbody></tbody> </table> </div> </section> <section class="content content-searchlist"> <div class=deptInfo></div> <div class="u-list u-scroll"> <table class="u-table u-table-assign u-table-row"> <thead></thead> <tbody></tbody> </table> </div> </section> <section class="content content-mailList"> <header class="toolbar j-mailListToolbar"></header> <div class="j-listDetail u-maillist-info"></div> <div class="u-list u-scroll mailList"> <div class="j-listTableDec"></div> <table class="u-table u-table-assign u-table-row"> <thead></thead> <tbody></tbody> </table> </div> </section> </div> <section class="panel"> <header class="toolbar"> <div class="toolbar-wrapper"> <div class="u-btns btns-list f-fr" data-role=nav> <button class="u-btn u-btn-default"> <i class="iconfont iconblock"></i> </button> <button class="u-btn u-btn-default"> <i class="iconfont iconlist"></i> </button> </div> </div> </header> <div class="panel-content u-scroll u-scroll-wrapper"> <div class="detail j-panel-detail"> </div> <div class=list data-role=content> <div class="thumbview"> <div class="list-wrapper"> <ul> </ul> </div> </div> <div class="listview"> <table class="u-table u-table-assign2"> <tbody></tbody> </table> </div> </div> </div> </section> </div>              </section>',{listHeadTpl:'<tr> <th class="firstTH"> <span class="j-selectAll"> <input type="checkbox" /> </span> </th> <th class="nth2TH">&nbsp;</th> {{#each fields}} <th {{#if sortable}}data-sort="{{id}}"{{/if}} class="{{#gt @index 1}}hideForShrink{{/gt}}"> <div class="f-ellipsis"> {{label}} {{{if$ (eq id ../order.field) (join \'<i class="iconfont iconmove\' (if$ ../order.desc \'down\' \'up\') \'"></i>\') }}} </div> </th> {{/each}} </tr>',listTpl:'<tr data-action="show{{if$ (in type \'O,L\') type}}" data-dn="{{if$ (eq type \'O\') uniqueid}}" data-email="{{emailaddr}}" data-gender="{{gender}}"> <td class="firstTD"> {{#if emailaddr}} <input type="checkbox" value="{{emailaddr}}" data-name="{{name}}" data-cdn="{{cdn}}" data-uniqueid="{{uniqueid}}" data-gender="{{gender}}"> {{^}}&nbsp;{{/if}} </td> <td class="nth2TD"><i class="iconfont {{class}}"></i></td> {{#each td}} <td class="{{#gt @index 1}}hideForShrink{{/gt}}"> <div class="f-ellipsis" title="{{.}}">{{.}}</div> </td> {{^}} <td colspan="{{fields.length}}"><div class=f-ellipsis title="{{formatted name}}">{{formatted name}}</div></td> {{/each}} </tr>',mailListDetailsTpl:'<h4>{{i18n \'contact/lbl_maillist_dec\'}}</h4> <div class="detail-item"> <label>{{i18n \'contact/lbl_maillist_name\'}}</label> <span class="f-mgl">{{name}}</span> </div> <div class="detail-item"> <label>{{i18n \'contact/lbl_maillist_email\'}}</label> <span class="f-mgl" id="maillist_id">{{id}}</span> </div> <div class="detail-item"> <label>{{i18n \'contact/lbl_maillist_location\'}}</label> <span class="f-mgl">{{location}}</span> </div>',listMailListTpl:'<tr data-action="show" data-email="{{emailaddr}}" data-gender="{{gender}}"> <td class="firstTD"> {{#if emailaddr}} <input type="checkbox" value="{{emailaddr}}" data-name="{{true_name}}" data-cdn="{{cdn}}" data-uniqueid="{{uniqueid}}" data-gender="{{gender}}" data-usertype="{{usertype}}"> {{^}}&nbsp;{{/if}} </td> <td class="nth2TD"><i class="iconfont {{class}}"></i></td> {{#each td}} <td class="{{#gt @index 1}}hideForShrink{{/gt}}"> <div class="f-ellipsis" title="{{.}}">{{.}}</div> </td> {{/each}}',selectedContactListTpl:'<tr data-uniqueid="{{uniqueid}}" data-cdn="{{cdn}}" data-name="{{name}}" data-emailaddr="{{emailaddr}}" class="{{#if isDir}}j-dir{{/if}} {{#if isRemote}}j-remote-user{{else}}j-local-user{{/if}}"> <td class="firstTD"><span class="f-ellipsis">{{formatted name}}</span></td> <td class="nth2TD"><span class="f-ellipsis">{{emailaddr}}</span></td> <td class="lastTD"><a href="javascript:void(0)" data-operation="remove">{{i18n "contact/op_remove"}}</a></td> </tr>',selectedContactThumbTpl:'<li data-uniqueid="{{uniqueid}}" data-cdn="{{cdn}}"> <div> <a class="del" href="javascript:void(0)" data-operation="remove"><i class="iconfont icondelword"></i></a> <div class="u-img u-img-thumbnails"><a href="javascript:void(0)"><img src="{{avatar}}" alt="avatar"></a></div> <p class="f-ellipsis">{{formatted name}}</p> </div> </li>',contactTpl:'<div class="avatar"> <div class="u-img"> <a href="javascript:void(0)"><img src="{{avatar}}" alt="avatar"></a> </div> <div class="text"> <div class="name"> <a href="javascript:void(0)">{{formatted name}}</a> <i class="iconfont {{genderCls}}"></i> </div> {{#if ou}} <div class="department"><a data-action="accessToOu" title="{{i18n \'contact/lbl_viewOuMembers\'}}">{{formatted location}}</a></div> {{/if}} <div class="position">{{formatted duty}}</div> </div> </div> <div class="infos"> <table class="u-table u-table-assign1"> <tbody> {{#each fields}} <tr> <td>{{label}}</td><td title="{{value}}">: {{value}}</td> </tr> {{/each}} </tbody> </table> </div>',advanceSearchTpl:'<div class="advsearch-panel u-scroll"> <div class="header"> <span class="hd-name">{{i18n "contact/op_advanceSearch"}}</span> <div class="hd-close" data-operation="closePopup"> <a href="javascript:void(0)"> <i class="iconfont icontabclose"></i> </a> </div> </div> <div class="content"> <form name=advanceSearchForm> <table style="border-collapse: separate; border-spacing: 15px"> <tr> <td class=label-1>{{i18n "contact/lbl_searchPosition"}}:</td> <td><select name=dn></select></td> </tr> <tr> <td></td> <td> <label><input type=checkbox name=recursive checked value=true>&nbsp;{{i18n "oab/c_search_recursive"}}</label> </td> </tr> {{#each (seq \'true_name\' \'email\' \'mobile_number\' \'company_phone\')}} <tr> <td class=label-1>{{i18n (join \'oab/h_\' . )}}:</td> <td><input class=u-input name={{.}} autocomplete=off></td> </tr> {{/each}} </table> </form> </div> <div class="footer"> <div class="u-btns u-btns-1" data-action="advanceSearch"> <button class="u-btn u-btn-primary"> {{i18n "contact/op_startSearch"}} </button> </div> <div class="u-btns" data-operation="closePopup"> <button class="u-btn u-btn-default"> {{i18n "contact/op_cancel"}} </button> </div> </div> </div>',pabGroupsTpl:'<li class="u-submenu"> <a href="javascript:void(0)">{{i18n "oab/act_exportToPAB"}}</a> <ul class="u-menu"> {{#each this}} <li data-action="addToPabContact" data-groupid="{{id}}"><a href="javascript:void(0)">{{formatted name}}</a></li> {{/each}} <li class="divider"></li> <li data-action="addToPabContact"><a href="javascript:void(0)">{{i18n "pab/c_others"}}</a></li> <li data-action="addGroup"><a href="javascript:void(0)">{{i18n "pab/c_group_new"}}</a></li> </ul> </li>',toolbarTpl:'<button class="u-btn u-btn-primary btn-detail" data-operation="closeDetails"><i class="iconfont iconright"></i>{{i18n "contact/op_collapse"}}</button> <button class="u-btn u-btn-default btn-list" data-operation="removeAll">{{i18n "contact/op_removeAll"}}</button> {{>opButtons compose=(i18n "contact/op_compose")}}',mailListToolbarTpl:'<button class="u-btn u-btn-primary" data-action=back>{{i18n "common/back"}}</button> {{>opButtons compose=(i18n "oab/act_compose_userlist")}}',opButtons:'{{#if @config.mail.enablesendmail}} <button class="u-btn u-btn-default" data-action=msg>{{compose}}</button> {{/if}} {{#if @config.user.enableLunkr}} <button class="u-btn u-btn-default" data-action=msg name="toLunkr">{{i18n "contact/op_lunkr"}}</button> {{/if}} <div class="u-btns"> <span class="u-btn u-btn-default j-moreOp">{{i18n "contact/op_more"}}<i class="iconfont icondown"></i> <ul class="u-menu"> {{#if @root}}{{>pabGroupsTpl}}{{/if}} <li data-action="listMails"> <a href="javascript:void(0)">{{i18n "oab/act_listmails"}}</a> </li> </ul> </span> </div>',contactsEmptyTpl:'<tr><td colspan="{{colspan}}">{{i18n "oab/no_user"}}</td></tr>'})},935:function(e,t,a){(function(t,i){a(936),a(509),a(572),a(486);var n=a(534),s=a(463),o=a(489),l=o['default'],r=o.rcCheck,c=a(465),d=a(479),p=a(466),u=a(475),f=a(472),m=a(617),h=a(473).h,v=a(470),g=v.alert,b=v.confirm,_=a(522),y=a(487),w=a(543),k=a(468).get,T=a(467),x=T.go,C=a(474),j=a(659),S=a(616),$=k('contact.itemperpage')||20;var D=a(618).helpers({formattedValidity:function(e,t){return h(c('contact/lbl_certValidityDisplay'),[d(e).format('YYYY-MM-DD'),d(t).format('YYYY-MM-DD')])}});e.exports=f.extend({element:D()},(function(e,o){var f=this,v=S(f);f.events={'click :not(.disabled)[data-action]':[function(e,a){switch(e){case'editContact':ae();break;case'saveContact':v.save((function(){X(),ne(!0),ce('-edit'),f.publish('changed')}));break;case'createContact':ae(!0);break;case'exportContact':d=f.$('[name="exportContactsForm"]').serializeJSON(),d=s.extend({sid:T.getSid()},d),f.$('#exportIframe').attr('src',i.basePath('jsp/contact.jsp?'+s.param(d)));break;case'importContact':!function(){var e,t=f.$('#fileChoose');if(!function(e){var t=f.$('.content:visible');if(!e.val())return g(c('contact/msg_importFileEmptyErr'),{parentNode:t}),!1;var a=e[0].files&&e[0].files[0].filename||e.val(),i=a.substring(a.lastIndexOf('.')+1).toLowerCase();if('vcf'!==i&&'csv'!==i)return g(c('contact/msg_importFileFormatErr'),{parentNode:t}),!1;if('vcf'===i)return f.$('#informat').val('10'),!0;if('csv'===i)return f.$('#informat').val('8'),!0}(t))return!1;e=f.$('[name="importContactsForm"]').serializeJSON(),m.importContacts(e,t).then((function(e){f.$('#importResultContainer').removeClass('f-dn').html(D.importResultTpl(e)),f.$('#importContactsForm').addClass('f-dn'),f.$('.panel .toolbar-wrapper .import button').toggleClass('f-dn'),f.publish('changed'),K('',1)}))}();break;case'show':ce('detail'),J([''+a.data('id')]);break;case'deleteGroup':b(h(c('pab/confirm_del'),a.data('groupname')),{onConfirm:function(){var e;e=''+a.data('groupid'),m.deleteGroup(e).then((function(){s.notify(c('pab/c_grp_delete')),se(),f.publish('changed')}))},parentNode:'.content:visible'});break;case'cleanUpGroup':b(h(c('pab/confirm_clean'),a.data('groupname')),{onConfirm:function(){var e;e=''+a.data('groupid'),m.cleanGroup(e).then((function(){s.notify(c('pab/c_grp_clean')),se(),f.publish('changed')}))},parentNode:'.content:visible'});break;case'renameGroup':!function(e){var t=''+e.data('groupid'),a=e.data('groupname');y.pabGroups().then((function(i){b(D.renameGroupTpl({name:a}),{parentNode:'.content:visible',onConfirm:function(){var n=f.$('#newGroupName').val(),o=j.validate(n,i,'update',a);if(!o.state)return f.$('#errMsg').removeClass('f-dn').find('label').html(o.errMsg),!1;m.renameGroup(t,n).then((function(){e.data('groupname',n),e.siblings().data('groupname',n),e.parents('.list-item').find('.label a').html(n),s.notify(c('pab/c_grp_rename')),f.publish('changed')}))}})}))}(a);break;case'saveGroup':r=f.$('form[name=newGroupInfo]').serializeJSON(),y.pabGroups().then((function(e){var a=f.$('#addrContainer :hidden'),i=new Set(t.map(R,'id')),n=t.groupBy(t.map(a.get(),'value'),(function(e,t){return i['delete'](e)?2:s(a[t]).data('isoab')?0:1}),[[],[]]),o=n[0],l=n[1];r.uidsForPab=l.join(' '),r.updateUids=t.map(i).join(' '),r.uidsForOab=o.join(' ');var d,p='edit'===r.func;if(!(d=p?j.validate(r.name,e,'update',r.originalName):j.validate(r.name,e,'addnew')).state)return g(d.errMsg),!1;y.savePabGroup(r).then((function(e){p?s.notify(c('contact/msg_successfullyEditGrp')):s.notify(c('pab/c_grp_add')),ce('-gedit'),z[e.id]=s.extend(e,{isMtg:!0}),f.publish('changed'),function(e){var t=f.$('div.content-wrapper');t.hasClass('toggled-searchList')||(t.hasClass('toggled-grpManage')?se():K(e.id,1))}(e)}))}));break;case'switchToGroup':K(''+a.data().groupid);break;case'goCompose':var n=ee(),o=n[0],l=n[1];o?W(o.map(le('name','emailaddr'))):l&&W(oe([l]))}var r;var d}],'click [data-operation]':[function(e,t){switch(e){case'remove':var a=Y(t);ne(a),G(a,!1);break;case'removeAll':ne(!0),G(!0,!1);break;case'showList':re.trigger('clearKeyword'),K(E);break;case'closeDetails':ce('-detail');break;case'closeContact':var i=f.$('form[name=contactInfo] [name=id]').val();i&&i===te().id?ce('detail'):ce('-edit');break;case'closeImport':ce('-import');break;case'closeExport':ce('-export');break;case'closeGroup':ce('-gedit');break;case'goBack':Z();break;case'edit':ce('detail'),ae();break;case'removeFromGroup':t.parents('.j-contactItem').remove();break;case'cleanUpText':t.addClass('f-dn'),t.prev('input').val('');break;case'setCertAsDefault':!function(e){var t=parseInt(e.data('index')),a=f.$('#contactInfo [name=id]').val(),i=f.$('#contactInfo [name="EMAIL;PREF"]').val();p.wmCall('pab:setContactDefaultKey',{uid:a,keyIndex:t}).then((function(){m.contactKeys({uid:a}).then((function(e){e=pe(e,i),f.$('.j-cert-import').data('certs',e).html(D.importCertTpl({certs:e})),s.notify.success(c('contact/msg_setKeyAsDefaultSuccess'))}))})).onFail((function(){s.notify.error(c('contact/msg_setKeyAsDefaultFail'))}))}(t);break;case'deleteCert':!function(e){var t=parseInt(e.data('index')),a=f.$('#contactInfo [name=id]').val(),i=f.$('#contactInfo [name="EMAIL;PREF"]').val();b(h(c('contact/msg_deleteKeyConfirm'),[e.data('name')]),(function(){p.wmCall('pab:deleteContactKey',{uid:a,keyIndex:t}).then((function(){m.contactKeys({uid:a}).then((function(e){e=pe(e,i),f.$('.j-cert-import').data('certs',e).html(D.importCertTpl({certs:e})),s.notify.success(c('contact/msg_deleteKeySuccess'))}))})).onFail((function(){s.notify.error(c('contact/msg_deleteKeyFail'))}))}))}(t);break;case'downloadCert':!function(e){var t=parseInt(e.data('index')),a=te().id;e.attr('href',p.wmURL({func:'pab:downloadContactSingleKey',uid:a,keyIndex:t}))}(t);break;case'checkCert':!function(e){var t=e.data('index'),a=f.$('.j-cert-import').data('certs');g(D.certStatusTpl(a[t]),{title:c('contact/lbl_checkCert')})}(t);break;case'showCert':!function(e){var t=e.data('index'),a=f.$('.j-cert-import').data('certs');g(D.certDetailsTpl(a[t]),{title:c('contact/lbl_certDetails')})}(t)}}],'click [data-sort]':[function(e,t){var a=t.find('i');a.hasClass('icondown')||a.hasClass('iconup')?a.toggleClass('icondown iconup'):(f.$('.content:visible [data-sort] i').removeClass('icondown iconup'),a.addClass('iconup'));F=I===e&&!F,I=e,A?M&&Q({keyword:M,order:I,desc:F}):Q({groupid:E,order:I,desc:F})}],'change #certChoose':function(){var e,t,a=f.$('#certChoose'),i=f.$('#contactInfo'),n=i.find('[name=id]').val(),o=i.find('[name=\'EMAIL;PREF\']').val();m.addContactKeyStd(a).then((function(a){if(''===n)return t=i.find('[name=certHashId]').val(),i.find('[name=certHashId]').val(t.concat(a.hashId,',')),s.notify.success(c('contact/msg_contactKeySaveSuccess')),e=pe([a.cerInfo],o)[0],i.find('.cert-import').length>0&&i.find('.cert-list').html('<ul></ul>'),void i.find('.cert-list').removeClass('cert-list-empty').append(D.certListItem(e));function l(){p.wmCall('pab:saveContactKey',{hashId:a.hashId,uid:n}).then((function(){m.contactKeys({uid:n}).then((function(t){s.notify.success(c('contact/msg_contactKeySaveSuccess')),e=pe(t,o),f.$('.j-cert-import').data('certs',e).html(D.importCertTpl({certs:e}))}))}))}var r=pe([a.cerInfo],o)[0];r.query=!0,r.status.isExpired||r.status.isUnmatched?b(D.certStatusTpl(r),{title:c('contact/lbl_checkCert')}).then(l):l()})).catchCode(['FA_FILE_SIZE_EXCEEDED','FA_PARSE_CER'],(function(e){a.replaceWith(a.clone(!0)),g(c('error/'+e.code))})).catchCode(/./,(function(e){g(c('common/FA_OTHER_CODE',{code:e.code}))}))}};var E,M,I,F,R=[],P=k('contact.pab.schema'),L=new Set,A=!1,z={};e()(o);var N=f.$('div.listview tbody'),U=f.$('div.thumbview ul'),O=f.$('div.detailview');function H(e){n(f.$('#newGroupContainer').html(D.newGroup(e)),{trigger:'a[data-action=addFromContact]',withOab:!!k('contact.enableaddedfromoab'),init:de,onSelect:q})}function q(e){f.$('#addrContainer').html(t.map(e,(function(e){return e.isUser&&D.addrTpl(e)})))}function W(e){C.compose({to:t.mapFilter(e,(function(e){return u.test(e)&&''+e}))})}function G(e,a){var i=f.$('section.content'),n=f.$('section.content tbody :checkbox'),o=!0===e?n:s(t.mapFilter(e,(function(e){return n.filter('[data-uniqueid="'+e.uniqueid+'"]')[0]})));r(o,a),o.parents('tr').toggleClass('contact-selected',a),r(i.find('span.j-selectAll :checkbox'),!n.filter(':not(:checked)')[0])}function B(){ce(L.size?'list':'-list')}function Y(e){return e.get().map((function(e){return t.assign({uniqueid:(e=s(e).closest('[data-uniqueid]')).attr('data-uniqueid')},e.is('li')?{}:{name:e.attr('data-name'),emailaddr:e.attr('data-emailaddr')||e.val()})}))}function V(e){Q({keyword:M=e,reload:!0})}f.render(),y.pabGroups().then((function(e){var a;!function(e){var a='',i='';z=t.objBy(e,(function(e){return e.id!==E&&(a+=D.groupItem2(e),e.isMtg=!0,i+=D.groupItem2(e)),e.id})),f.$('#addToGroup ul').append(a),f.$('#moveToGroup ul').append(i)}(e),a=k('mail.enablesendmail'),f.$('.panel .mixins').prepend(D.toolbarTpl({enableSendMail:a})),f.$('.j-doMore').append(D.dropdownTpl({enableSendMail:a})),f.$('div.j-doMore').dropdown({callback:function(){var e,a=s(this).data('panel');switch(a){case'edit':ae(!0);break;case'gedit':y.pabSearch({groups:[E],returnAttrs:['id','FN','EMAIL;PREF']}).then((function(e){t.iter(R=e||[],(function(e){e.addr=e['EMAIL;PREF'],e.name=e.FN,e.isOab=!1,e.isUser=!0})),H(z[E]),q(R)}));break;case'glist':se();break;case'import':e=f.$('.panel .toolbar-wrapper .import'),f.$('#importResultContainer').addClass('f-dn'),f.$('#importContactsForm').removeClass('f-dn').html(D.importContactsFormTpl()),e.find('button:last').addClass('f-dn'),e.find('button:lt(2)').removeClass('f-dn'),l(f.$()),f.$('#fileChoose').on('change',(function(){f.$('#fileName').removeClass('f-dn').html(s(this).val())})),y.pabGroups().then((function(e){var t='';s.each(e,(function(e,a){t+=D.groupItem(a)})),f.$('#importToGroup').append(t)}))}'gcompose'===a?y.pabSearchInJsp({groupid:E,reload:!0}).then(oe).then(W):'glist'===a?Z('grpManage'):ce(a)}}),f.$('#more').dropdown({callback:function(){var e=s(this).data(),a=e.action,i=e.groupid,n=ee(),o=n[0],l=n[1],r=o?t.map(o,'uniqueid'):l?[l.id]:[],d=o?t.map(o,'emailaddr'):l?[l['EMAIL;PREF']]:[];switch(a){case'addToGroup':!function(e,t,a){m.addToGroup({gid:e,uid:t.join(' ')}).then((function(){a&&J(t),s.notify(c('pab/c_jointo_success')),f.publish('changed')}))}(''+i,r,l);break;case'moveToGroup':!function(e,t,a,i){m.moveToGroup({gid:e,fGid:t,uid:a.join(' ')}).then((function(){i&&J(a),s.notify(c('pab/c_moveto_success')),f.publish('changed'),X()}))}(''+i,E,r,l);break;case'deleteContacts':!function(e){m.deleteContacts(e).then((function(){s.notify(c('contact/msg_delContactSuccessfully')),ne(!0),X(),ce('-detail'),f.publish('changed')})).onFail((function(){s.notify.error(c('contact/msg_delContactFailErr'))}))}(r);break;case'listMails':x('mail.search',{fromType:'pab',fromAddress:d.join(',')});break;case'print':window.open(T.detachURL('contact.pabPrint',{ids:r.join(',')}))}}}),new w({element:f.$('section.panel'),triggerType:'click'}),f.$('section.content').on('click','span.j-selectAll .checkbox',(function(e){e.stopPropagation();var t=s(this).hasClass('checkbox-checked'),a=Y(f.$('.content:visible tbody :checkbox:'+(t?'not(:checked)':'checked')));G(!0,t),t?ie(a):ne(a)})).on('click','.u-table tbody .checkbox',(function(e){e.stopPropagation();var t=s(this).hasClass('checkbox-checked'),a=Y(s(this).prev());G(a,t),t?ie(a):ne(a)}))})),f.before('destroy',(function(){re.destroy()})),(f.invoke=function(e){switch(e){case'addGroup':ce('gedit'),H({isCreate:!0});break;case'addContact':ae(!0);break;case'mangeGroups':f.$('[data-panel="glist"]').trigger('click');break;default:!function(e){var t=e.type,a=e.id;if(t&&null!=a)switch(ce(t),t){case'detail':J([''+a]);break;case'edit':ae(!1,''+a)}}(e)}})(T.getCurrentState().param);var K=f.setCid=function(e,t){A=!1,Z(),E!==e&&x(f.name,{cid:E=e}),(E!==e||t)&&X(),f.$('[data-panel=gedit]').toggle(!!E&&'OTHER'!==E),f.$('#moveToGroup').toggle(!!E)};function X(){Q({groupid:E,reload:!0})}function Q(e){var t=!('start'in e);e.limit=$;var i=f.$('.content-wrapper .content:visible').mask();y.pabSearchInJsp(e).then((function(e,n,o){t&&function(e){f.$(A?'.u-search-pagination':'.u-list-pagination').pagination({total:e||1,limit:$,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:function(e){Q(A?{start:e*$}:{groupid:E,start:e*$,order:I,desc:F})}})}(n||e.length),i.find('.deptInfo').html(h(c('contact/lbl_deptInfo2'),[A?c('pab/c_search_result'):a(530)('pabTree').getSelectedNodes()[0].nm,n])),function(e){var t=k('contact.pab.normallistattrs'),i=[];s.each(t,(function(e,t){i.push({id:t,label:P[t]})})),f.$('.content:visible .u-table thead').html(D.listHeadTpl({fields:i}));var n=f.$('.content:visible .u-table tbody');if(0===e.length)n.html(D.contactsEmptyTpl({colspan:t.length+1}));else{for(var o='',r=function(a){var i=e[a];i.emailaddr=i['EMAIL;PREF'],i.name=i.FN;var n=[];s.each(t,(function(e,t){n.push({value:i[t]})})),i.fields=n,o+=D.listTpl(i)},c=0;c<e.length;c++)r(c);n.html(o),G(Y(N.find('tr')),!0)}l(f.$()),a(569).byWrapper(f)}(e)})).fin((function(){i.mask('hide')}))}function Z(e){f.$('.content-wrapper').attr('class','content-wrapper toggled-'+(e||(A?'searchList':'list'))),f.$('.j-search-return').toggleClass('f-dni',!A)}function J(e){f.$('.panel').mask(),p.when(y.pabGet(e),y.contactAvatars('pab',e[0]),m.contactKeys({uid:e[0],requireContent:!0}),y.pabGroups()).then((function(e,t,a,i){var n,o=e[0]||{},l=[],r=[];s.each(k('contact.pab.viewattrs'),(function(e,t){switch(t){case'EMAIL;#':s.each(o,(function(e,a){0===e.indexOf(t)&&l.push({label:P['EMAIL;PREF'],value:a})}));break;case'FN':case'EMAIL;PREF':l.push({id:t,label:P[t],value:o[t]});break;case'groups':var a=[];s.each(o[t],(function(e,t){s.each(i,(function(e,i){if(i.id===t)return a.push(i.name),!1}))})),l.push({id:t,label:P[t],value:a});break;default:r.push({label:P[t],value:o[t]})}})),a&&(n=pe(a,o['EMAIL;PREF'])),O.html(D.contactInfoTpl({avatar:t[0].avatarUrl,basic:l,extra:r,certs:n})).data('info',o)})).either((function(){setTimeout((function(){f.$('.panel').mask('hide')}),300)}))}function ee(){var e=f.$('.panel-content > div:visible');return[e.is('.list')&&Y(N.find('tr')),e.is('.detail')&&te()]}function te(){return O.data('info')||{}}function ae(e,t){if(!e&&!t){var a=ee(),i=a[0],n=a[1];if(i){if(!i[0])return g(c('contact/msg_noOneToEdit')),!1;if(i[1])return g(c('contact/msg_oneToEdit')),!1;t=i[0].uniqueid}else n&&(t=n.id)}ce('edit');var s=e?{groups:E?[E]:[]}:t;S.load(s,(function(e,t,a,i,n){f.$('#newContactContainer').html(D.newContact({avatar:i,id:e.id,attrs:t})).find('[name=contactInfo]').data({aliasLength:a.length}).end().scrollTo(0,0);var s=pe(n,e['EMAIL;PREF']);f.$('.j-cert-import').html(D.importCertTpl({certs:s})).data({certs:s}),l(f.$())}))}function ie(e){var t='',a='',i=[];e.forEach((function(e){L.has(e.uniqueid)||(L.add(e.uniqueid),i.push(e.uniqueid),t+=D.selectedContactListTpl(e),a+=D.selectedContactThumbTpl(e))})),U.append(a),N.append(t),y.contactAvatars('pab',i.join(' ')).then((function(e){e.forEach((function(e){U.find('[data-uniqueid="'+e.uid+'"] img').attr('src',e.avatarUrl)}))})),B()}function ne(e){!0===e?(N.empty(),U.empty(),L.clear()):e.forEach((function(e){var t=e.uniqueid;L['delete'](t),N.find('[data-uniqueid=\''+t+'\']').remove(),U.find('[data-uniqueid=\''+t+'\']').remove()})),B()}function se(){y.getPabGroupsWithCount().then((function(e){var t=k('contact.pab.permanentgroups')||[];t.length>0&&e.groups.forEach((function(e){e.permanent=t.includes(e.id)}));var a=h(c('contact/msg_groupSummary'),[e.groups.length,e.gcCount,k('contact.pab.maxiaddresscount')]);f.$('div.grpList').html(D.groupsManagement(e)),f.$('section.content-grpManage label.info').html(a)}))}function oe(e){return e.map(le('FN','EMAIL;PREF'))}var le=function(e,t){return function(a){var i=u.of(a[t]);return i.trueName?i:u(a[e],i.address)}},re=new _({element:f.$('.j-select-wrapper'),placeholder:c('contact/lbl_quickSearchContacts'),controlClassName:'u-input-control-1'}).on('submit',(function(e){A=!0,Z(),f.$('#searchViewContainer').html(D.searchViewTpl()),V(e)}));function ce(e){function t(e,t){return(t.match(/\bswitch-\S+/g)||[]).join(' ')}if(e.startsWith('-')){var a=e.substring(1);('detail'===a||'export'===a||'import'===a||'edit'===a||'gedit'===a)&&L.size?f.$('.main-wrapper').removeClass(t).addClass('switch-pab-list'):f.$('.main-wrapper').removeClass(t)}else f.$('.main-wrapper').removeClass(t).addClass('switch-pab-'+e)}function de(){return f.$('#addrContainer :hidden').get().map((function(e){return{id:s(e).val(),name:s(e).data('name'),addr:s(e).data('addr'),isOab:s(e).data('isoab'),isUser:!0}}))}function pe(e,t){var a=[];function i(e){var t,a=e.split(/,\s?/),i={};return s.each(a,(function(e,a){t=a.split('='),i[t[0]]=t[1]})),i}return s.each(e,(function(e,n){var s,o,l,r;a.push({issuerDN:i(n.issuerDN),subjectDN:i(n.subjectDN),notAfter:n.notAfter.match(/^\d{4}-\d{1,2}-\d{1,2}/)[0],notBefore:n.notBefore.match(/^\d{4}-\d{1,2}-\d{1,2}/)[0],status:(s=n.notAfter,o=n.notBefore,l=n.subjectDN,r=i(l).EMAILADDRESS,{isExpired:!d().isBetween(o,s),isUnmatched:r!==t})})})),a}}))}).call(this,a(464),a(478))},937:function(e,t,a){e.exports=a(469)('<section class="m-contact"> <div class="contact-wrapper"> <aside class=ctsidebar> <div class="ctsidebar-bg"></div> <nav class="u-tab u-tab-highlight-down j-contact-nav"> <ul class="cttabs"> {{#each this}} <li data-trigger="{{id}}"> <a href="javascript:void(0)"> {{title}} <span class="bar"></span> </a> </li> {{/each}} </ul> </nav> <div class="u-scroll scroll-wrapper"> <ul class="ztree" id="oabTree"></ul> </div> <div class="u-scroll scroll-wrapper"> <ul class="ztree" id="pabTree"></ul> <div class="link-wrapper"> <a href="javascript:void(0)" data-operation="addGroup">[{{i18n "contact/lbl_addGrp"}}]</a> </div> <div class="link-wrapper"> <a href="javascript:void(0)" data-operation="addContact">[{{i18n "contact/lbl_addContact"}}]</a> </div> <div class="link-wrapper"> <a href="javascript:void(0)" data-operation="mangeGroups">[{{i18n "contact/lbl_manageGroup"}}]</a> </div> </div> </aside> <article class="ctmain"> <div class="ctmain-bg"></div> <div class="j-contact-content"></div> </article> </div> </section>',{})},938:function(e,t,a){(function(e){a(939);var t=a(463),i=a(465),n=a(472),s=a(487),o=a(471),l=a(467),r=a(480),c=n.extend({Implements:r,events:{'click [data-operation]':'_dispatchOperation','click header .checkbox':'_updatePreviewItem'},setup:function(){this.defChecked={'EMAIL;PREF':!0,'TEL;CELL;VOICE':!0,ORGNAME:!0,'ADR;WORK':!0}},render:function(){c.superclass.render.call(this),this._initContactSchema(),this._initPreviewItem()},_initContactSchema:function(){var a=this;e.wmCall('pab:getContactSchema').then((function(e){var i=[],n=[],s=a.$('#conditionsTpl').html();t.each(e,(function(e,t){a.defChecked[t.name]?(t.isChecked='checked',i.push(t),a.defChecked[t.name]=t.label):'FN'!=t.name&&n.push(t)}));for(var o=6-i.length,l=0;l<o&&0!=n.length;l++)i.push(n[0]),n.shift();a.$('#defContainer').html(a.compile(s,{withMoreOp:!0,conditions:i}));var r=n.length;if(r>0&&r<=7)a.$('#extraContainer').html(a.compile(s,{conditions:n}));else if(r>7)for(var c=0,d=c;c<r;c+=7){var p=n.slice(c,d+=7);a.$('#extraContainer').append(a.compile(s,{conditions:p}))}a.element&&a.element.customRadioCheckbox()}))},_initPreviewItem:function(){var e=this,a=l.getCurrentState(!0).param.ids;if(!a)return!1;s.pabGet(a.split(',')).then((function(a){var i=[];t.each(a,(function(a,n){var s=[];t.each(e.defChecked,(function(e,t){'Grouping'==e&&(e='groups'),n[e]&&s.push({label:t,value:n[e]})})),i.push({id:n.id,name:n.FN,extra:s})}));var n=e.$('#previewItemTpl').html();e.$('#previewItemContainer').html(e.compile(n,{previewItem:i}))}))},_dispatchOperation:function(e,a){switch(t(a).data('operation')){case'showExtra':t(a).find('i').toggleClass('icondown iconup'),this.$('#extraContainer').toggleClass('f-dn'),this._adjustPrevContainer();break;case'doPrint':this.$('> header').addClass('f-dn'),this._adjustPrevContainer(),window.print(),this.$('> header').removeClass('f-dn'),this._adjustPrevContainer()}},_updatePreviewItem:function(){this.defChecked=this.$('[name="conditionsForm"]').serializeJSON({defaultType:'+B'}),this._initPreviewItem()},_adjustPrevContainer:function(){var e=this.$('> header').height()+36;this.$('> .content').css('top',e)},templateHelpers:{formatted:function(e){return e||i('common/none')}}});o.module({name:'contact.pabPrint',template:a(940)},c)}).call(this,a(466))},940:function(e,t){e.exports='<section class="m-ctpabPrint">\r\n    <header>\r\n        <div class="header header-primary">\r\n            <p class=""></p>\r\n            <form name="conditionsForm" action="#">\r\n                <div class="default" id="defContainer"></div>\r\n                <div class="extra f-dn" id="extraContainer"></div>\r\n            </form>\r\n        </div>\r\n\r\n        <div class="header f-tar">\r\n            <label></label>\r\n            <button class="u-btn u-btn-primary" data-operation="doPrint"></button>\r\n            \x3c!--<button class="u-btn u-btn-default"></button>--\x3e\r\n        </div>\r\n    </header>\r\n    <div class="content u-scroll">\r\n        <section class="container u-scroll" id="previewItemContainer"></section>\r\n    </div>\r\n\r\n    {{#raw}}\r\n    <script type="text/x-handlebars-template" id="conditionsTpl">\r\n        <div class="content">\r\n            [[#each conditions]]\r\n            <span class="cbWrapper">\r\n                <input type="checkbox" name="[[name]]" id="[[name]]" value="[[label]]" [[isChecked]]/>\r\n                <label for="[[name]]">[[label]]</label>\r\n            </span>\r\n            [[/each]]\r\n            [[#if withMoreOp]]\r\n            <span class="aWrapper">\r\n                <a href="javascript:void(0)" data-operation="showExtra"><i class="iconfont iconup"></i></a>\r\n            </span>\r\n            [[/if]]\r\n        </div>\r\n    <\/script>\r\n\r\n    <script type="text/x-handlebars-template" id="previewItemTpl">\r\n        [[#each previewItem]]\r\n        <div class="u-box u-box-primary">\r\n            <div class="u-box-head">\r\n                <h3 class="u-box-head-title">[[formatted name]]</h3>\r\n            </div>\r\n            <div class="u-box-container">\r\n                [[#each extra]]\r\n                <div class="u-box-content">\r\n                    <div class="label label-left"><label>[[label]]</label></div>\r\n                    <div class="label label-right"><label>[[value]]</label></div>\r\n                </div>\r\n                [[/each]]\r\n            </div>\r\n        </div>\r\n        [[/each]]\r\n    <\/script>\r\n    {{/raw}}\r\n</section>'}}]);
//# sourceMappingURL=C.c2f53.js.map