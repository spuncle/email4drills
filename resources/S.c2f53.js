(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1001:function(e,t,i){e.exports=i(469)('<section class="m-forward" > <div class="main-wrapper"> <div class="j-forward-set content-wrapper"></div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e </div>  </section>',{forwardSetTpl:'<div class="title dotted"> <h4>{{i18n "setting/lbl_forwardsetting"}}</h4> </div> <form action="#" id="forward" onsubmit="return false;"> <div class="form-control"> <div class="form-item"> <label class="form-label">{{i18n "setting/lbl_forward"}} :</label> <span class="f-ib f-vam"> <input type="checkbox" id="toggle" role="switchBtn" class="checkbox " value="1" {{#compare forwardactive \'!=\' 0 }}checked{{/compare}}> </span> </div> <div class="form-item"> <label class="form-label">{{i18n "setting/lbl_forward_condition"}} :</label> <div class="forwardOpt1"> <label for="forwardactive_1" class="label"> <input type="radio" name="forwardactive" id="forwardactive_1" value="1" {{#compare forwardactive \'==\' 1}}checked{{/compare}}>{{i18n "setting/lbl_forwardAutoEnable"}} </label> </div> </div> <div class="form-item"> <div class="forwardOpt2"> <label> <input type="checkbox" name="keeplocal" id="keeplocal" value="1" {{#compare forwardactive \'==\' 1}}{{#compare keeplocal \'==\' 1}}checked{{/compare}}{{/compare}} /> {{i18n "setting/lbl_forwardKeepLocal"}} </label> </div> </div> <div class="form-item"> <div class="forwardOpt3"> <label for="forwardactive_3"> <input type="radio" name="forwardactive" id="forwardactive_3" value="3" {{#compare forwardactive \'==\' 3 }}checked{{/compare}} /> {{i18n "setting/lbl_forwardFullEnable"}} </label> </div> </div> <div class="disable-mask {{#compare forwardactive \'!=\' 0 }}f-dn{{/compare}}"></div> </div> <div class="title dotted"> <h4> {{i18n "setting/lbl_forwardlist"}}</h4> </div> <div class="u-list-modify"> <div class="u-input-control"> <span class="u-input-container"> <input type="text" class="j-new-rule" placeholder="{{i18n \'setting/lbl_forward_address\'}}"> </span> </div> <button type="button" class="u-btn u-btn-primary j-button-add" data-action="add">{{i18n "setting/op_add"}}</button> {{#if maxForwardMailCount}} <span class="tip"> <label>{{i18n "setting/lbl_autoforward_statistics" forwardDesLength=forwarddes.length maxForwardMailCount=maxForwardMailCount }}</label> </span> {{/if}} <div class="u-error-alert f-dn"></div> </div> <div class="list-title"> <span class="f-csp" data-action="listToggle"> <i class="iconfont iconcollapse"></i> <span>{{i18n "setting/lbl_contact"}}</span> <span class="opr">{{i18n "setting/lbl_op"}}</span> </span> </div> <table class="j-list"> {{#each forwarddes}} <tr> <td>{{this}}<input type="hidden" name="forwarddes[]" value="{{this}}"/></td> <td class="last-child"> <a href="javascript:void(0);" class="link" data-action="remove" data-item-name="{{this}}" > {{i18n "setting/op_remove"}} </a> </td> </tr> {{/each}} </table> </form>'})},1002:function(e,t,i){i(1003),i(509);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(498),o=i(501),c=i(467),d=i(476),u=i(479),p=i(465),f=i(473),m=(0,i(468).get)('setting.enableAutoRepTitle'),v=a.extend({Implements:l,templateHelpers:{formattedDate:function(e,t){return e?u(e).format(t):''},selectOption:function(e){for(var t=e?u(e).format('HH'):'',i='',a=0;a<24;a++){var s=(a<10?'0':'')+a;i+=n('<option>',{text:s,selected:s===t,value:s})[0].outerHTML}return i}},events:{'click [data-action]':'_dispatchAction','click #switch .checkbox':'_handleToggleBtn','change .hasDatepicker':'_checkSelectDate','blur .hasDatepicker':'_checkSelectDate','change .j-beginDate':'_handleShowPicker','click form :input:not(.u-btn .j-title)':'_checkSelectDate','blur .j-title':'_checkSelectDate'},render:function(){v.superclass.render.call(this),this._initView(!0),this._initModuleEvent()},_initView:function(e){var t,i=this;(e=e||!1)?(i.element.mask(),t=['autorepmode','autoreptext','autorep_condition','autorep_welcometip'],m&&t.push('autoreptitle'),d.optAttrs(t).then((function(e){e.autoreptext=e.autoreptext||p('pref/autoresp/default_text');var t=e.autorep_condition;if(1===e.autorepmode&&t?(e.begintime=t.begintime,e.endtime=t.endtime):(e.begintime=u().hours(0).format('YYYY-MM-DD HH:mm:ss'),e.endtime=u().hours(0).add(1,'days').format('YYYY-MM-DD HH:mm:ss')),e.instation=t&&parseInt(t.instation)||0,m){var n=c.getUser();e.autoreptitle=e.autoreptitle||f(p('pref/autoresp/autoreptitle_default_value'),n.email),e.enableAutoRepTitle=!0}i.autoReplySet=e,i._generateView(),i.element.mask('hide')}))):i._generateView()},_initModuleEvent:function(){var e=this;this.onMessage('view:change',(function(){e._initView(!0)}),null)},_dispatchAction:function(e,t){switch(n(t).data('action')){case'save':this._handleSaveAutoReply();break;case'cancel':this._initView()}},_generateView:function(){var e=this,t=e.compile(n('#autoReplyTpl').html(),e.autoReplySet);e.$('.j-autoreply').html(t),e.element.customRadioCheckbox(),e.$('form[name="autoreply"] .u-select').each((function(){r({maxHeight:200,trigger:n(this),style:{minWidth:96}}).on('change',(function(){e._checkSelectDate()}))})),e.$('.hasDatepicker').datepicker({startDate:new Date})},_formatDate:function(e){var t=e.autorep_condition.begintime,i=e.autorep_condition.endtime;n.extend(e.autorep_condition,{begintime:u(t[0]).add(t[1],'hours').toDate(),endtime:u(i[0]).add(i[1],'hours').toDate()})},_handleSaveAutoReply:function(){var e=this.$('form[name=\'autoreply\']').serializeJSON({defaultType:'+I',checkboxUncheckedValue:0});0===e.autorepmode&&(delete e.autorep_condition.begintime,delete e.autorep_condition.endtime),this._saveAutoReply(e)},_saveAutoReply:function(e){var t=this;m&&(e.autoreptitle=''+e.autoreptitle),e.autorep_condition.begintime&&t._formatDate(e),c.updateUser(e).then((function(){t.autoReplySet=e,o.remove('disable_autoreply_notify'),t.sendMessage('mail.welcome','view:refresh',null),t.sendMessage('mail.list','notify:refresh',null),n.notify(p('pref/autoresp/info_update_success')),t._toggleButtonDisabledAttr(!0)}))},_handleToggleBtn:function(){var e=this.$('.disable-mask');e.toggleClass('f-dn'),e.hasClass('f-dn')?this._checkSelectDate():this._toggleButtonDisabledAttr()},_handleShowPicker:function(e,t){var i=n(t).val(),a=new Date;u(i,'YYYY-MM-DD',!0).isValid()&&(a=new Date(i));var s=this.$('.j-endDate');s.datepicker('destroy'),s.datepicker({startDate:a})},_checkSelectDate:function(){var e,t=this,i=t.$('.j-beginDate').val(),n=t.$('.j-select-beginHour').val(),a=t.$('.j-endDate').val(),s=t.$('.j-select-endHour').val(),l=u(i,'YYYY-MM-DD',!0).isValid(),r=u(a,'YYYY-MM-DD',!0).isValid(),o=t.$('.j-title').val()||'',c=t.$('.j-timeError').hide(),d=t.$('.j-titleError').hide();function v(e,i){e.html(i).show(),t._toggleButtonDisabledAttr(!0,!1)}t._toggleButtonDisabledAttr(),l&&r?(i=u(i).add(n,'hours'),a=u(a).add(s,'hours'),e=u(),i.isAfter(a)?v(c,p('pref/autoresp/err_begintime_late_endtime')):a.isBefore(e)&&v(c,p('pref/autoresp/err_time_early_now'))):v(c,p(i?a?'pref/autoresp/date_is_invalid':'pref/autoresp/err_endtime_empty':'pref/autoresp/err_begintime_empty')),m&&!o.trim()&&v(d,f.h(p('pref/autoresp/autorep_empty'),p('pref/autoresp/autoreptitle')))},_toggleButtonDisabledAttr:function(e,t){e='boolean'===n.type(e)&&e,(t='boolean'!==n.type(t)||t)?this.$('.u-btn').prop('disabled',e):this.$('.u-btn-primary').prop('disabled',e)}});s.module({name:'setting.delivery.autoreply',template:i(1004)},v)},1004:function(e,t){e.exports='<section class="m-autoreply content-wrapper">\r\n    <section class="j-autoreply"></section>\r\n\r\n{{#raw}}\r\n<script type="text/x-handlebars-template" id="autoReplyTpl">\r\n    <form name="autoreply">\r\n        <div class="u-btns-top">\r\n            <button type="button" class="u-btn u-btn-primary" id="saveAutoReply" data-action="save" disabled>[[i18n \'setting/op_save\']]</button>\r\n            <button type="reset" class="u-btn u-btn-default" data-action="cancel" disabled>[[i18n \'setting/op_cancel\']]</button>\r\n        </div>\r\n\r\n        <div class="u-form-item f-mgt f-cf" id="switch">\r\n            <label class="u-form-label f-dis">[[i18n \'setting/lbl_autoreply\']] :&nbsp;&nbsp;</label>\r\n            <span class="f-ib f-vam">\r\n                <input type="checkbox" name="autorepmode" role="switchBtn" class="checkbox" value="1" [[#compare autorepmode \'==\' \'1\' ]] checked[[/compare]] />\r\n            </span>\r\n        </div>\r\n       \x3c!--遮罩层--\x3e\r\n        <div class="disable-mask [[#compare autorepmode \'==\' \'1\' ]] f-dn[[/compare]]"></div>\r\n\r\n        <div class="u-form-item f-rel">\r\n            <label class="u-form-label f-dis">[[i18n "pref/autoresp/time"]] :&nbsp;&nbsp;</label>\r\n            <input class="hasDatepicker j-beginDate"  type="text" name="autorep_condition[begintime][]" value=\'[[formattedDate begintime "YYYY-MM-DD" ]]\'> :\r\n            <select name="autorep_condition[begintime][]:string" class="u-select j-select-beginHour">\r\n                [[[selectOption begintime]]]\r\n            </select>\r\n            <span class="f-dis">&nbsp;[[i18n "pref/autoresp/to"]]&nbsp;</span>\r\n            <input class="hasDatepicker j-endDate"  type="text" name="autorep_condition[endtime][]" value=\'[[formattedDate endtime "YYYY-MM-DD" ]]\'/>  :\r\n            <select name="autorep_condition[endtime][]:string" class="u-select j-select-endHour">\r\n                [[[selectOption endtime]]]\r\n            </select>\r\n            <div class="j-timeError error f-dn"></div>\r\n\r\n        </div>\r\n        [[#if enableAutoRepTitle]]\r\n        <div class="u-form-item">\r\n          <label class="u-form-label f-dis">[[i18n "pref/autoresp/title"]] :&nbsp;&nbsp;</label>\r\n          <input class="j-title title"  type="text" name="autoreptitle" value=\'[[autoreptitle]]\'>\r\n          <div class="j-titleError error f-dn"></div>\r\n        </div>\r\n        [[/if]]\r\n\r\n        <div class="u-form-item">\r\n            <label class="u-form-label f-dis">[[i18n "pref/autoresp/content"]]:&nbsp;&nbsp;</label>\r\n            <textarea name="autoreptext:string" id="dest" cols="50" rows="5">[[autoreptext]]</textarea>\r\n            <p class="u-choice">\r\n              <label for="autoresp_instation">\r\n                <input type="checkbox" name="autorep_condition[instation]:number" id="autoresp_instation" value="1" [[#compare instation \'==\' 1]]checked[[/compare]] />[[i18n "pref/autoresp/instation_tip_set"]]\r\n              </label>\r\n              <br />\r\n              <label for="autorep_welcometip">\r\n                <input type="checkbox" name="autorep_welcometip" id="autorep_welcometip" value="1"  [[#compare autorep_welcometip \'==\' \'1\']]checked[[/compare]] />[[i18n "pref/autoresp/welcome_tip_set"]]\r\n              </label>\r\n            </p>\r\n        </div>\r\n\r\n    </form>\r\n<\/script>\r\n{{/raw}}\r\n</section>\r\n'},1005:function(e,t,i){(function(e){i(1006),i(1007),i(583);var t=i(463),n=i(472),a=i(471),s=i(470).confirm,l=i(498),r=i(547),o=i(650),c=i(465),d=i(497),u=i(485),p=i(483).encode,f=i(466),m=i(468).get,v=i(467),h=i(474),b=n.extend({},(function(){var i,n,a,b,_=this,y=e.objBy(m('user.allemails'),'addr',e.noop),w=g.helpers({tplOptions:function(n){return t('<select>').append(e.map(i,(function(e,i){return t('<option>',{value:i,selected:i==n,text:e.name})}))).html()},translateTpl:function(e){return e&&i[e]&&i[e].name.slice(0,10)||c('setting/lbl_templateNotSet')}}),k=w.templateSetTpl,x=w.accDefaultTplCard,j=w.editAccTpl,S=w.displayVarTpl,C=w.editMailTpl;function T(){var e=v.getCurrentState().param||{};'create'===e.type&&(a=e.id,I())}function $(){_.$('.account-tpl-container').html(x({accounts:y}))}function A(){E(),a&&(v.go('mail.compose',{id:a}),a=null)}function I(){b||E({isHtml:1===v.getUser().edit_mode})}function D(){n&&(_.$('.j-edit-template').height(_.$().height()-42),n.resize(0,_.$().height()-155))}function M(e){_.$('.j-mail-template').html(k({templates:i})),_.$('.tpl-item h4').dotdotdot(),$(),e||_.sendMessage('component.mailTemplate','list:refresh')}function E(e){n&&n.remove(),n=null,_.$('.j-mail-template').toggle(!e),_.$('.j-edit-template').html(e?C(e):'').toggle(!!e),F(b=e),e&&(r([_,function(e){return n=e},D],'#tpl_editor',[b.isHtml],0,{items:1}),t(window).off('resize',D).resize(D))}function F(e){e=b&&b.opt||{},_.$('.j-import-file').toggle(!e.fileName),_.$('.j-file-info').html(S(e))}_.events={'click [data-action]':[function(r,d){var f=d.data(),m=f.tid,v=f.name,g=f.index;switch(r){case'editTpl':!function(e){E(i[e])}(m);break;case'delTpl':!function(e,n){s(c('setting/msg_tpl_remove_confirm',{name:p(n)}),(function(){o.deleteMailTpl({id:e}).then((function(){t.notify.success(c('setting/msg_template_delete_success')),delete i[e],M()})).onFail((function(){t.notify.error(c('setting/msg_template_delete_failed'))}))}))}(m,v);break;case'useTpl':!function(t){var n=i[t];h.compose({content:n.content,isHtml:n.isHtml}).then((function(i){var n;u.setItem('compose_tpl_map',e.assign({},u.getItem('compose_tpl_map'),((n={})[i.id]=t,n)))}))}(m);break;case'addTpl':I();break;case'saveTpl':!function(){var l=_.$('.j-tpl-id').val(),r=_.$('.j-tpl-name').val().trim(),d={name:r,isHtml:n.designMode,content:n.html(),opt:b.opt},u=r?r.length>20?c('setting/msg_tpl_name_overflow'):e.mapFind(i,(function(e,t){return e.name===r&&t!=l&&c('setting/msg_tpl_name_exist')})):c('setting/msg_tpl_name_empty');if(u)return void _.$('.tpl-name').addClass('error').find('.u-form-explain').text(u);if(n.isEmpty())return s(c('setting/msg_tpl_content_empty'));l&&(d.id=l);o.upsetMailTpl([d],!!l).then((function(n){l?t.notify.success(c('setting/msg_update_template_success')):(t.notify.success(c('setting/msg_create_template_success')),i[d.id=n[0]]=d),e.assign(b,d),M(),a&&_.sendMessage('component.mailTemplate','switch.template',{composeId:a}),A()}))}();break;case'resetTpl':A();break;case'removeSource':s(c('setting/msg_tpl_file_remove'),(function(){F(delete b.opt)}));break;case'editAcc':s(j({account:w=g,setting:y[w]}),{title:c('setting/lbl_defaultAccountSet'),closeTpl:'<span class="iconfont icontabclose"></span>',onConfirm:function(){var e,i=t('.j-account-tpl-edit').serializeJSON({defaultType:'+I'});y[w]=i,o.updateMailTplMeta({opt:{accounts:(e={},e[w]=i,e)}}).then((function(){t.notify.success(c('setting/lbl_update_account_success')),$()}))}}),t('.j-account-tpl-edit .u-select').each((function(){var e=t(this);l({width:148,autoSetWidth:!0,trigger:e,disabled:e.prop('disabled')||!1,parentNode:e.parent(),zIndex:999})}))}var w}],'click .tags':function(e,i){var a='{{'+i.title+'}}';if(n.designMode)n.insertHtml('<span>'+p(a)+'</span>');else{var s=t(n.getTextarea()).focus(),l=s.caret(),r=n.html().replace(/\r\n/g,'\n');n.text(r.substring(0,l)+a+r.substring(l,r.length)),s.caret(l+a.length)}},'change #tplVariableFile':function(){var e=_.$('#tplVariableFile');o.uploadTplSourceFile(e).then((function(e){var t=d.path.basename(e.fileName);o.parseTplSource(e.attachmentId).then((function(e){F(b.opt={fileName:t,variables:Object.keys(e[0])})}))})).either(e.replaceWith.bind(e,e.clone(!0)))},'focus .j-tpl-name':[function(e){e.parent().removeClass('error')},t]},_.after('render',(function(){t.notify.loading(),f.when(o.listMailTpl(),o.getMailTplMeta()).then((function(n,a){i=e.objBy(n,'id'),e.assign(y,e.pick(e.get(a,'opt.accounts'),Object.keys(y))),M(!0),t.notify.loading('hide'),_.subscribe('dispatcher','url:changed',T),T()}))}))})),g=i(1008);a.module({name:'setting.delivery.template',template:g},b)}).call(this,i(464))},1007:function(e,t,i){(function(e){!function(e,t){if(!e.fn.dotdotdot){e.fn.dotdotdot=function(t){if(0==this.length)return e.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each((function(){e(this).dotdotdot(t)}));var n=this;n.data('dotdotdot')&&n.trigger('destroy.dot'),n.data('dotdotdot-style',n.attr('style')||''),n.css('word-wrap','break-word'),'nowrap'===n.css('white-space')&&n.css('white-space','normal'),n.bind_events=function(){return n.bind('update.dot',(function(t,i){t.preventDefault(),t.stopPropagation(),d.maxHeight='number'==typeof d.height?d.height:function(e){for(var t=e.innerHeight(),i=['paddingTop','paddingBottom'],n=0,a=i.length;n<a;n++){var s=parseInt(e.css(i[n]),10);isNaN(s)&&(s=0),t-=s}return t}(n),d.maxHeight+=d.tolerance,void 0!==i&&(('string'==typeof i||i instanceof HTMLElement)&&(i=e('<div />').append(i).contents()),i instanceof e&&(a=i)),(v=n.wrapInner('<div class="dotdotdot" />').children()).contents().detach().end().append(a.clone(!0)).find('br').replaceWith('  <br />  ').end().css({height:'auto',width:'auto',border:'none',padding:0,margin:0});var r=!1,f=!1;return p.afterElement&&((r=p.afterElement.clone(!0)).show(),p.afterElement.detach()),s(v,d)&&(f='children'==d.wrap?function(e,t,i){var n=e.children(),a=!1;e.empty();for(var l=0,r=n.length;l<r;l++){var o=n.eq(l);if(e.append(o),i&&e.append(i),s(e,t)){o.remove(),a=!0;break}i&&i.detach()}return a}(v,d,r):function m(t,i,n,a,r){var d=!1;return t.contents().detach().each((function(){var p=this,f=e(p);if(void 0===p||3==p.nodeType&&0==e.trim(p.data).length)return!0;if(f.is('script, .dotdotdot-keep'))t.append(f);else{if(d)return!0;t.append(f),r&&t[t.is('table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style')?'after':'append'](r),s(n,a)&&((d=3==p.nodeType?function(t,i,n,a,r){var d=t[0];if(!d)return!1;var p=c(d),f=-1!==p.indexOf(' ')?' ':'　',m='letter'==a.wrap?'':f,v=p.split(m),h=-1,b=-1,g=0,_=v.length-1;a.fallbackToLetter&&0==g&&0==_&&(m='',v=p.split(m),_=v.length-1);for(;g<=_&&(0!=g||0!=_);){var y=Math.floor((g+_)/2);if(y==b)break;b=y,o(d,v.slice(0,b+1).join(m)+a.ellipsis),s(n,a)?(_=b,a.fallbackToLetter&&0==g&&0==_&&(m='',v=v[0].split(m),h=-1,b=-1,g=0,_=v.length-1)):(h=b,g=b)}if(-1==h||1==v.length&&0==v[0].length){var w=t.parent();t.detach();var k=r&&r.closest(w).length?r.length:0;w.contents().length>k?d=u(w.contents().eq(-1-k),i):(d=u(w,i,!0),k||w.detach()),d&&(p=l(c(d),a),o(d,p),k&&r&&e(d).parent().append(r))}else p=l(v.slice(0,h+1).join(m),a),o(d,p);return!0}(f,i,n,a,r):m(f,i,n,a,r))||(f.detach(),d=!0)),d||r&&r.detach()}})),d}(v,n,v,d,r)),v.replaceWith(v.contents()),v=null,e.isFunction(d.callback)&&d.callback.call(n[0],f,a),p.isTruncated=f,f})).bind('isTruncated.dot',(function(e,t){return e.preventDefault(),e.stopPropagation(),'function'==typeof t&&t.call(n[0],p.isTruncated),p.isTruncated})).bind('originalContent.dot',(function(e,t){return e.preventDefault(),e.stopPropagation(),'function'==typeof t&&t.call(n[0],a),a})).bind('destroy.dot',(function(e){e.preventDefault(),e.stopPropagation(),n.unwatch().unbind_events().contents().detach().end().append(a).attr('style',n.data('dotdotdot-style')||'').data('dotdotdot',!1)})),n},n.unbind_events=function(){return n.unbind('.dot'),n},n.watch=function(){if(n.unwatch(),'window'==d.watch){var t=e(window),i=t.width(),a=t.height();t.bind('resize.dot'+p.dotId,(function(){i==t.width()&&a==t.height()&&d.windowResizeFix||(i=t.width(),a=t.height(),m&&clearInterval(m),m=setTimeout((function(){n.trigger('update.dot')}),100))}))}else f=r(n),m=setInterval((function(){if(n.is(':visible')){var e=r(n);f.width==e.width&&f.height==e.height||(n.trigger('update.dot'),f=e)}}),500);return n},n.unwatch=function(){return e(window).unbind('resize.dot'+p.dotId),m&&clearInterval(m),n};var a=n.contents(),d=e.extend(!0,{},e.fn.dotdotdot.defaults,t),p={},f={},m=null,v=null;return d.lastCharacter.remove instanceof Array||(d.lastCharacter.remove=e.fn.dotdotdot.defaultArrays.lastCharacter.remove),d.lastCharacter.noEllipsis instanceof Array||(d.lastCharacter.noEllipsis=e.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),p.afterElement=function(t,i){if(!t)return!1;if('string'==typeof t)return!!(t=e(t,i)).length&&t;return!!t.jquery&&t}(d.after,n),p.isTruncated=!1,p.dotId=i++,n.data('dotdotdot',!0).bind_events().trigger('update.dot'),d.watch&&n.watch(),n},e.fn.dotdotdot.defaults={ellipsis:'... ',wrap:'word',fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},e.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[' ','　',',',';','.','!','?'],noEllipsis:[]}},e.fn.dotdotdot.debug=function(e){};var i=1,n=e.fn.html;e.fn.html=function(t){return null!=t&&!e.isFunction(t)&&this.data('dotdotdot')?this.trigger('update',[t]):n.apply(this,arguments)};var a=e.fn.text;e.fn.text=function(t){return null!=t&&!e.isFunction(t)&&this.data('dotdotdot')?(t=e('<div />').text(t).html(),this.trigger('update',[t])):a.apply(this,arguments)}}function s(e,t){return e.innerHeight()>t.maxHeight}function l(t,i){for(;e.inArray(t.slice(-1),i.lastCharacter.remove)>-1;)t=t.slice(0,-1);return e.inArray(t.slice(-1),i.lastCharacter.noEllipsis)<0&&(t+=i.ellipsis),t}function r(e){return{width:e.innerWidth(),height:e.innerHeight()}}function o(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function c(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:''}function d(e){do{e=e.previousSibling}while(e&&1!==e.nodeType&&3!==e.nodeType);return e}function u(t,i,n){var a,s=t&&t[0];if(s){if(!n){if(3===s.nodeType)return s;if(e.trim(t.text()))return u(t.contents().last(),i)}for(a=d(s);!a;){if((t=t.parent()).is(i)||!t.length)return!1;a=d(t[0])}if(a)return u(e(a),i)}return!1}}(e)}).call(this,i(463))},1008:function(e,t,i){e.exports=i(469)('<section class="m-mail-template content-wrapper"> <div class="m-setting-info"> {{i18n \'setting/lbl_setting_info\'}} </div> <div class="j-mail-template m-list-tpl"></div> <div class="j-edit-template m-edit-tpl f-dn"></div> </section>',{templateSetTpl:'<div class="title dotted"> <h4>{{i18n \'setting/lbl_template_set\'}}</h4> </div> <div class="tpl-container"> {{#each templates}} <div class="tpl-item"> <h4>{{name}}</h4> <div class="tpl-opr"> <span class="del" href="#" data-action="delTpl" data-tid="{{id}}" data-name="{{name}}"><i class="iconfont icontabclose"></i></span> <span class="edit" href="#" data-action="editTpl" data-tid="{{id}}"><i class="iconfont iconsetupcenter"></i></span> <span class="compose" href="#" data-action="useTpl" data-tid="{{id}}"><i class="iconfont iconcreate"></i></span> </div> </div> {{/each}} <div class="tpl-item add"> <i class="iconadd iconfont" data-action="addTpl"></i> </div> </div> {{!-- 暂时屏蔽账号默认模板管理 <div class="title dotted"> <h4>{{i18n \'setting/lbl_template_manage\'}}</h4> </div> <div class="account-tpl-container"></div> --}}',accDefaultTplCard:'{{#each accounts}} <div class="account-card"> <h4>{{@key}}</h4> <div class="card-item"> <label class="item-label">{{i18n \'setting/lbl_generalDefault\'}}: </label> <span class="item-text">{{translateTpl generalDefault}}</span> </div> <div class="card-item"> <label class="item-label">{{i18n \'setting/lbl_replyDefault\'}}: </label> <span class="item-text">{{translateTpl replyDefault}}</span> </div> <div class="card-item"> <label class="item-label">{{i18n \'setting/lbl_forwardDefault\'}}: </label> <span class="item-text">{{translateTpl forwardDefault}}</span> </div> <div class="acc-opr"> <span class="edit" href="#" data-action="editAcc" data-index="{{@key}}"> <i class="iconfont iconcreate"></i></span> </div> </div> {{/each}}',editAccTpl:'<form action="#" class="j-account-tpl-edit m-acc-template" onsubmit="return false"> <div class="u-form-item"> <label class="u-form-label">{{i18n \'setting/lbl_account_tpl\'}}: </label> <span class="u-form-text" style="font-weight: bold; color: #333">{{account}}</span> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n \'setting/lbl_generalDefault\'}}: </label> <div class="f-ib"> <select name="generalDefault" class="u-select"> {{{tplOptions setting.generalDefault}}} </select> </div> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n \'setting/lbl_replyDefault\'}}: </label> <select name="replyDefault" class="u-select"> {{{tplOptions setting.replyDefault}}} </select> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n \'setting/lbl_forwardDefault\'}}: </label> <select name="forwardDefault" class="u-select"> {{{tplOptions setting.forwardDefault}}} </select> </div> </form>',displayVarTpl:'{{#if fileName}} <div> <p class="title">{{i18n "setting/lbl_imported_file"}}</p> <p> <span class="f-ib f-ellipsis" style="max-width: 10em;">{{fileName}}</span> <a href="#" class="link f-fr f-mgl" data-action="removeSource">{{i18n "common/op_delete"}}</a> <label class="link f-fr" for="tplVariableFile">{{i18n "setting/lbl_reimport"}}</label> </p> <p class="title">{{i18n "setting/lbl_imported_variable"}}</p> <div class="u-template-vars"> {{#each variables}} <span class="tags f-ellipsis" title=\'{{this}}\'>{{this}}</span> {{/each}} </div> </div> {{/if}}',editMailTpl:'<div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="saveTpl">{{i18n \'setting/op_save\'}}</button> <button type="button" class="u-btn u-btn-default" data-action="resetTpl">{{i18n \'setting/op_cancel\'}}</button> </div> <div class="tpl-wrapper"> <div class="u-form-item tpl-name"> <label class="u-form-label">{{i18n \'setting/lbl_template_name\'}} :</label> <input type="text" class="u-input j-tpl-name" value="{{name}}"> {{#if id}} <input type="hidden" value="{{id}}" name="id" class="j-tpl-id"> {{/if}} <div class="u-form-explain f-dn"></div> </div> <div class="u-form-item tpl-content"> <label class="u-form-label">{{i18n \'setting/lbl_template_content\'}} :</label> <div class="tpl-compose j-tpl-compose"> <textarea id="tpl_editor" name="template" style="width:100%; height: 100%">{{content}}</textarea> </div> </div> <div class="tpl-variable"> <p class="title">{{i18n "setting/lbl_mail_template_desc"}}</p> <ul> <li>{{{i18n "setting/lbl_imported_desc1"}}}</li> <li>{{i18n "setting/lbl_imported_desc2"}}</li> <li>{{i18n "setting/lbl_imported_desc3"}}</li> </ul> <label for="tplVariableFile" class="u-btn u-btn-primary j-import-file" > {{i18n "setting/lbl_import_file"}} </label> <div class="j-file-info"></div> <input type="file" id="tplVariableFile" name="tplFile" style="position: fixed; right: -9999px"> </div> </div>'})},1009:function(e,t,i){var n=i(499),a=i(465),s=i(468).get;n('setting.filter',{overrides:{letter:a('pref/filter'),vip:s('mail.enableVipMessage')}},{setup:function(){var e=this;e.subscribe('dispatcher','view:changed',(function(t){var i=t.message.newState.module;i.startsWith('setting.filter.')&&e.sendMessage(i,'view:refresh')}))}})},1010:function(e,t,i){(function(e){i(1011),i(486),i(532),i(636);var t,n=i(534),a=i(463),s=i(464),l=i(489)['default'],r=i(479),o=i(472),c=i(498),d=i(476),u=i(474),p=i(471),f=i(467),m=i(470),v=m.alert,h=m.confirm,b=m.prompt,g=i(469),_=i(494).SafeString,y=i(468).get,w=i(465),k=i(475),x=i(473),j=i(483).encode,S=i(529),C=i(482),T=i(506).decimalInt,$=i(514),A=y('user.enableforward'),I=y('setting.advanceFilter'),D=s.biz(/^(from|recipients|to|cc)$/),M=s.biz(/^(subject|content|text|attachName)$/),E=s.biz(/size/i),F=s.biz(/date/i),P=['contains','excludes','=','!=','startsWith','endsWith'],N=function(e){return{'<':w('pref/junkfilter/op_size_lt'),'>':w('pref/junkfilter/op_size_gt')}[e]||w('pref/junkfilter/op_text_'+e)},L=function(e){return w('pref/filter/c_'+e)},R=function(e,t,i){var n=M(e)?s.unique(('text'===e?['subject','content']:[e]).concat(t.matchFilename?'attachName':[])):[];return n[i?0:1]?[L('text'),n.map(L)]:[L(e)]},O={1:w('common/op_urgent'),3:w('common/op_general'),5:w('common/op_slow')},U=function(e){return L('mailType_'+e)},V={linkAttached:w('common/attachment_large'),attached:w('common/attachment_general'),noAttach:w('common/attachment_without')},z=C.get(),B=z.values,q=z.all,H=function(e){return w('pref/filter/a_'+e)},Y=function(e){return e.field?R(e.field,e,I)[0]:e.type?H(e.type):L(e)},W=function(e,t,i){return i||{text:w('pref/pop/foldernotfound'),'class':'error'}},J=y('mail.label0Count'),G=function(e){return{text:w('mbox/flagged_option_color'+e),'class':'flagged label0-'+e}},K=function(e){return s.find(t,{id:e})},X=function(e,t){return(t=K(e))?{text:t.name,style:'color:'+t.color}:{text:w('mail/msg_mark_tag_not_found'),'class':'error'}},Z=s['let']({vip:[y('mail.enableVipMessage')],read:[1],tags:[y('setting.supportMailTagged'),'tag'],label0:[J],defer:[I&&y('mail.enabledefermail'),'setDefer'],priority:[1,,w('mbox/mail_priority')]},(function(e){return[s.keys(s.pickBy(e,0)),s.mapValues(e,(function(e,t){var i=e[1];return e[2]||w('common/op_'+(i||t))}))]})),Q=[w('mail/today'),w('mail/tomorrow'),w('mail/theDayAfterTmr')],ee=['forward','attachForward','redirect'],te=function(e){return w('pref/filter/a_forward_'+ee.indexOf(e))},ie=['KB','MB','GB','TB'],ne=o.extend({},(function(o,p){var m=this;m.events={'click [data-action]':[function(e,t){switch(e){case'createRule':return be();case'editRule':return t.data().isVip?f.go('setting.filter.vip'):ge(t.data().ruleid);case'deleteRule':return _e(t);case'saveRule':return function(){var e=m.$('[name=ruleForm]'),t=e.serializeJSON();if(m.$('.tip-error').hide(),ye(a('[name=name]',e).parent()))return;if(i('conditions','.j-condition-list','Cond'))return;if(i('exceptConditions','.j-except-condition-list'))return;if(t.reject)t.actions=[{type:'reject'}];else if(i('actions','.j-action-list','Act'))return;return delete t.reject,function(e){var t=function(t,i){return s['let'](s.find(e.conditions.concat(e.exceptConditions),{field:t}),i)},i=function(t,i){return s['let'](s.find(e.actions,{type:t}),i)},n=ve(i('move','target'))||i('tags')&&K(i('tags').value[0])||i('flags')||i('defer'),l=e.id;return le([e],(function(){(l?d.mailRuleUpdate:d.mailRuleAdd)(e).then((function(e){fe(ne=function(){n&&!(t('content')||t('text')||t('subject','matchFilename')||t('attachName')||t('sum(attachSize)'))?function(e){m.$('.filter').html(oe.filterMessageTpl(me(s.find(z,{id:e})))),ke('filter');var t='@'+e,i=y('contact.itemperpage')||20;!function n(e){var s={fid:1,ruleConditions:t,returnTotal:!0,limit:i,start:e*i};u.getMailList(s).then((function(s,l){var r=l.total;m.$('.panel-message').html(x(w('pref/filter/msg_execFilter'+(r&&1)),'<b>'+r+'</b>')).find('a').addClass('f-csp').click((function(){return function(e,t){u.updateMailAttrs([],{},{rule:e,fid:t}).then((function(){a.notify(x(w('pref/filter/msg_execOK'))),ke(),u.flush()}))}(t,1)})),u.formatMails(s),m.$('.panel-list').css('top',m.$('.panel-content').height()+3).html(oe.messageGroupTpl(u.groupMailList(s))),function(e,t,i,n){m.$('.pagination').toggle(e>t).pagination({total:e,limit:t,currentPage:i,round:!0,menuAlignCenter:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:n})}(r,i,e,n)}),(function(e){v(w('error/'+e.code),fe)}))}(0)}(+l||e[0]):(ke(),n&&ue.show().find('span').html(w('pref/filter/note_no_exec')),pe())}),a.notify(w('setting/msg_rule'+(l?'Edited':'Added')+'Successfully'))}))}),!0)}(t);function i(e,i,n){var a=t[e],l=t[e]=[];return s.some(a,(function(e,t){return 1===(e=ye(m.$(i+' .j-item').eq(t),e))||e&&!l.push(e)}))||!l[0]&&n&&v(w('pref/filter/err_empty'+n))}}();case'up':case'down':return i=t.data('ruleid'),n=t.closest('tr')['up'===e?'prev':'next']().find('[data-ruleid]').data('ruleid'),void d.adjustMailRules({id:i,ref:n,value:0}).then(fe);case'switchStatus':return function(e){var t=e.data('ruleid'),i=!e.find(':checkbox').prop('checked');d.mailRuleUpdate({id:t,disabled:i}).then((function(){e.closest('tr')[0].className='item'+(i?'-disabled':'')}))}(t);case'backToList':case'closePanel':return ke()}var i,n}],'click div.j-listtt':[function(e){var t=e.next('div.list-body'),i=t.hasClass('fold');t[i?'slideDown':'slideUp']().toggleClass('fold',!i),e.find('i').toggleClass('iconcollapse iconunfold')},a]};var S=y('setting.maxRuleCount'),$=s.fn({name:'##VIP'}),z=[],ne=he;o()(p);var ce=m.$('.j-head'),de=m.$('.j-body'),ue=m.$('.message-tip').click(pe);function pe(e){e&&a(e.target).is('.j-close')&&ue.hide(),de.css({top:ue.filter(':visible').outerHeight()+ce.outerHeight()+12})}function fe(){m.$().mask(),e.when(d.mailRules(),u.getTags()).then((function(e,i){t=i,le(z=e,(function(){!function(){a('.tip',ce).html(x(w('setting/lbl_statistics'),[z.length,S]));var e=z.filter(s.not($)).length<2;m.$('[data-action=removeAllRules]').toggleClass('disabled',e).off('click').click((function(){e||_e(m.$('[data-action=deleteRule]'))})),de.html(oe.rulesTpl(s.map(z,me))),pe()}(),l(m.$()),m.$().mask('hide'),m.rebindMessage('view:refresh',fe),m.resubscribe('dispatcher','url:changed',he),ne(ne=s.noop)}))}))}function me(e){var t=function(e){return s.map(e,(function(e){var t=se(e),i=t[0],l=t[1],r=t[2],o={move:ve([r])||a('<span>',W()),label0:a('<span>',G(r)),tags:a('<span>',X(r)),defer:Q[r]+' '+w('main/mbox_todo_email'),priority:''+O[r]}[l||i]||Z[1][l]||j(r||'');return s.assign({error:o.is&&o.is('.error'),summary:({mark:H('mark'),forward:te(l)}[i]||w('pref/junkfilter/ac_'+i))+' '+n(o)},e)}))}(e.actions);return s.assign({},e,{conditions:i(e.conditions),exceptConditions:i(e.exceptConditions),actions:t,hasInvalidAction:s.some(t,'error'),vip:$(e)});function i(e){return s.mapFilter(e,(function(e){var t=ae(e),i=t[0],a=t[1],l=t[2],r=function(t){return e.forIAddress?{VIP:w('main/vip_contact')}[t]||t:E(i)?t+ie[l]:{priority:O[t],mailType:U(t),securityLevel:q[t]}[i]||t},o=function(e){return n(j(s.filter(s.array(e)).map(r).join(', ')))},c=s.assign({},e,{operand:a,unit:l}),d=e.operator,u=R(i,e),p=u[0],f=u[1];return c.summary='attachType'===i?'noAttach'===a?V[a]:N(d)+' '+V[a]:p+(f?' ('+f.join(', ')+')':'')+' '+('between'===d?x(w('pref/filter/op_between'),a.map(o)):N(d)+' '+o(a)),'rcptType'!==i&&c}))}function n(e){return a('<span>',{'class':'f-pre highlight',html:e})[0].outerHTML}}function ve(e){return u.getCacheFolder(e).name}function he(){var e=f.getCurrentState(),t=e.module,i=e.param,n=i.type,a=i.emailaddr;if(t===re){switch(n){case'create':!function(e){be({name:e?x(w('pref/junkfilter/auto_create_ruleName'),e):'',conditions:[{field:'from',operator:'=',operand:e}]})}(a)}f.setCurrentState({module:t})}}function be(e){z.length<S?ge(0,s.assign({'continue':!0,conditions:['from','recipients','subject','size']},e)):v(w('setting/msg_beyondMaxRuleLimit'))}function ge(o,p){e.when(p||d.mailRules(),y('setting.supportsmsnotify')&&d.getSMSAttrs(),d.optAttrs('permAudit')).then((function(e,d,f){var v,h,b=f.permAudit,g=s.assign(p=p||s.find(e,{id:o}),(v=p.actions,h=s.filter(v,(function(e){return!/^(reject|sms|reply)$/.test(e.type)})),{reject:s.find(v,{type:'reject'}),actions:s.filter([].concat(s.find(v,{type:'sms'})||'sms',h[0]?h:['move','mark',A&&'forward'],s.find(v,{type:'reply'})||y('user.enableautoreply')&&'reply'))}));ke('edit'),le([g],(function(){!function(e,o,d,p){var f=function(e){return function(e,i){return{op:[P,N,1,80],or:[{and:w('pref/filter/fmt_and'),or:w('pref/filter/fmt_or')},,1,216],unit:[[0,1,2,3],ie,1,50],priority:[O],mailType:[s.filter([1,2,3,4,5,y('calendar.enable')&&6,y('calendar.enable')&&7,i&&8]),U],securityLevel:[B,q],attachType:[V],move:[,W],mark:Z,label0:[s.times(J),G],tags:[s.map(t,'id'),X],defer:[[0,1,2],Q],forward:[ee,te]}[e]}(e,p)},v=function(e,t){var i=t.hash;return new _('<input name="'+e+'" data-select=\''+JSON.stringify(i)+'\'>')},h=function(e,t){return e&&/tags|label0|defer|priority/.test(e)?'<div class="element values">'+v('actions[][value]',{hash:{type:e,value:t}})+'</div>':''},b=function(e,t){return j(t?'exceptConditions':'conditions',e,ae(e))},g=function(e){return j('actions',e,se(e))};function j(t,i,n){var a=n[0],l=n[3],r=oe[(D(a)?'address':M(a)?'keyword':E(a)||F(a)?'range':a)+'Tpl']||f(a)&&oe.selectTpl,o=s.assign({top:t},i=e&&s.isOBJ(i)&&i,{},l);return oe.itemTpl(s.assign({body:r&&r(o,S),original:i},o),S)}var S={data:{create:!e,advance:I,sms:d},helpers:{'u-select':v,select2:h,label:Y,conditionTpl:b,actionTpl:g}},T=a(oe.editRuleTpl(o,S));m.$('.edit').html(T.on('click','[data-action=deleteItem]',(function(){var e=a(this),t=e.closest('.j-except-condition-list');t[0]&&!t.children()[1]&&t.closest('.j-block').hide(),e.closest('.j-item').remove(),z()}))),le(T),z();var $=T.find('input[name^=reject]').click(R);function R(){T.find('.j-action-list, .j-add-action').toggle($.is('[value=0]:checked'))}function z(){s.iter({action:0,condition:1,'except-condition':3},(function(e,t){var i=1&e,n=2&e,l=m.$('.j-'+t+'-list'),r=function(e){return l.find('.j-item:has(input[value='+e+'])')},o=function(e,t,n){return e&&{name:t||(i?L:H)(e),children:s.filter(n),v:e}},c=i?[[o('from'),o('recipients',L('to'),I&&[o('to'),o('cc'),o('recipients')]),o('subject',I&&L('text')),I?o(1,w('common/mailbox'),[o('size'),o('receivedDate'),o('priority'),o('mailType'),o(C.enabled&&'securityLevel')]):o('size'),o(I,w('common/mail_attached'),[o('attachType'),o('sum(attachSize)')])],function(e){var t=a(b(e,n));n&&l.closest('.j-block').show(),le(t.appendTo(l))}]:[[o(!r('move')[0]&&'move'),o('mark'),o(A&&(K('forward')||ee)[0],H('forward'))],function(e){var t=a(g(e));r('reply').before(t.appendTo(l)),le(t),z()}],d=c[0],u=c[1];m.$('.j-add-'+t).dropdown({data:s.filter(d),callback:function(e){var t=e.v;u(t)}})})),ne()}function K(e,t){var i=s.mapFilter(m.$('.u-select').get(),(function(t){var i=a(t).data().self,n=i.get('model');return i.__type===e&&[i,n.map((function(e){return s.isOBJ(e)?s.assign({},e,{disabled:0}):{value:e}})),i.getValue()]}));return s.iter(i,(function(e){var n=e[0],a=e[2];null==a||t&&t.test(a)||s.iter(i,(function(e){var t=e[0],i=e[1];(s.find(i,{value:a})||{}).disabled=t!==n}))})),s.iter(i,(function(e){var t=e[0],i=e[1],n=e[2];t.syncModel(i,n)})),i[0]&&s.difference(s.map(i[0][1],'value'),s.mapFilter(i,2))}function ne(){K('mark',/tags/),K('forward'),K('tags')}function le(e){e.find('[data-select]').each((function(e,t){!function(e){var t=function(){return u.fdrOptions({mail:1,'new':s.fn(we,(function(e){g.syncModel(t(),e)}))})},i=e.data().select,n=i.type,l=i.value,r=f(i.type),o=r[0],d=r[1],p=r[2],m=r[3],v=s.isOBJ(o)?s.keys(o):o||t(),b={maxHeight:192,width:m||151,trigger:e,parentNode:e.parent(),hint:p?'':x(w('pref/filter/hint'),w.get('pref/filter/hint_'+n)||''),model:v,format:s.isFUN(d)?d:function(e,t){return(d||o)[s.isArray(d)?t:e]},value:null==l?l:s.isSTR(v[0])?''+l:+l},g=c(b).on('change',(function(){'mark'===n&&(e.closest('.element').next('.values').remove(),le(a(h(g.getValue())).insertAfter(e.closest('.element')))),'mark'!==n&&'forward'!==n&&'tags'!==n||ne()}));g.__type=n}(a(t))})),i(509)(e.find('.datepicker').on('change',(function(){var e=a(this),t='start'===e.data('role'),i=e.closest('.element').find('[data-role='+(t?'end':'start')+']').data('datepicker');if(e.val()){var n=r(e.val()).startOf('day').format('YYYY-MM-DD');i[t?'setStartDate':'setEndDate'](n)}else i[t?'startDate':'endDate']=null,i.isBuilt&&i.fillAll()}))),e.find('.datepicker[value]').trigger('change'),e.find('input[role=contact]').tagEditor({checkEmail:!1,contactac:{container:m.$('.j-panel')}}),n(m.$(),{trigger:['.contact-btn',function(e){return{selectTitle:(e=e.closest('.j-item')).find('label').text(),input:e.find('input[role=contact]')}}],onSelect:function(e,t){t.tagEditor('updateTags',e.map((function(e){return''+k(e.name,e.addr)})),!0)}}),l(e).on('change','input[data-role=autoTrim]',(function(){this.value=this.value.trim()}))}R()}(o,g,d,b)}))}))}function _e(t){var i=s.map(t,(function(e){return a(e).data('ruleid')}));h(w('setting/msg_delete'+(i[1]?'All':'FilterTip')),(function(){e.wmCall('user:removeMailRules',{ids:i}).then(fe)}))}function ye(e,t){var i=['subject','content','attachName'].map((function(t){return e.find('.checkbox[data-role='+t+']')[0]}));if(i[0]){var n=s.map(i,'checked'),l=n[0],o=n[1],c=n[2],d=l?o?'text':'subject':o?'content':c&&'attachName';if(!d)return j('keywordType');t.field=d,t.matchFilename=(l||o)&&c}if(!t){var u=a('input',e),p=u.val();return p?p!==u.attr('value')&&s.some(z,{name:p})?j('nameDuplicate'):j(p,2e3):j('nameEmpty')}var f=t.field,m=t.operand,v=t.type,h=t.type2,b=t.target,g=t.content,_=t.value;return f?(E(f)||F(f)?m[0]||m[1]:m||null==m)&&(function(e,t){var i=E(e);return i||F(e)?s.some(t,(function(e){return e&&(i?!(T(e)>0)&&j('notInt'):!/\d{4}-\d{2}-\d{2}/.test(e)&&j('invalidDate'))}))||t[0]&&t[1]&&(i?+t[0]>=+t[1]:new Date(t[0])>new Date(t[1]))&&j('invalidRange'):j(t,2e3)}(f,m||'')?1:function(e,t,i){return s.assign({},e.original||s.assign({},D(t)&&{forAddress:1,extractAddress:1},{},(D(t)||M(t))&&{ignoreCase:1,listOfValues:1}),{},s.omit(e,['original','unit']),{},'attachType'===t&&{field:'flags',operator:'noAttach'===i?'excludes':'contains',operand:'noAttach'===i?['attached','linkAttached']:'linkAttached'===i?['linkAttached']:['attached']},{},E(t)&&n((function(t){return t*Math.pow(1024,e.unit)})),{},F(t)&&n((function(e,t){return r(e).add(t?1:0,'days').startOf('day').toDate()})));function n(e){var t=i[0],n=i[1];return{operator:t&&n?'between':t?'>':'<',operand:t&&n?s.map(i,e):e(t||n,!t)}}}(t,f,m)):!t.disabled&&([_,b,g].join('').trim()||/vip|read/.test(h))&&(function(e,t,i){if(ee.includes(e)){var n=k.parse(t);return s.map(n,'address').some(s.not(k.test))?j('forwardFormat'):j(n,y('user.maxForwardMailCount')||1,'forwardLimit')||j(t,2e3)}if('reply'===e)return j(i,2e3)}(v,b,g)?1:function(e,t,i,n,a){return s.assign({},a,{},s.omit(e,['original','type2']),{},{forward:s.assign({type:i||t},!a&&{keepLocal:1})}[t],{},{vip:{type:'flags',value:{vip:!0}},read:{type:'flags',value:{read:!0}},label0:{type:'flags',value:{flagged:!0,label0:n}},priority:{type:'flags',value:{priority:+n}},defer:{type:i},tags:{type:i,value:[n]}}[i])}(t,v,h,_,t.original));function j(t,i,n){if(!i||t.length>i){var s=x(w('pref/filter/err_'+(i?n||'limitLength':t)),i);return a.notify.error(s),e.find('.tip-error').html(s).show(),1}}}function we(e){b(g('<div><label class=\'label f-ib f-tar\' style=\'width: 150px\'>'+w('setting/msg_inputFolderName')+':</label> &nbsp;&nbsp;<input style="width: 226px"> <br> <br><label class=\'label f-ib f-tar\' style=\'width: 150px\'>'+w('setting/lbl_folderPos')+':</label> &nbsp;&nbsp;<select class=\'j-new-folderPid\' style=\'width: 230px\'>{{fdrOptions nest=1}}</select></div>')(),{title:w('main/bt_createfolder'),onConfirm:function(t){var i=this.$('.j-new-folderPid').val(),n={name:t,parent:+i},l=d.trimName(n);return'ok'===l?d.createFolders([n]).then((function(t){a.notify.success(w('setting/msg_createFolderSuccess')),u.flush().then(s.fn(e,t[0]))})):(a.notify.error(w('setting/msg_err_'+l)),!1)}})}function ke(e){var t=m.$('.main-wrapper');t.removeClass('show switchedit switchfilter'),e&&t.addClass('show switch'+e)}a(window).resize(pe),fe()}));function ae(e){var t,i=e.field||e,n=e.operator,a=e.operand;if('flags'===i&&(a.includes('attached')||a.includes('linkAttached')))i='attachType',a='excludes'===n?'noAttach':a[0];else if(E(i)){t=Math.min.apply(0,(a=s.array(a)).map((function(e){return/0*$/.exec(e.toString(2))[0].length})))/10|0,a=a.map((function(e){return e/Math.pow(1024,t)})),a='<'===n?[,a[0]]:a}else F(i)&&(a=s.array(a,(function(e,t){return r(e).add(t?-1:0,'second').format('YYYY-MM-DD HH:mm:ss').replace(/ (00:00:00|23:59:59)$/,'')})),a='<'===n?[,a[0]]:a);return[i,a,t,{field:i,operand:a,unit:t}]}function se(e){var t=e.type||e,i=e.value,n=i||0,a=n.flagged?'label0':s.keys(n)[0],l={flags:['mark',n[a]||0,a],defer:['mark',i,t],tags:['mark',n[0],t],reply:[t,e.content]}[t]||S(t,[[/sms|move/,[t,e.target]],[ee,['forward',e.target,t]]],[t,i]),r=l[0],o=l[1],c=l[2];return[r,c,o,{type:r,type2:c,value:o}]}function le(e,t,i){var n=i?/^(x?cm--.*)$/:/^usrou#([^*]*)\/\*$/,a={},l=a[i?'email':'dn']=[];function r(t){s.flatMap(e,'conditions').forEach((function(e){D(e.field)&&(e.operand=e.operand.split(',').map((function(e){var a=n.exec(i?k.of(e).address:e);return a&&t(a[1])||e})).join())}))}r((function(e){l.push(e)})),l[0]?$.dirLookup(a).then((function(e){r((function(t,n){return(n=e[t])&&(i?'usrou#'+n.dn+'/*':k(n.name,n.email))})),t()})):t()}var re='setting.filter.letter',oe=i(1012);p.module({name:re,template:oe},ne)}).call(this,i(466))},1012:function(e,t,i){e.exports=i(469)('<section class="m-letterFilter grid-row"> <div class="main-wrapper"> <div class="message-tip f-dn u-alert-warning u-alert-dismissible f-ellipsis"> <i class="close iconfont icondelword j-close"></i><span></span> </div> <div class="j-head head-wrapper"> <div class="m-setting-info"> {{{i18n \'setting/lbl_filter_info\'}}} </div> <div class="grid-row lfheader"> <div class="grid-col12"> <div class="u-btns"> <button type="button" class="u-btn u-btn-primary" data-action="createRule">{{i18n "pref/junkfilter/addfilter"}}</button> </div> <span class=tip></span> <a class=f-csp data-action=removeAllRules>{{i18n \'setting/op_removeAll\'}}</a> </div> </div> </div> <div class="j-body body-wrapper u-scroll"></div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="panel j-panel"> <div class="panel-content-wrapper edit"></div> <div class="panel-content-wrapper filter"></div> </div> </div>               </section>',{rulesTpl:'<table class="sg-table"> <thead> <tr> <th width="60"></th> <th>{{i18n \'pref/filter/th_rules\'}}</th> <th width="100">{{i18n \'common/op_sort\'}}</th> <th width="100">{{i18n \'main/h_operation\'}}</th> </tr> </thead> <tbody> {{#if this.[0] }} {{#each this}} <tr class="item{{if$ disabled \'-disabled\'}}"> <td class="ruleStatus" data-action="{{if$ (not vip) \'switchStatus\'}}" data-ruleid="{{id}}"> {{#if (not vip)}} <input type="checkbox" role="switchBtn" class="checkbox" {{#unless disabled}}checked{{/unless}} /> {{/if}} </td> <td class="ruleDetail"> <div> <span class="ruleName {{if$ hasInvalidAction \'error\'}}"> {{if$ vip (i18n "main/vip_message") name}} </span> {{#if hasInvalidAction}}<span class="warning">({{i18n \'pref/filter/warn_invalid\'}})</span>{{/if}} {{>ruleSummaryTpl}} </div> </td> <td class="ruleSort"> {{#if @first}} {{^}} <a class=f-csp data-action="up" data-ruleid="{{id}}" title=\'{{i18n "pref/junkfilter/moveup"}}\'><i class="iconfont iconmoveup"></i></a> {{/if}} {{#if @last}} {{^}} <a class=f-csp data-action="down" data-ruleid="{{id}}" title=\'{{i18n "pref/junkfilter/movedown"}}\'><i class="iconfont iconmovedown"></i></a> {{/if}} </td> <td class="ruleOp"> {{#if (not vip)}} <a class=f-csp data-action="deleteRule" data-ruleid="{{id}}" title=\'{{i18n "pref/junkfilter/deletefilter"}}\'>{{i18n "pref/junkfilter/deletefilter"}}</a> {{/if}} <a class=f-csp data-action="editRule" data-ruleid="{{id}}" data-is-vip="{{vip}}" title=\'{{i18n "pref/junkfilter/updatefilter"}}\'>{{i18n "pref/junkfilter/updatefilter"}}</a> </td> </tr> {{/each}} {{^}} <tr> <td class="noRule" colspan="4">{{i18n \'pref/filter/no_rule\'}}</td> </tr> {{/if}} </tbody> </table>',conditionSummaryTpl:'<tr class="ruleContent"> <td>{{i18n (join \'pref/filter/\' lbl)}}</td> <td class="ruleCondition"> {{#each conditions}} {{#if (not @first)}} <span> <br /> {{i18n (join \'pref/junkfilter/cond_\'(if$ flagOperatorOr \'or\' (or ../operator \'and\')))}} </span> {{/if}} {{{summary}}} {{#if (and (in field \'from,recipients,to,cc,subject,text,content,attachName\') (not forIAddress))}} <span>{{i18n (join \'pref/junkfilter/\' (if$ ignoreCase \'nocase\' \'case\'))}}</span> {{/if}} {{#if forAddress}}<span>{{i18n "pref/junkfilter/forAddress"}}</span>{{/if}} {{/each}} </td> </tr>',ruleSummaryTpl:'<table> <tbody> {{> conditionSummaryTpl lbl=\'lbl_if\'}} <tr class="ruleContent"> <td>{{i18n "pref/junkfilter/execute"}}</td> <td class="ruleAction"> {{#each actions}} <div> {{#if (not disabled)}} {{#if (not @first)}}<span>{{i18n "pref/junkfilter/cond_and"}}</span>{{/if}} {{{summary}}} {{#if keepLocal}}<span class="additions">{{i18n "pref/junkfilter/ac_keeplocal"}}</span>{{/if}} {{/if}} </div> {{/each}} </td> {{#if exceptConditions}}{{> conditionSummaryTpl lbl=\'lbl_unless\' operator=exceptOperator conditions=exceptConditions}}{{/if}} </tr> </tbody> </table>',editRuleTpl:'<div class="panel-item panel-item1"> <div class="u-btns-top"> <button data-action="saveRule" class="u-btn u-btn-primary" type="button">{{i18n "common/save"}}</button> <button data-action="closePanel" class="u-btn u-btn-default" type="button">{{i18n "pref/cancel"}}</button> </div> </div> <div class="title dotted"> <h4>{{i18n (join \'pref/junkfilter/\' (if$ @create \'add_filter_rule\' \'setfilter\'))}}</h4> </div> <form name=ruleForm action=# class=panel-body> {{#if (not @create) }} <input type=hidden name=id value="{{id}}"> {{/if}} <div class=panel-item> <div> <div class=label> <span>{{i18n \'setting/lbl_filtername\'}}: </span> </div> <div class=items> <div class=rule-item> <input name=name value="{{name}}" class=u-input autocomplete=off> {{#if @create}}<label class=require>{{i18n "pref/junkfilter/name_new_need"}}</label>{{/if}} &nbsp;<label class="tip-error f-dn"></label> </div> </div> </div> <div> <div class=label> <span>{{i18n \'setting/lbl_condition\'}}: </span> </div> <div class=items> {{> conditionOperatorTpl name=\'operator\'}} <div class=j-condition-list> {{#each conditions}}{{{conditionTpl . 0}}}{{/each}} </div> <div class=rule-item> <div class=element style="margin-right: 24px"> <a class="f-csp f-pr j-add-condition">{{i18n \'pref/filter/add_condition\'}}</a> </div> {{#if @advance}} <div class=element> <a class="f-csp f-pr j-add-except-condition">{{i18n \'pref/filter/add_except\'}}</a> </div> {{/if}} </div> </div> </div> <div class="j-block {{if$ exceptConditions.[0] \'\' \'f-dn\'}}"> <div class=label> <span>{{i18n \'setting/lbl_exceptions\'}}: </span> </div> <div class=items> {{> conditionOperatorTpl name=\'exceptOperator\' operator=exceptOperator}} <div class=j-except-condition-list> {{#each exceptConditions}}{{{conditionTpl . 1}}}{{/each}} </div> </div> </div> <div> <div class=label> <span>{{i18n \'setting/lbl_operation\'}}: </span> </div> <div class=items> <div class="rule-item action"> {{#each (seq 0 1)}} <span class="f-ib f-mgr"> <label> <input type=radio name=reject:number value={{.}} {{if$ (if$ @root.reject . (not . )) \'checked\'}}> {{i18n (join \'setting/lbl_\'(if$ . \'reject\' \'rule\'))}} </label> </span> {{/each}} </div> <div class="j-action-list {{if$ reject \'f-dn\'}}"> {{#each actions}}{{{actionTpl .}}}{{/each}} </div> <div class=rule-item> <div class=element style="margin-right: 24px"> <a class="f-csp j-add-action {{if$ reject \'f-dn\'}}"> {{i18n \'pref/filter/add_action\'}} </a> </div> </div> </div> </div> <div> <div class="last items"> <div class=rule-item> <div class="element label label-2"> <label> <input type=checkbox name=continue:boolean value=true data-unchecked-value=false {{if$ continue \'checked\'}}> {{i18n "setting/lbl_filter_continue_desc"}} </label> </div> </div> </div> </div> </div> </form>',itemTpl:'<div class="{{if$ body \'rule-item\'}} j-item"> <input type=hidden name="{{top}}[][{{if$ field \'field\' \'type\'}}]" value={{or field type}}> <input type=hidden name="{{top}}[][original]:object" value="{{json original}}"> {{#if body}} {{#if (ne type \'sms\')}} <div class="element label label-1"><label>{{label .}}</label></div> {{/if}} {{{body}}} {{#if (not (in type \'sms,reply\'))}} <div class=element><i class="iconfont icondelc" data-action=deleteItem></i></div> {{/if}} <div class=element><label class="tip-error f-dn"></label></div> {{/if}} </div>',addressTpl:'<div class="element"> {{u-select (join top "[][operator]") type="op" value=(or operator \'=\')}} </div> <div class="element"> <input type="text" name="{{top}}[][operand]" placeholder=\'{{i18n "setting/lbl_sampleEmail"}}\' value="{{operand}}" autocomplete="off" role="contact" /> </div> <div class="element"> <a class="f-csp contact-btn">{{i18n \'setting/op_addFromContact\'}}</a> </div>',keywordTpl:'<div class=element> {{u-select (join top "[][operator]") type="op" value=operator}} </div> <div class=element> <label> <input name="{{top}}[][operand]" class=u-input placeholder=\'{{i18n "setting/lbl_sampleKeyword"}}\' value="{{operand}}" autocomplete=off data-role=autoTrim> </label> </div> {{#if (or @advance matchFilename)}} <div class=element> <label> <input type=checkbox {{if$ (in field \'subject,text\') \'checked\'}} class=checkbox data-role=subject> {{label \'subject\'}} </label> </div> <div class=element> <label> <input type=checkbox {{if$ (in field \'content,text\') \'checked\'}} class=checkbox data-role=content> {{label \'content\'}} </label> </div> <div class=element> <label> <input type=checkbox {{if$ (or matchFilename (eq field \'attachName\')) \'checked\'}} class=checkbox data-role=attachName> {{label \'attachName\'}} </label> </div> {{/if}}',rangeTpl:'<div class=element> {{#seq (or operand.[0] \'\') 0 (or operand.[1] \'\') as |v i|}} {{#if (eq v 0)}} <span style="margin:0 10px">~</span> {{else ne ../unit null}} <input name="{{../top}}[][operand][]" class="u-input u-short-input" data-role=autoTrim placeholder="{{i18n \'prop:setting/lbl_sampleSize\' 0=(if$ i 400 200)}}" value="{{v}}" autocomplete=off> {{^}} <input name="{{../top}}[][operand][]" class="u-input datepicker" data-role={{if$ i \'end\' \'start\'}} placeholder="{{i18n \'setting/lbl_selectDate\'}}" value="{{v}}" autocomplete=off> {{/if}} {{/seq}} </div> {{#if (ne unit null)}} <div class=element>{{u-select (join top "[][unit]") type=\'unit\' value=unit}}</div> {{/if}}',selectTpl:'{{#if field}} <input type="hidden" name="{{top}}[][operator]" value="="/> {{/if}} <div class="element"> {{#if (ne top \'actions\')}} {{u-select (join top \'[][operand]\') type=field value=operand}} {{else if (or @advance (ne type \'forward\') (ne type type2))}} {{u-select (join top \'[][\' (if$ (eq type \'move\') \'target\' \'type2\') \']\') type=type value=(or type2 target)}} {{/if}} </div> {{{select2 type2 value}}} {{#if (eq type \'forward\')}} <div class="element"> <input type="text" name="{{top}}[][target]" placeholder=\'{{i18n "setting/lbl_sampleEmail"}}\' value="{{target}}" autocomplete="off" role="contact" /> </div> <div class="element"> <a class="f-csp contact-btn">{{i18n \'setting/op_addFromContact\'}}</a> </div> {{/if}}',conditionOperatorTpl:'<div class=rule-item> {{u-select name type=\'or\' value=operator}} </div>',replyTpl:'<div class="element"> <textarea style="width: 458px; height: 82px" name="actions[][content]" class="u-input" autocomplete="off">{{content}}</textarea> </div>',smsTpl:'{{#with (or target @sms.cellNumber)}} <div class="element label label-1"> <label> <input type=checkbox name=actions[][disabled]:boolean {{if$ ../target \'checked\'}} value=false data-unchecked-value=true> <input type=hidden name=actions[][target] value="{{.}}"> {{i18n "setting/lbl_sms"}} </label> </div> {{/with}}',filterMessageTpl:'<div class="panel-content"> <div class="panel-btn"> <div class="u-btns-top"> <button class="u-btn u-btn-default" data-action="backToList">{{i18n "pref/junkfilter/closefilter"}}</button> </div> </div> <div> <div class="title dotted"> <h4>{{i18n "pref/junkfilter/setfilter"}}</h4> <a data-action="editRule" class="f-csp f-fr" style="margin-top: 20px" data-ruleid="{{id}}">{{i18n "pref/junkfilter/updatefilter"}}</a> </div> <div class=ruleSummary>{{>ruleSummaryTpl}}</div> </div> <div> <div class="title dotted"> <h4>{{i18n "pref/junkfilter/filterResult"}}</h4> </div> <div class=panel-message></div> </div> </div> <div class="panel-list panel-body"></div> <div class="panel-page panel-footer"> <div class="pagination"></div> </div>',messageGroupTpl:'{{#each this}} <div class="list-title f-csp j-listtt"> <i class="iconfont iconcollapse"></i> <span class="j-select-group">{{name}} ({{list.length}})</span> </div> <div class="list-body"> <table class="u-table "> <tbody> {{#each list}} <tr class="j-mail"> <td class="from"><span>{{formatfrom}}</span></td> <td class="subject"><span>{{subject}}</span></td> <td class="attach"><span><i class="iconfont {{#if flags.attached}} iconacc{{/if}}"></i></span></td> <td class="time"><span>{{formatReceivedDate}}</span></td> </tr> {{/each}} </tbody> </table> </div> {{/each}}'})},1013:function(e,t,i){(function(e){i(1014),i(532);var t=i(534),n=i(463),a=i(465),s=i(466),l=i(473).h,r=i(475),o=i(483).encode,c=i(472),d=i(470),u=d.alert,p=d.confirm,f=i(487),m=i(476),v=i(471),h=i(467);function b(e,t){t=t||[];for(var i=0,n=(e=e||[]).length,a=!1,s=!1,l=[];;i++){if(i===n){s||l.push({field:'from',operator:'contains',operand:'VIP',forIAddress:!0,disabled:!1,ignoreCase:!1,flagOperatorOr:!0,forAddress:!1,listOfValues:!1}),a||0===t.length||l.push({field:'subject',operator:'contains',operand:t.join(','),listOfValues:!0,ignoreCase:!0,flagOperatorOr:!0,disable:!1});break}'subject'===e[i].field?(0!==t.length&&(e[i].operand=t.join(','),l.push(e[i])),a=!0):'from'===e[i].field&&(l.push(e[i]),s=!0)}return l}var g=c.extend({},(function(i,c){var d=this;d.events={'click [data-operation]':[function(e,t){var i;switch(e){case'collapse':t.find('i').toggleClass('iconcollapse').toggleClass('iconunfold'),(i=t.parents('.grid-row')).next('.grid-row').toggleClass('collapse');break;case'closePanel':A(!0);break;case'addContact':I();break;case'addSubject':D();break;case'removeContact':var n=(i=t.parents('.conditions-block')).find(':hidden');delete w[n.data('addr')],i.remove();break;case'removeSubject':t.parents('.conditions-block').remove();var a=d.$('[name=subjectForm]').serializeJSON()||{};k=a.operand||[]}}],'click [data-action]':[function(t,i){switch(t){case'newContact':A(!1),w={},S(_.newContact()),C(g,!0,!1),o=d.$('#getMatchContacts').contactac({uniqueContacts:!0,select:function(e){o.data('info',{isUser:!0,isOab:e.original.isOab,id:e.original.id,name:e.original.isOab?e.original.name:e.original.FN,addr:e.original.isOab?e.original.email:e.original['EMAIL;PREF']})},width:400,zIndex:1e3});break;case'newSubject':A(!1),k=[],S(_.newSubject()),M(y,!1);break;case'saveContact':!function(){var t='#selectedContactsContainer :hidden';if(!(d.$(t)[0]?F('ignoreEmpty'):F()))return;d.$('#getMatchContacts').val()&&I();var i=function(t){var i=[],a=[],s=[];return e.iter(t,(function(e){n(e).val()?n(e).data('isoab')?a.push(n(e).val()):s.push(n(e).val()):i.push({FN:n(e).data('name'),'EMAIL;PREF':n(e).data('addr'),groups:['VIP']})})),[i,a,s]}(d.$(t)),l=i[0],r=i[1],o=i[2];s.when(f.savePabGroup({func:'edit',gid:'VIP',uidsForPab:o.join(' '),uidsForOab:r.join(' ')}),l.length&&f.createPabContacts(l)).then((function(){A(!0),n.notify(a('setting/msg_addContactSuccessful')),e.isEmpty(v)?(v.conditions=b(),$(v,(function(){A(!0),j()}))):j()}))}();break;case'saveSubject':!function(){var e=d.$('#subjectToAdd'),t=d.$('[name=subjectForm]').serializeJSON();if(e.val()){if(!P())return!1;D(),t=d.$('[name=subjectForm]').serializeJSON()}else if(!t.operand||0===t.operand.length)return e.parent().addClass('errorSub'),!1;v.conditions=b(v.conditions,[].concat(y,t.operand)),T(v,(function(){A(!0),j(),n.notify(a('setting/msg_addSubjectSuccessful'))}))}();break;case'deleteContact':var r=''+i.data('id');p(l(a('setting/msg_confirmContactDel'),i.data('addr')),(function(){var t;t=[r],f.pabGet(t).then((function(t){t.forEach((function(t){delete w[t['EMAIL;PREF']],t.groups=e.difference(t.groups,['VIP'])})),f.updatePabContacts(t).then((function(){n.notify(a('pab/c_todel_success')),j()}))}))}));break;case'deleteSubject':p(l(a('setting/msg_confirmSubjectDel'),i.data('subject')),(function(){!function(e){e.parents('tr').remove();var t=d.$('[name=subjectListForm]').serializeJSON()||{};v.conditions=b(v.conditions,t.operand),T(v,(function(){j(),n.notify(a('setting/msg_subjectDelSuccessful'))}))}(i)}))}var o}],'focus #getMatchContacts':E,'focus #subjectToAdd':function(){d.$('[data-action=saveSubject]').prop('disabled',!1)}};var v={},g=[],y=[],w={},k=[],x=h.getUser().primary_email;function j(){s.when(m.mailRules(),f.pabSearch({returnAttrs:['EMAIL;PREF','FN','id'],groups:['VIP']})).then((function(t,i){v=e.find(t,{name:'##VIP'})||{},g=i,d.$('#contactList tbody').html(g[0]?g.map((function(e){return e.name=e.FN?e.FN:a('setting/msg_null'),e.addr=e['EMAIL;PREF']?e['EMAIL;PREF']:a('setting/msg_null'),e.isUser=!0,e.isOab=!1,_.contactListTpl(e)})):_.emptyContactListTpl());var n=(e.find(v.conditions,{field:'subject'})||0).operand||'';y=n?n.split(','):[],d.$('#subjectList tbody').html(y.length?y.map((function(e){return _.subjectListTpl({val:e})})):_.emptySubjectListTpl())}))}function S(i){t(d.$('#newContactOrSubjectContainer').html(i),{trigger:'a[data-action=addFromContact]',title:a('setting/op_addVIPContact'),selectTitle:a('setting/lbl_vipContact'),init:N,onSelect:function(t){var i=e.remove(t,{addr:x}),n=e.remove(t,(function(e){return w[e.addr]})),s=(i[0]?l(a('setting/msg_isSelfEmailErr'),x):'')+(n[0]?l(a('setting/msg_duplicateEmailErr'),e.map(n,'addr').join()):'');s?u(a('setting/msg_addToListErr')+s,(function(){C(t)})):(E(),C(t))}})}function C(t,i,n){d.$('#selectedContactsContainer')[!1===i?'append':'html'](e.mapFilter(t,(function(t){if(t.isUser&&(w[t.addr]=!0,!1!==n))return _.addContactTpl(e.assign({val:r(t.name,t.addr)},t))})))}function T(t,i){m.mailRuleUpdate(t).then(i).catchCode('FA_ID_NOT_FOUND',e.fn($,t,i))}function $(t,i){m.mailRuleAdd(e.assign(t,{name:'##VIP',actions:[{type:'flags',value:{vip:!0}}]})).then((function(e){m.adjustMailRules({id:e[0],value:-1}),i()}))}function A(e){e?d.$('.main-wrapper').removeClass('toggled'):d.$('.main-wrapper').addClass('toggled')}function I(){var e=d.$('#getMatchContacts'),t=e.val(),i=r.parseAddress(t);if(!F())return!1;w[i]=!0;var n=[],a=e.data('info');a&&a.addr===i?(a.name=a.name||'',n.push(a)):n.push({name:r.parseTrueName(t),addr:i,isOab:!1,isUser:!0}),C(n,!1),e.val('')}function D(){var e=d.$('#subjectToAdd'),t=o(e.val());if(!P())return!1;M([t]),e.val('')}function M(t,i){d.$('#subjectContainer').append(e.mapFilter(t,(function(e){if(e=o(e),k.push(e),!1!==i)return _.addSubjectTpl({value:e})})))}function E(){d.$('[data-action=saveContact]').prop('disabled',!1)}function F(e){var t=d.$('#getMatchContacts'),i=t.val();if(i){var n=r.parseAddress(i);if(!r.test(n))return s(l(a('setting/msg_errformat_error'),i)),!1;if(n===x)return s(l(a('setting/msg_isSelfEmailErr_error'),x)),t.val(''),!1;if(w[n])return s(l(a('setting/msg_exist_error'),n)),t.val(''),!1}else if('ignoreEmpty'!==e)return s(a('setting/msg_emailNullErr')),!1;return t.parent().removeClass('error'),E(),!0;function s(e){t.parent().find('.error-tip').html(e),t.parent().addClass('error')}}function P(){var e=0,t=k.length,i=d.$('#subjectToAdd'),n=i.val();if(i.parent().removeClass('errorSub'),!n)return i.parent().find('.error-tip').html(a('setting/msg_subjNullErr')),i.parent().addClass('errorSub'),!1;for(;e!==t;e++)if(k[e]===n)return i.parent().find('.error-tip').html(l(a('setting/msg_subjectExist_error'),n)),i.parent().addClass('errorSub'),i.val(''),!1;return!0}function N(){return d.$('#selectedContactsContainer :hidden').get().map((function(e){return{id:n(e).val(),name:n(e).data('name'),addr:n(e).data('addr'),isOab:n(e).data('isoab'),isUser:!0}}))}i()(c),j(),d.onMessage('view:refresh',j)})),_=i(1015);v.module({name:'setting.filter.vip',template:_},g)}).call(this,i(464))},1015:function(e,t,i){e.exports=i(469)('<section class="m-vip grid-row"> <div class="main-wrapper"> <div class="content-wrapper"> <div class="m-setting-info"> {{i18n \'setting/lbl_filter_vip_info\'}} </div> <div class="mainContainer" id="mainContainer"> <div class="grid-row lfheader"> <div class="grid-col12"> <div class="u-btns"> <button type="button" class="u-btn u-btn-primary" data-action="newContact">{{i18n "setting/op_addVIPContact"}}</button> </div> <div class="u-btns"> <button type="button" class="u-btn u-btn-primary" data-action="newSubject">{{i18n "setting/op_addVIPSubject"}}</button> </div> </div> </div> <div class="grid-row subContainer u-scroll"> <div class="grid-row tHead"> <table class="u-table u-table-1"> <thead> <tr> <th class="firstTH"><a href="javascript:void(0)" data-operation="collapse"><i class="iconfont iconcollapse"></i></a></th> <th class="nth2TH">{{i18n "setting/lbl_vipContact"}}</th> <th class="nth3TH">{{i18n "setting/lbl_vipEmail"}}</th> <th class="lastTH">{{i18n "setting/lbl_op"}}</th> </tr> </thead> </table> </div> <div class="grid-row tBody"> <table class="u-table u-table-1" id="contactList"> <tbody></tbody> </table> </div> <div class="grid-row tHead"> <table class="u-table"> <thead> <tr> <th class="firstTH"><a href="javascript:void(0)" data-operation="collapse"><i class="iconfont iconcollapse"></i></a></th> <th>{{i18n "setting/lbl_vipSubject"}}</th> <th class="lastTH">{{i18n "setting/lbl_op"}}</th> </tr> </thead> </table> </div> <div class="grid-row"> <form name="subjectListForm" action="#"> <table class="u-table" id="subjectList"> <tbody></tbody> </table> </form> </div> </div> </div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="panel u-scroll" id="newContactOrSubjectContainer"></div> </div> </section>',{newContact:'<form name="contactForm" action="#" onsubmit="return false"> <div class="panel-item panel-item-1"> <div class="btn-group"> <button data-action="saveContact" disabled class="u-btn u-btn-primary" type="button">{{i18n "setting/op_add"}}</button> <button data-operation="closePanel" class="u-btn u-btn-default" type="button">{{i18n "setting/op_cancel"}}</button> </div> </div> <div class="panel-item panel-item-2"> <h4>{{i18n "setting/op_addVIPContact"}}</h4> </div> <div class="panel-item panel-item-3 u-scroll" id="selectedContactsContainer"></div> <div class="panel-item"> <div class="conditions-block"> <div class="label label-1"> <span>{{i18n "setting/lbl_vipContact"}}</span> </div> <div class="conditions conditions-1"> <div class="condition condition-2"> <input type="text" class="u-input u-input-1" name="name" id="getMatchContacts" autocomplete="off"/> <span> <a href="javascript:void(0)" class="f-fr" data-operation="addContact"> <i class="iconadd iconfont"></i> {{i18n "setting/op_new"}} </a> </span> <div class="error-tip">{{i18n "setting/msg_errorEmailFormat"}}</div> <div class="btn-contact"> <a href="javascript:void(0)" data-action="addFromContact">{{i18n "setting/op_addFromContact"}}</a> </div> </div> </div> </div> </div> </form>',newSubject:'<form name="subjectForm" action="#" onsubmit="return false"> <div class="panel-item panel-item-1"> <div class="btn-group"> <button data-action="saveSubject" disabled class="u-btn u-btn-primary" type="button">{{i18n "setting/op_add"}}</button> <button data-operation="closePanel" class="u-btn u-btn-default" type="button">{{i18n "setting/op_cancel"}}</button> </div> </div> <div class="panel-item panel-item-2"> <h4>{{i18n "setting/op_addVIPSubject"}}</h4> </div> <div class="panel-item panel-item-3 u-scroll" id="subjectContainer"></div> <div class="panel-item"> <div class="conditions-block"> <div class="label"> <span>{{i18n "setting/lbl_vipSubject"}}:</span> </div> <div class="conditions"> <div class=""> <input type="text" class="u-input u-input-1" name="name" id="subjectToAdd" autocomplete="off"/> <span> <a href="javascript:void(0)" class="f-fr" data-operation="addSubject"> <i class="iconadd iconfont"></i> {{i18n "setting/op_new"}} </a> </span> <div class="error-tip">{{i18n "setting/msg_subjNullErr"}}</div> </div> </div> </div> </div> </form>',addSubjectTpl:'<div class="conditions-block"> <input type="hidden" name="operand[]" value="{{{value}}}"> <div class="label"> <span class="sequence">{{i18n "setting/lbl_vipSubject"}}</span> </div> <div class="conditions"> <div class="condition condition-1"> <span class="vipSubject">{{{value}}}</span> <a href="javascript:void(0)" data-operation="removeSubject"> <i class="iconremove iconfont"></i> {{i18n "setting/op_remove"}} </a> </div> </div> </div>',addContactTpl:'<div class="conditions-block"> <input type="hidden" value="{{id}}" data-name="{{name}}" data-addr="{{addr}}" data-isoab="{{isOab}}"/> <div class="label label-1"> <span class="sequence">{{i18n "setting/lbl_vipContact"}}</span> </div> <div class="conditions conditions-1"> <div class="condition condition-1"> <span class="vipContact">{{val}}</span> <a href="javascript:void(0)" data-operation="removeContact"> <i class="iconremove iconfont"></i> {{i18n "setting/op_remove"}} </a> </div> </div> </div>',emptyContactListTpl:'<tr> <td colspan="4" style="text-align:left"><span>{{i18n "setting/lbl_noMoreVIPContact"}}</span></td> </tr>',contactListTpl:'<tr> <td class="firstTD"></td> <td class="nth2TD"><span>{{name}}</span></td> <td><span>{{addr}}</span></td> <td class="lastTD"><a href="javascript:void(0)" data-action="deleteContact" data-id="{{id}}" data-addr="{{addr}}"> {{i18n "setting/op_remove"}} </a></td> </tr>',emptySubjectListTpl:'<tr> <td colspan="3" style="text-align:left"><span>{{i18n "setting/lbl_noMoreVIPSubject"}}</span></td> <tr>',subjectListTpl:'<tr> <td class="firstTD"><input type="hidden" name="operand[]" value="{{val}}"></td> <td><span>{{val}}</span></td> <td class="lastTD"><a href="javascript:void(0)" data-action="deleteSubject" data-subject="{{val}}">{{i18n "setting/op_remove"}}</a></td> </tr>'})},1016:function(e,t,i){var n=i(499),a=i(465),s=i(468).get,l=i(508),r=s('user')||{},o=s('setting')||{};n('setting.security',{'default':'junkfilter',className:'m-slsecurity',overrides:{junkfilter:a('pref.junklevel'),junknotify:o.enablejunknotify&&a('pref.junkNotify'),offsiteremind:o.supportoffsiteremindstatus&&a('pref.offSiteRemind'),antivirus:r.supportantivirus,auth2lock:o.enableauth2lock,twofactorauth:a('setting.tab_'+(l.authConfig.AUTH_DEVICE?'trustdevice':'twofactorauth')),logindevices:o.supportauthorizeddevice,smime:r.supportsmime&&r.syssupportsmime}})},1017:function(e,t,i){(function(e){var t=i(463),n=i(472),a=i(471),s=i(480),l=i(470).confirm,r=i(467),o=i(476),c=i(465),d=i(473),u=i(475),p=n.extend({Implements:s,setup:function(){this.state=r.getCurrentState(),this.config=i(549)(),this._params={refuselist:[],safelist:[],userEmails:this.config.allEmails}},render:function(){p.superclass.render.call(this),this._initView(),this._initModuleMessage()},events:{'click [data-action]:not(.disabled)':'_dispatchAction'},_initView:function(){var e,i=this;this.element.mask(),this._clearAllCache(),o.optAttrs('safelist,refuselist').then((function(n){var a=[];n.refuselist&&t.each(n.refuselist.split(/\s?,\s?/),(function(e,t){i._params.refuselist.push(t)})),n.safelist&&t.each(n.safelist.split(/\s?,\s?/),(function(e,t){a.push({key:t}),i._params.safelist.push(t)})),e=i.compile(i.$('#whitelistTpl').html(),{safelist:a}),i.$('.j-whitelist-info').html(e),i.element.mask('hide')}))},_initModuleMessage:function(){var e=this;e.onMessage('list:reload',(function(){e._initView()}),null)},_dispatchAction:function(e,i){switch(t(i).data('action')){case'tableToggle':this._handleToggleTable(t(i));break;case'save':this._handleSaveRules();break;case'remove':this._handleRemoveSingleRule(t(i));break;case'removeAll':this._handleRemoveAllRules()}},_handleToggleTable:function(e){this.$('table').toggle(),e.find('i').toggleClass('iconunfold iconcollapse')},_handleSaveRules:function(){var e,i=this;this.$('.u-list-modify').removeClass('error');var n=this.$('.j-new-rule').val();if(n=n.trim().replace(/\n/g,' ').replace(/ +/g,',')){if(!u.test(n)){if(!/^@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(n))return void this._displayErrorMsg(c('setting/msg_errorEmailFormat'));n='*'+n}for(var a=0;a<this._params.userEmails;a++)if(n===this._params.userEmails[a].addr)return void this._displayErrorMsg(c('setting/msg_errExceptOwnMail'));-1===t.inArray(n,this._params.safelist)&&-1===t.inArray(n,this._params.newlist)?-1===t.inArray(n,this._params.refuselist)?(this.$('.j-new-rule').val(''),this._params.safelist.push(n),e=this._params.safelist.join(','),r.updateUser({safelist:e}).then((function(){t.notify.success(c('setting/msg_rulesSaveSucccess')),i.$('.j-newItems').empty(),i._initView()}))):this._displayErrorMsg(d.h(c('setting/msg_errMailExistInBlackList'),n)):this._displayErrorMsg(d.h(c('setting/msg_errMailExistInCurrentList'),n))}else this._displayErrorMsg(c('setting/msg_inputEmpty'))},_handleRemoveSingleRule:function(i){var n,a=i.data('name'),s=this;l(d.h(c('setting/msg_confirmRemoveListItem'),a),(function(){s._params.safelist=e.difference(s._params.safelist,a),n=s._params.safelist.join(','),r.updateUser({safelist:n}).then((function(){s._initView(),t.notify(c('setting/msg_rulesRemoveSuccess'))}))}))},_handleRemoveAllRules:function(){var e=this;l(c('setting/msg_confirmRemoveAllListItem'),(function(){r.updateUser({safelist:''}).then((function(){e._initView(),t.notify(c('setting/msg_rulesRemoveSuccess'))}))}))},_displayErrorMsg:function(e){this.$('.u-list-modify').find('.u-error-alert').html(e).end().addClass('error')},_clearAllCache:function(){this._params.newlist=[],this._params.refuselist=[],this._params.safelist=[]}});a.module({name:'setting.security.whitelist',template:i(1018)},p)}).call(this,i(464))},1018:function(e,t){e.exports='<section class="m-whitelist grid-row">\r\n  <div class="main-wrapper">\r\n    <div class="content-wrapper">\r\n      <div class="m-setting-info">\r\n        {{i18n "setting/lbl_safalist_desc"}}\r\n      </div>\r\n      \x3c!--显示用户白名单--\x3e\r\n      <div class="j-whitelist-info u-scroll"></div>\r\n    </div>\r\n    \x3c!--[if lt IE 9]>\r\n    <div class="sg-mask"></div>\r\n    <![endif]--\x3e\r\n  </div>\r\n\r\n  {{#raw}}\r\n  \x3c!--白名单列表显示模板--\x3e\r\n  <script type="text/x-handlebars-template" id="whitelistTpl">\r\n    <div class="u-list-modify">\r\n      <div class="u-input-control">\r\n        <span class="u-input-container">\r\n          <input type="text" class="j-new-rule" placeholder="[[i18n \'setting/lbl_addfilteritem\']]">\r\n        </span>\r\n      </div>\r\n      <div class="u-btns-top f-ib">\r\n        <button type="button" class="u-btn u-btn-primary" data-action="save">[[i18n "setting/op_add"]]</button>\r\n        <button type="button" class="u-btn u-btn-default [[#unless safelist.length]]disabled[[/unless]]" data-action="removeAll">[[i18n "setting/lbl_emptysafelist"]]</button>\r\n      </div>\r\n      <div class="u-explain">[[i18n "setting/lbl_filterexample"]]</div>\r\n      <div class="u-error-alert f-dn"></div>\r\n    </div>\r\n\r\n    <div class="list-title f-csp" data-action="tableToggle">\r\n      <i class="iconfont iconcollapse"></i>\r\n      <span>[[i18n "setting/lbl_contact"]]</span>\r\n      <span class="opr">[[i18n "setting/lbl_op"]]</span>\r\n    </div>\r\n\r\n    <table>\r\n      <tbody>\r\n      [[#each safelist]]\r\n      <tr>\r\n        <td>[[key]]</td>\r\n        <td><a href="javascript:void(0);" data-action="remove" data-name="[[key]]" >[[i18n "setting/op_remove"]]</a></td>\r\n      </tr>\r\n      [[/each]]\r\n\r\n      [[#unless safelist.length]]\r\n      <tr class="gray">\r\n        <td>[[i18n "setting/msg_whitelist_empty"]]</td>\r\n        <td></td>\r\n      </tr>\r\n\r\n      [[/unless]]\r\n      </tbody>\r\n    </table>\r\n  <\/script>\r\n  {{/raw}}\r\n</section>\r\n\r\n'},1019:function(e,t,i){(function(e){var t=i(463),n=i(472),a=i(471),s=i(480),l=i(470).confirm,r=i(467),o=i(476),c=i(465),d=i(473),u=i(475),p=n.extend({Implements:s,setup:function(){this.state=r.getCurrentState(),this.config=i(549)(),this._params={refuselist:[],safelist:[],userEmails:this.config.allEmails}},render:function(){p.superclass.render.call(this),this._initView(),this._initModuleMessage()},events:{'click [data-action]:not(.disabled)':'_dispatchAction'},_initView:function(){var e,i=this;this.element.mask(),this._clearAllCache(),o.optAttrs('safelist,refuselist').then((function(n){var a=[];n.refuselist&&t.each(n.refuselist.split(/\s?,\s?/),(function(e,t){a.push({key:t}),i._params.refuselist.push(t)})),n.safelist&&t.each(n.safelist.split(/\s?,\s?/),(function(e,t){i._params.safelist.push(t)})),e=i.compile(i.$('#blacklistTpl').html(),{refuselist:a}),i.$('.j-blacklist-info').html(e),i.element.mask('hide')}))},_initModuleMessage:function(){var e=this;e.onMessage('list:reload',(function(){e._initView()}),null)},_dispatchAction:function(e,i){switch(t(i).data('action')){case'tableToggle':this._handleToggleTable(t(i));break;case'save':this._handleSaveRules();break;case'remove':this._handleRemoveSingleRule(t(i));break;case'removeAll':this._handleRemoveAllRules()}},_handleToggleTable:function(e){this.$('table').toggle(),e.find('i').toggleClass('iconunfold iconcollapse')},_handleSaveRules:function(){var e,i=this;this.$('.u-list-modify').removeClass('error');var n=this.$('.j-new-rule').val();if(n=n.trim().replace(/\n/g,' ').replace(/ +/g,',')){if(!u.test(n)){if(!/^@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(n))return void this._displayErrorMsg(c('setting/msg_errorEmailFormat'));n='*'+n}for(var a=0;a<this._params.userEmails;a++)if(n==this._params.userEmails[a].addr)return void this._displayErrorMsg(c('setting/msg_errExceptOwnMail'));-1===t.inArray(n,this._params.refuselist)&&-1===t.inArray(n,this._params.newlist)?-1===t.inArray(n,this._params.safelist)?(this._params.refuselist.push(n),e=this._params.refuselist.join(','),r.updateUser({refuselist:e}).then((function(){t.notify.success(c('setting/msg_rulesSaveSucccess')),i._initView()}))):this._displayErrorMsg(d.h(c('setting/msg_errMailExistInWhiteList'),n)):this._displayErrorMsg(d.h(c('setting/msg_errMailExistInCurrentList'),n))}else this._displayErrorMsg(c('setting/msg_inputEmpty'))},_handleRemoveSingleRule:function(i){var n,a=i.data('name'),s=this;l(d.h(c('setting/msg_confirmRemoveListItem'),a),(function(){s._params.refuselist=e.difference(s._params.refuselist,a),n=s._params.refuselist.join(','),r.updateUser({refuselist:n}).then((function(){s._initView(),t.notify(c('setting/msg_rulesRemoveSuccess'))}))}))},_handleRemoveAllRules:function(){var e=this;l(c('setting/msg_confirmRemoveAllListItem'),(function(){r.updateUser({refuselist:''}).then((function(){e._initView(),t.notify(c('setting/msg_rulesRemoveSuccess'))}))}))},_displayErrorMsg:function(e){this.$('.u-list-modify').find('.u-error-alert').html(e).end().addClass('error')},_clearAllCache:function(){this._params.newlist=[],this._params.refuselist=[],this._params.safelist=[]}});a.module({name:'setting.security.blacklist',template:i(1020)},p)}).call(this,i(464))},1020:function(e,t){e.exports='<section class="m-blacklist grid-row">\r\n  <div class="main-wrapper">\r\n    <div class="content-wrapper">\r\n      <div class="m-setting-info">\r\n        {{i18n "setting/lbl_refuselist_desc"}}\r\n      </div>\r\n      \x3c!--显示用户黑名单--\x3e\r\n      <div class="j-blacklist-info u-scroll"></div>\r\n    </div>\r\n    \x3c!--[if lt IE 9]>\r\n    <div class="sg-mask" />\r\n    <![endif]--\x3e\r\n  </div>\r\n  {{#raw}}\r\n  \x3c!--黑名单列表显示模板--\x3e\r\n  <script type="text/x-handlebars-template" id="blacklistTpl">\r\n    <div class="u-list-modify">\r\n      <div class="u-input-control">\r\n        <span class="u-input-container">\r\n          <input type="text" class="j-new-rule" placeholder="[[i18n \'setting/lbl_addfilteritem\']]">\r\n        </span>\r\n      </div>\r\n      <div class="u-btns-top f-ib">\r\n        <button type="button" class="u-btn u-btn-primary" data-action="save">[[i18n "setting/op_add"]]</button>\r\n        <button type="button" class="u-btn u-btn-default [[#unless refuselist.length]]disabled[[/unless]]" data-action="removeAll">\r\n          [[i18n "setting/lbl_emptyrefuselist"]]\r\n        </button>\r\n      </div>\r\n      <div class="u-explain">[[i18n "setting/lbl_filterexample"]]</div>\r\n      <div class="u-error-alert f-dn"></div>\r\n    </div>\r\n\r\n    <div class="list-title f-csp" data-action="tableToggle">\r\n      <i class="iconfont iconcollapse"></i>\r\n      <span >{{i18n "setting/lbl_contact"}}</span>\r\n      <span class="opr">{{i18n "setting/lbl_op"}}</span>\r\n    </div>\r\n\r\n    <table>\r\n      <tbody>\r\n      [[#each refuselist]]\r\n      <tr>\r\n        <td>[[key]]</td>\r\n        <td><a href="javascript:void(0);" data-action="remove" data-name="[[key]]" >[[i18n "setting/op_remove"]]</a></td>\r\n      </tr>\r\n      [[/each]]\r\n\r\n      [[#unless refuselist.length]]\r\n      <tr class="gray">\r\n        <td>[[i18n "setting/msg_blacklist_empty"]]</td>\r\n        <td></td>\r\n      </tr>\r\n      [[/unless]]\r\n      </tbody>\r\n    </table>\r\n  <\/script>\r\n  {{/raw}}\r\n</section>\r\n\r\n'},1021:function(e,t,i){(function(e){i(1022);var t=i(463),n=i(472),a=i(471),s=i(480),l=i(467),r=i(476),o=i(465),c={},d=n.extend({Implements:s,events:{'click label.j-av-active':'_handleAntiToggle','click #saveAntivirus':'_handleSaveAntiVirus','click #resetAntivirus':'_genernateView','click label':'_checkUserEdit'},render:function(){d.superclass.render.call(this),this._initView(!0)},_initView:function(t){var i=this;t?(i.element.mask(),r.getAVInfo().then((function(t){c=e.assign({},t,{virusFolderName:l.getConfig('setting.virusfoldername')}),i._genernateView()})).either((function(){i.element.mask('hide')}))):i._genernateView()},_genernateView:function(){var e=this.compile(this.$('#avInfoTpl').html(),c);this.$('form[name=\'antivirus\']').html(e).data('change',!1),c.active||this.$('input').not('input[name=\'active\']').attr('disabled',!0),this.element.customRadioCheckbox()},_checkUserEdit:function(e){var i=t(e.target).parents('form');i.data('change')||(i.find('#saveAntivirus').prop('disabled',!1),i.data('change',!0))},_handleAntiToggle:function(e,i){'true'===t(i).find('input').val()?(this.$('.j-virus-process input').attr('disabled',!1),this.$('.j-virus-process i').removeClass('rc-disabled'),this.$('.disable-mask').hide()):(this.$('.j-virus-process input').attr('disabled',!0),this.$('.j-virus-process i').addClass('rc-disabled'),this.$('.disable-mask').show())},_handleSaveAntiVirus:function(){var e=this.$('form[name=\'antivirus\']').serializeJSON({defaultType:'+B',checkboxUncheckedValue:!1});r.saveAVInfo(e).then((function(){Object.assign(c,e),t.notify.success(o('pref/antivirus/successMod'))}))}});a.module({name:'setting.security.antivirus',template:i(1023)},d)}).call(this,i(464))},1023:function(e,t){e.exports='<section class="m-antivirus content-wrapper">\r\n\r\n  <form action="#" name="antivirus"></form>\r\n\r\n  <script type="text/x-handlebars-template" id="avInfoTpl">\r\n      {{#raw}}\r\n      <div class="u-btns-top">\r\n          <button type="button"  class="u-btn u-btn-primary" id="saveAntivirus" disabled>[[i18n "setting/op_save"]]</button>\r\n          <button type="reset" class="u-btn u-btn-default"  id="resetAntivirus" >[[i18n "setting/op_cancel"]]</button>\r\n      </div>\r\n\r\n      <div class="title dotted">\r\n          <h4>[[i18n "pref/antivirus/mothod"]]</h4>\r\n      </div>\r\n      <div class="f-pdl">\r\n          <p class="items">\r\n              <label for="active_1" class="j-av-active">\r\n                <input type="radio" id="active_1" name="active" value="true" [[#if active ]] checked [[/if]] />\r\n                [[i18n "pref/antivirus/scan"]]\r\n              </label>\r\n          </p>\r\n          <p class="items">\r\n              <label for="active_0" class="j-av-active">\r\n                <input type="radio" id="active_0" name="active" value="false" [[#unless active ]] checked [[/unless]] />\r\n                [[i18n "pref/antivirus/discard"]]\r\n              </label>\r\n          </p>\r\n      </div>\r\n      \x3c!--遮罩层--\x3e\r\n      <div class="disable-mask [[#if active]] f-dn [[/if]]"></div>\r\n\r\n      <div class="j-virus-process">\r\n          <div class="title dotted">\r\n              <h4>[[i18n "pref/antivirus/action"]]</h4>\r\n          </div>\r\n          <div class="f-pdl">\r\n              <h4 class="sub-title">[[i18n "pref/antivirus/whenkillok"]]</h4>\r\n              <div class="f-pdl">\r\n                  <p class="items">\r\n                      <label >\r\n                          <input type="radio" name="strategy[succeed]" value="clean" [[#compare strategy.succeed \'==\' \'clean\']] checked [[/compare]]> &nbsp;[[[i18n "prop:pref/antivirus/killandmark" 0="<span class=\'state-icon icon-avsCLEANED\'></span>"]]]\r\n                      </label>\r\n                  </p>\r\n                  <p class="items">\r\n                      <label>\r\n                          <input type="radio" name="strategy[succeed]" value="quarantine" [[#compare strategy.succeed \'==\' \'quarantine\']] checked[[/compare]]>&nbsp; [[i18n "prop:pref/antivirus/move" 0=virusFolderName]]\r\n                      </label>\r\n                  </p>\r\n                  <p class="items">\r\n                      <label>\r\n                          <input type="radio" name="strategy[succeed]" value="delete" [[#compare strategy.succeed \'==\' \'delete\']] checked [[/compare]]>&nbsp; [[i18n "pref/antivirus/drop"]]\r\n                      </label>\r\n                  </p>\r\n              </div>\r\n\r\n              <h4 class="sub-title">[[i18n "pref/antivirus/whenkillfail"]]</h4>\r\n              <div class="f-pdl">\r\n                  <p class="items">\r\n                      <label>\r\n                          <input type="radio" name="strategy[failed]" value="clean" [[#compare strategy.failed \'==\' \'clean\']]checked[[/compare]]> &nbsp;[[[i18n "prop:pref/antivirus/attandmark" 0="<span class=\'state-icon icon-avsINFECTED\'></span>"]]]\r\n                      </label>\r\n                  </p>\r\n                  <p class="items">\r\n                      <label>\r\n                          <input type="radio" name="strategy[failed]" value="quarantine" [[#compare strategy.failed \'==\' \'quarantine\']]checked[[/compare]]> &nbsp;[[i18n "prop:pref/antivirus/move" 0=virusFolderName]]\r\n                      </label>\r\n                  </p>\r\n                  <p class="items">\r\n                      <label>\r\n                          <input type="radio" name="strategy[failed]" value="delete" [[#compare strategy.failed \'==\' \'delete\']]checked[[/compare]]>&nbsp;[[i18n "pref/antivirus/drop"]]\r\n                      </label>\r\n                  </p>\r\n              </div>\r\n\r\n               <h4 class="sub-title">[[i18n "pref/antivirus/whennotsure"]]</h4>\r\n               <div class="f-pdl">\r\n                   <p class="items">\r\n                       <label>\r\n                           <input type="radio" name="strategy[undetermined]" value="clean" [[#compare strategy.undetermined \'==\' \'clean\']]checked[[/compare]]> &nbsp;[[[i18n "prop:pref/antivirus/marknotsure" 0="<span class=\'state-icon icon-avsUNDETERMINED\'></span>"]]]\r\n                       </label>\r\n                   </p>\r\n                  <p class="items">\r\n                    <label>\r\n                      <input type="radio" name="strategy[undetermined]" value="quarantine" [[#compare strategy.undetermined \'==\' \'quarantine\']]checked[[/compare]]>&nbsp;[[i18n "prop:pref/antivirus/move" 0=virusFolderName]]\r\n                    </label>\r\n                  </p>\r\n                  <p class="items">\r\n                    <label>\r\n                      <input type="radio" name="strategy[undetermined]" value="delete" [[#compare strategy.undetermined \'==\' \'delete\']]checked[[/compare]]>&nbsp;[[i18n "pref/antivirus/drop"]]\r\n                    </label>\r\n                  </p>\r\n               </div>\r\n          </div>\r\n\r\n          <div class="title dotted">\r\n               <h4>[[i18n "pref/antivirus/notifyme"]]</h4>\r\n          </div>\r\n          <div class="f-pdl">\r\n              <p class="items">\r\n                  <label>\r\n                    <input type="checkbox" name="notifyUser" id="notifyUser" value="true" [[#compare notifyUser \'==\' true]]checked[[/compare]]> &nbsp;[[i18n "pref/antivirus/notifyme_y"]]([[i18n "pref/antivirus/notifyme_tips"]])\r\n                  </label>\r\n              </p>\r\n          </div>\r\n\r\n          <div class="title dotted">\r\n               <h4>[[i18n "pref/antivirus/notifysender"]]</h4>\r\n          </div>\r\n          <div class="f-pdl">\r\n              <p class="items">\r\n                <label>\r\n                  <input type="checkbox" name="notifySender" id="notifySender" value="true" [[#compare notifySender \'==\' true]]checked[[/compare]]>&nbsp; [[i18n "pref/antivirus/notifysender_y"]] ([[i18n "pref/antivirus/notifysender_tips"]] )\r\n                </label>\r\n              </p>\r\n          </div>\r\n      </div>\r\n    {{/raw}}\r\n  <\/script>\r\n</section>\r\n'},1024:function(e,t,i){i(1025);var n=i(463),a=i(476),s=i(472),l=i(471),r=i(480),o=i(465),c=s.extend({Implements:r,setup:function(){this.cache={}},render:function(){c.superclass.render.call(this),this._initView()},events:{'click [data-action]':'_dispatchAction','click label':'_checkUserEdit'},_initView:function(){var e=this;a.getJunkFilterInfo().then((function(t){e.cache.filterSet=t,e._generateView()}))},_dispatchAction:function(e,t){var i=n(t).data('action');switch(i){case'enable':case'disable':('enable'===i?u:p)(this.$('input[name=rejectjunk]'));break;case'save':this._handleSaveFilterSet();break;case'cancel':this._generateView()}},_checkUserEdit:function(e){var t,i=n(e.target);if('I'==i.prop('tagName')&&i.hasClass('rc-disabled')||i.find('i').hasClass('rc-disabled'))return!1;(t=i.parents('form')).data('change')||(t.find('button[data-action]').prop('disabled',!1),t.data('change',!0))},_generateView:function(){var e=this.$('#junkFilterTpl').html(),t=this.compile(e,this.cache.filterSet);this.$('.j-filter-set').html(t),('2'!=this.cache.filterSet.junkfilter?p:u)(this.$('input[name=rejectjunk]')),this.element.customRadioCheckbox()},_handleSaveFilterSet:function(){var e=this.$('form[name=\'junkfilter\']').serializeJSON(),t=this;a.setJunkFilterInfo(e).then((function(){n.extend(t.cache.filterSet,e),n.notify.success(o('setting/msg_junkFilterSetSuccess'))}))}}),d=i(489),u=d.rcEnable,p=d.rcOff;l.module({name:'setting.security.junkfilter',template:i(1026)},c)},1026:function(e,t){e.exports='<section class="m-junkfilter content-wrapper">\r\n\r\n  <div class="j-filter-set"></div>\r\n\r\n  <script type="text/x-handlebars-template" id="junkFilterTpl">\r\n    {{#raw}}\r\n    <form action="" name="junkfilter">\r\n\r\n    <div class="u-btns-top">\r\n      <button type="button" class="u-btn u-btn-primary" data-action="save" disabled>[[i18n "setting/op_save"]]</button>\r\n      <button type="reset"  class="u-btn u-btn-default"  data-action="cancel">[[i18n "setting/op_cancel"]]</button>\r\n    </div>\r\n\r\n    <div class="title dotted">\r\n      <h4>[[i18n "setting/lbl_junkFilter"]]</h4>\r\n    </div>\r\n\r\n    <div class="wrapper">\r\n      <div class="item-block">\r\n        <label for="junkfilter_0">\r\n          <input type="radio"  name="junkfilter" id="junkfilter_0" value="0" data-action="disable" [[#compare junkfilter \'==\' "0"]]checked[[/compare]] /> &nbsp;[[i18n "pref/junkfilter/method0_1"]]\r\n        </label>\r\n        <span>[[i18n "pref/junkfilter/method0"]]</span>\r\n      </div>\r\n\r\n      <div class="item-block">\r\n        <label for="junkfilter_1">\r\n          <input type="radio"  name="junkfilter" id="junkfilter_1" value="1" data-action="disable" [[#compare junkfilter \'==\' "1"]]checked[[/compare]]/>&nbsp;[[i18n "pref/junkfilter/method1_1"]]\r\n        </label>\r\n        <span>[[[i18n "pref/junkfilter/method1"]]]</span>\r\n      </div>\r\n\r\n      <div class="item-block">\r\n        <label for="junkfilter_2">\r\n          <input type="radio" name="junkfilter" id="junkfilter_2" value="2" data-action="enable" [[#compare junkfilter \'==\' "2"]]checked[[/compare]] />&nbsp;[[i18n "pref/junkfilter/method2_1"]]\r\n        </label>\r\n        <span class="f-ib">[[i18n "pref/junkfilter/method2"]]</span>\r\n        <span class="item-notice">[[i18n "pref/junkfilter/notice"]]</span>\r\n      </div>\r\n      <div class="sub-choice">\r\n        <p>\r\n          <label for="rejectjunk_1">\r\n            <input type="radio" name="rejectjunk" id="rejectjunk_1" value="1"  [[#compare rejectjunk \'==\' "1"]]checked[[/compare]]/> &nbsp;[[[i18n "pref/junkfilter/move"]]]\r\n          </label>\r\n        </p>\r\n        <p>\r\n          <label for="rejectjunk_0">\r\n            <input type="radio" name="rejectjunk" id="rejectjunk_0" value="0"  [[#compare rejectjunk \'==\' "0"]]checked[[/compare]]/> &nbsp;[[i18n "pref/junkfilter/reject"]]\r\n          </label>\r\n        </p>\r\n      </div>\r\n    </div>\r\n\r\n    </form>\r\n    {{/raw}}\r\n\r\n  <\/script>\r\n</section>\r\n'},1027:function(e,t,i){(function(e,t,n){i(1028);var a=i(489),s=a['default'],l=a.rcCheck,r=i(472),o=i(471),c=i(465),d=i(470).alert,u=i(476),p=i(467),f=p.getUser,m=p.putUser,v=i(474),h=r.extend({},(function(){var i=this,a={};function r(){i.$().mask(),i.pubsub.off(),v.flush().then((function(){i.subscribe('mail','fdr:changed',(function(){r(),i.$('.main-wrapper').removeClass(g)})),u.optAttrs('def_sec_folder').then((function(n){m(n);var l=!!n.def_sec_folder,r=f().sec_nf;u.chosenFoldersData(l?f().sec_folder:[],r).then((function(n){a=n,e.extend(a,function(){var t=f().sec_op,i='',n=[];t.length>0&&(e.each(t,(function(e,t){i+=c('setting/lbl_authLockOp'+t)+','})),i=i.substring(0,i.length-1));for(var a=0;a<3;a++)n[a]={val:a+1,lbl:c('setting/lbl_authLockOp'+(a+1))},~e.inArray(n[a].val.toString(),t)?n[a].selected=!0:n[a].selected=!1;return{lockOpName:i,lockOpInfo:n}}(),{auth2LockDefined:l}),i.$('.auth2lock-content').html(b.lockInfoTpl(a)),i.$('.panel-wrapper').html(b.panelTpl(t.assign({},a,{nfSelected:r}))),s(i.$())}))})).either((function(){i.element.mask('hide')}))}))}function o(){var e=i.$('.j-disable-lock-input');p('user:closeAuth2Lock',i.$('form[name=closeLock]').serializeJSON(),e,(function(){m({def_sec_folder:''}),r(),_(e),i.$('.main-wrapper').removeClass(g)}))}function p(t,i,a,s){function l(){a.parents('.u-form-item').removeClass('verify').addClass('error')}!a[0]||a.val()?n.wmCall({url:'XT5/jsp/setting.jsp',func:t},e.param(i)).then((function(){a.parents('.u-form-item').removeClass('error').addClass('verify'),a.parents('form').find('.j-btn-error').removeAttr('disabled'),s()})).catchCode('FA_UNAUTHORIZED',l):l()}i.events={'click [data-action]':[{editLock:function(){i.$('.main-wrapper').removeClass(g).addClass('switched-edit')},editRange:function(){i.$('.parent-node:visible').each((function(t,i){var n=e(i).find('input:checked').length,a=e(i).find('input').length;a&&n==a&&e(i).prev().find('input').prop('checked',!0)})),s(i.$()),i.$('.main-wrapper').removeClass(g).addClass('switched-range')},cancel:function(e){l(i.$('.j-lock-toggle'),a.auth2LockDefined),_(e),i.$('.main-wrapper').removeClass(g)},disableLock:o,changeLockPwd:function(t){var n=t.closest('form').find('input[name=old_password]'),a=i.$('form[name="changeLockPwd"]').serializeJSON();if(!a.password||!a.repass)return d(c('setting/msg_inputEmpty'));if(a.password!==a.repass)return d(c('setting/msg_authPwdNotSame'));p('user:changeLockPwd',a,n,(function(){i.$('.main-wrapper').removeClass(g),_(n),e.notify.success(c('setting/msg_AuthLockPwdChangeSuccess'))}))},lockEnable:function(){var t=i.$('form[name="lockEnable"]').serializeJSON();if(!t.password)return d(c('setting/msg_easMissPass'));if(!t.repass)return d(c('setting/msg_easMissRepass'));if(t.password!==t.repass)return d(c('setting/msg_authPwdNotSame'));if(!t.lockItem1&&!t.lockItem2&&!t.lockItem3)return d(c('setting/msg_authLockRangeEmpty'));t.lockItem1&&(t.lockItem1=t.lockItem1.join(' '));t.lockItem2&&(t.lockItem2=t.lockItem2.join(' '));t.lockItem3&&(t.lockItem3=t.lockItem3.join(' '));h(t,e(),(function(){r(),e.notify.success(c('setting/msg_authLockRangeUpdateSuccess')),i.$('.main-wrapper').removeClass(g)}))},updateRange:function(t){var n=t.closest('form').find('input[name=current_password]'),a=i.$('form[name=lockRange]').serializeJSON();if(!a.lockItem1&&!a.lockItem2&&!a.lockItem3)return d(c('setting/msg_chose_range'));a.lockItem1&&(a.lockItem1=a.lockItem1.join(' '));a.lockItem2&&(a.lockItem2=a.lockItem2.join(' '));a.lockItem3&&(a.lockItem3=a.lockItem3.join(' '));h(a,n,(function(){e.notify.success(c('setting/msg_authLockRangeUpdateSuccess')),_(n),r(),i.$('.main-wrapper').removeClass(g)}))}},e],'click .j-check-all+i':[function(e){l(e.parent().next().find('li input'),e.hasClass('checkbox-checked'))},e],'click .j-check-sub+i':[function(e){var t=e.closest('.parent-node');l(t.prev().find(':checkbox'),!t.has(':checkbox:not(:checked)')[0])},e],'change.crc .j-lock-toggle':function(){a.auth2LockDefined?i.$('.main-wrapper').removeClass(g).addClass('switched-off'):(i.$('form[name="lockEnable"]')[0].reset(),s(i.$()),i.$('.main-wrapper').removeClass(g).addClass('switched-on'))},'click .j-lock-item':[function(e){e.siblings('.checkbox').click()},e],'keypress .j-disable-lock-input':function(e){13===e.which&&(t.stop(e,0),o())},'blur input[name=repass]':[function(e){e.closest('.u-form-item').toggleClass('error',e.val()!==e.closest('form').find('input[name=password]').val())},e]},i.after('render',r);var h=t.fn(p,'user:changeAuth2Lock');function _(e){var t=e.closest('form');t[0].reset(),t.find('.u-form-item').removeClass('error verify')}})),b=i(1029);function g(e,t){return(t.match(/\bswitched\S+/g)||[]).join(' ')}o.module({name:'setting.security.auth2lock',template:b},h)}).call(this,i(463),i(464),i(466))},1029:function(e,t,i){e.exports=i(469)('<section class="m-auth2lock"> <div class="main-wrapper"> <div class="content-wrapper"> <div class="m-setting-info"> {{i18n "setting/lbl_authLock_desc"}} </div> <div class="auth2lock-content"></div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="panel-wrapper"></div> </div> </section>',{panelTpl:'<div class="panel u-scroll edit-panel"> <form action="#" name="changeLockPwd" method="post"> <div class="u-btns-top"> <button type="button" data-action="changeLockPwd" class="u-btn u-btn-primary j-btn-error">{{i18n "setting/op_confirm"}}</button> <button type="reset" data-action="cancel" class="u-btn u-btn-default">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "pref/personal/auth2password"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_curPassword"}}</label> </div> <div class="u-form-value"> <input type="password" name="old_password" class="u-input f-mgr"> <span class="notify f-dn f-mgr">{{i18n "pref/personal/FA_PASSWORD_ERR"}}</span> <i class="iconfont iconchoose f-dn"></i> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_newPassword"}}</label> </div> <div class="u-form-value"> <input type="password" name="password" class="u-input" value=""> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_confirmPassword"}}</label> </div> <div class="u-form-value"> <input type="password" name="repass" class="u-input" value=""> <span class="notify f-dn">{{i18n "setting/msg_authPwdNotSame"}}</span> </div> </div> </form> </div> <div class="panel u-scroll range-panel"> <form action="#" name="lockRange" method="post"> <div class="u-btns-top"> <button type="button" data-action="updateRange" class="u-btn u-btn-primary j-btn-error">{{i18n "setting/op_confirm"}}</button> <button type="reset" data-action="cancel" class="u-btn u-btn-default">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "setting/lbl_authLockRangeEdit"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "pref/personal/auth2password"}}&nbsp;:</label> </div> <div class="u-form-value"> <input type="password" name="current_password" class="u-input f-mgr"> <i class="iconfont iconchoose f-dn" ></i> <span class="notify f-dn">{{i18n "pref/personal/FA_PASSWORD_ERR"}}</span> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr"><i class="u-img icon-lock-type icon-tools"></i>{{i18n "setting/lbl_authLockOperations"}}&nbsp;:</label> </div> <div class="u-form-value j-protect-operations">{{> opsTreeTpl}}</div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr"><i class="u-img icon-lock-type icon-folder"></i>{{i18n "setting/lbl_authLockRange"}}&nbsp;:</label> </div> <div class="u-form-value j-folder-tree">{{> folderTreeTpl}}</div> </div> </form> </div> <div class="panel u-scroll off-panel"> <form action="#" name="closeLock" method="post"> <div class="u-btns-top"> <button type="button" data-action="disableLock" class="u-btn u-btn-primary">{{i18n "setting/op_confirm"}}</button> <button type="reset" data-action="cancel" class="u-btn u-btn-default j-lock-reset">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "pref/personal/close_lock"}}</h4> <p class="u-lbl-disable-lock-tip">{{i18n "setting/lbl_disableLock_desc"}}</p> <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "pref/personal/auth2password"}}&nbsp;:</label> <input type="password" class="u-input f-mgr j-disable-lock-input" name="current_password" /> <span class="notify f-dn f-mgr">{{i18n "pref/personal/FA_PASSWORD_ERR"}}</span> <i class="iconfont iconchoose f-dn"></i> </div> </form> </div> <div class="panel u-scroll on-panel"> <form action="#" name="lockEnable" method="post"> <div class="u-btns-top"> <button type="button" data-action="lockEnable" class="u-btn u-btn-primary">{{i18n "setting/op_confirm"}}</button> <button type="reset" data-action="cancel" class="u-btn u-btn-default j-lock-reset" >{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "setting/lbl_authLock"}}</h4> <p class="u-lock-enable-tip">{{i18n "setting/lbl_authLock_enable_tip"}}</p> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "pref/personal/auth2password"}}&nbsp;:</label> </div> <div class="u-form-value"> <input type="password" name="password" class="u-input f-mgr"> <i class="iconfont iconchoose f-dn">{{i18n "pref/personal/auth2password"}}</i> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "pref/personal/set_pwd_again"}}&nbsp;:</label> </div> <div class="u-form-value"> <input type="password" name="repass" class="u-input f-mgr"> <span class="notify f-dn">{{i18n "setting/msg_authPwdNotSame"}}</span> </div> </div> <h4 class="sub-header">{{i18n "setting/lbl_authLockRangeEdit"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr"><i class="u-img icon-lock-type icon-tools"></i>{{i18n "setting/lbl_authLockOperations"}}&nbsp;:</label> </div> <div class="u-form-value j-protect-operations">{{> opsTreeTpl}}</div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr"><i class="u-img icon-lock-type icon-folder"></i>{{i18n "setting/lbl_authLockRange"}}&nbsp;:</label> </div> <div class="u-form-value j-folder-tree">{{> folderTreeTpl}}</div> </div> </form> </div>',opsTreeTpl:'<ul class="f-fl tree"> {{#each lockOpInfo}} <li> <input type="checkbox" name="lockItem3[]" {{#if selected}} checked {{/if}} value=\'{{val}}\'/> <div class="j-lock-item f-ib f-csp">{{lbl}}</div> </li> {{/each}} </ul>',folderTreeTpl:'<ul class="tree f-fl"> <li> <input type="checkbox" id="chkAllSyFolders" class="j-check-all"/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{i18n "pref/personal/sysfolder"}}</div> </li> <li class="parent-node"> <ul> {{#each sysFolders}} <li> <input type="checkbox" name="lockItem1[]" class="j-check-sub {{#if children}} j-check-all {{/if}}" {{#if selected}} checked {{/if}} value=\'{{id}}\'/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{name}}</div> </li> {{#if children}} <ul> {{#each children}} <li> <input type="checkbox" name="lockItem2[]" class="j-check-sub" {{#if selected}} checked{{/if}} value=\'{{id}}\'/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{name}}</div> </li> {{/each}} </ul> {{/if}} {{/each}} </ul> </li> {{#if @config.file.ispermitnf}} <li> <input type="checkbox" name="lockItem1[]" value="nf:{{@config.file.nfrootid}}" {{if$ nfSelected \'checked\'}}> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{i18n "pref/personal/netfolder"}}</div> </li> {{/if}} <li> {{#compare otherFolders.length "==" 0}} <input type="checkbox" id="chkallUserFolders" class="j-check-all" disabled/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{i18n "setting/lbl_user_folder"}}{{i18n "setting/lbl_lack"}}</div> {{else}} <input type="checkbox" id="chkallUserFolders" class="j-check-all"/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{i18n "setting/lbl_user_folder"}}</div> {{/compare}} </li> <li class="parent-node"> <ul> {{#each otherFolders}} <li> <input type="checkbox" name="lockItem1[]" class="j-check-sub {{#if children}} j-check-all {{/if}}" {{#if selected}} checked {{/if}} value=\'{{id}}\'/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{name}}</div> </li> {{#if children}} <ul> {{#each children}} <li> <input type="checkbox" name="lockItem2[]" class="j-check-sub" {{#if selected}} checked {{/if}} value=\'{{id}}\'/> <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>{{name}}</div> </li> {{/each}} </ul> {{/if}} {{/each}} </ul> </li> </ul>',lockInfoTpl:'<div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_authLock"}}&nbsp;:</label> <span class="f-ib"> <input type="checkbox" name="lock" role="switchBtn" class="checkbox j-lock-toggle" data-action="lockToggle" {{#if auth2LockDefined}}checked{{/if}}/> </span> </div> <div class="u-form-item {{#unless auth2LockDefined}}u-lock-disabled{{/unless}}"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_auth2password"}}&nbsp;:</label> {{#if auth2LockDefined}} <a class="j-update-lockpwd" href="javascript:void(0)" data-action="editLock">{{i18n "setting/op_update_pwd"}}</a> {{else}} <span>{{i18n "setting/lbl_authLockPwdNotSet"}}</span> {{/if}} </div> <div class="u-form-item {{#unless auth2LockDefined}}u-lock-disabled{{/unless}}"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_authLockRangeTitle"}}&nbsp;:</label> {{#if auth2LockDefined}} <ul class="u-lockfolder-desc"> {{#compare lockOpName "!==" ""}} <li class="u-lock-operations"><i class="u-img icon-lock-type icon-tools"></i><span>{{lockOpName}} </span></li> {{/compare}} <li class="u-lock-range"><i class="u-img icon-lock-type icon-folder"></i><span>{{chosenFoldersName}} </span></li> <a href="javascript:void(0)" data-action="editRange">{{i18n "setting/op_update"}}</a> </ul> {{else}} <span>{{i18n "setting/lbl_authLockRangeNull"}}</span> {{/if}} </div> <div class="u-tips"> <h4>{{i18n "pref/personal/tips"}}&nbsp;:</h4> <p>{{i18n "pref.personal/lock_tip_1"}}</p> </div>'})},1030:function(e,t,i){i(1031);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(465),o=i(1032),c=a.extend({Implements:l,templateHelpers:{formatResource:function(){var e=arguments[0]||'';if(e.length>0)for(var t=1;t<arguments.length-1;t++)e=e.replace(new RegExp('\\{'+(t-1)+'\\}'),arguments[t]);return r(e)}},setup:function(){this.showData={notifyIntervals:[3,7,14,0]},this.cache={}},render:function(){c.superclass.render.call(this),this._initView()},events:{'click [data-action]':'_dispatchAction','click label':'_checkUserEdit'},_initView:function(){var e=this;o.getJunkNotifyInfo().then((function(t){var i=e.showData;i.userNotifyInterval=t.junkNotify>0?+t.notifyInterval:0,e.cache.data=i,e._generateView()}))},_dispatchAction:function(e,t){var i=this;switch(n(t).data('action')){case'cancel':i._generateView();break;case'save':var a=i.$('form[name=\'junknotify\']').serializeJSON({defaultType:'+I'});n.when(o.setJunkNotifyInfo(a.notifyInterval)).then((function(){var e=i.showData;e.userNotifyInterval=a.notifyInterval,i.cache.data=e,n.notify(r('setting/msg_junkNotifySetSuccess'))}))}},_checkUserEdit:function(e){var t=n(e.target).parents('form');t.data('change')||(t.find('button[data-action]').prop('disabled',!1),t.data('change',!0))},_generateView:function(){var e=this.compile(this.$('#junkNotifyTpl').html(),this.cache.data);this.$('.j-notify-set').html(e),this.element.customRadioCheckbox()}});s.module({name:'setting.security.junknotify',template:i(1033)},c)},1032:function(e,t,i){var n=i(463),a=i(497),s=i(467);e.exports={getJunkNotifyInfo:function(){var e=n.Deferred();return a.xhr.simpleCall({query:{func:'user:getATNotifyOption',sid:s.getSid()}},(function(t){e.resolve(t)}),(function(){e.reject()})),e.promise()},setJunkNotifyInfo:function(e){var t=n.Deferred();return a.xhr.simpleCall({query:{func:'user:setATNotifyOption',sid:s.getSid()},data:{notifyInterval:e}},(function(e){t.resolve(e)}),(function(){t.reject()})),t.promise()}}},1033:function(e,t){e.exports='<section class="m-junknotify">\r\n\r\n    <div class="j-notify-set"></div>\r\n\r\n    <script type="text/x-handlebars-template" id="junkNotifyTpl">\r\n        {{#raw}}\r\n        <form action="" name="junknotify">\r\n\r\n            <div class="u-btns-top">\r\n                <button type="button" class="u-btn u-btn-primary" data-action="save" disabled>[[i18n "setting/op_save"]]</button>\r\n                <button type="reset" class="u-btn u-btn-default"  data-action="cancel">[[i18n "setting/op_cancel"]]</button>\r\n            </div>\r\n\r\n            <div class="title dotted">\r\n                <h4>[[i18n "setting/lbl_junkNotify"]]</h4>\r\n            </div>\r\n            <div class="wrapper">\r\n                [[#each notifyIntervals]]\r\n                <div class="grid-row">\r\n                    <div class="grid-col2">\r\n                        <label for="junknotify_[[this]]">\r\n                            <input type="radio"  name="notifyInterval" id="junknotify_[[this]]" value="[[this]]"  [[#compare @root.userNotifyInterval \'==\' this]]checked[[/compare]]/>\r\n                            [[#compare this \'!=\' 0]]\r\n                            &nbsp;[[formatResource "pref/junkfilter/anti_junk_inform_interval_{0}" this]]\r\n                            [[/compare]]\r\n\r\n                            [[#compare this \'==\' 0]]\r\n                            &nbsp;[[i18n "pref/junkfilter/anti_junk_not_inform"]]\r\n                            [[/compare]]\r\n                        </label>\r\n                    </div>\r\n                    <div class="grid-col10">\r\n                        [[#compare this \'!=\' 0]]\r\n                        <span>[[formatResource "pref/junkfilter/anti_junk_inform_interval_{0}_{1}" this "desc"]]</span>\r\n                        [[#compare this \'==\' 7]]\r\n                            <span class="recommend">[\r\n                                [[i18n "pref/junkfilter/anti_junk_inform_recommend"]]\r\n                                ]</span>\r\n                        [[/compare]]\r\n                        [[/compare]]\r\n                    </div>\r\n                </div>\r\n                [[/each]]\r\n\r\n            </div>\r\n\r\n        </form>\r\n        {{/raw}}\r\n\r\n    <\/script>\r\n</section>'},1034:function(e,t,i){i(661);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(465),o=i(1035),c=a.extend({Implements:l,setup:function(){this.data={}},render:function(){c.superclass.render.call(this),this._initView()},events:{'click [data-action]':'_handleOffSiteRemindStatus'},_initView:function(){var e=this;o.getOffSiteRemindStatus().then((function(t){e.data=t,e._renderView()}),(function(){n.notify.error(r('setting/noStatus'))}))},_handleOffSiteRemindStatus:function(e,t){var i=this.$(t).data('action'),a=this.$('.j-remind-from').serializeJSON({defaultType:'+I'});'save'===i?o.setOffSiteRemindStatus(a.status).then((function(e){console.log(e),n.notify.success(r('setting/success'))}),(function(){n.notify.error(r('setting/fail'))})):'cancel'===i&&this._renderView()},_renderView:function(){var e=this.data;this.$('.j-remind-from').html(this.compile(this.$('#offSiteRemindTpl').html(),e)),this.element.customRadioCheckbox()}});s.module({name:'setting.security.offsiteremind',template:i(1036)},c)},1035:function(e,t,i){var n=i(463),a=i(497),s=i(467);e.exports={getOffSiteRemindStatus:function(){var e=n.Deferred();return a.xhr.simpleCall({query:{func:'user:getOffSiteRemindStatus',sid:s.getSid()}},(function(t){e.resolve(t)}),(function(){e.reject()})),e.promise()},setOffSiteRemindStatus:function(e){var t=n.Deferred();return a.xhr.simpleCall({query:{func:'user:setOffSiteRemindStatus',sid:s.getSid(),status:e}},(function(e){t.resolve(e)}),(function(){t.reject()})),t.promise()}}},1036:function(e,t){e.exports='<section class="m-off-site-remind content-wrapper">\r\n\r\n    <div class="u-btns-top">\r\n        <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button>\r\n        <button type="reset" class="u-btn u-btn-default"  data-action="cancel">{{i18n "setting/op_cancel"}}</button>\r\n    </div>\r\n    <div class="title dotted">\r\n        <h4>{{i18n "pref/offSiteRemind_desc"}}</h4>\r\n    </div>\r\n    <form class="j-remind-from remind-from" action=""></form>\r\n    <script type="text/x-handlebars-template" id="offSiteRemindTpl">\r\n        {{#raw}}\r\n            <div class="remind-item">\r\n                <input type="radio" name="status" value="1" id="remindStatus_1" [[#compare this.off_site_remind_status \'==\' 1]]checked[[/compare]]/>\r\n                <label for="remindStatus_1">[[i18n "setting/on"]]</label>\r\n                <span class="remind-info">[[i18n "setting/on_desc"]] <span class="recommend">[ [[i18n "setting/recommend"]] ]</span></span>\r\n            </div>\r\n\r\n            <div class="remind-item">\r\n                <input type="radio" name="status" value="0" id="remindStatus_0" [[#compare this.off_site_remind_status \'==\' 0]]checked[[/compare]]/>\r\n                <label for="remindStatus_0">[[i18n "setting/off"]]</label>\r\n                <span class="remind-info">[[i18n "setting/off_desc"]]</span>\r\n            </div>\r\n\r\n        {{/raw}}\r\n    <\/script>\r\n</section>'},1037:function(e,t,i){(function(e){i(1038);var t=i(463),n=i(472),a=i(471),s=i(470).alert,l=i(1039),r=i(465),o=i(468),c=n.extend({},(function(){var i,n,a=this,c={},u=o.get('mail.opensmimekeypass');a.after('render',(function(){var e=d.switchSmimeTpl({switchSmime:u});a.$('#switchSmime').html(e),a.element.customRadioCheckbox()})),a.events={'click [data-action]':function(i,n){(c[t(n).data('action')]||e.noop)()},'blur input[name="newPassword"]':function(e,i){t(i).val().length<6?t(i).parent().addClass('error-less'):t(i).parent().removeClass('error-less')},'blur input[name="rePassword"]':function(e,i){var n=t(i).val(),s=a.$('input[name=\'newPassword\']').val();n!==s?t(i).parent().addClass('error'):t(i).parent().removeClass('error')},'click form input':function(){i||(a.$('button[data-action = changePwd]').prop('disabled',!1),i=!0);n||(a.$('button[data-action = save]').prop('disabled',!1),n=!0)}},c.changePwd=function(){var e=a.$('form[name=\'changePwd\']').serializeJSON(),i={password:e.oldPassword,enableKeyPass:!0,smimeKeyPass:e.newPassword};return!a.$('input[name=newPassword]').parent().hasClass('error-less')&&!a.$('input[name=rePassword]').parent().hasClass('error')&&(e.oldPassword?e.newPassword?void(e.newPassword===e.rePassword&&(delete e.rePassword,l.setSmimeKeyAttrs(i).then((function(){if(e.newPassword===e.oldPassword)return s(r('pref/smime_mustDifferentPass'));t.notify(r('pref/smime_successMod')),a.$('.main-wrapper').removeClass('switched-edit'),a.element.customRadioCheckbox()})).catchCode(['FA_INVALID_PARAMETER','FA_UNAUTHORIZED'],(function(){a.$('.j-pwd-edit').find('.u-input').val(''),s(r('pref/smime_pwd_err'))})))):s(r('pref/smime_new_pwd_empty')):s(r('pref/smime_please_input_pwd')))},c.save=function(){var e=a.$('form[name=smime]').serializeJSON();if('true'===e.enableKeyPass){if(u)return t.notify(r('pref/smime_had_start')),!1}else{if(!u)return t.notify(r('pref/smime_had_stop')),!1;if(!e.password)return s(r('pref/smime_pwd_empty')),!1}l.setSmimeKeyAttrs(e).then((function(){'true'===e.enableKeyPass?(t.notify(r('pref/smime_suc_start')),a.$('[data-action=editPwd]').attr('data-click',''),u=!0,location.reload()):(t.notify(r('pref/smime_suc_stop')),a.$('form[name=smime]').find('.u-input').val(''),a.$('[data-action=editPwd]').attr('data-click','false_click'),u=!1,location.reload())})).catchCode('FA_INVALID_PARAMETER',(function(){s(r('pref/smime_pwd_empty'))})).catchCode('FA_UNAUTHORIZED',(function(){s(r('pref/smime_pwd_err'))}))},c.cancel_fix=function(){u?a.$('[data-action=start]').trigger('click'):(a.$('[data-action=stop]').trigger('click'),a.$('[data-action=start]').prop('checked',!1))},c.start=function(){a.$('form[name=\'smime\']').find('.u-input').val('').attr('disabled',!0)},c.stop=function(){a.$('form[name=\'smime\']').find('.u-input').attr('disabled',!1)},c.editPwd=function(){u&&(a.$('.j-pwd-edit').html(d.passEditTpl()),i=!1,a.$('.main-wrapper').addClass('switched-edit'))},c.cancel=function(){a.$('.main-wrapper').removeClass('switched-edit'),i=!1}})),d=i(1040);a.module({name:'setting.security.smime',template:d},c)}).call(this,i(464))},1039:function(e,t,i){(function(t){e.exports={setSmimeKeyAttrs:t.wmBind('user:setSmimeKeyAttrs')}}).call(this,i(466))},1040:function(e,t,i){e.exports=i(469)('<section class="m-smime"> <div class="main-wrapper"> <div class="content-wrapper"> <form class="smime" name="smime" onsubmit="return false;"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button> <button type="reset" class="u-btn u-btn-default" data-action="cancel_fix">{{i18n "setting/op_cancel"}}</button> </div> <div class="title dotted"> <h4>{{i18n "pref/msg_smime_pwd_set"}}</h4> </div> <div class="u-form-item"> <div class="u-pdl"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/msg_smime_pwd"}}</label> </div> <div class="u-form-value" id="switchSmime"> </div> </div> <div class="u-pdl"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/msg_smime_tips"}}</label> </div> <div class="u-form-value"> <p>{{i18n "pref/msg_smime_tips_1"}}</p> <p> {{i18n "pref/msg_smime_tips_2"}} </p> <p> {{i18n "pref/msg_smime_tips_3"}} </p> </div> </div> </div> </form> </div> <div class="panel u-scroll edit-panel u-smime-pass-edit"> <div class="j-pwd-edit"></div> </div> </div> </section>',{switchSmimeTpl:'<label> <input type="radio" data-action="start" name="enableKeyPass" value= "true" {{#if switchSmime}}checked{{/if}} /> {{i18n "pref/smime_start"}} </label> <a href="javascript:void(0)" data-action="editPwd" class="editSmimePwd" {{#unless switchSmime}}data-click="false_click"{{/unless}}>{{i18n "pref/msg_smime_fix"}}</a> <div class="u-stop-smime"> <label> <input type="radio" data-action="stop" name="enableKeyPass" {{#unless switchSmime}}checked{{/unless}} value= "false" /> {{i18n "pref/smime_stop"}} <input class="u-input" name="password" {{#if switchSmime}}disabled{{/if}} type="password"/> </label> </div>',passEditTpl:'<form action="#" method="post" name="changePwd" class="u-form" onsubmit="return false;"> <div class="u-btns-top"> <button type="button" data-action="changePwd" disabled="" class="u-btn u-btn-primary">{{i18n "setting/op_save"}}</button> <button type="reset" class="u-btn u-btn-default " data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <h4>{{i18n "pref/smime_pwd_fix"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/old_smime_pwd"}}</label> </div> <div class="u-form-value"> <input class="u-input" type="password" name="oldPassword" /> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/new_smime_pwd"}}</label> </div> <div class="u-form-value"> <input class="u-input" name="newPassword" type="password" /> <span class="strengthHint">{{i18n "pref/smime_newl_pwd_limit"}}</span> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/re_new_smime_pwd"}}</label> </div> <div class="u-form-value"> <input class="u-input" name="rePassword" type="password" /> <span class="notify f-dn">{{i18n "pref/smime_mustsame"}}</span> </div> </div> </form>'})},1046:function(e,t,i){(function(t){i(1047);var n=i(463),a=i(465),s=i(479),l=i(466),r=i(472),o=i(471),c=i(510),d=i(470).confirm,u=i(529),p=i(468).get,f=i(467),m=i(1048),v=i(508),h=m.devicesType;function b(e){n.isPlainObject(e)?e=[e]:n.isArray(e)||(e=[]),this.devices=e,n.each(this.devices,n.proxy((function(e,t){this._formatDevice(t)}),this)),this._sortByLastTime()}b.prototype={constructor:b,_formatDevice:function(e){e.lastTime?s.isMoment(e.lastTime)||(e.lastTime=s(e.lastTime)):e.lastTime=null},_sortByLastTime:function(){this.devices.sort((function(e,t){var i,n;return(i=null==e.lastTime?-1:e.lastTime.valueOf())>(n=null==t.lastTime?-1:t.lastTime.valueOf())?-1:i===n?0:i<n?1:void 0}))},destroy:function(){this.devices=[]},deleteById:function(e){var t,i=-1;for(t=0;t<this.devices.length;t++)if(this.devices[t].id==e){i=t;break}return i<0?{}:this.devices.splice(t,1)},updateById:function(e){var t,i=-1;if(!e||!e.id)return{};for(var a=0;a<this.devices.length;a++)if((t=this.devices[a]).id==e.id){i=a,this.devices[a]=n.extend(t,e,!0);break}return i>=0?t:{}},addById:function(e){var t;return e&&e.id?(t=this.getById(e.id),this._formatDevice(e),n.isEmptyObject(t)?(this.devices.push(e),t=e):n.extend(t,e,!0),this._sortByLastTime(),t):{}},getById:function(e){for(var t,i=-1,n=0;n<this.devices.length;n++)if((t=this.devices[n]).id==e){i=n;break}return i<0?{}:t}};var g=r.extend({twoFactorAuthState:null,devicesSet:{authorized:null,recent:null},config:null,$authorizedListWrap:null,$authorizedList:null,$recentListWrap:null,$recentList:null,events:{'click .j-device-action':'_handleDeviceActionClick','mouseenter .j-auth-disabled-tip':'_showDeviceActionDisabledTip'},setup:function(){this.state=f.getCurrentState(),delete this.state.param.view,this.config=i(549)()},render:function(){if(g.superclass.render.call(this),!this.config.supportAuthorizedDevice)return this._renderForbidden(),!1;this._doRender(),this._initModuleEvent()},destroy:function(){g.superclass.destroy.call(this)},_renderForbidden:function(){this.$('.j-main').html(y())},_doRender:function(){this._initStore(this._renderDevicesSet)},_initStore:function(e){var t=this;t._cleanDevicesSet(),v.queryAuthInfo().fin((function(i,n){t.twoFactorAuthState=i?n:{type:'DISABLED'},l.wmCall('user:listDevices').then((function(i){t.devicesSet={recent:t._formatDevicesToSet(i.recent),authorized:t._formatDevicesToSet(i.authorized)},e.call(t)}))}))},_initModuleEvent:function(){var e=this;this.unsubscribe('setting.security.twofactorauth','authStatusChange').subscribe('setting.security.twofactorauth','authStatusChange',(function(){e._initStore(e._updateDeviceListTpl)}))},_handleDeviceActionClick:function(e){var i=this;t.stop(e,0);var s=n(e.currentTarget),r=s.closest('.j-device-card').eq(0),o=s.attr('data-action'),c=+r.attr('data-id');if(!c)return!1;if(s.hasClass('disabled'))return!1;var p=u(o,[['delete',[function(){return l.wmCall('user:deleteDevices',{ids:[c],invalidateSession:w}).then((function(){i.devicesSet.authorized.deleteById(c),i.devicesSet.recent.deleteById(c),i._updateDeviceListTpl()}))},a('setting/msg_loginDevices_delete_current')]],['unauth',[function(){return l.wmCall('user:authDevice',{deviceId:c,auth:!1,invalidateSession:w}).then((function(){i.devicesSet.recent.updateById({id:c,authorized:!1}),i.devicesSet.authorized.deleteById(c),i._updateDeviceListTpl()}))},a('setting/msg_loginDevices_unauth_current')]]]),m=p[0],h=p[1],b=r.data(),g=b.authorized,_=b.isCurrent,y=v.authConfig.AUTH_DEVICE,w=y&&!_;return(g||_)&&y?d(h).truthy().then(m).then(_?f.logoutUser:n.noop):m(),!1},_showDeviceActionDisabledTip:function(e){t.stop(e,0);var i=n(e.currentTarget);new c({zIndex:999,trigger:i,content:a('setting/msg_loginDevices_action_disabled_unauth'),inViewport:!0,arrowPosition:11}).after('hide',(function(){this.destroy()})).show()},_renderDevicesSet:function(){var e={showAuthorized:!v.isForbidden,devicePreservePeriod:j(p('setting.devicePreservePeriod'))};this.$('.j-main').html(w(e)),this.$authorizedListWrap=this.$('.j-authorized-list-wrap'),this.$authorizedList=this.$('.j-authorized-list'),this.$recentListWrap=this.$('.j-recent-list-wrap'),this.$recentList=this.$('.j-recent-list'),this._updateDeviceListTpl()},_cleanDevicesSet:function(){this.devicesSet.authorized&&(this.devicesSet.authorized.destroy(),this.devicesSet.authorized=null),this.devicesSet.recent&&(this.devicesSet.recent.destroy(),this.devicesSet.recent=null)},_compileDeviceListTpl:function(e,t){var i=this,s=[];return null!=t&&t.devices.length?(s.push('<ul>'),n.each(t.devices,(function(t,n){s.push(i._compileDeviceTpl(e,n))})),s.push('</ul>'),s.join('')):k({title:a('setting/msg_loginDevices_empty_recent_title'),content:a('setting/msg_loginDevices_empty')})},_updateAuthorizedDeviceListTpl:function(){if(v.isForbidden)return!1;var e,t=this.devicesSet.authorized;if(null==t||!t.devices.length)return e=k({title:a('setting/msg_loginDevices_empty_authorized_title'),content:'DISABLED'===this.twoFactorAuthState.type?a('setting/msg_loginDevices_empty_authorized_disabled_content'):a('setting/msg_loginDevices_empty_authorized_content')}),void this.$authorizedList.html(e);this.$authorizedList.html(this._compileDeviceListTpl(h.AUTHORIZED,this.devicesSet.authorized))},_updateRecentDeviceListTpl:function(){this.$recentList.html(this._compileDeviceListTpl(h.RECENT,this.devicesSet.recent))},_updateDeviceListTpl:function(){this._updateAuthorizedDeviceListTpl(),this._updateRecentDeviceListTpl()},_compileDeviceTpl:function(e,t){var i=this.twoFactorAuthState,n=('OTP'===i.type&&i.deviceInfo||{}).uuid,s=t.UUID||t.uuid,l=n&&n===s,r=t.lastSid===f.getSid(),o=[];l||(e===h.RECENT&&o.push({type:'delete',desc:a('setting/lbl_logindevices_device_action_delete')}),t.authorized&&o.push({type:'unauth',desc:a('setting/lbl_logindevices_device_action_unauth'),authDisabled:'DISABLED'===this.twoFactorAuthState.type}));t.model&&'na'!==t.model||(t.model=a('setting/lbl_logindevices_device_model_unknown')),t.os&&'na'!==t.os||(t.os=a('setting/lbl_logindevices_device_model_unknown'));var c='Webmail'===t.deviceType;return t.friendlyName&&'na'!==t.friendlyName||(t.friendlyName=a(c?'setting/lbl_logindevices_device_browser_unknown':'setting/lbl_logindevices_device_name_unknown')),x({deviceInfo:t,deviceType:e,actions:o,isBindDevice:l,isCurrentDevice:r,isWebmail:c,osUIInfo:m.getDeviceOSUIInfo(t.os)})},_formatDevicesToSet:function(e){return null==e?new b:new b(e)}}),_=i(1049).helpers({FormatLastTime:function(e){var t=a('setting/lbl_logindevices_device_lasttime_suffix'),i=e?j(s().valueOf()-e.valueOf()):'';return i&&i+t}}),y=_.disableTpl,w=_.mainTpl,k=_.DeviceListEmptyTpl,x=_.deviceItemTpl;function j(e){var t=e>0&&Math.floor(e/1e3),i=Math.floor(t/60),n=Math.floor(i/60),s=Math.floor(n/24),l=function(e,t){return a('common/dateunit_'+e,{count:t})};return s?l('day',s):n?l('hour',n):i?l('minute',i):t?l('second',t):''}o.module({name:'setting.security.logindevices',template:_},g),e.exports=g}).call(this,i(464))},1048:function(e,t){var i={wp:['bg-windows','iconwindows'],windows:['bg-windows','iconwindowsos'],macosx:['bg-apple','iconmacos'],ios:['bg-apple','iconapple'],yunos:['bg-yunos','iconyunos'],android:['bg-android','iconanroid'],chromeos:['bg-chromeos','iconchromeos'],linux:['bg-linux','iconlinuxos'],windowsce:['bg-windows','iconwindowsce'],symbian:['bg-symbian','iconsymbian'],blackberry:['bg-blackberry','iconblackberry']};e.exports={getDeviceOSUIInfo:function(e){var t,n={bgClass:'bg-default',iconClass:'iconunknownapp'};return'string'==typeof e&&e.length?(e=e.toLowerCase(),null==(t=i[e])||(t[0]&&(n.bgClass=t[0]),t[1]&&(n.iconClass=t[1])),n):n},devicesType:{AUTHORIZED:'authorized',RECENT:'recent'}}},1049:function(e,t,i){e.exports=i(469)('<div class="m-setting-logindevices content-wrapper"> <div class="main-wrapper j-main"> </div> </div>',{disableTpl:'<p>{{ i18n "setting/msg_loginDevices_disable" }}</p>',mainTpl:'{{#if showAuthorized}} <div class="list-wrap authorized-list-wrap j-authorized-list-wrap"> <div class="title dotted"> <h4> {{ i18n "setting/lbl_logindevices_authorized_title" }} {{#if (not @config.setting.2FA.AUTH_DEVICE)}}<small>{{ i18n "setting/lbl_logindevices_authorized_desc" }}</small>{{/if}} </h4> </div> <div class="list j-authorized-list f-cf"></div> </div> {{/if}} <div class="list-wrap recent-list-wrap j-recent-list-wrap"> <div class="title dotted"> <h4> {{ i18n "setting/lbl_logindevices_recent_title" }} <small>{{ i18n "setting/lbl_logindevices_recent_desc" date=devicePreservePeriod }}</small> </h4> </div> <div class="list j-recent-list f-cf"></div> </div>',DeviceListEmptyTpl:'<div class="device-card"> <div class="device-card-header"> <p> {{ title }} </p> </div> <div class="device-card-body f-cf"> <div class="device-card-body-icon bg-default"> <i class="iconfont iconinfo"></i> </div> <div class="device-card-body-content"> <p> {{ content }} </p> </div> </div> </div>',deviceItemTpl:'<li class="device-card j-device-card" data-type="{{deviceType}}" data-id="{{deviceInfo.id}}" data-is-current="{{isCurrentDevice}}" data-authorized="{{deviceInfo.authorized}}"> <div class="device-card-header"> <p> {{deviceInfo.model}} {{#if isCurrentDevice}} <small>{{ i18n "setting/lbl_logindevices_device_current" }}</small> {{else}} <small>{{{FormatLastTime deviceInfo.lastTime}}}</small> {{/if}} </p> {{#if isBindDevice }} <p class="f-fr small"> {{{ i18n "setting/lbl_logindevices_device_authority" }}} </p> {{/if}} {{#each actions }} <a href="javascript:void(0);" class="action j-device-action{{if$ authDisabled \' disabled j-auth-disabled-tip\'}}" data-action="{{type}}">&#91{{desc}}&#93</a> {{/each}} </div> <div class="device-card-body f-cf"> <div class="device-card-body-icon {{osUIInfo.bgClass}}"> <i class="iconfont {{osUIInfo.iconClass}}"></i> </div> <div class="device-card-body-content"> <p> <span class="label">{{ i18n "setting/lbl_logindevices_device_os" }}：</span> {{deviceInfo.os}} </p> <p> {{#if isWebmail}} <span class="label">{{ i18n "setting/lbl_logindevices_device_browser" }}：</span> {{else}} <span class="label">{{ i18n "setting/lbl_logindevices_device_name" }}：</span> {{/if}} {{deviceInfo.friendlyName}} </p> <p> <span class="label">{{ i18n "setting/lbl_logindevices_device_app" }}：</span> {{deviceInfo.deviceType}} </p> </div> </div> </li>'})},1050:function(e,t,i){i(499)('setting.folder',{className:'m-sgaccount'},{setup:function(){var e=this;e.subscribe('dispatcher','url:changed',(function(t){'create'===t.message.newState.param.panel&&e.sendMessage('setting.folder.folder','folder:create')}))}})},1051:function(e,t,i){(function(e,t){i(1052),i(573);var n=i(463),a=i(472),s=i(498),l=i(471),r=i(493),o=i(528).hash,c=i(470),d=c.alert,u=c.confirm,p=c.prompt,f=i(476),m=i(474),v=i(467),h=i(465),b=i(473),g=i(513).basename,_=i(468).get;var y=_('setting.limitmessagesize'),w=_('setting.limitmessagecount'),k=a.extend({},(function(){var a=this,l={cancel:I};a.events={'click [data-action]':[l,n],'change #fileChoose':[function(t){var i=t[0].files||[{name:g(t.val())}];a.$('#fileName').html(e.mapFilter(i,(function(e){var t=e.name;return P(t)&&n('<p>',{text:t})}))).show()},n],'focus .j-folder-name':function(){a.$('.u-create-folder').removeClass('error')},'keyup .j-folder-name':[function(e){var t=f.trimName({name:e.val()}),i=a.$('.u-create-folder');'ok'!==t?i.addClass('error').find('.u-error-notify').html(h('setting/msg_err_folder_'+t)):i.removeClass('error')},n]};var c,k=_('setting.enableimportmessage'),x=_('setting.foldercount'),S=_('setting.limitfoldercount'),C=v.getUser().sec_folder,T=+v.getUser().preview_layout,$=_('setting.enablefoldermodify'),A='create'===v.getCurrentState().param.panel;function I(t){a.$('.main-wrapper').removeClass((function(e,t){return(t.match(/\bswitched\S+/g)||[]).join(' ')})).addClass(e.isSTR(t)?'switched-'+t:'')}function D(){m.fdrTree().then((function(t){c=function i(t,n){var a=v.getFolderLockedStatus(),s=e.map(e.filter(t,e.not('flags.system')),'id');return e.iter(t,(function(t){var l=t.id,r=t.children,o=t.stats,c=m.isExpandThreadMid(l);e.assign(t,{auth2unlocked:a.isAuth,lockedDefined:a.lockedDefined,auth2Locked:C.includes(''+l),noUp:l===s[0],noDown:l===e.last(s),paddingLeft:n,unreadMessageCount:c?o.unreadThreadCount:o.unreadMessageCount,allMessageCount:c?o.threadCount:o.messageCount,isEnableCleanUp:$&&o.messageSize>0&&l>3,isEnableDelete:$&&!r&&!t.isPop}),i(r,n+25)})),t}(t,0),a.$().html(j(function(t){var i=e.groupBy(t,e.biz('flags.system',0,1),[[],[]]).map((function(t){return e.assign(t=M(t),{size:e.sumBy(t,'stats.messageSize'),count:e.sumBy(t,'stats.messageCount'),unread:e.sumBy(t,'stats.unreadMessageCount')})})),n={sys:i[0],other:i[1]};return e.assign({groups:n,unused:e.mapValues({size:y,count:w},(function(t,n){var a=e.sumBy(i,n),s=Math.max(t,a);return i.forEach((function(e){e[n+'_r']=Math.min(.995,Math.max(.005,e[n]/s))})),s-a}))},n)}(c))),a.$('[data-action=create]').attr('disabled',x>=S),k||a.$('[data-action=importEML]').hide(),A&&(A=!1,v.setCurrentState({module:'setting.folder.folder',param:{}}),F()),a.$().mask('hide')}))}a.after('render',(function(){a.$().addClass('m-userfolder').mask(),a.pubsub.off(),m.flush().then(E).then(D)}));var M=function(t){return e.reduce(t,(function(e,t){return e.concat(t,M(t.children))}),[])};function E(){a.subscribe('mail','fdr:changed',D),a.onMessage('folder:create',F)}l.toggleFolder=function(e){e.closest('table').find('tbody').toggle(),e.find('i').toggleClass('iconunfold iconcollapse')};var F=l.createFolder=function(){a.$('.create-panel').html(j.createFolderTpl()),N('parent'),I('create')};var P=function(e){return e.match(/\.eml/i)||void d(b.h(h('setting/msg_uploadTypeError'),e))};function N(e){s({width:230,parentNode:a.$(),trigger:a.$('[name='+e+']')})}l.importEML=function(){a.$('.import-panel').html(j.importEMLTpl()),N('fid'),I('import')},l.rename=function(e){var t=e.parent().data(),i=t.fid,a=t.name;p(h('setting/msg_inputFolderName'),''+a,(function(e){var t={id:i,name:e},a=f.trimName(t);if('ok'!==a)return n.notify.error(h('setting/msg_err_folder_'+a)),!1;f.updateFolders([t]).then((function(){n.notify(h('setting/msg_renameFolderSuccess')),L()}))}))},l.create=function(){var e,t=a.$('.j-create-folder').serializeJSON({defaultType:'+I'}),i=f.trimName(t);'ok'===i?(t.flags={pop3:(e=c,e.some((function(e){return!e.flags.system&&e.flags.pop3})))},f.createFolders([t]).then((function(){n.notify.success(h('setting/msg_createFolderSuccess')),L(),I()}))):a.$('.u-create-folder').addClass('error').find('.u-error-notify').html(h('setting/msg_err_folder_'+i))};var L=m.flush,R=function(e){return function(i){return t.wmCall('mbox:setFolderPosition',{id:i.parent().data().fid,relPos:e}).then(L)}};l.up=R(-1),l.down=R(1),l['import']=function(){var e=a.$('#uploadEMLForm').serializeJSON({defaultType:'+I'}),t=a.$('#fileChoose');f.importEMLToFolder(e.fid,t).then((function(){n.notify.success(h('setting/msg_uploadEMLSuccess')),L(),I()})).onFail((function(){n.notify.error(h('setting/msg_uploadEMLFailed'))}))},l['delete']=function(e){var t=e.parent().data(),i=t.fid,a=t.name,s=t.msgCnt,l=t.type,o=t.acc,c=v.getFolderLockedStatus().isAuth,d=C.includes(''+i);if('pop'!==l){var p=function(){f.deleteFolders([i]).then((function(){n.notify.success(b(h('setting/msg_deleteFolderSuccess'),a)),L()})).onFail((function(){n.notify.error(b(h('setting/msg_deleteFolderFail'),a))}))};if(d&&!c)return r.box({successCb:function(){e.click()}}),!1;s?u(b.h(h('setting/msg_confirmEmptyAndRemoveFolder'),a),(function(){f.doEmptyFolder(i).then(p)})):u(b.h(h('setting/msg_confirmRemoveFolder'),a),p)}else n.notify.error(b(h('main/err_folder_delPopFolder'),o))},l.cleanup=function(e){var t=e.parent().data(),i=t.fid,a=t.name,s=v.getFolderLockedStatus().isAuth;if(C.includes(''+i)&&!s)return r.box({successCb:function(){e.click()}}),!1;u(b.h(h('main/confirm_clean'),a),(function(){f.doEmptyFolder(i).then((function(){n.notify.success(h('mbox/empty_folder_succ')),L()}))}))},l.view=function(e){var t=e.data(),n=t.fid,a=t.filter,s=T?'mail.previewlayout':'mail.list',l={fid:n};l.historyUrl=o(s,l),T&&(l.layout=T),a&&(l.filterFlags={read:!1},l.action='unread'),i(477).go(s,l)},l.deletePop=function(){v.go('setting.advance.pop')}})),x=function(e){return(e/this*100).toFixed(1)+'%'},j=i(1053).helpers({ratio:x.bind(1),ratioS:x.bind(y)});l.module({name:'setting.folder.folder'},k)}).call(this,i(464),i(466))},1053:function(e,t,i){e.exports=i(469)('<div class="main-wrapper"> <div class="content-wrapper"> <section class="folder-list u-scroll"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="createFolder">{{i18n "main/bt_createfolder"}}</button> <button type="button" class="u-btn u-btn-default" data-action="importEML">{{i18n "setting/op_importMessage"}}</button> </div> {{> folderTpl}} <div class="pop-folder-desc"> {{i18n "setting/msg_popFolderDeleteNotify"}} <a data-action="deletePop" href="javascript:void(0);" class="link" > {{i18n "setting/tab_popaccount"}} </a> </div> </section> <section class="folder-usage">{{> folderOverViewTpl}}</section> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <section class="panel u-scroll create-panel"></section> <section class="panel u-scroll import-panel"></section> </div>',{folderTpl:'{{#each groups}} <table> <thead> <th nowrap class="f-tal"> <div class="f-csp" data-action="toggleFolder"> <i class="iconfont iconcollapse"></i> <span>{{i18n (join "setting/lbl_" @key "Folder")}}</span> </div> </th> <th width="150">{{i18n "main/h_newmsg"}} ({{unread}})</th> <th width="150">{{i18n "main/h_msgcnt"}} ({{count}})</th> <th width="150">{{i18n "main/h_sizevalue"}} ({{size$ size 2}})</th> <th width="150">{{i18n "main/h_sizeratio"}}</th> <th width="200" class="operation">{{i18n "main/h_operation"}}</th> </thead> <tbody> {{#each this}} <tr> <td class="f-tal" style="padding-left:{{paddingLeft}}px"> {{#and lockedDefined auth2Locked}} <div class="cnt f-ib"><i class="iconfont {{#if auth2unlocked}}iconunlock{{^}}iconlock{{/if}}"></i></div> {{^}} <div class="f-spc f-ib"></div> {{/and}} <a data-action="view" data-fid="{{id}}"> {{#if isPop}} {{i18n "setting/lbl_POPFolder"}} {{/if}} {{name}}</a> </td> <td> {{#if unreadMessageCount}} <a data-action="view" data-fid="{{id}}" data-filter=unread class=number>{{unreadMessageCount}}</a> {{^}} {{unreadMessageCount}} {{/if}} </td> <td> {{allMessageCount}}</td> <td> {{size$ stats.messageSize 2}}</td> <td> {{ratioS stats.messageSize}}</td> <td class="operation" {{#if isPop}} data-type="pop" data-acc="{{popAccount}}"{{/if}} data-fid="{{id}}" data-name="{{name}}" data-msg-cnt="{{allMessageCount}}"> {{#if isEnableCleanUp}}<a data-action="cleanup">{{i18n "main/act_empty"}}</a>{{/if}} {{#if (not flags.system)}} {{#if isEnableDelete}}<a data-action="delete">{{i18n "main/act_delete"}}</a>{{/if}} <a data-action="rename">{{i18n "setting/op_act_rename"}}</a> <a class="{{if$ noUp \'f-vh\'}}" data-action="up"><i class="iconfont iconmoveup"></i></a> <a class="{{if$ noDown \'f-vh\'}}" data-action="down"><i class="iconfont iconmovedown"></i></a> {{/if}} </td> </tr> {{/each}} </tbody> </table> {{/each}}',folderOverViewTpl:'<div> <div class="folder-usage-overview"> <p class="overview-title">{{i18n "setting/lbl_messageCount"}}:</p> <span class="overview-item"><i class="square sys"></i>{{i18n "main/links_mboxSysFolder"}} {{i18n "prop:main/mbox_message_count" 0=sys.count}}</span> <span class="overview-item"><i class="square other"></i>{{i18n "main/links_mboxUserFolder"}} {{i18n "prop:main/mbox_message_count" 0=other.count}}</span> <span class="overview-item"><i class="square unused"></i>{{i18n "setting/lbl_unused"}} {{i18n "prop:main/mbox_message_count" 0=unused.count}}</span> </div> <div class="folder-usage-capacity"> <i class="capacity-bar sys" style="width: {{ratio sys.count_r}}"></i> <i class="capacity-bar other" style="width: {{ratio other.count_r}}"></i> </div> </div> <span></span> <div> <div class="folder-usage-overview"> <p class="overview-title">{{i18n "setting/lbl_folderUsage"}}:</p> <span class="overview-item"><i class="square sys"></i>{{i18n "main/links_mboxSysFolder"}} {{size$ sys.size 2}}</span> <span class="overview-item"><i class="square other"></i>{{i18n "main/links_mboxUserFolder"}} {{size$ other.size 2}}</span> <span class="overview-item"><i class="square unused"></i>{{i18n "setting/lbl_unused"}} {{size$ unused.size 2}}</span> </div> <div class="folder-usage-capacity"> <i class="capacity-bar sys" style="width: {{ratio sys.size_r}}"></i> <i class="capacity-bar other" style="width: {{ratio other.size_r}}"></i> </div> </div>',createFolderTpl:'<form action="#" name="createFolder" class="j-create-folder" onsubmit="return false"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="create">{{i18n "setting/op_confirm"}}</button> <button type="reset" class="u-btn u-btn-default" data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "main/bt_createfolder"}}</h4> <div class="u-form-item u-create-folder"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_newFolderName"}}&nbsp; :</label> <input type="text" class="u-input j-folder-name" name="name:string"> <div class="u-error-notify f-dn"></div> </div> <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_folderPos"}}&nbsp;:</label> <select name=parent>{{fdrOptions nest=1}}</select> </div> </form>',importEMLTpl:'<form action="" id="uploadEMLForm"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="import">{{i18n "setting/op_confirm"}}</button> <button type="reset" class="u-btn u-btn-default" data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{i18n "setting/lbl_importEML"}}</h4> <div class="u-form-item"> <label class="u-form-label f-mgr f-cfn">{{i18n "setting/lbl_choseFolderName"}}:</label> <div class="u-btn u-btn-primary fileSelector f-oh"> <label for="fileChoose">{{i18n "main/trsSelectFileBtn"}}</label> <input type="file" id="fileChoose" name="files[]" accept="message/rfc822" multiple style="position: fixed; left: -9999px"> </div> <div class="f-dn u-file-list " id="fileName"> </div> </div> <div class="u-form-item j-import-eml"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_folderPos"}}&nbsp;:</label> <select name=fid>{{fdrOptions mail=1}}</select> </div> </form>'})},1054:function(e,t,i){i(499)('setting.calendar',{className:'m-sgaccount'})},1055:function(e,t,i){(function(e,t){i(1056),i(532);var n=i(463),a=i(472),s=i(471),l=i(470),r=l.alert,o=l.confirm,c=i(475),d=i(473).h,u=i(467),p=i(476),f=i(651),m=i(465),v=a.extend({},(function(i,a){var s,l,v,b=this;b.events={'click [data-action]':[function(i,a){var r=a.data(),c=a.data().fid;({tableToggle:function(){return function(e,t){b.$('.j-'+t.target).toggle(),e.find('i').toggleClass('iconunfold iconcollapse')}(a,r)},deleteCalendar:function(){return function(i,a,r){o(d(m('cal/msg_confirm_delete_calendar'),r.name),(function(){t.wmCall('cal:delete'+(i?'':'Accessed')+'CalFolder',{fid:a}).then((function(){(i?w:k)((i?s:l).filter(e.not({fid:a}))),n.notify(m('cal/info_delete_success')),b.publish('calUpdate',{fid:a,updateType:'DELETE'})}))}))}(r.own,c,r)},setCalVisible:function(){return function(i,n){t.wmCall('cal:setAccessedCalFolderVisible',{fid:i,visible:n}).then((function(){e.find(l,{fid:i}).hidden=!n,k(l),b.sendMessage('calendar','view:refresh',{fid:i})}))}(c,r.visible)},updateCalendar:e.fn(x,!0,c),createCalendar:e.fn(x,!0),cancelEdit:x})[i]()}]},i()(a);var g=function(e){return 1===e.link_fid?d(m('main/cal_share_tab').replace('<br>',' '),/.*(?=@)/.exec(e.link_uid)):e.name};function _(){f(!0).then((function(e,t){w(e),k(t),v=(e[0]||0).first_week_day,b.$('.j-first-day-value').html(h.setFirstDayTpl({firstDayOfWeek:v})),b.$().customRadioCheckbox()}))}function y(i,a){var l=b.$('form').submit(e.stop((function(){return function(i,a,l){if(1===i&&(l.name=m('cal/myCalendar')),!(a&&a.name===l.name||function(e){if('ok'!==p.trimName(e,50,'%\'"\\/:*?<>|=,^'))return r(d(m('setting/msg_invailCalName'),[50,'%\'"\\/:*?<>|=,^'])),!1;var t=e.name;if(!s&&t!==m('cal/myCalendar'))return!0;for(var i=0;i<s.length;i++)if(t===s[i].name.trim()||t===m('cal/myCalendar'))return r(m('setting/msg_CalNameExist')),!1;return!0}(l)))return;t.wmCall(a?'cal:updateCalFolder':'cal:createCalFolder',l).then((function(t){a?e.reassign(a,l):s.push(e.assign({},l,{fid:i=t.fid,first_week_day:v})),w(s),n.notify(m('cal/info_'+(a?'update':'create')+'_success')),x(),b.publish('calUpdate',{fid:i,updateType:a?'UPDATE':'CREATE'})}))}(i,a,o())}))),o=function(){return l.serializeJSON({defaultType:'+I'})},f=b.$('.j-btn-add').click(e.fun(y))[0],g=b.$('.j-input').on('keyup cut paste',(function(){f.disabled=!g.val(),_()}));function _(e,t){b.$('.j-info').text(e).toggleClass('error-msg',!t).toggle(!!e),g.toggleClass('error',!!e&&!t)}function y(i){return g.val(i=i?i.original.emailaddr:g.val()),f.disabled=!0,_(m('setting/msg_addingContacts'),!0),c.test(i)?u.getUser().email===i?_(m('setting/msg_CalShareToOwnErr')):e.some(o().targets,{uid:i})?_(m('setting/msg_existEmailForShare')):void t.wmCall({url:'/XT5/jsp/setting.jsp',func:'user:isNormalUser',uid:i}).then((function(){b.$('.j-contact').append(h.newContactTpl({uid:i})),_()})).onFail((function(){_(m('setting/msg_calShareErr'))})):_(m('setting/msg_errorEmailFormat'))}!function(e,t){e.contactac({select:t,width:256,zIndex:1e3})}(g,y)}function w(e){b.$('.j-ownCal').html(h.ownCalTpl(s=e))}function k(e){b.$('.j-receivedCal').html(h.helpers({convertShareCalName:g}).receivedCalTpl(l=e))}function x(t,i){if(t){var n=e.find(s,{fid:i});1===i&&(n.name=m('cal/myCalendar')),b.$('.m-edit-cal').html(h.calendarSetTpl(n)),y(i,n)}b.$('.main-wrapper').toggleClass('toggled',!!t)}_(),b.onMessage('view:refresh',_),b.$().on('change.crc','[name=first_week_day]',(function(){var e=this.value;v!==e&&u.updateUser({first_week_day:e}).then((function(){v=e,n.notify.success(m('cal/info_update_success')),b.publish('calUpdate',{updateType:'UPDATE_ALL'})}))}))})),h=i(1057);s.module({name:'setting.calendar.calendar',template:h},v)}).call(this,i(464),i(466))},1057:function(e,t,i){e.exports=i(469)('<section class="m-calendar-set"> <div class="main-wrapper"> <div class="content-wrapper"> <div class="title dotted"> <h4>{{i18n "cal/calendar-display-set"}}</h4> </div> <div class="u-form-item first-day"> <div class="f-fl"> <label>{{i18n "cal/info_first_week_day"}}:</label> </div> <div class="u-form-value j-first-day-value"></div> </div> <div class="title dotted list-dotted"> <h4>{{i18n "cal/my-lists"}}</h4> </div> <div class="u-btn-cal"> <button type="button" class="u-btn u-btn-primary" data-action="createCalendar">{{i18n "cal/addCalendar"}}</button> </div> <div class="m-cal-list-head"> <table class="u-table u-table-row"> <thead> <tr> <td data-action="tableToggle" data-target="ownCal" class="f-usn"> <i class="iconfont iconcollapse"></i> {{i18n "setting/lbl_calendar"}} </td> <td class="opr">{{i18n "setting/lbl_op"}}</td> </tr> </thead> </table> </div> <div class="m-cal-list-body j-ownCal"> </div> <div class="title dotted list-dotted f-pdt2"> <h4>{{i18n "cal/my-lists"}}</h4> </div> <div class="u-cal-notify"> <span class="circle"></span> <h4>{{i18n "setting/lbl_shareCalendarNotify"}}</h4> </div> <div class="m-cal-list-head share"> <table class="u-table u-table-row"> <thead> <tr> <td class="cal-index f-usn" data-action="tableToggle" data-target="receivedCal" > <i class="iconfont iconcollapse"></i> {{i18n "setting/lbl_receivedCalendar"}} </td> <td> {{i18n "setting/lbl_shareCalendarUid"}} </td> <td class="opr">{{i18n "setting/lbl_op"}}</td> </tr> </thead> </table> </div> <div class="m-cal-list-body share j-receivedCal"> <span class="empty">{{i18n "setting/lbl_shareCalendarEmpty"}}</span> </div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask"></div> <![endif]--\x3e <div class="panel m-edit-cal u-scroll"></div> </div> </section>',{setFirstDayTpl:'{{#seq 1 2}} <label class="f-ib f-mgl"> <input type=radio name=first_week_day {{#eq ../firstDayOfWeek .}}checked{{/eq}} value={{.}}>{{i18n (join "cal/value_first_week_day_" . )}} </label> {{/seq}}',ownCalTpl:'<table class="u-table u-table-row"> {{#each .}} <tr> <td>{{if$ (eq fid 1) (i18n "cal/myCalendar") name}}</td> <td class="opr"> <a class=link data-action=updateCalendar data-fid="{{fid}}">{{i18n "setting/lbl_calendarEdit"}}</a> {{#ne fid 1}} <a class="link f-mgl" data-action=deleteCalendar data-fid="{{fid}}" data-name="{{name}}" data-own=1>{{i18n "setting/op_remove"}}</a> {{/ne}} </td> </tr> {{/each}} </table>',receivedCalTpl:'<table class="u-table u-table-row"> {{#each .}} <tr {{#if hidden}}class=hide_row{{/if}}> <td class=cal-index>{{convertShareCalName .}}</td> <td class=cal-owner>{{link_uid}}</td> <td class=opr> <a class=link data-action=setCalVisible data-fid="{{fid}}" data-visible="{{or hidden false}}"> {{i18n (join "setting/lbl_" (if$ hidden "show" "hide") "Calendar")}} </a> <a class="link f-mgl" data-action=deleteCalendar data-fid="{{fid}}" data-name="{{name}}">{{i18n "setting/op_remove"}}</a> </td> </tr> {{/each}} </table>',calendarSetTpl:'<form> <div class="u-btns-top"> <button class="u-btn u-btn-primary">{{i18n "setting/op_confirm"}}</button> <button type=reset class="u-btn u-btn-default" data-action=cancelEdit>{{i18n "setting/op_cancel"}}</button> </div> <input type=hidden name=first_week_day value="{{or data.first_week_day 1}}"> <h4 class=sub-header>{{i18n "setting/lbl_calendarSetAndShare"}}</h4> {{#if fid}} <input type=hidden name=fid value="{{fid}}"/> {{/if}} <div class=u-form-item> <label class=u-form-label>{{i18n "cal/calendar_name"}}:</label>&nbsp; {{#eq fid 1}} <span>{{name}}</span> {{^}} <input name=name:string class=u-input value="{{name}}"> {{/eq}} </div> <div class="u-form-item u-input-contact"> <label class=u-form-label>{{i18n "setting/lbl_calendarShareTfo"}}:</label>&nbsp; <input class="u-input share j-input" name=target[uid]><button type=button class="u-btn u-btn-primary u-btn-small j-btn-add" disabled>{{i18n "setting/lbl_addShareUser"}}</button> <p class=j-info></p> </div> <div class="j-contact u-contact-list"> {{#each targets}}{{>newContactTpl}}{{/each}} </div> </form>',newContactTpl:'<div class=u-form-item> <label class=u-form-label><i class="iconfont icontabclose f-csp" onclick="$(this).closest(\'div\').remove()"></i></label> <span class=u-contact>{{uid}}</span> <input type=hidden name=targets[][uid] value="{{uid}}"/> <select name=targets[][accessType]:number> {{#seq 1 2}} <option {{#eq ../accessType .}}selected{{/eq}} value={{.}}>{{i18n (join "setting/lbl_calendarAccess_" . )}} {{/seq}} </select> </div>'})},1058:function(e,t,i){var n=i(499),a=i(465),s=i(468).get,l=s('user')||{},r=s('setting')||{},o=i(662),c=l.enablecellphonebinding;e.exports=o.all.get((function(e){n('setting.advance',{className:'m-sgadvance',overrides:{mboxshare:r.enablemboxshare,pop:r.enablePOPAgent&&a('setting/tab_popaccount'),smsnotification:l.enablesmsnotifysetting,translate:l.enableTranslate,mailpush:l.supportactivesync&&a('pref/eas_device'),bindmobile:c,loginnotification:(r.supportmsgnotify&&r.supportmsgnotifyfolder||r.supportsmsloginnotify&&c||r.supportapploginnotify)&&a('setting/tab_msgset'),hotkeys:l.supportShortcut,entrustManager:e[0]&&a('main/Maillist')}})}))},1059:function(e,t,i){i(1060),i(532);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(505),o=i(466),c=i(473),d=i(465),u=i(475),p=i(467),f=i(474),m=i(476),v=a.extend({Implements:l,attrs:{mboxShareAccount:[],mboxAccessAccount:[],editMode:!1},setup:function(){this.state=p.getCurrentState(),this.config={allEmails:p.getConfig('user.allEmails'),enableSecurityLevel:i(482).enabled}},render:function(){v.superclass.render.call(this),this._fetchData()},events:{'click [data-action]':'_dispatchAction','change.crc .j-switch':'_handleSetMboxVisible'},_fetchData:function(){var e=this;o.when(o.wmCall({url:'/XT5/jsp/setting.jsp',func:'mbox:getShareACL'}),o.wmCall({url:'/XT5/jsp/setting.jsp',func:'mbox:listSharedAccessMbox'})).then((function(t,i){t.forEach((function(e){e.hasHeadImage=e.hasHeadImage||'','1'==e.hasHeadImage&&(e.avatar=e.avatar+'&sid='+p.getSid()+'&uid='+e.uid+'&time='+(new Date).getTime()),e.sendText=d('setting/lbl_share_permission_'+e.send),e.name=e.name||d('setting/lbl_mboxUnknownName')})),i.forEach((function(e){e.hasHeadImage=e.hasHeadImage||'','1'==e.hasHeadImage&&(e.avatar=e.avatar+'&sid='+p.getSid()+'&uid='+e.email+'&time='+(new Date).getTime()),e.sendText=d('setting/lbl_share_permission_'+e.send)})),e.set('mboxShareAccount',t),e.set('mboxAccessAccount',i),e.element.mask('hide')}))},_dispatchAction:function(e,t){var i=n(t).data();switch(i.action){case'delete':this._handleDeleteMbox(i);break;case'create':this._handleCreateMbox();break;case'save':this._handleSaveMbox();break;case'edit':this._handleEditMbox(i);break;case'cancel':this.set('editMode',!1)}},_handleSetMboxVisible:function(e){var t={visible:e.target.checked,email:e.target.value};o.wmCall('mbox:setSharedAccessMboxVisible',t).then((function(){n.notify.success(d('setting/msg_mboxAccessAccountVisibleUpdateSuccess')),f.flush()}))},_handleDeleteMbox:function(e){var t=e.uid,i=this;r.confirm(c.h(d('setting/msg_mboxAccountDelConfirm'),t),(function(){var e={},a=i.get('mboxShareAccount'),s=n.grep(a,(function(e){return e.uid!=t}));n.each(s,(function(t,i){e[i.uid]={send:i.send,rw:i.rw}})),o.wmCall('mbox:putShareACL',{acl:e}).then((function(){i.set('mboxShareAccount',[],{silent:!1}),i.set('mboxShareAccount',s)}))}))},_handleCreateMbox:function(){var e=this;m.auth2continue(p.getLockOpValues().mboxShare).then((function(){var t=e.compile(e.$('#mboxShareAccountEditTpl').html(),'');e.$('.m-edit-share').html(t),e._contactAutoComplete(),e.element.customRadioCheckbox(),e.set('editMode',!0)}))},_handleSaveMbox:function(){var e,t=this.$('form[name=shareAccount]').serializeJSON({defaultType:'+I'}),i=this.get('mboxShareAccount'),a={},s=this,l=[];if(t.uid=n.trim(t.uid),!t.uid)return r.alert(d('setting/msg_inputEmpty'));if(!u.test(t.uid))return r.alert(d('setting/msg_errorEmailFormat'));for(e=0;e<this.config.allEmails.length;e++)if(t.uid==this.config.allEmails[e].addr)return r.alert(d('setting/msg_accountSharedToSelf'));for(e=0;e<i.length;e++)t.uid!=i[e].uid&&l.push(i[e].uid),a[i[e].uid]={send:i[e].send,rw:i[e].rw};var c='undefined'!=typeof a[t.uid];n.post(o.wmURL({url:'/XT5/checkUserForShare.jsp',uid:t.uid,userList:l.join(',')})).then((function(e){'S_OK'===e?(a[t.uid]={send:t.send==undefined?0:t.send,rw:1==t.send},o.wmCall('mbox:putShareACL',{acl:a}).then((function(){c?n.notify(d('setting/msg_mboxShareAccountUpdateSuccess')):n.notify(d('setting/msg_mboxShareAccountCreateSuccess')),s._fetchData(),s.set('editMode',!1)}))):r.alert(d('setting/msg_mboxShareAccountInvalid'))}))},_handleEditMbox:function(e){var t=this;m.auth2continue(p.getLockOpValues().mboxShare).then((function(){var i=e.uid,a=n.grep(t.get('mboxShareAccount'),(function(e){return e.uid==i}))[0],s=t.compile(t.$('#mboxShareAccountEditTpl').html(),a);t.$('.m-edit-share').html(s),t._contactAutoComplete(),t.element.customRadioCheckbox(),t.set('editMode',!0)}))},_contactAutoComplete:function(){var e=this;this.$('input[role=contact]').contactac({enableSecurityLevel:e.config.enableSecurityLevel,select:function(t){e.$('input[role=contact]').val(t.original.emailaddr)},width:256,zIndex:1e3})},_onRenderMboxShareAccount:function(e){var t=this.compile(this.$('#mboxShareAccountTpl').html(),{acl:e});this.$('.j-mboxShare').html(t)},_onRenderMboxAccessAccount:function(e){var t=this.compile(this.$('#mboxAccessAccountTpl').html(),{account:e});this.$('.j-mboxAccess').html(t).customRadioCheckbox()},_onChangeMboxShareAccount:function(e){var t=this.compile(this.$('#mboxShareAccountTpl').html(),{acl:e});this.$('.j-mboxShare').html(t)},_onChangeEditMode:function(e){this.$('.main-wrapper').toggleClass('toggled',e)}});s.module({name:'setting.advance.mboxshare',template:i(1061)},v)},1061:function(e,t){e.exports='<section class="m-mboxshare">\r\n  <div class="main-wrapper">\r\n    <div class="content-wrapper">\r\n      <div class="m-setting-info">\r\n        {{i18n \'setting/lbl_mboxShare_info\'}}\r\n      </div>\r\n\r\n      <div class="card-container j-mboxAccess grid-col12"></div>\r\n      <div class="card-container j-mboxShare grid-col12"></div>\r\n    </div>\r\n    \x3c!--[if lt IE 9]>\r\n    <div class="sg-mask" />\r\n    <![endif]--\x3e\r\n\r\n    \x3c!--添加 编辑共享邮箱信息 --\x3e\r\n    <div class="panel m-edit-share edit-panel u-scroll"></div>\r\n\r\n  </div>\r\n\r\n  {{#raw}}\r\n  \x3c!--邮箱共享显示模板--\x3e\r\n  <script type="text/x-handlebars-template" id="mboxShareAccountTpl">\r\n    <div class="title dotted">\r\n      <h4>[[i18n "setting/lbl_my_shared_mbox"]]</h4>\r\n    </div>\r\n    [[#each acl]]\r\n    <div class="m-share-card f-pr f-fl">\r\n      <i class="icontabclose iconfont" data-action="delete" data-uid="[[uid]]"></i>\r\n      <a href="#" class="u-img u-img-round f-fl">\r\n        <img src="[[avatar]]" alt="">\r\n      </a>\r\n      <div class="u-profile f-fl">\r\n        <h4 class="f-il f-ellipsis">[[name]]</h4>\r\n        <span class="uid f-ellipsis">[[uid]]</span>\r\n      </div>\r\n      <div class="privilege">\r\n        <div class="u-form-item">\r\n          <div class="f-fl">\r\n            <label class="u-form-label">{{i18n "setting/lbl_privilege"}}&nbsp;:</label>\r\n          </div>\r\n          <div class="u-form-value">\r\n            <label class="f-mgr">[[sendText]]</label>\r\n            <a href="javascript:void(0)" data-action="edit" data-uid="[[uid]]" >{{i18n "setting/op_edit"}}</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/each]]\r\n    <div class="m-addcard" data-action="create"><i class="iconadd iconfont"></i></div>\r\n  <\/script>\r\n\r\n  \x3c!--可访问的共享邮箱显示模板--\x3e\r\n  <script type="text/x-handlebars-template" id="mboxAccessAccountTpl">\r\n\r\n    [[#if account.length]]\r\n    <div class="title dotted">\r\n      <h4>[[i18n "setting/lbl_other_shared_mbox"]]</h4>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#each account]]\r\n    <div class="m-share-card accessBox f-pr f-fl">\r\n      <div class="accessBox-header">\r\n        <div class="mbox-toggle">\r\n          <input type="checkbox" class="j-switch" [[#unless hidden]] checked [[/unless]]  value="[[email]]" role="switchBtn">\r\n        </div>\r\n        <label class="mbox-toggle-label ">[[i18n \'setting/lbl_mbox_display_in_folder_list\']]</label>\r\n      </div>\r\n      <a href="#" class="u-img u-img-round f-fl">\r\n        <img src="[[avatar]]" alt="">\r\n      </a>\r\n      <div class="u-profile f-fl">\r\n        <h4 class="f-il f-ellipsis">[[name]]</h4>\r\n        <span class="uid f-ellipsis">[[email]]</span>\r\n      </div>\r\n      <div class="privilege">\r\n        <div class="u-form-item">\r\n          <div class="f-fl">\r\n            <label class="u-form-label">{{i18n "setting/lbl_privilege"}}&nbsp;:</label>\r\n          </div>\r\n          <div class="u-form-value">\r\n            <label class="f-mgr">[[sendText]]</label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/each]]\r\n  <\/script>\r\n\r\n  \x3c!--邮箱编辑模板--\x3e\r\n  <script type="text/x-handlebars-template" id="mboxShareAccountEditTpl">\r\n    <form action="#" name="shareAccount" onsubmit="return false;">\r\n      <div class="u-btns-top">\r\n        <button type="button" data-action="save" class="u-btn u-btn-primary">[[i18n "setting/op_share"]]</button>\r\n        <button type="button" data-action="cancel" class="u-btn u-btn-default">[[i18n "setting/op_cancel"]]</button>\r\n      </div>\r\n      [[#if uid]]\r\n      <h4 class="sub-header">[[i18n "setting/lbl_editMboxShareAccount"]]</h4>\r\n      [[else]]\r\n      <h4 class="sub-header">[[i18n "setting/lbl_createMboxShareAccount"]]</h4>\r\n      [[/if]]\r\n\r\n      <div class="u-form-item">\r\n        <div class="f-fl">\r\n          <label class="u-form-label">[[i18n "setting/lbl_mboxShareTo"]]&nbsp; :</label>\r\n        </div>\r\n        <div class="u-form-value">\r\n          [[#if uid]]\r\n          <input type="hidden" name="uid" class="u-input" value="[[uid]]"/>\r\n          <span>[[uid]]</span>\r\n          [[else]]\r\n          <input type="text" name="uid" class="u-input" value="" role="contact" placeholder="[[i18n \'pref/mboxShare/email_input_hint\']]"/>\r\n          [[/if]]\r\n          <span class="notify f-dn">[[i18n "setting/msg_errorEmailFormat"]]</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class="u-form-item">\r\n        <div class="f-fl">\r\n          <label class="u-form-label">[[i18n "setting/lbl_privilege"]]&nbsp; :</label>\r\n        </div>\r\n        <div class="u-form-value">\r\n            <select name="send" class="u-select">\r\n              <option value="0" [[#compare send "==" 0]]selected [[/compare]] >[[i18n "pref/mboxShare/share_permission_0"]]</option>\r\n              <option value="1" [[#compare send "==" 1]]selected [[/compare]] >[[i18n "pref/mboxShare/share_permission_1"]]</option>\r\n              <option value="2" [[#compare send "==" 2]]selected [[/compare]] >[[i18n "pref/mboxShare/share_permission_2"]]</option>\r\n            </select>\r\n        </div>\r\n      </div>\r\n    </form>\r\n    <div class="u-tips">\r\n      <h4>[[i18n "pref/personal/tips"]]&nbsp;:</h4>\r\n      <br />\r\n      <table class="m-info">\r\n        <colgroup>\r\n          <col width="150"/>\r\n          <col width="50"/>\r\n          <col width="160"/>\r\n          <col width="160"/>\r\n        </colgroup>\r\n        <thead>\r\n        <tr>\r\n          <th class="slash-wrapper">\r\n            <div class="slash">\r\n              <span class="ne">[[i18n "pref/mboxShare/table_th0_ne"]]</span>\r\n              <span class="sw">[[i18n "pref/mboxShare/table_th0_sw"]]</span>\r\n            </div>\r\n          </th>\r\n          <th>[[i18n "pref/mboxShare/table_th1"]]</th>\r\n          <th>[[i18n "pref/mboxShare/table_th2"]]</th>\r\n          <th>[[i18n "pref/mboxShare/table_th3"]]</th>\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n        <tr>\r\n          <td>[[i18n "pref/mboxShare/table_td1_1"]]</td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n        </tr>\r\n        <tr>\r\n          <td>[[i18n "pref/mboxShare/table_td2_1"]]</td>\r\n          <td><i class="iconfont icontabclose"></i></td>\r\n          <td><i class="iconfont icontabclose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n        </tr>\r\n        <tr>\r\n          <td>[[i18n "pref/mboxShare/table_td3_1"]]</td>\r\n          <td><i class="iconfont icontabclose"></i></td>\r\n          <td><i class="iconfont icontabclose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n        </tr>\r\n        <tr>\r\n          <td>[[i18n "pref/mboxShare/table_td4_1"]]</td>\r\n          <td><i class="iconfont icontabclose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n          <td><i class="iconfont iconchoose"></i></td>\r\n        </tr>\r\n        <tr>\r\n          <td>[[i18n "pref/mboxShare/table_td5_1"]]</td>\r\n          <td>--</td>\r\n          <td>[[i18n "pref/mboxShare/table_td5_3"]]</td>\r\n          <td>[[i18n "pref/mboxShare/table_td5_4"]]</td>\r\n        </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  <\/script>\r\n  {{/raw}}\r\n</section>'},1062:function(e,t,i){(function(e,t,n){i(1063);var a=i(463),s=i(472),l=i(471),r=i(470),o=r.alert,c=r.confirm,d=r.prompt,u=i(467),p=i(468).get,f=i(474),m=f.flushAllEmails,v=i(473).h,h=i(475),b=i(488).bytesToSize,g=i(479),_=i(476),y=_.popAccounts,w=y.get,k=y.flush,x=_.trimName,j=_.createFolders,S=function(t,i){return e.wmCall(t,i).onRTN(k)},C=e.wmBind('user:checkPOPAccount'),T=s.extend({},(function(i,s){var l,r,_=this,y=p('context.locale')||'',T=p('setting.maxPopAccount');function I(i){_.$().mask(),_.pubsub.off(),e.when(e.wmCall('user:flushPOPAccountStats'),w(),i||f.flush()).then((function(e,i){l=i,_.$('.j-popaccount').html(A.accountCardTpl({popAccount:l,maxCount:T})),_.$().mask('hide'),_.$('[data-account-id=\'all\']').prop('disabled',!l[0]),D(),_.subscribe('mail','fdr:changed',t.fn(I,1)).subscribe('dispatcher','url:changed',D)}))}function D(){var e=u.getCurrentState(),t=e.module,i=e.param;if(t===$){u.setCurrentState({module:t});var n={sync:1,progress:0}[i.action];null!=n&&R(n,i.id)}}function M(){if(l.length>=T)for(var e=0;e<2;e++)_.$('.m-pop-notify').fadeTo('fast',.5).fadeTo('fast',1);else F({})}function E(e){w((function(i){F(t.find(l=i,{id:e}))}))}function F(i){U('edit',A.editAccountTpl(i)),function(e){var t,i,s,l=[n('pref/pop/lastWeek'),n('pref/pop/last2Week'),n('pref/pop/lastMonth'),n('pref/pop/last2Month'),n('pref/pop/last3Month'),n('pref/pop/lastHalfYear')];'0'===(e=e?''+e:'0')?(t='<p class="u-explain"><label><input type="radio" name="limitDays" value="0" checked />'+n('pref/pop/allMails')+'</label></p>',a.each([7,14,30,60,90,183],(function(e,a){s=g().subtract(a,'days'),i='<p class="u-explain"><label><input type="radio" name="limitDays" value="-'+s.format('YYYYMMDD')+'" />'+l[e]+' ('+n('pref/pop/limitDaysLabel',{date:s.locale(y).format('LL')})+')</label></p>',t+=i}))):(t='<p class="u-explain"><label><input type="radio" name="limitDays" value="0" />'+n('pref/pop/allMails')+'</label></p>',i='<p class="u-explain"><label><input type="radio" name="limitDays" value="'+e+'" checked />'+n('pref/pop/limitDaysLabel',{date:g(e.substring(1),'YYYYMMDD').locale(y).format('LL')})+'</label></p>',t+=i);_.$('.j-limitDays').html(t)}(i.limitDays),function(i){var s=_.$('form').submit(!1).customRadioCheckbox(),l=!i.id,r=function(e){return s.find('[name='+e+']')},o=function(e,t,n){return r(e).rcCheck(i[e]||n||0).on('change.crc',t)},c=r('type'),d=r('server'),u=o('useSSL',j,l),f=o('delegatedSend',T),m=r('smtpHost'),v=o('smtpUseSSL',S,l),b={pop3:[/^imap/,'pop'],imap:[/^pop3?/,'imap']};(c[0].onchange=function(e){o('leaveOnServer',null,l),_.$('[name=fid][value=-1]').click(),_.$('.j-imap').toggle('imap'===c.val()),_.$('.j-pop3').toggle('pop3'===c.val()),j(e),d.val(t.fn(b[c.val()])(d.val()))})(),T(),o('acceptAllCerts',null,l);var g=r('username').keyup((function(){r('folderName').val(g.val())})).blur((function(){var e=g.val(),t=h.test(e);if(k(g,t),t){var i=e.split('@')[1]||p('user.uid').split('@')[1];d.val(d.val()||b[c.val()][1]+'.'+i),m.val(m.val()||'smtp.'+i)}})),y=_.$('.checkBtn').click((function(){var t;$()&&(t=$(),a.notify.success(n('setting/msg_checkingPOPAccount'),{forever:!0,closeIcon:!1}),C({item:t,checkSMTP:!!t.delegatedSend}).fin((function(t,i){var s=i||{},l=s.code,r=s.smtpFailCode,o=n.get('setting/msg_checkPOP_'+(t?'OK':r?'SMTP_'+r:l));(t?a.notify:a.notify.error)(o||n('setting/msg_popUnknownError')),o&&e.abort()})))})),w=_.$('.saveBtn').click((function(){$()&&(l?N:L)($())}));function k(e,t){e.closest('.u-form-item').toggleClass('error',!t),y.prop('disabled',!t),w.prop('disabled',!t)}function x(e,t,i,n,a,s){var o=t.is(':checked');(e||l)&&r(i).val(a[o?1:0]),n.html(a[o?1:0]),_.$(s).toggle(!o)}function j(e){x(e,u,'port',_.$('.defaultPort'),{pop3:[110,995],imap:[143,993]}[c.val()],'.j-useSSLTip')}function S(e){x(e,v,'smtpPort',a(),[25,994],'.j-smtpUseSSLTip')}function T(e){var t=f.is(':checked');_.$('.j-smtp').prop('disabled',!t),v.rcEnable(t),S(t&&e)}function $(){var e=s.serializeJSON({defaultType:'+B',checkboxUncheckedValue:!1}),t=_.$('.j-auth'),i=g.val().replace(/@.*/,''),n=i?!(e.id||e.password)&&_.$('.j-pwd'):g;if(!n){'-1'===e.fid&&delete e.fid;var a=t[0].checked;return(a^t[0].defaultChecked||g.val()!==g[0].defaultValue)&&(e.auth=a?i:''),e}k(n)}_.$('.j-truePwd').blur((function(){this.value||a(this).hide().prop('disabled',!0).siblings('input').show()})),_.$('.j-fakePwd').focus((function(){a(this).blur().hide().siblings('input').show().prop('disabled',!1).focus()}))}(i)}function P(e,t){c(v(n('setting/msg_popaccountDelConfirm'),t),(function(){S('user:deletePOPAccounts',{ids:[e],autoDeleteFolder:!0}).then((function(){a.notify.success(n('setting/msg_deletePOPaccountSuccess')),I(),m()}))}))}function N(e){S('user:createPOPAccounts',{items:e}).catchCode('FA_ACCOUNT_EXISTS',t.ary(o,1,n('setting/msg_popAccountExist'))).then((function(t){var i=t[0];a.notify.success(n('setting/msg_popAccountSucceed')),U(),I(),e.delegatedSend&&C({id:i,checkSMTP:!0,updateDelegatedSend:!0,autoUpdate:!0}).fin(m)}))}function L(e){var t;e.delegatedSend||(e.name='',e.smtpHost='',e.smtpPort='',e.smtpUseSSL=!1,e.smtpPassword=''),S('user:updatePOPAccounts',{items:[e]}).then((function(){U(),I(),e.delegatedSend&&(t=parseInt(e.id,10),C({id:t,checkSMTP:!0,updateDelegatedSend:!0,autoUpdate:!0}).fin(m))}))}function R(i,a){function s(e){l=e||l;var i=a?t.filter(l,{id:a}):l,s=e?[]:0;U('sync',function(e){return A.helpers({stat:function(t){var i,a=t.stats,s=t.limitDays,l=a||0,r=l.code,o=l.failedMessage,c=l.startTime,d=l.endTime,u=l.exceedQuota,p=l.userReject,f=l.messageSize,m=l.receivedMessageSize,h=l.skippedMessageSize,_=l.messageCount,w=l.receivedMessageCount,k=l.skippedMessageCount;if(r)if(e&&'PENDING'!==r){var x='S_OK'===r,j=(100*Math.min(x?1:(m+h)/f||0,1)).toFixed(2)+'%';i='<span class="f-ib f-fl">'+(o&&!/FA_BAD_PASSWORD|FA_BAD_CERT|FA_BAD_SERVER/.test(r)?v(n('pref/pop/NOT_VALID'),o):n('pref/pop/'+r))+'</span><div class="u-progress f-mgl f-ib f-vm f-fl"><div class=u-progress-bar style="width:'+j+'"></div></div>',c&&(i+='<p class="f-cb">'+n('pref/pop/startTime')+':&nbsp;&nbsp;'+g(c).format('YYYY-MM-DD HH:mm:ss')+'</p>'),d&&(i+='<p>'+n('pref/pop/endTime')+':&nbsp;&nbsp;'+g(d).format('YYYY-MM-DD HH:mm:ss')+'</p>'),x?i+='<p>'+v(n('pref/pop/receivedCount'),w)+' ('+n('pref/pop/timeLimits')+(s?n('pref/pop/limitDaysLabel',{date:g(s.toString().substring(1),'YYYYMMDD').locale(y).format('LL')}):n('pref/pop/allMails'))+')</p><p>'+n('pref/pop/receivedSize')+'&nbsp;'+b(m,2)+'</p>':(_&&(i+='<p>'+v(n('pref/pop/runningStatus'),_)+' '+b(f,2)+'</p>'),w&&(i+='<p>'+v(n('pref/pop/runningReceivedStatus'),[w,b(m,2),j])+'</p>')),k&&(i+='<p>'+(u||p?'(':'')+(u?n('pref/pop/exceedQuota'):'')+(u&&p?', ':'')+(p?n('pref/pop/userReject'):'')+(u||p?') ':'')+v(n('pref/pop/skipNM'),[k,b(h,2)])+'</p>')}else i=n('setting/msg_waitForSync');else i=n('setting/msg_popSyncNotTrigger');return e&&!d&&e.push(t),i}})}(s).syncStatusTpl(i)),r=s[0]&&setTimeout(o,1e3)}function o(){k(),w(s)}s(),i?e.wmCall('user:syncPOPAccounts',{ids:a?[a]:t.map(l,'id')}).then(o):o()}function O(){d(n('setting/msg_inputFolderName'),(function(e){var t={name:e,parent:0},i=x(t);'ok'===i?j([t]).then((function(e){var i=e[0];a.notify.success(n('setting/msg_createFolderSuccess')),_.$('select[name=fid]').append(a('<option value='+i+' selected/>').text(t.name)),I()})):a.notify.error(n('setting/msg_err_folder_'+i))}))}function U(e,t){_.$('.'+e+'-panel').html(t),_.$('.main-wrapper').attr('class','main-wrapper switched-'+e),r&&(clearTimeout(r),r=null)}_.events={'click [data-action]':[function(e,i){var n=i.closest('[data-]').data('')||0;({add:M,edit:E,'delete':P,sync:t.fn(R,1),syncAll:t.fn(R,1,0),statAll:t.fn(R,0,0),createFolder:O,cancel:t.fun(U)})[e](n.id,n.username)}]},i()(s),I()})),$='setting.advance.pop',A=i(1064);l.module({name:$,template:A},T)}).call(this,i(466),i(464),i(465))},1064:function(e,t,i){e.exports=i(469)('<section class="m-popaccount"> <div class="main-wrapper"> <div class="content-wrapper"> <div class="m-setting-info"> {{i18n \'setting/lbl_pop_info\'}} </div> <div class="popaccount j-popaccount"></div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="panel u-scroll m-edit-account edit-panel"></div> <div class="panel u-scroll m-sync-status sync-panel"></div> </div>    </section>',{accountCardTpl:'<div class="u-btns-top f-ib"> <button data-action=syncAll class="u-btn u-btn-default">{{i18n "setting/op_receiveAll"}}</button> <button data-action=statAll class="u-btn u-btn-default">{{i18n "setting/op_accountStat"}}</button> </div> <div class="card-container f-cf"> {{#each popAccount}} <div class="m-popcard f-pr" data-="{{json .}}"> <i class="icontabclose iconfont" data-action=delete></i> <div class="card-header"> <h4>{{username}}</h4> </div> <div class="card-body"> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/server"}}:</label> </div> <div class="u-form-value"> <label>{{server}}</label> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/username"}}:</label> </div> <div class="u-form-value"> <label>{{username}}</label> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/folderName"}}:</label> </div> <div class="u-form-value"> <label>{{lookup (folder$ fid) \'name\'}}</label> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "setting/lbl_isLeaveOnServer"}}:</label> </div> <div class="u-form-value"> <label>{{i18n (if$ leaveOnServer \'pref/pop/yes\' \'pref/pop/no\')}}</label> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "setting/lbl_pop_autosync"}}:</label> </div> <div class="u-form-value"> <label>{{i18n (if$ autoSync \'pref/pop/yes\' \'pref/pop/no\')}}</label> </div> </div> </div> <div class="card-footer"> <a class=f-csp data-action=sync>{{i18n "pref/pop/sync"}}</a> <a class=f-csp data-action=edit>{{i18n "pref/pop/modify"}}</a> </div> </div> {{/each}} <div class="m-pop-create"> <div class="m-addcard {{if$ (ge popAccount.length maxCount) \'m-addcard-disable\'}}" data-action=add> <i class="iconadd iconfont"></i> </div> <div class="m-pop-notify {{if$ (lt popAccount.length maxCount) \'f-dn\'}}"> <span class="u-notify-desc f-ib f-tac"> {{{i18n "prop:setting/msg_popAccountOverView" 0=maxCount }}} </span> </div> </div> </div>',editAccountTpl:'<form> <div class="u-btns-top"> <button class="u-btn u-btn-primary checkBtn">{{i18n "setting/op_check"}}</button> <button class="u-btn u-btn-primary saveBtn" >{{i18n "setting/op_save"}} </button> <button class="u-btn u-btn-default" data-action=cancel>{{i18n "setting/op_cancel"}}</button> </div> {{#if id}} <input type="hidden" name="id:number" value="{{id}}"/> {{/if}} <h4 class="sub-header">{{i18n "pref/pop/accountSetUp"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/mailaddress"}}</label> </div> <div class="u-form-value"> <input name=username class=u-input value="{{username}}" autocomplete=off> <span class="notify f-dn">{{i18n "setting/msg_errorEmailFormat"}}</span> </div> </div> <div class="u-form-item j-pwd"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/password"}}</label> </div> <div class="u-form-value"> {{#if id}} <input type="text" class="u-input j-fakePwd f-ib" value="*********" /> <input type="password" class="u-input f-dn j-truePwd" name="password" disabled /> {{else}} <input type="password" class="u-input" name="password" autocomplete="off"/> <span class="notify f-dn">{{i18n "setting/msg_checkPOPEmptyPwd"}}</span> {{/if}} </div> </div> <h4 class="sub-header">{{i18n "pref/pop/receiveSetUp"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/servername"}}</label> </div> <div class="u-form-value"> <input name=server class=u-input value="{{server}}"> <select class=u-select name=type {{#if type}}disabled{{/if}}> <option value="pop3" {{if$ (eq type "pop3") "selected"}}>POP3</option> {{#if @config.setting.enablePOPAgentIMAP}} <option value="imap" {{if$ (eq type "imap") "selected"}}>IMAP</option> {{/if}} </select> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/timeLimits"}}</label> </div> <div class="u-form-value f-fl j-limitDays"></div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/folder"}}</label> </div> <div class="u-form-value f-fl"> {{#if id}} <select name=fid class=u-select>{{fdrOptions fid=fid}}</select> <button data-action=createFolder class="u-btn u-btn-default">{{i18n "main/bt_createfolder"}}</button> {{^}} <p class=u-explain> <label class=f-fl><input type=radio name=fid value=-1>{{i18n "pref/pop/popCreateFolder"}}</label> <input class=u-input name=folderName> </p> <p class="u-explain j-pop3"> <label class=f-fl><input type=radio name=fid value=1>{{i18n "pref/pop/popInbox"}}</label> </p> <p class="u-explain j-imap"> <label class=f-fl><input type=radio name=fid value=0>{{i18n "pref/pop/rootFolder"}}</label> </p> {{/if}} </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/checkOptions"}}</label> </div> <div class="u-form-value u-single-item f-pr"> <div class="disabled-mask j-imap"></div> <label class="f-ib"> <input type=checkbox name=leaveOnServer value=true> <span>{{i18n "setting/lbl_pop_backup"}}</span> </label> &nbsp; <label class="f-ib"> <input type=checkbox name=autoSync value=true {{if$ autoSync \'checked\'}}> {{i18n "pref/pop/lbl_autosync"}} </label> <i class="iconfont iconinformation" title="{{i18n "pref/pop/propertyInfo"}}"></i> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/port"}}</label> </div> <div class="u-form-value f-fl"> <p class="u-explain"> <input name=port class=u-input value="{{port}}"> {{i18n "pref/pop/defaultport"}} <span class=defaultPort></span> </p> <div class="u-explain"> <label> <input type=checkbox name=useSSL> {{i18n "pref/pop/requires_secure_conn"}} <div class="j-useSSLTip notify_tips"> {{i18n "pref/pop/msg_not_use_ssl"}} </div> </label> </div> <p class="u-explain u-single-item"> <label> <input type=checkbox class=j-auth {{if$ auth \'checked\'}}> {{i18n "setting/lbl_exchangeServer"}} </label> </p> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/color"}}</label> </div> <div class="u-form-value f-fl"> <p> {{#seq 8}} <span class="square square-bg{{.}}"><input type=radio name=color value={{.}} {{#eq ../color .}}checked{{/eq}}/></span> {{/seq}} </p> <p class="color-info">{{i18n "pref/pop/colorInfo"}}</p> </div> </div> {{#if (and @config.setting.enablePOPAgentSMTP (not id))}} <h4 class="sub-header">{{i18n "pref/pop/sendSetUp"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label"></label> </div> <div class="u-form-value u-single-item"> <label> <input type=checkbox name=delegatedSend value=true> {{i18n "setting/lbl_enableSmtpDeliver"}} </label> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/name"}}: </label> </div> <div class="u-form-value"> <input class="u-input j-smtp" name=name value="{{name}}"> {{i18n "pref/pop/optional"}} </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/smtpHost"}}: </label> </div> <div class="u-form-value"> <input class="u-input j-smtp" name=smtpHost value="{{smtpHost}}"> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/smtpPort"}}: </label> </div> <div class="u-form-value f-fl"> <p class="u-explain"> <input class="u-input j-smtp" name=smtpPort value="{{smtpPort}}"> </p> <div class="u-explain f-pr"> <label> <input type=checkbox name=smtpUseSSL value=true> {{i18n "pref/pop/requires_secure_conn"}} <div class="j-smtpUseSSLTip notify_tips"> {{i18n "pref/pop/msg_not_use_ssl"}} </div> </label> </div> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/pop/smtpPassword"}}</label> </div> <div class="u-form-value"> <input class="u-input j-fakePwd j-smtp" value="{{if$ id \'*********\' (i18n \'pref/pop/notChange\')}}"> <input type=password name=smtpPassword class="u-input f-dn j-truePwd j-smtp" disabled> </div> </div> {{/if}} <h4 class="sub-header">{{i18n "setting/lbl_popAdvanceSet"}}</h4> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "setting/lbl_pop_timeout"}}</label> </div> <div class="u-form-value"> <input class=u-input name=timeout value={{or timeout 60}}> {{i18n "pref/pop/commend"}} <i class="iconfont iconinformation" title="{{i18n "pref/pop/timeoutInfo"}}"></i> </div> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "setting/lbl_pop_accept_all_certs"}}</label> </div> <div class="u-form-value u-single-item f-pr"> <label class="f-ib"> <input type=checkbox name=acceptAllCerts value=true> {{i18n "pref/pop/accept_all_certs"}} </label> </div> </div> </form>',syncStatusTpl:'<div class="u-btns-top"> <button data-action=cancel class="u-btn u-btn-primary">{{i18n "setting/op_back"}}</button> </div> <h4 class="sub-header"> {{i18n "setting/lbl_receiveEmail"}} </h4> <table> <thead> <tr> <td>{{i18n "pref/pop/h_serialNum"}}</td> <td>{{i18n "pref/pop/h_account"}}</td> <td>{{i18n "pref/pop/h_state"}}</td> </tr> </thead> <tbody> {{#each .}} <tr> <td>{{math @index "+" 1}}</td> <td>{{username}}</td> <td>{{{stat .}}}</td> </tr> {{/each}} </tbody> </table>'})},1065:function(e,t,i){(function(e){i(1066);var t=i(534),n=i(463),a=i(472),s=i(471),l=i(470).alert,r=i(465),o=i(475),c=i(498),d=i(467),u=i(476),p=i(1067),f=a.extend({},(function(){var a=this;a.events={'click [data-action]':[function(t){switch(t){case'save':var i,s=a.$('input[name="interval"]:checked').val();'custom'===s?(i=[],a.$('input[name="customInterval"]:checked').each((function(){i.push(n(this).val())})),i=i?i.join(','):''):i=a.common[s];var c=e.map(o.parse(h().val()),'address'),d='',p='';if(h().is('[name=whiteContent]')?d=c.join():p=c.join(),!c.every((function(e){return o.test(e)||o.isValidDomain(e.replace(/^\./,''))})))return l(r('setting/msg_smsnotification_wblist_error'));var f={attrs:{notify:1==a.$('input[name=\'notify\']:checked').val(),sms_filter:{datefrom:a.$('select[name=\'datefrom\'] option:selected').val(),dateto:a.$('select[name=\'dateto\'] option:selected').val(),minfrom:a.$('select[name=\'minfrom\'] option:selected').val(),minto:a.$('select[name=\'minto\'] option:selected').val(),interval:i,enable:1,black:p,white:d}}};u.setSMSAttrs(f).then((function(){v(),n.notify(r('setting/msg_saveSmsNotificationSuccess'))})).onFail((function(){n.notify(r('setting/msg_saveSmsNotificationFail'))}));break;case'cancel':v()}}],'click [name=interval]':b,'click [name=WBList]':g};var s=i(1068).helpers({timeOptionCreater:function(e,t,i,a,s){a||(a=s);for(var l='',r=t;r<=i;r++)l+=n('<option>',{text:r,selected:r==a,value:r})[0].outerHTML;return l},formatResource:function(){var e=arguments[0]||'';if(e.length>0)for(var t=1;t<arguments.length-1;t++)e=e.replace(new RegExp('\\{'+(t-1)+'\\}'),arguments[t]);return r(e)},customIntervalCheck:function(e,t,i){return'custom'==i&&-1!=t.indexOf(e)?'checked="checked"':''}}),f=s.unbindMobileTpl,m=s.mmsSettingTpl;function v(){n.when(p.getUserSmsAttrs()).then((function(i){if(a.notify=i.notify,a.cellNumber=i.cellNumber,a.sms_filter=i.sms_filter||{},a.sms_filter.interval){for(var s=a.common.type,o=0;o<s.length;o++){if(a.common[s[o]]===a.sms_filter.interval){a.sms_filter.intervalType=s[o];break}}a.sms_filter.intervalType||(a.sms_filter.intervalType='custom')}else a.sms_filter.interval=a.common.everyday,a.sms_filter.intervalType='everyday';var d;a.sms_filter.enableWhite=!a.sms_filter.white||a.sms_filter.white.length>0,a.sms_filter.enableBlack=!!a.sms_filter.black&&a.sms_filter.black.length>0,d=a.$().addClass('m-smsnotification'),a.cellNumber?(d.html(m(a)),a.$('.mobileRecTimeSet .u-select').each((function(){c({maxHeight:170,trigger:n(this)})})),a.config.isEnableAddedFromOab&&t(a.$(),{trigger:['[data-action=addFromContact]',function(){return{input:h()}}],onSelect:function(t,i){var n=e.mapFilter(t,(function(e){return e.addr!==a.email&&e.isUser?e.addr:t=0})),s=function(){i.val(n.join())};t?s():l(r('setting/msg_mobileFilter_addWBlist_Err')).then(s)}}),d.customRadioCheckbox(),b(),g()):d.html(f(a))}))}function h(){return a.$('textarea[name='+a.$('input[name=WBList]:checked').val()+'Content]')}function b(){a.$('.customInterval').toggle('custom'===a.$('input[name=interval]:checked').val())}function g(){var e='white'===a.$('input[name=WBList]:checked').val();a.$('textarea[name=blackContent]').prop('disabled',e),a.$('textarea[name=whiteContent]').prop('disabled',!e),a.$('.blackDiv a').toggle(!e),a.$('.whiteDiv a').toggle(e)}a.email=d.getUser().primary_email,a.config={enableCellphoneBinding:d.getConfig('user.enablecellphonebinding'),enableSMSNotifySetting:d.getConfig('user.enablesmsnotifysetting'),enableSMSFilter:d.getConfig('user.enablesmsfilter'),isEnableAddedFromOab:d.getConfig('contact.enableaddedfromoab')&&(d.getConfig('user.supportpab')||d.getConfig('user.supportoab'))},a.common={type:['everyday','MonToFri','MonToSat','Weekend','custom'],everyday:'1,2,3,4,5,6,7',MonToFri:'1,2,3,4,5',MonToSat:'1,2,3,4,5,6',Weekend:'6,7',custom:'custom',customDays:[1,2,3,4,5,6,7]},a.after('render',v)}));s.module({name:'setting.advance.smsnotification'},f)}).call(this,i(464))},1067:function(e,t,i){var n=i(463),a=i(497),s=i(467);e.exports={getUserSmsAttrs:function(){var e=n.Deferred();return a.xhr.simpleCall({query:{func:'user:getSMSAttrs',sid:s.getSid()}},(function(t){e.resolve(t)}),(function(t,i,n){e.reject(n)})),e.promise()}}},1068:function(e,t,i){e.exports=i(469)('',{unbindMobileTpl:'<div id="unbindMobile" class="content-wrapper"> <div class="content"> <div class="grid-col12 j-pwd-info"> <div class="u-form-item"> {{#if config.enableCellphoneBinding}} {{{i18n "prop:pref/mobile/pleasebind" 0=(join "<a href=\'#setting.advance.bindmobile\'>" (i18n "pref/mobile/gobinding") "</a>")}}} {{else}} <div class="u-not-phone"> <i class="icon iconfont u-not-phone-icon">&#xe662;</i> {{i18n "pref/mobile/contactAdmin"}} </div> {{/if}} </div> </div> </div> </div>',mmsSettingTpl:'<div class="content-wrapper" id="mmsSetting"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button> <button type="button" class="u-btn u-btn-default" data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <div class="notifyConf"> <div class="title dotted"> <h4>{{i18n "setting/lbl_smsnotification"}}</h4> </div> <div class="u-form-item"> <label class="u-form-label f-dis">{{i18n "pref/mobile/isopen"}} </label> <div class="u-form-value"> <div> <label> <input type="radio" name="notify" value="1" {{#compare notify \'==\' true}} checked="checked" {{/compare}} /> {{i18n "pref/mobile/yes"}} </label> </div> <div> <label> <input type="radio" name="notify" value="0" {{#compare notify \'==\' false}} checked="checked" {{/compare}}/> {{i18n "pref/mobile/no"}} </label> </div> </div> </div> </div> {{#if config.enableSMSFilter}} <div class="mobileRecTimeSet"> <div class="title dotted"> <h4>{{i18n "pref/mobile/receive_time"}}</h4> </div> <div class="u-form-item f-rel"> <label class="u-form-label f-dis">{{i18n "pref/mobile/time"}} :&nbsp;&nbsp;</label> <select name="datefrom" class="u-select j-select-beginHour"> {{{timeOptionCreater \'datefrom\' 0 23 sms_filter.datefrom 0}}} </select> <span class="f-dis">&nbsp;:&nbsp;</span> <select name="minfrom" class="u-select j-select-beginHour"> {{{timeOptionCreater \'minfrom\' 0 59 sms_filter.minfrom 0}}} </select> <span class="f-dis">&nbsp;~&nbsp;</span> <select name="dateto" class="u-select j-select-beginHour"> {{{timeOptionCreater \'dateto\' 0 23 sms_filter.dateto 23}}} </select> <span class="f-dis">&nbsp;:&nbsp;</span> <select name="minto" class="u-select j-select-endHour"> {{{timeOptionCreater \'minto\' 0 59 sms_filter.minto 59}}} </select> </div> <div class="u-form-item"> <label class="u-form-label f-dis">{{i18n "pref/mobile/date"}} :&nbsp;&nbsp;</label> <div class="u-form-value"> {{#each common.type}} <div> <label> <input type="radio" name="interval" value="{{this}}" id="{{this}}" {{#compare this \'==\' @root.sms_filter.intervalType}} checked="checked" {{/compare}} /> {{formatResource "pref/mobile/interval_{0}" this}} </label> </div> {{/each}} <div class="customInterval"> {{#each common.customDays}} <span> <label> <input type="checkbox" name="customInterval" value="{{this}}" {{{customIntervalCheck this @root.sms_filter.interval @root.sms_filter.intervalType}}}/> {{formatResource "pref/mobile/interval_day_{0}" this}} </label> </span> {{#compare this \'==\' 5}} <br/> {{/compare}} {{/each}} </div> </div> </div> </div> <div class="mobileMailFilter"> <div class="title dotted"> <h4>{{i18n "pref/mobile/phone_email_filter"}}</h4> </div> <div class="u-form-item"> <div class="WBListDiv"> <div class="whiteDiv"> <label> <input type="radio" name="WBList" value="white" {{#compare sms_filter.enableWhite \'==\'true}}checked="checked"{{/compare}}/> {{i18n "pref/mobile/white_list"}} ( {{i18n "pref/mobile/white_list_desc"}} ) </label> {{#if config.isEnableAddedFromOab}} <a href="javascript:void(0)" data-action=addFromContact class="iconfont iconadd" title="{{i18n "setting/op_addFromContact"}}"></a> {{/if}} </div> <div> <textarea name="whiteContent" cols="50" rows="5">{{sms_filter.white}}</textarea> </div> </div> <div class="WBListDiv"> <div class="blackDiv"> <label> <input type="radio" name="WBList" value="black" {{#compare sms_filter.enableBlack \'==\'true}}checked="checked"{{/compare}}/> {{i18n "pref/mobile/black_list"}} ( {{i18n "pref/mobile/black_list_desc"}} ) </label> {{#if config.isEnableAddedFromOab}} <a href="javascript:void(0)" data-action=addFromContact class="iconfont iconadd" title="{{i18n "setting/op_addFromContact"}}"></a> {{/if}} </div> <div> <textarea name="blackContent" cols="50" rows="5">{{sms_filter.black}}</textarea> </div> </div> <div class="desc"> <label class="u-form-label f-dis">{{i18n "pref/mobile/description"}} :&nbsp;&nbsp;</label> <div> {{i18n "pref/mobile/emaillist_desc"}} </div> <br/> <label class="u-form-label f-dis">{{i18n "pref/mobile/emaillist_desc2"}} :&nbsp;&nbsp;</label> <div> {{i18n "pref/mobile/emaillist_desc2_detail_1"}} <br/> {{i18n "pref/mobile/emaillist_desc2_detail_2"}} <br/> {{i18n "pref/mobile/emaillist_desc2_detail_3"}} </div> </div> </div> </div> {{/if}} </div>'})},1069:function(e,t,i){(function(t,n){i(1070);var a=i(472),s=i(471),l=i(468).get,r=i(467),o=i(465),c=i(1071).helpers({selectOption:function(e,t){return e.map((function(e){return new Option(e.text,e.key,e.key===t).outerHTML})).join('')}}),d=a.extend({},(function(){var e=this;e.after('render',(function i(){var a=r.getUser(),s=(a.translate_condition||'').split(',');e.$().html(c.translateTpl({originalLanguages:l('user.originalLanguages').map((function(e){return{key:e,text:o('pref/translate/translate_'+e)}})),targetLanguages:l('user.targetLanguages').map((function(e){return{key:e,text:o('pref/translate/translate_'+e)}})),translate:a.translate,original:s[0]||'en',target:s[1]||'zh'})),e.$().customRadioCheckbox(),e.$('[data-action=cancel]').click(i),function(e){var i=e.$('.j-select-original').change(l),a=e.$('.j-select-target').change(l),s=e.$('.j-translate-toggle').on('change.crc',t.fn(c,!0));function l(){var t=i.val()===a.val();e.$('.j-error').html(t&&o('pref/translate/translate_same_language')),c(!t)}function c(t){e.$('.disable-mask').toggle(!s[0].checked),e.$('.u-btn-primary').prop('disabled',!t)}c(),e.$('[data-action=save]').click((function(){r.updateUser({translate:s[0].checked?1:0,translate_condition:i.val()+','+a.val()}).then((function(){n.notify(o('pref/translate/info_update_success')),c()}))}))}(e)}))}));s.module({name:'setting.advance.translate',template:c},d),e.exports=d}).call(this,i(464),i(463))},1071:function(e,t,i){e.exports=i(469)('<section class="m-translate content-wrapper"></section>',{translateTpl:'<form> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n \'setting/op_save\'}}</button> <button type="reset" class="u-btn u-btn-default" data-action="cancel">{{i18n \'setting/op_cancel\'}}</button> </div> <div class="u-form-item u-form-item-switch f-cf"> <label class="u-form-label">{{i18n \'setting/lbl_translate\'}} :&nbsp;&nbsp;</label> <span class="switch-btn f-ib"> <input type="checkbox" name="translate" role="switchBtn" class="j-translate-toggle" value="1" {{if$ (ge translate 1) \'checked\'}} /> </span> </div> <div class="disable-mask"></div> <div class="u-form-item f-pr"> <label class="u-form-label">{{i18n "pref/translate/translate_orginal"}} :&nbsp;&nbsp;</label> <select name="original" class="u-select j-select-original"> {{{selectOption originalLanguages original}}} </select> <div class="error j-error"></div> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "pref/translate/translate_target"}} :&nbsp;&nbsp;</label> <select name="target" class="u-select j-select-target"> {{{selectOption targetLanguages target}}} </select> </div> </form>'})},1072:function(e,t,i){(function(e,t,n,a){var s=i(473),l=i(472),r=i(471),o=i(474),c=i(476),d=i(489)['default'],u=i(467),p=i(498);r.module({name:'setting.advance.mua',template:'<div class=m-st-mua-wrap>'},l.extend({},(function(){var l=this;function r(){e.when(c.optAttrs(['smtp_save_sent','pop_limit_day','imap_limit_day']),o.fdrList()).then(f)}function f(m,v){var h=t.groupBy(v,(function(e){return 5===e.id?0:e.flags.system?2:1}),[]),b=h[0],g=h[1],_=t.mapValues({other:g,junk:b},(function(e,i){return{pop:e&&t.every(e,'flags.pop3'),txt:n('setting/lbl_pop3set.'+i),arr:e}}));d(l.$().html(i(1073)(t.assign({pop3:_},m))));var y=p({width:160,parentNode:l.$(),trigger:l.$('.j-limit'),model:[-30,-90,-365,-730,0],value:m.pop_limit_day||0,format:function(e,t){return s(n(e?'mbox/date_option_'+(['1m','3m','1y','2y'][t]||'n'):'common/op_all'),-e)}});l.$('[data-action=cancel]').click(t.fn(f,m,v)),l.$('[data-action=save]').click((function(){var i,s=(g||[]).concat(b||[]).map((function(e){var t=l.$(5===e.id?'#junk':'#other')[0].checked;return{id:e.id,flags:{pop3:t}}})),d=y.getValue();l.pubsub.off(),e.when(u.updateUser(t.pick((i={},i.smtp_save_sent=l.$('input[name="smtp_save_sent"]').is(':checked')?1:0,i.pop_limit_day=d,i.imap_limit_day=d,i),t.keys(m))),c.updateFolders(s).then(o.flush)).then(r).then(t.fn(a.notify,n('setting/msg_prefUpdateSuccess')))})),l.resubscribe('mail','fdr:changed',r)}l.after('render',r)})))}).call(this,i(466),i(464),i(465),i(463))},1073:function(e,t,i){e.exports=i(469)('<div class="m-st-mua content-wrapper"> <div class=u-btns-top> <button type=button class="u-btn u-btn-primary" data-action=save>{{i18n "setting/op_save"}}</button> <button type=reset class="u-btn u-btn-default" data-action=cancel>{{i18n "setting/op_cancel"}}</button> </div> <div class="title dotted"> <h4>{{i18n \'setting/lbl_mua_recv_option\'}}</h4> </div> {{#each pop3}} <div class="list-item"> <label><input type=checkbox class=u-input id={{@key}} {{if$ pop \'checked\' (if$ arr \'\' \'disabled\')}}>{{txt}}</label> <span style="color: #888">{{i18n \'prop:setting/msg_only_apply_to\' 0=\'POP3\'}}</span> </div> {{/each}} {{#if (has pop_limit_day)}} <div class="list-item"> <span class="label">{{i18n \'setting/lbl_mua_recv_range\'}}:</span> <a class=j-limit></a> <span style="color: #888">{{i18n \'prop:setting/msg_only_apply_to\' 0=(if$ (has imap_limit_day) \'POP3, IMAP\' \'POP3\')}}</span> </div> {{/if}} {{#if (has smtp_save_sent)}} <div class="title dotted"> <h4>{{i18n \'setting/lbl_mua_send_option\'}}</h4> </div> <div class="list-item"> <div> <label> <input type="checkbox" name="smtp_save_sent" {{if$ (eq smtp_save_sent 1) \'checked\'}} /> {{i18n \'setting/smtp_save_sent_text\'}} </label> </div> </div> {{/if}} </div>',{})},1074:function(e,t,i){(function(e,t){var n=i(463),a=i(479),s=i(465),l=i(472),r=i(471),o=i(470).confirm,c=i(467),d=l.extend({},(function(i,l){var r=this;r.events={'click [data-collapse]':[e.stop((function(e,t){var i=t.find('i.collapse-toggle');if((e=r.$(e)).hasClass('collapsing'))return;e.hasClass('in')?(e.addClass('collapsing'),e.hide(350,(function(){e.removeClass('in').removeClass('collapsing'),i.removeClass('iconup').addClass('icondown')}))):(e.addClass('in').addClass('collapsing'),e.show(350,(function(){i.removeClass('icondown').addClass('iconup'),e.removeClass('collapsing')})))}))],'click [data-action]':[{wipe:function(i){var l={max:5,current:0,lastTryDate:null,tryInterval:6e4};_(l)?g(s('pref/mobile/eas.wipe_device.title'),s('setting/msg_easWrongPassForbidden',{seconds:Math.floor((l.tryInterval-a().diff(l.lastTryDate))/1e3)})):v((function(){var i=n(this.form),r=i.serializeJSON(),o=a();h(i,r)&&t.wmCall('user:wipeActiveSyncDevice',e.pick(r,['password','deviceId'])).then((function(){n.notify.success(s('setting/msg_easWipeDeviceSuccess')),m(),y(l),p()})).onFail((function(){b(i,s('setting/msg_easWrongPass')),l.current++,l.lastTryDate=o,l.current>=l.max&&g(s('pref/mobile/eas.action.recoveryPassword'),s('setting/msg_easWrongPass')+s('setting/msg_easWrongPassForbidden',{seconds:l.tryInterval/1e3}))}))}),i.attr('data-deviceID'),s('pref/mobile/eas.wipe_device.title'),s('setting/msg_easWipe_deviceTips'));k()},recoverPass:function(i){var l={max:5,current:0,lastTryDate:null,tryInterval:6e4};_(l)?g(s('pref/mobile/eas.action.recoveryPassword'),s('setting/msg_easWrongPassForbidden',{seconds:Math.floor((l.tryInterval-a().diff(l.lastTryDate))/1e3)})):v((function(){var i=n(this.form),r=i.serializeJSON(),o=a();h(i,r)&&t.wmCall('user:showRecoveryPassword',e.pick(r,['password','deviceId'])).then((function(e){var t=s('pref/mobile/eas.action.recoveryPassword'),i=e&&e.password||s('pref/mobile/eas.recoveryPassword.emptyResult');y(l),g(t,i)})).catchCode('FA_UNAUTHORIZED',(function(){b(i,s('setting/msg_easWrongPass')),l.current++,l.lastTryDate=o,l.current>=l.max&&g(s('pref/mobile/eas.action.recoveryPassword'),s('setting/msg_easWrongPass')+s('setting/msg_easWrongPassForbidden',{seconds:l.tryInterval/1e3}))}))}),i.attr('data-deviceID'),s('pref/mobile/eas.action.recoveryPassword'),s('pref/mobile/eas.recoveryPassword.checking'));k()},remove:function(e){o(s('pref/mobile/eas.tips_remove_device'),(function(){t.wmCall('user:removeActiveSyncDevice',{deviceId:e.attr('data-deviceID')}).then((function(){n.notify.success(s('setting/msg_easDeviceRemoveSuccess')),p()})).onFail((function(){n.notify.error(s('setting/msg_easDeviceRemoveFailed'))}))}))},cancel:m,cancelWipe:function(e){t.wmCall('user:cancelWipeActiveSyncDevice',{deviceId:e.attr('data-deviceID')}).then((function(){n.notify.success(s('setting/msg_easWipeDeviceCancelSuccess')),p()})).onFail((function(){n.notify.error(s('setting/msg_easWipeDeviceCancelFailed'))}))}},n]},i()(l);var d=r.$('#synActionTplContainer');function p(){t.wmCall({url:'XT5/jsp/setting.jsp',func:'user:getActiveSyncDeviceInfos'}).then(f).onFail((function(){n.notify.error(s('setting/msg_easDeviceFetchFail'))}))}function f(e){r.$('.m-st-client-mailpush-statement').html(u.clientMailPushStatementTpl({cnt:e.length,max:c.getConfig('user.activeSyncDeviceCountLimit')})),r.$('.m-st-client-mailpush-list').html(u.clientMailPushListTpl({pushDevices:e,enableRemoteWipe:c.getConfig('user.enableremotewipe')}))}function m(){x(),d.empty()}function v(t,i,n,a){d.html(u.checkPassTpl({deviceId:i,header:n,label:a})).find(':submit').click(e.stop(t))}function h(e,t){return t.password?(b(e),!0):(b(e,s('setting/msg_easMissPass')),!1)}function b(e,t){e.find('.u-form-item').toggleClass('error',!!t),e.find('.u-form-explain').html(t).toggleClass('f-dn',!t)}function g(e,t){d.html(u.infoPanelTpl({title:e,content:t}))}function _(e){var t=a(),i=!1,n=!1;return e.current<e.max?i=!1:e.lastTryDate?t.diff(e.lastTryDate)<e.tryInterval?i=!0:(n=!0)&&(i=!1):(i=!1,n=!0),n&&(y(e),i=!1),i}function y(e){e.current=0,e.lastTryDate=null}c.getConfig('user.supportactivesync')&&p();var w=[!0,!1].map(e.fn(e.fun,n().toggleClass,['toggled',e],r.$('.main-wrapper'))),k=w[0],x=w[1]})),u=i(1075);r.module({name:'setting.advance.mailpush',template:u},d)}).call(this,i(464),i(466))},1075:function(e,t,i){e.exports=i(469)('<div class="m-st-client-mailpush-wrap grid-row"> <div class="main-wrapper grid-col12"> <div class="content-wrapper"> <div class="m-setting-info"> {{i18n \'setting/lbl_mailpush_info\'}} </div> <div class="mailpush-content"> <section class="m-st-client-mailpush-statement"> </section> <section class="m-st-client-mailpush-list u-scroll"> </section> </div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="m-st-client-mailpush-panel panel u-scroll" id="synActionTplContainer"></div> </div> </div>',{clientMailPushStatementTpl:'<p> {{{i18n (if$ cnt "setting/msg_easDeviceSummary" "setting/msg_easDeviceSummaryEmpty") cnt=cnt}}} {{{i18n "setting/msg_easDeviceSummaryMax" max=max}}} </p> <p> {{{i18n "pref/mobile/eas_hint_1"}}} </p>',clientMailPushListTpl:'<ul class="u-list"> {{#each pushDevices}} <li> <div class="u-box" data-active="true"> <div class="u-box-head"> <h3> {{or deviceInformation.Model deviceType (i18n \'pref/mobile/eas.unknownDevice\')}} </h3> {{#if WIPE}} {{#if (eq WIPE "OK")}} <p>{{i18n "pref/mobile/eas.syncState.WIPE_OK"}}</p> {{/if}} {{#if (eq WIPE "PENDING")}} <p> <span class="highlight_error">{{i18n "pref/mobile/eas.syncState.WIPE_PENDING"}}</span> {{#if wipeIssueTime}} <span>{{i18n "setting/msg_easWipeDeviceIssueTime"}}{{GetDateYMDHm wipeIssueTime}}</span> {{/if}} <a class=f-csp data-action=cancelWipe data-deviceID="{{id}}"> {{i18n "pref/mobile/eas.action.cancel_wipe"}} </a> </p> {{/if}} {{else}} <p>{{i18n "pref/mobile/eas.syncState.OK"}}</p> {{/if}} <p>{{i18n "pref/mobile/eas.deviceId"}}: {{id}}</p> </div> <div class="u-box-container collapse" id="deviceID_{{id}}_detail"> {{#if (eq WIPE "OK")}} <p>{{i18n "pref/mobile/eas.syncState.WipeNote"}}</p> {{else}} {{#if lastSyncTime}} <p>{{i18n "pref/mobile/eas.lastSyncTime"}}: {{GetDateYMDHm lastSyncTime}}</p> {{/if}} {{#if firstSyncTime}} <p>{{i18n "pref/mobile/eas.firstSyncTime"}}: {{GetDateYMDHm firstSyncTime}}</p> {{/if}} {{#if userAgent}} <p>{{i18n "pref/mobile/eas.userAgent"}}: {{userAgent}}</p> {{/if}} {{#seq \'FriendlyName\' \'Model\' \'OS\' \'IMEI\' as |key|}} {{#with (lookup ../deviceInformation key)}} <p>{{i18n (join \'pref/mobile/eas.deviceInformation.\' key)}}: {{this}}</p> {{/with}} {{/seq}} {{/if}} </div> <div class="mailpush-action"> <a class=f-csp data-action=recoverPass data-deviceID={{id}}>{{i18n "pref/mobile/eas.action.recoveryPassword"}}</a> <a class=f-csp data-action=remove data-deviceID={{id}}>{{i18n "pref/mobile/eas.action.remove"}}</a> {{#if (and (not WIPE) ../enableRemoteWipe)}} <a class=f-csp data-action=wipe data-deviceID={{id}}>{{i18n "pref/mobile/eas.action.wipe"}}</a> {{/if}} </div> <a class=f-csp data-toggle=collapse data-collapse="#deviceID_{{id}}_detail"> <i class="collapse-toggle icondown"></i> </a> </div> </li> {{/each}} </ul>',checkPassTpl:'<form name=checkPasswordForm> <div class="u-btns-top"> <button type=reset data-action="cancel" class="u-btn u-btn-default">{{i18n \'setting/op_cancel\'}}</button> </div> <h4 class="sub-header">{{header}}</h4> <label class="label">{{{label}}}</label> <div class="u-form-item"> <div class="u-input-control"> <span class="u-input-container"> <input type="password" name="password"/> </span> <span class="iconfont iconlock"></span> <button type=submit class="u-btn u-btn-primary">{{i18n "setting/op_confirm"}}</button> <input type="hidden" name="deviceId" value="{{deviceId}}" /> </div> <p class="u-form-explain f-dn"></p> </div> </form>',infoPanelTpl:'<div class="u-btns-top"> <button type=reset data-action="cancel" class="u-btn u-btn-default">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header">{{title}}</h4> <p>{{{content}}}</p>'})},1076:function(e,t,i){(function(e){i(1077);var t=i(463),n=i(472),a=i(471),s=i(465),l=i(473),r=i(476),o=i(623).newTempSession,c=i(466),d=i(524),u=i(585),p=i(468).get,f=i(508),m=i(470).confirm,v=n.extend({},(function(){var n,a=this,v=!1,g=!1,_='';function y(){_?(a.$('.j-operation').html(b.operationTpl({toUpdate:!1})),a.$('.j-main').html(b.mobileBoundTpl({cellNumber:_}))):w(!0)}function w(e){S().then((function(i){var n,r,o,c;a.$('.j-operation').html(b.operationTpl({toUpdate:!0,toBind:e})),a.$('.j-main').html(b.updateMobilePhoneTpl({vcImageSrc:i,tip:(n=+p('setting.tempSessionTime'),r=n/60|0,o=n%60,l(s('pref/mobile/sms_verify_code_tip'),l(s('pref/mobile/seconds_fmt').split('|')[r&&o?0:r?1:2],[r,o]))),toBind:e,cellNumber:_})),c=['verifyCode','cellNumber','smsVerifyCode'].map((function(e){var t={name:e,rules:'required',display:s('pref/mobile/msg_'+e+'_error')};return'cellNumber'===e&&(t.rules+='|regexp_cellNumber',t.regexp_cellNumber=d.regExp(),t.display+='|'+t.display),t})),new u('mobileBind',c,(function(e){var i=e.errors;g&&(i=i.filter((function(e){var t=e.name;return['verifyCode','cellNumber'].includes(t)})),g=!1),v=i.length>0,a.$('.u-form-item').removeClass('error').find('.j-form-explain').html(''),v&&i.forEach((function(e){var i=e.element,n=e.message;t(i).closest('.u-form-item').addClass('error').find('.j-form-explain').html(n)}))}))}))}function k(){if(a.$('.j-bind-form').submit(),!v){var e=a.$('.j-bind-form').serializeJSON(),i=e.cellNumber,n=void 0===i?'':i,l=e.smsVerifyCode,o=!!n;r.setSMSAttrs({attrs:{cellNumber:n},verifyCode:l}).then((function(){_=n,t.notify.success(s(o?'pref/mobile/msg_bind_succeed':'pref/mobile/msg_unite_succeed')),y()})).catchCode('FA_INVALID_VERIFY_CODE',(function(){a.$('.j-sms-code-explain').html(s('pref/mobile/msg_smsVerifyCode_error')).closest('.u-form-item').addClass('error')})).catchCode('FA_NEED_VERIFY_CELL',(function(){x(),t.notify.error(s('pref/mobile/msg_smsVerifyCode_fail'))}))}}function x(){S().then((function(e){a.$('.j-verify-code').attr('src',e)}))}function j(){var e=a.$('.j-send-code');i(496)(e,e,59,s('login/resend'))}a.after('render',(function(){r.getSMSAttrs().then((function(e){var t=e.cellNumber;_=t||'',y()}))})),a.events={'click [data-action]':[{bind:k,cancel:y,toUntie:function(){c.resolve(f.authConfig.SMS&&f.queryAuthInfo().then(e.prop('cellNumber'))).truthy().then((function(){m(s('pref/mobile/msg_confirm_cancel_bind'),{onConfirm:function(){i(477).go('setting.security.twofactorauth')},confirmTpl:s('pref/mobile/btn_confirm_cancel')})})).onFail(w.bind(0,!1))},untie:k,refresh:x,sendSmsVerifyCode:function(){if(g=!0,a.$('.j-bind-form').submit(),v)return;var e=a.$('.j-bind-form').serializeJSON(),i=e.cellNumber,l=e.verifyCode,o=function(e){r.sendVerifyCode({cellNumber:e,verifyCode:l,tempSid:n}).then(j).catchCode('FA_INVALID_VERIFY_CODE',(function(){a.$('.j-verify-code-explain').html(s('pref/mobile/msg_verifyCode_error')).closest('.u-form-item').addClass('error')})).catchCode('FA_TOO_FREQUENTLY',(function(){x(),t.notify.error(s('pref/mobile/msg_verify_code_send_quickly'))})).catchCode('FA_NEED_VERIFY_CODE',(function(){x(),t.notify.error(s('pref/mobile/msg_verifyCode_error'))})).catchCode('FA_INVALID_TEMP_SESSION',(function(){x(),t.notify.error(s('pref/mobile/msg_verifyCode_fail'))})).onFail((function(){t.notify.error(s('setting/msg_sendValidateCodeFail'))}))};_?o(_):r.isCellnumberBinded(i).then((function(e){1===e.isBinded?a.$('.j-cell-number-explain').html(s('pref/mobile/mobile_used_for_send_code')).closest('.u-form-item').addClass('error'):o(i)}))}}]};var S=function(){return o().then((function(e){var t=e.sid;return h(n=t)}))}})),h=function(e){return c.wmFullURL({url:'displayVerifyCode.jsp',sid:e,category:'verifyCode',rand:Math.random()})};var b=i(1078);a.module({name:'setting.advance.bindmobile',template:b},v)}).call(this,i(464))},1078:function(e,t,i){e.exports=i(469)('<section class="m-bind-mobile content-wrapper"> <div class="operation j-operation"></div> <div class="j-main"></div> </section>',{operationTpl:'<div class="u-btns-top"> {{#if toUpdate}} <button type="button" class="u-btn u-btn-primary" data-action={{#if toBind}}"bind"{{^}}"untie"{{/if}}>{{i18n "pref/mobile/save"}}</button> <button type="button" class="u-btn u-btn-default" data-action="cancel">{{i18n "setting/op_cancel"}}</button> {{^}} <button type="button" class="u-btn u-btn-primary" data-action="toUntie">{{i18n "pref/mobile/cancelbind"}}</button> {{/if}} </div>',updateMobilePhoneTpl:'<div class="main-panel"> <div class="title dotted"> <h4>{{#if toBind}}{{i18n "pref/mobile/notbind"}}{{^}}{{i18n "pref/mobile/untie_mobile_phone"}}{{/if}}</h4> </div> <div class="mainContent"> <form class="j-bind-form" action="#" name="mobileBind" onsubmit="return false"> {{#unless toBind}} <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_cellphone"}}:</label> <div class="input-wrapper number-text">{{encodePhoneNumber cellNumber}}</div> </div> {{/unless}} <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "pref/mobile/verify_code"}}:</label> <div class="input-wrapper"> <input type="text" class="u-input" maxlength="10" name="verifyCode" placeholder="{{i18n \'pref/mobile/verify_code\'}}"/> <div class="verify-code-wrapper"> <img class="j-verify-code" src="{{vcImageSrc}}" alt="{{i18n \'pref/mobile/verify_code\'}}"> <span class="u-btn u-btn-default refresh" data-action="refresh"> <i class="iconfont iconrevocation" title=""></i> </span> </div> </div> <span class="u-form-explain j-form-explain j-verify-code-explain"></span> </div> {{#if toBind}} <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "pref/mobile/bindto"}}:</label> <input type="text" class="u-input" maxlength="11" name="cellNumber" placeholder="{{i18n \'pref/mobile/cell_number\'}}"/> <span class="u-form-explain j-form-explain j-cell-number-explain"></span> </div> {{/if}} <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "pref/mobile/sms_verify_code"}}:</label> <input type="text" class="u-input cell-code-input" maxlength="10" name="smsVerifyCode" placeholder="{{i18n \'pref/mobile/sms_verify_code\'}}"/> <span class="u-btn u-btn-default send-verify-code j-send-code" data-action="sendSmsVerifyCode">{{i18n \'setting/lbl_sendVerifyCode\'}}</span> <span class="tip">{{tip}}</span> <span class="u-form-explain j-form-explain j-sms-code-explain"></span> </div> </form> </div> </div>',mobileBoundTpl:'<div class="bound-wrapper"> <div class="bound-content"> <i class="iconfont icon-phone"></i> <div class="bound-info"> <p class="info-header">{{i18n \'setting/tab_bindmobile\'}}</p> <p> <label class="info-label">{{i18n \'pref/mobile/lbl_has_set\'}}:</label> {{encodePhoneNumber cellNumber}} </p> </div> </div> </div>'})},1079:function(e,t,i){(function(e){i(1080);var t=i(463),n=i(472),a=i(471),s=i(480),l=i(465),r=i(466),o=i(473),c=i(476),d=i(1081),u=i(467),p=i(524),f=n.extend({Implements:s,templateHelpers:{translateTerminal:function(e,t){var i=[];return(e||'').trim().split(',').forEach((function(e){var t='setting/lbl_terminal_'+e.toLowerCase(),n=l(t);n==t&&(n=e),i.push(n)})),o(l('setting/lbl_'+t+'_notify_tip'),i.join('、'))}},events:{'click [data-action]':'_dispatchAction','click .j-check-all+i':'_handleSelectPartAll','click .j-check-sub+i':'_handleSelectSingleFolder','click .j-lock-item':'_handleCheckLockItem','change.crc .j-msg-toggle,.j-sms-toggle,.j-app-toggle':'_enableMsgNotify','click .j-sendAgain:not(.countdown)':'_handleSendAgain'},setup:function(){this.config=i(1083)()},render:function(){f.superclass.render.call(this),this._initView(),this._initModuleEvent()},_initModuleEvent:function(){this.on('updatePhoneAreaDomStatus',(function(e,i,n){var a=this;e&&t.each(['phone','code'],(function(e,t){a.$('.j-'+t+'ErrorMsg').addClass('f-dn').html('')})),i&&this.$('.j-'+i+'ErrorMsg').removeClass('f-dn').html(n)}))},_initView:function(){this._setMsgView()},_renderMsgView:function(){this.$('div.j-msg-notify').html(this.compile(this.$('#msgNotifyTpl').html(),{msgModel:this.msgModel,config:this.config})).customRadioCheckbox()},_dispatchAction:function(e,i){switch(t(i).data('action')){case'save.msg':this._handleUpdateRange(i);break;case'cancel.msg':this._handleMsgCancel(i);break;case'chkall.msg':this._handleChkAllFolders(i);break;case'edit.range.msg':this._showNotifyRangePanel();break;case'update.phone.msg':this._handleValidatePhone(i);break;case'bind.phone.msg':this._handleBindPhone(i);break;case'cancelBind.phone.msg':this._handleCancelBindPhone()}},_setMsgView:function(){var e=this;e.msgModel=e._buildMsgModel();var t=e.msgModel.filterAll?0:e.msgModel.enableMsgNotify&&e.msgModel.notifyFoldersIdList||[];r.when(c.chosenFoldersData(t),c.getSMSAttrs()).then((function(t,i){e.msgModel.folderData=t,e.msgModel.cellphone=i.cellNumber,e._renderMsgView()}))},_buildMsgModel:function(){var e=u.getUser(),t='@all'===e.ws_msg_notify_folder||null==e.ws_msg_notify_folder,i=t||'@none'===e.ws_msg_notify_folder?[]:e.ws_msg_notify_folder.split(',');return{enableMsgNotify:1===e.ws_msg_notify,filterAll:t,notifyFoldersIdList:i,enableSmsNotify:1===e.sms_login_notify,enableAppNotify:1===e.app_login_notify,countdown:60}},_enableMsgNotify:function(){var e=this,i=e.$('.j-msg-form').serializeJSON({defaultType:'+I',checkboxUncheckedValue:0});u.updateUser(i).then((function(){e.sendMessage('component.notification','notificationReset',i),t.notify(l('setting/msg_prefUpdateSuccess')),e._setMsgView()}))},_handleSendAgain:function(){var e=this,i=this.$('.j-cellphone').val();return this.trigger('updatePhoneAreaDomStatus',!0),i?p.test(i)?void c.isCellnumberBinded(i).then((function(n){1==n.isBinded?e.trigger('updatePhoneAreaDomStatus',!1,'phone',l('setting/lbl_phoneAlreadyBound')):(c.sendVerifyCode({cellNumber:i}).catchCode('FA_TOO_FREQUENTLY',(function(){t.notify.error(l('pref/mobile/msg_verify_code_send_quickly'))})).onFail((function(){t.notify(l('setting/msg_sendValidateCodeFail'))})),e._handleCountdown())})):(this.trigger('updatePhoneAreaDomStatus',!1,'phone',l('setting/lbl_invalidPhoneNumber')),!1):(this.trigger('updatePhoneAreaDomStatus',!1,'phone',l('setting/lbl_phoneEmptyError')),!1)},_handleCountdown:function(){var n=this,a=n.$('.j-sendAgain'),s=a.find('label');a.find('.btnValue').html(l('setting/lbl_sendAgain')),a.addClass('countdown u-btn-disabled').prop('disabled',!0),i(496)(t(),s,s.text(),e,(function(){a.removeClass('countdown u-btn-disabled').prop('disabled',!1),s.text(n.msgModel.countdown)}))},_showNotifyRangePanel:function(){var e=this.compile(this.$('#folderTreeTpl').html(),this.msgModel.folderData);this.$('.j-folder-tree').html(e),this._checkParentNode(),this.element.customRadioCheckbox(),this.$('.main-wrapper').addClass('switched-range')},_handleValidatePhone:function(e){var i=this,n=t(e).prev('.j-phoneNum').html();new d({cellphone:n,callback:function(){t(e).closest('.msg-form-item').addClass('unbound'),i.$('.j-verifyCode').prop('disabled',!1),i.$('.j-cellphone').val(n).prop('disabled',!1)}}).render()},_handleBindPhone:function(){var e=this,i='',n='',a=this.$('.j-cellphone').val(),s=this.$('.j-verifyCode').val();if(this.trigger('updatePhoneAreaDomStatus',!0),a?p.test(a)?s||(n='code',i=l('setting/lbl_codeEmptyError')):(n='phone',i=l('setting/lbl_invalidPhoneNumber')):(n='phone',i=l('setting/lbl_phoneEmptyError')),n)return this.trigger('updatePhoneAreaDomStatus',!1,n,i),!1;c.setSMSAttrs({attrs:{cellNumber:a},verifyCode:s}).then((function(){t.notify(l('setting/msg_bindPhoneSuccessfully')),e.$('.j-phoneArea').removeClass('unbound'),e.$('.j-cellphone, .j-verifyCode').val('').prop('disabled',!0),e.$('.j-sendAgain .btnValue').html(l('setting/lbl_sendVerifyCode')),e.$('.j-phoneNum').html(a),e.msgModel.cellphone=a})).catchCode('FA_INVALID_VERIFY_CODE',(function(){e.trigger('updatePhoneAreaDomStatus',!1,'code',l('setting/lbl_invalidCode'))}))},_handleCancelBindPhone:function(){this.msgModel.cellphone?this._renderMsgView():this.$('.j-sms-toggle').trigger('click')},_handleUpdateRange:function(){var i=this,n=i.$('form[name="notifyRange"]').serializeJSON(),a=n.rangeItem1||n.rangeItem2?e.map(n).join(','):'@none';u.updateUser({ws_msg_notify_folder:a}).then((function(){t.notify(l('setting/msg_prefUpdateSuccess')),i._setMsgView(),i.$('.main-wrapper').removeClass('switch-range')}))},_checkParentNode:function(){this.$('.parent-node:visible').each((function(e,i){var n=t(i).find('input:checked').length,a=t(i).find('input').length;a&&n==a&&t(i).prev().find('input').prop('checked',!0)}))},_handleMsgCancel:function(){this.$('.main-wrapper').removeClass('switched-range')},_handleChkAllFolders:function(e){var i=t(e).is(':checked');this.$('#chkAllSyFolders').prop('checked',i),this.$('#chkallUserFolders').prop('checked',i)},_handleSelectPartAll:function(e,i){var n=t(i).parent().next();t(i).hasClass('checkbox-checked')?n.find('li i').addClass('checkbox-checked').end().find('li input').each((function(){this.checked=!0})):n.find('li i').removeClass('checkbox-checked').end().find('li input').each((function(){this.checked=!1}))},_handleSelectSingleFolder:function(e,i){var n=t(i).parents('.parent-node');n.find('.checkbox').length==n.find('.checkbox-checked').length?n.prev().find('.checkbox').addClass('checkbox-checked'):n.prev().find('.checkbox').removeClass('checkbox-checked')},_handleCheckLockItem:function(e){t(e.target||e.srcElement).siblings('.checkbox').click()}});a.module({name:'setting.advance.loginnotification',template:i(1084)},f)}).call(this,i(464))},1081:function(e,t,i){(function(t){i(1082);var n=i(463),a=i(465),s=i(500),l=i(476),r=s.extend({constant:{msgTip:'',sendAgainBtn:a('setting/lbl_sendAgain'),countdown:60},attrs:{title:a('setting/lbl_validatePhone'),cellphone:'',callback:n.noop()},events:{'click .j-sendAgain:not(.countdown)':'_handleSendAgain'},setup:function(){var e=this;e.constant.msgTip=a('setting/lbl_smsAlreadySent',{mobile:this._formatCellphone(this.get('cellphone'))}),e.set('message',e.compile('<div class="u-validatePhone"><p>{{msgTip}}</p><div><input type="text" class="u-input j-verifyCode"/><button type="button" class="u-btn u-btn-default j-sendAgain">{{sendAgainBtn}}<span>(<label>{{countdown}}</label>s)</span></button><p class="j-errorMsg error f-dn"></p></div></div>',e.constant)),r.superclass.setup.call(this),e.on('confirm',(function(){e._handleValidatePhone()})),e.on('cancel',(function(){e.destroy()}))},render:function(){r.superclass.render.call(this),this.show(),this._handleSendVerifyCode(),this._handleUpdateDomStatus()},_handleSendVerifyCode:function(){this.trigger('updateErrorMsgStatus',!1,''),l.sendVerifyCode({cellNumber:this.get('cellphone')}).catchCode('FA_TOO_FREQUENTLY',(function(){n.notify.error(a('pref/mobile/msg_verify_code_send_quickly'))}))},_handleUpdateDomStatus:function(){var e=this;this.on('updateErrorMsgStatus',(function(t,i){var n=e.$('.j-errorMsg');t?n.removeClass('f-dn'):n.addClass('f-dn'),n.html(i)})),this.on('updateSendAgainBtnStatus',(function(e){var t=this.$('.j-sendAgain');e?t.removeClass('countdown u-btn-disabled').prop('disabled',!1):t.addClass('countdown u-btn-disabled').prop('disabled',!0)}))},_handleSendAgain:function(){this._handleSendVerifyCode(),this._handleCountdown()},_handleCountdown:function(){var e=this,a=e.$('.j-sendAgain').find('label');e.trigger('updateSendAgainBtnStatus',!1),i(496)(n(),a,a.text(),t,(function(){e.trigger('updateSendAgainBtnStatus',!0),a.text(e.constant.countdown)}))},_formatCellphone:function(e){return e?e.substr(0,4)+'****'+e.substr(e.length-4):''},_handleValidatePhone:function(){var e=this,t=e.$('.j-verifyCode').val();if(e.trigger('updateErrorMsgStatus',!1,''),!t)return e.trigger('updateErrorMsgStatus',!0,a('setting/lbl_codeEmptyError')),!1;l.setSMSAttrs({attrs:{cellNumber:e.get('cellphone')},verifyCode:t}).then((function(){'function'==n.type(e.get('callback'))&&e.get('callback')(),e.destroy()})).catchCode('FA_INVALID_VERIFY_CODE',(function(){e.trigger('updateErrorMsgStatus',!0,a('setting/lbl_invalidCode'))}))}});e.exports=r}).call(this,i(464))},1083:function(e,t,i){(function(t){var n=i(467),a=n.getConfig('user.enablecellphonebinding'),s={supportMsgNotify:n.getConfig('setting.supportmsgnotify'),supportMsgNotifyFolder:n.getConfig('setting.supportmsgnotifyfolder'),supportSMSLoginNotify:n.getConfig('setting.supportsmsloginnotify')&&a,supportAppLoginNotify:n.getConfig('setting.supportapploginnotify')};e.exports=function(){return t.assign({},s,{sendLoginNoticeTerminals:n.getConfig('setting.sendloginnoticeterminals')})}}).call(this,i(464))},1084:function(e,t){e.exports='<section class="m-msgnotify">\r\n  <div class="j-msg-notify">\r\n\r\n  </div>\r\n\r\n  {{#raw}}\r\n  \x3c!--提醒设置--\x3e\r\n  <script id="msgNotifyTpl" type="text/x-handlebars-template">\r\n    <div class="main-wrapper">\r\n      \x3c!--设置内容--\x3e\r\n      <div class="content-wrapper grid-col12">\r\n        <div>\r\n          \x3c!--消息设置提醒--\x3e\r\n          <form method="post" class="u-msg-form-part j-msg-form">\r\n            [[#and config.supportMsgNotify config.supportMsgNotifyFolder]]\r\n            <div class="title dotted"><h4>{{i18n "setting/lbl_msg_notify"}}</h4></div>\r\n            <div class="f-cf msg-form-item">\r\n              <div class="f-fl">\r\n                <label class="msg-form-label">{{i18n "setting/lbl_msg_notify"}}:</label>\r\n              </div>\r\n              <div class="msg-form-value">\r\n                <input type="checkbox" class="j-msg-toggle" role="switchBtn" name="ws_msg_notify" value="1" [[#if msgModel.enableMsgNotify]] checked [[/if]]/>\r\n              </div>\r\n              <div class="msg-form-others">\r\n                [[i18n "setting/msg_msg_notify"]]\r\n              </div>\r\n            </div>\r\n            [[#if msgModel.enableMsgNotify]]\r\n            <div class="f-cf msg-form-item j-msg-setting-range">\r\n              <div class="f-fl">\r\n                <label class="msg-form-label">{{i18n "setting/lbl_msg_notify_folder"}}: </label>\r\n              </div>\r\n              <div class="msg-form-value">\r\n                <span>[[msgModel.folderData.chosenFoldersName]]</span>\r\n                <a href="javascript:void(0)" data-action="edit.range.msg">[{{i18n "setting/op_update"}}]</a>\r\n              </div>\r\n              <div class="msg-form-others">\r\n                [[i18n "setting/msg_msg_notify_folder"]]\r\n              </div>\r\n            </div>\r\n            [[/if]]\r\n            [[/and]]\r\n\r\n            [[#or config.supportSMSLoginNotify config.supportAppLoginNotify]]\r\n            <div class="title dotted"><h4>{{i18n "setting/lbl_login_notify"}}</h4></div>\r\n\r\n            [[#if config.supportSMSLoginNotify]]\r\n            <div class="f-cf msg-form-item">\r\n              <div class="f-fl msg-form-label">\r\n                <label>{{i18n "setting/lbl_sms_notify"}} :</label>\r\n              </div>\r\n              <div class="msg-form-value">\r\n                <input type="checkbox" class="j-sms-toggle" role="switchBtn" name="sms_login_notify" value="1" [[#if msgModel.enableSmsNotify]] checked [[/if]] />\r\n              </div>\r\n              <div class="msg-form-others">\r\n                [[translateTerminal config.sendLoginNoticeTerminals \'sms\']]\r\n              </div>\r\n            </div>\r\n\r\n            [[#if msgModel.enableSmsNotify]]\r\n            <div class="f-cf msg-form-item j-phoneArea [[#unless msgModel.cellphone]] unbound [[/unless]]">\r\n\r\n              <div class="f-fl msg-form-label">\r\n                <label>{{i18n "setting/lbl_cellphone"}} :</label>\r\n              </div>\r\n\r\n              <div class="msg-form-value textArea">\r\n                <span class="j-phoneNum">[[msgModel.cellphone]]</span>\r\n                [<a href="javascript:void(0)" data-action="update.phone.msg">{{i18n "setting/op_update"}}</a>]\r\n              </div>\r\n\r\n              \x3c!-- 手机输入框 --\x3e\r\n              <div class="msg-form-value inputArea">\r\n                <input type="text" class="u-input j-cellphone" [[#if msgModel.cellphone]] disabled [[/if]]/>\r\n                <span class="j-phoneErrorMsg error f-dn"></span>\r\n              </div>\r\n\r\n              <div class="msg-form-others">\r\n                {{i18n "setting/lbl_cellphone_tip"}}\r\n              </div>\r\n\r\n              <div class="f-fl msg-form-label inputArea">\r\n                <label>{{i18n "setting/lbl_verifyCode"}} :</label>\r\n              </div>\r\n\r\n              \x3c!-- 验证码输入框 --\x3e\r\n              <div class="msg-form-value inputArea">\r\n                <input type="text" class="u-input j-verifyCode" [[#if msgModel.cellphone]] disabled [[/if]]/>\r\n                <button type="button" class="u-btn u-btn-default j-sendAgain">\r\n                  <span class="btnValue">[[i18n \'setting/lbl_sendVerifyCode\']]</span>\r\n                  <span class="countdownTxt">(<label>[[msgModel.countdown]]</label>s)</span>\r\n                </button>\r\n                <span class="j-codeErrorMsg error f-dn"></span>\r\n                <div class="wrapper">\r\n                  <button type="button" class="u-btn u-btn-primary" data-action="bind.phone.msg">[[i18n \'setting/op_confirm\']]</button>\r\n                  <button type="button" class="u-btn u-btn-default" data-action="cancelBind.phone.msg">[[i18n \'setting/op_cancel\']]</button>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n            [[/if]]\r\n            [[/if]]\r\n\r\n            [[#if config.supportAppLoginNotify]]\r\n            <div class="f-cf msg-form-item">\r\n              <div class="f-fl msg-form-label">\r\n                <label>{{i18n "setting/lbl_appPush_notify"}} :</label>\r\n              </div>\r\n              <div class="msg-form-value">\r\n                <input type="checkbox" class="j-app-toggle" role="switchBtn" name="app_login_notify" value="1" [[#if msgModel.enableAppNotify]] checked [[/if]] />\r\n              </div>\r\n              <div class="msg-form-others">\r\n                [[translateTerminal config.sendLoginNoticeTerminals \'appPush\']]\r\n              </div>\r\n            </div>\r\n            [[/if]]\r\n\r\n            [[/or]]\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      \x3c!--开启文件夹范围编辑 滑窗--\x3e\r\n      <div class="panel u-scroll range-panel">\r\n        <form action="#" name="notifyRange" method="post">\r\n          <div class="u-btns-top">\r\n            <button type="button" data-action="save.msg" class="u-btn u-btn-primary j-btn-error">{{i18n "setting/op_confirm"}}</button>\r\n            <button type="reset"  data-action="cancel.msg"   class="u-btn u-btn-default">{{i18n "setting/op_cancel"}}</button>\r\n          </div>\r\n\r\n          <div class="u-checkall sub-header j-checkall-folders">\r\n            <input type="checkbox" data-action="chkall.msg" class="j-check-all"><i class="iconfont iconfiler"></i>{{i18n "setting/lbl_folder"}}\r\n          </div>\r\n\r\n          <div class="u-form-item">\r\n            <div class="u-form-value j-folder-tree"></div>\r\n          </div>\r\n\r\n        </form>\r\n      </div>\r\n    </div>\r\n  <\/script>\r\n\r\n  \x3c!--文件夹目录树模板--\x3e\r\n  <script type="text/x-handlebars-template" id="folderTreeTpl" >\r\n    <ul class="tree f-fl">\r\n      \x3c!--系统文件夹--\x3e\r\n      <li>\r\n        <input type="checkbox" id="chkAllSyFolders" class="j-check-all"/>\r\n        <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[i18n "pref/personal/sysfolder"]]</div>\r\n      </li>\r\n      <li class="parent-node">\r\n        <ul>\r\n          [[#each sysFolders]]\r\n          <li>\r\n            <input type="checkbox" name="rangeItem1[]" class="j-check-sub  [[#if children]] j-check-all [[/if]]" [[#if selected]] checked [[/if]]  value=\'[[id]]\'/>\r\n            <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[name]]</div>\r\n          </li>\r\n          [[#if children]]\r\n          <ul>\r\n            [[#each children]]\r\n            <li>\r\n              <input type="checkbox" name="rangeItem1[]" class="j-check-sub" [[#if selected]] checked[[/if]] value=\'[[id]]\'/>\r\n              <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[name]]</div>\r\n            </li>\r\n            [[/each]]\r\n          </ul>\r\n          [[/if]]\r\n          [[/each]]\r\n        </ul>\r\n      </li>\r\n\r\n      \x3c!--其他文件夹--\x3e\r\n      <li>\r\n        [[#compare otherFolders.length "==" 0]]\r\n        <input type="checkbox" id="chkallUserFolders" class="j-check-all" disabled/>\r\n        <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[i18n "setting/lbl_user_folder"]][[i18n "setting/lbl_lack"]]</div>\r\n        [[else]]\r\n        <input type="checkbox" id="chkallUserFolders" class="j-check-all"/>\r\n        <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[i18n "setting/lbl_user_folder"]]</div>\r\n        [[/compare]]\r\n      </li>\r\n      <li class="parent-node">\r\n        <ul>\r\n          [[#each otherFolders]]\r\n          <li>\r\n            <input type="checkbox" name="rangeItem2[]" class="j-check-sub [[#if children]] j-check-all [[/if]]" [[#if selected]] checked [[/if]]  value=\'[[id]]\'/>\r\n            <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[name]]</div>\r\n          </li>\r\n          [[#if children]]\r\n          <ul>\r\n            [[#each children]]\r\n            <li>\r\n              <input type="checkbox" name="rangeItem2[]" class="j-check-sub" [[#if selected]] checked [[/if]]  value=\'[[id]]\'/>\r\n              <div class="j-lock-item f-ib f-csp"><i class="iconfont iconfiler"></i>[[name]]</div>\r\n            </li>\r\n            [[/each]]\r\n          </ul>\r\n          [[/if]]\r\n          [[/each]]\r\n        </ul>\r\n      </li>\r\n    </ul>\r\n  <\/script>\r\n  {{/raw}}\r\n\r\n</section>'},1085:function(e,t,i){(function(e,t,n){i(1086);var a=i(489)['default'],s=i(472),l=i(471),r=i(467),o=r.getUser,c=r.updateUser;var d={key:function(e){return e.replace('^','macosx'===i(518).os.name?'⌘':'Ctrl').replace(/[^+]+/g,'<span class=u-key>$&</span>').replace(/\+/g,'<a>+</a>')},desc:function(e){return n('setting/hotkeys_'+e)}};l.module({name:'setting.advance.hotkeys',element:i(1087)({category:{global:['^+a','Shift+m','Del'],read:['r','a','f','k','j'],compose:['^+Enter','^+s']}},{helpers:d}),afterRender:function(){var i=this,s=!!o().shortcut,l=i.$('.j-hotkey-switch').change((function(){s=l[0].checked,c({shortcut:s?1:0}).then(e.ary(t.notify,1,n('setting/'+(s?'msg_hotkeyEnableSuccessfully':'msg_hotkeyDisableSuccessfully')))).then(r)}));function r(){i.$('.j-panel').toggleClass('u-panel-toggle',s)}l[0].checked=s,a(i.$()),r()}},s)}).call(this,i(464),i(463),i(465))},1087:function(e,t,i){e.exports=i(469)('<section class="m-sgadv-hotkeys content-wrapper"> <div> <div class="title dotted"> <h4>{{i18n "setting/tab_hotkeys"}}</h4> </div> <div class=u-hotkeys-switch> <label> <span class="f-fl f-mgr">{{i18n "setting/tab_hotkeys"}}:</span> <input type=checkbox class=j-hotkey-switch role=switchBtn /> </label> </div> <div class="u-panel j-panel"> {{#each category}} <div class=category> <h4 class=title><span>{{desc @key}}</span></h4> <div> {{#each this}} <div class=item> <span class=key>{{{key this}}}</span> <span class=desc>{{desc this}}</span> </div> {{/each}} </div> </div> {{/each}} </div> </div> </section>',{})},1088:function(e,t,i){(function(e){i(1089),i(486);var t=i(463),n=i(472),a=i(471),s=i(465),l=i(475),r=i(470).alert,o=i(467),c=i(468).get,d=i(662),u=o.getUser().maxlist,p=n.extend({},(function(){var i,n=this;n.events={'click div.j-listtt':[function(e){var t=e.next('.j-listbd');t.animate({height:'toggle'},{duration:200,complete:function(){t.is(':visible')?e.children('.iconfont').removeClass('iconunfold').addClass('iconcollapse'):e.children('.iconfont').removeClass('iconcollapse').addClass('iconunfold')}})},t],'click [data-action]':[function(e){switch(e){case'save':var a=n.$('form[name="mailListForm"]').serializeJSON({defaultType:'+I'});if(function(e){var i=1===e.maillistType,a=(l={},n.$('.filter-item:visible').each((function(e,i){var n=(i=t(i)).find('.j-filter-key').val(),a=n+'~',o=i.find('.j-filter-op').is(':checked')?a:n,c=i.find('.j-filter-value'),d=c.val();if(d){if(l[n]||l[a])return r(s('main/filter_attr_duplicate'),(function(){c.focus()})),l=!1,!1;l[o]=d}})),l&&t.param(l));var l;if(i){if(!e.filter_item_value_0)return r(s('main/filter_orgid_empty'),(function(){t('#filter_item_value_0').focus()})),!1;if(!a)return!1}var o=g('forwardmaillist'),c=0===e.junkfilter||g('safelist'),d=!0;p&&(d=g('maillist_errorto'));var u=o&&c&&d;i&&u&&(e.maillist_filter=a+'&includelist=,'+encodeURIComponent(e.forwardmaillist)+',');return!0}(a)){var l=a.junkfilter,o={junkfilter:l};0!==l&&(o.safelist=a.safelist),p&&(o.maillist_errorto=a.maillist_errorto),a.maillist_filter?(o.maillist_filter=a.maillist_filter,o.forwardmaillist=''):(o.maillist_filter='',o.forwardmaillist=a.forwardmaillist),d.setEntrustMailListAttrs({email:a.email,attrs:o}).then((function(){v(a.email),t.notify.success(s('main/maillist_editsucc'))}))}break;case'cancel':m(i);break;case'refresh':d.all.flush(),m()}}],'click tr.j-maillist':[function(e){v(e.attr('email'))},t],'click .j-icon':[function(e){e.hasClass('iconadd')?n.$('.filter-item:hidden:first').show():e.closest('.filter-item').hide()},t],'change .j-type':[function(e){n.$('.filter').toggle('1'===e.val())},t],'change .j-junkfilter':b},n.after('render',m.bind(0,null));var a=c('mail')||{},o=a.enableDynamicMailingList,p=a.maillistSupportErrorTo;function m(e){h('list'),d.all.get((function(t){var a,s=(e||0)*u;n.$('.j-list').html(f.listtpl({list:t.slice(s,s+u)})),null==e&&(a=t.length,n.$('#pagination').pagination({total:a,limit:u,currentPage:i,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,callback:m})),i=e||0}))}function v(i){var a=n.$('.j-edit');h('edit'),d.getEntrustMailListAttrs({email:i}).then((function(n){a.html(f.edittpl(e.assign(n,{email:i,enableDynamicMailingList:o,maillistSupportErrorTo:p}))),function(e){if(o&&e)for(var i=e.split('&'),n=['org_id','org_unit_id','user_id','domain_name','includelist'],a=0;a<i.length;a++)for(var s=0;s<n.length;s++)if(0===i[a].indexOf(n[s])){var l='';if(i[a].indexOf('~=')===n[s].length)t('#wildcard_'+s).prop('checked',!0),l=i[a].substring(n[s].length+2);else{if('includelist'===n[s]){l=i[a].substring(n[s].length+2,i[a].length-1),t('#forwardmaillist').val(decodeURIComponent(l));continue}l=i[a].substring(n[s].length+1),t('#wildcard_'+s).prop('checked',!1)}t('#filter_item_'+s).show(),t('#filter_item_value_'+s).val(decodeURIComponent(l))}}(n.maillistFilter),b(),a.customRadioCheckbox()}))}function h(e){n.$('.j-menu,.j-list').toggle('list'===e),n.$('.j-edit').toggle('list'!==e)}function b(){var e=!+n.$('.j-junkfilter').val();n.$('#safelist').prop('disabled',e).toggleClass('disabled',e)}function g(e){var i=[],n=[],a=[],r=t('#'+e),o=r.val();if(o){i=o.split(',');for(var c=0;c<i.length;c++){var d=i[c].trim();if(!(t.inArray(d,a)>0||t.inArray(d,n)>0))d&&!u(d,'safelist'===e)?n.push(d):a.push(d)}if(n.length>0)return r.addClass('error'),r.next('span').html(s('main/invalid_emailaddr')+n.join(', ')),!1;r.next('span').html(''),r.val(a.join(','))}return!0;function u(e,t){var i=e||'';return t?function(e){var t=e.indexOf('@');if(-1!==t){var i=e.substring(0,t),n=e.substring(t+1,e.length);return function(e){var t=new RegExp('^[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*(?:\\.[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*)*$');return null!=e.match(t)}(i)&&function(e){var t=new RegExp('^[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*(?:\\.[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*)+$');return null!=e.match(t)}(n)}return!1}(i):l.test(i)}}})),f=i(1090);a.module({name:'setting.advance.entrustManager',template:f},p)}).call(this,i(464))},1090:function(e,t,i){e.exports=i(469)('<div class="m-entrust-manager"> <div class="m-menu j-menu"> <span class="u-btn u-btn-default" data-action="refresh">{{i18n "common/op_refresh"}}</span> <div id="pagination" class="f-fr"></div> </div> <div class="m-list j-list"> </div> <div class="m-edit j-edit"></div> </div>',{listtpl:'<div class="list-title f-csp j-listtt"> <i class="iconfont iconcollapse"></i> <span class="mailAddress">{{i18n "main/email"}}</span> <span class="mailListName">{{i18n "main/maillist_name"}}</span> <span class="status">{{i18n "main/status"}}</span> </div> <div class="list-body j-listbd"> <table class="u-table"> <tbody> {{#each list}} <tr class="j-maillist" email="{{email}}"> <td class="emailAddress">{{email}}</td> <td class="listName">{{true_name}}</td> <td class="status {{if$ (eq user_status 1) \'disabled\'}}"> {{if$ (eq user_status 0) (i18n \'main/status_0\')}} {{if$ (eq user_status 1) (i18n \'main/status_1\')}} </td> </tr> {{/each}} </tbody> </table> </div>',edittpl:'<div class="u-btns-top"> <button type="button" data-action="save" class="u-btn u-btn-primary">{{i18n "main/bt_savec"}} </button> <button type="button" data-action="cancel" class="u-btn u-btn-default">{{i18n "main/bt_back"}}</button> </div> <form name="mailListForm" action="#" method="post" class="u-form"> <fieldset> <div class="title dotted"> <h4>{{i18n "main/MaillistEdit"}}</h4> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "main/email"}}：</label> <span class="u-form-text">{{email}}</span> <input type="hidden" value="{{email}}" name="email" /> </div> {{#if enableDynamicMailingList}} <div class="u-form-item"> <label class="u-form-label">{{i18n "main/maillist_type"}}：</label> <select class="u-select j-type type" name="maillistType"> <option value="0" {{#unless maillistFilter}}selected{{/unless}}>{{i18n "main/maillist_type_0"}}</option> <option value="1" {{#if maillistFilter}}selected{{/if}}>{{i18n "main/maillist_type_1"}}</option> </select> </div> {{/if}} <div class="u-form-item filter {{#unless maillistFilter}}f-dn{{/unless}}"> <label class="u-form-label">{{i18n "main/maillist_filter_items"}}：</label> <div class="filter-item" id="filter_item_0"> <select class="u-select disabled j-filter-key filter-key" name="filter_item_0" disabled> <option value="org_id" selected="">{{i18n "main/filter_key_0"}}</option> <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option> <option value="user_id">{{i18n "main/filter_key_2"}}</option> <option value="domain_name">{{i18n "main/filter_key_3"}}</option> </select> <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_0\' name=\'filter_item_value_0\' value=\'\' /> <div class="itemR"> <input type="checkbox" class="j-filter-op" name="wildcard_0" id="wildcard_0" /> <span class="label">{{i18n "main/user_wildcard"}}</span><span class="star">*</span> <i class="j-icon icon iconfont iconadd" title=\'{{i18n "main/add_item"}}\'></i> </div> </div> <div class="filter-item f-dn" id="filter_item_1"> <select class="u-select j-filter-key filter-key" name="filter_item_1"> <option value="org_id">{{i18n "main/filter_key_0"}}</option> <option value="org_unit_id" selected>{{i18n "main/filter_key_1"}}</option> <option value="user_id">{{i18n "main/filter_key_2"}}</option> <option value="domain_name">{{i18n "main/filter_key_3"}}</option> </select> <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_1\' name=\'filter_item_value_1\' value=\'\' /> <div class="itemR"> <input type="checkbox" class="j-filter-op" name="wildcard_1" id="wildcard_1" /> <span class="label">{{i18n "main/user_wildcard"}}</span> <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i> </div> </div> <div class="filter-item f-dn" id="filter_item_2"> <select class="u-select j-filter-key filter-key" name="filter_item_2"> <option value="org_id">{{i18n "main/filter_key_0"}}</option> <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option> <option value="user_id" selected>{{i18n "main/filter_key_2"}}</option> <option value="domain_name">{{i18n "main/filter_key_3"}}</option> </select> <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_2\' name=\'filter_item_value_2\' value=\'\' /> <div class="itemR"> <input type="checkbox" class="j-filter-op" name="wildcard_2" id="wildcard_2" /> <span class="label">{{i18n "main/user_wildcard"}}</span> <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i> </div> </div> <div class="filter-item f-dn" id="filter_item_3"> <select class="u-select j-filter-key filter-key" name="filter_item_3"> <option value="org_id">{{i18n "main/filter_key_0"}}</option> <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option> <option value="user_id">{{i18n "main/filter_key_2"}}</option> <option value="domain_name" selected>{{i18n "main/filter_key_3"}}</option> </select> <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_3\' name=\'filter_item_value_3\' value=\'\' /> <div class="itemR"> <input type="checkbox" class="j-filter-op" name="wildcard_3" id="wildcard_3" /> <span class="label">{{i18n "main/user_wildcard"}}</span> <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i> </div> </div> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "main/maillist_content"}}：</label> <textarea id=\'forwardmaillist\' name=\'forwardmaillist\' class="u-input">{{forwardMaillist}}</textarea> <span class="u-form-explain"></span> <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "main/maillist_user"}}：</label> <select class=\'u-select j-junkfilter junk-filter\' name="junkfilter"> <option value="0" {{if$ (eq junkFilter 0) \'selected\'}}>{{i18n "main/junkfilter_0"}}</option> <option value="2" {{if$ (eq junkFilter 2) \'selected\'}}>{{i18n "main/junkfilter_2"}}</option> <option value="3" {{if$ (eq junkFilter 3) \'selected\'}}>{{i18n "main/junkfilter_3"}}</option> </select> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "main/maillist_safelist"}}：</label> <textarea id="safelist" name=\'safelist\' class="u-input" {{if$ (eq junkFilter 0) \'disabled\'}}>{{safeList}}</textarea> <span class="u-form-explain"></span> <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p> </div> {{#if maillistSupportErrorTo}} <div class="u-form-item"> <label class="u-form-label">{{i18n "main/maillist_errorto"}}：</label> <textarea id=\'maillist_errorto\' name=\'maillist_errorto\' class="u-input">{{errortoList}}</textarea> <span class="u-form-explain"></span> <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p> </div> {{/if}} </fieldset> </form>'})},1091:function(e,t,i){var n=i(499),a=i(465);n('setting.labs',{className:'m-slsecurity',overrides:{offsiteremind:(0,i(468).get)('setting.supportEventNotifyOptions')&&a('setting.lbl_offSite_notify_title')}})},1092:function(e,t,i){(function(e,t){i(661);var n=i(472),a=i(471),s=i(465),l=i(467),r=n.extend({},(function(i,n){var a=this;function r(e){var t=l.getUser().event_notify_options||{},i=t.mail=t.mail||{},n=a.$('.j-offsite-toggle');return e?i.offsite_remind=n[0].checked:n.rcCheck(!!i.offsite_remind),{event_notify_options:t}}a.events={'click [data-action]':[{save:function(){l.updateUser(r(!0)).then((function(){t.notify(s('setting/msg_prefUpdateSuccess'))}))},cancel:e.ary(r,0)}]},i()(n),a.$().customRadioCheckbox(),r()}));a.module({name:'setting.labs.offsiteremind',template:i(1093)},r)}).call(this,i(464),i(463))},1093:function(e,t,i){e.exports=i(469)('<section class="m-off-site-remind content-wrapper"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button> <button type="reset" class="u-btn u-btn-default" data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <div class="title dotted"> <h4>{{i18n "setting/lbl_offSite_notify"}}</h4> </div> <form class="remind-from"> <div class="remind-item"> <input type="checkbox" class="j-offsite-toggle" role="switchBtn" /> <span class="remind-info">{{i18n "setting/lbl_offSite_notify_tip"}} </span> </div> </form> </section>',{})},499:function(e,t,i){(function(t,n){var a=i(472),s=i(471),l=i(519),r=i(465),o=i(467),c=o.getCurrentState,d=o.setCurrentState;e.exports=function(e,o,u){var p=o['default'],f=o.className,m=o.classPrefix,v=o.i18nPrefix,h=void 0===v?'setting/tab_':v,b=o.overrides,g=e+'.',_=e.split('.'),y=t.last(_);m=m||'j-'+y;var w=t.map(t['let'](i(557),e),(function(e,i){return{id:g+i,title:(e=b&&i in b?b[i]:1)?t.isSTR(e)?e:r.get(h.replace(/$|%/,i),r('pref/'+i)):0,module:s.module(g+(e&&e.id||i))}})),k=t.filter(w,'title'),x='<nav class="nav u-tab u-tab-highlight-down"><ul class="'+m+'-nav">'+k.map((function(e){return'<li data-trigger='+e.id+'><span class=bar></span><a href="javascript:void(0)">'+e.title+'</a></li>'})).join('')+'</ul></nav><div class="content '+m+'-content"></div>';s.module(e,a.extend(t.assign({},u,{render:function(){var s=this,r=c(),o=r.module.split('.')[_.length]||p,u=o?g+o:k[0].id;r.module=u,d(r),a.prototype.render.call(s);var v=new l({element:s.$().addClass(f||'m-'+y).html(x),classPrefix:m,activeTabId:u,activeTriggerClass:'z-current',onlyRenderActive:!0,generatePanelMarkup:function(e,t){return n('<div>',{'data-panel':e.sid,'class':t+' u-scroll'})},tabs:w}).on('render',t.ary(h,1,1)).on('refresh',t.ary(h,0));function h(e){i(477)[e?'render':'refresh'](v.current().id),e||b()}function b(){s.sendMessage(v.current().id,'view:active')}v.render(),s.subscribe('dispatcher','url:changed',(function(t){var i=t.message.newState,n=i.module;n===e?h():v.find(n)&&(d(i),v.switchTo(n))})),s.onMessage('view:active',b)}}),t.isFUN(u)&&u))}}).call(this,i(464),i(463))},523:function(e,t,i){(function(t){i(949);var n=i(472),a=i(465),s=i(467),l=i(493);e.exports=n.extend({},(function(e,i){var n,r,o=i.template.logsListTpl,c=this,d=0,u=20;function p(){c.withAuth&&!s.getFolderLockedStatus().isAuth?(c.element.hide(),l.box({successCb:p})):n||(n=!0,m())}function f(){c.$('.j-pagination').pagination({total:r,limit:u,currentPage:d,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,callback:function(e){d=e*u,v()}})}c.after('render',(function(){var e,t;e=c.$('.j-page-size'),t=e.find('label'),e.dropdown({type:'radio',data:(c.pageSizeOptions||[10,[20,!0],30]).map((function(e){return[].concat(e)})).map((function(e){var t=e[0],i=e[1];return{value:t,name:a('appcenter/lbl_choose_per_page',{num:t}),'default':!!i}})),callback:function(e){t.text(a('appcenter/lbl_choose_per_page',{num:e.value})),u=e.value,m()}}),c.onMessage('view:reload',m,null),c.withAuth&&(c.onMessage('view:auth',p),c.subscribe('component.userauth2','auth2Unlocked',p)),p()}));var m=c.reload=function(){d=0,v().then(f)},v=c._fetchData=function(){return c.element.show().mask(),c.requestData({start:d,limit:u}).then((function(e,i){!function(e){var i=c.$('.j-list').html(o({list:e,total:r})),n=i.find('tr');r?n.customRadioCheckbox().filter((function(e,i){return(1+t(i).data('index')||e)%2})).addClass('even'):(n.find('th:has(:checkbox)').remove(),n.after('<tr><td colspan='+n.find('th').length+'>'+a('mbox/no_record')+'</td></tr>')),c.$('.j-total').text(a('appcenter/lbl_logs_total',{num:r})),i.find('td[data-collapse]').each((function(e,i){var n=t(i);i.scrollWidth>i.clientWidth&&n.html([t('<i class="iconfont iconcollapse"/>').click((function(){t(this).toggleClass('iconcollapse iconunfold'),n.toggleClass('pre')})),t('<span/>',{title:n.text(),html:n.html()})])}))}(e,r=i.total)})).either((function(){c.element.mask('hide')}))}}))}).call(this,i(463))},549:function(e,t,i){var n=i(467);e.exports=function(){return{allEmails:n.getConfig('user.allEmails'),enableJunkNotify:n.getConfig('setting.enablejunknotify'),supportOffSiteRemindStatus:n.getConfig('setting.supportoffsiteremindstatus'),supportAntivirus:n.getConfig('user.supportantivirus'),supportSMIMEServer:n.getConfig('user.supportsmime')&&n.getConfig('user.syssupportsmime'),enableAuth2lock:n.getConfig('setting.enableauth2lock'),supportTwoFactorAuth:!0,supportAuthorizedDevice:n.getConfig('setting.supportauthorizeddevice'),supportAlternativePassword:n.getConfig('setting.supportalternativepassword')}}},585:function(e,t,i){e.exports=function(){var e={rule:/^(.+?)\((.+)\)$/,numericRegex:/^[0-9]+$/,email:/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/,ip:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])((\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}|(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){5})$/,fax:/^(([0\+]\d{2,3}-)?(0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/,phone:/^((\+?[0-9]{1,4})|(\(\+86\)))?(13[0-9]|14[57]|15[012356789]|17[03678]|18[0-9])\d{8}$/,url:/[a-zA-z]+:\/\/[^\s]/,money:/^(0|[1-9]\d*)(\.\d+)?$/,english:/^[A-Za-z]+$/,chinese:/^[\u0391-\uFFE5]+$/,percent:/^(?:[1-9][0-9]?|100)(?:\.[0-9]{1,2})?$/},t={is_email:function(t){return e.email.test(s(t))},is_ip:function(t){return e.ip.test(s(t))},is_fax:function(t){return e.fax.test(s(t))},is_tel:function(t){return e.fax.test(s(t))},is_phone:function(t){return e.phone.test(s(t))},is_url:function(t){return e.url.test(s(t))},is_money:function(t){return e.money.test(s(t))},is_english:function(t){return e.english.test(s(t))},is_chinese:function(t){return e.chinese.test(s(t))},is_percent:function(t){return e.percent.test(s(t))},required:function(e){var t=s(e);return'checkbox'===e.type||'radio'===e.type?!0===e.checked:null!==t&&''!==t},max_length:function(t,i){return!!e.numericRegex.test(i)&&s(t).length<=parseInt(i,10)},min_length:function(t,i){return!!e.numericRegex.test(i)&&s(t).length>=parseInt(i,10)},same:function(e,t){return s(e)==s(this.fields[t].element)},different:function(e,t){return!this.same(e,t)},contains:function(e,t){return s(e)==t},accepted:function(e){var t=s(e);return'YES'==t.toUpperCase()||'ON'==t.toUpperCase()||1==t||0==t}},i=function(e,i,n){for(var s in t)this[(l=s,l.replace(/\_([a-z])/g,(function(e,t){return t.toUpperCase()})))]=t[s];var l,r;if(!e)return this;this.callback=n||function(){},this.form=('object'==typeof(r=e)?r:document.forms[r])||{},this.errors=[],this.fields={},this.handles={};for(var o=0,c=i.length;o<c;o++){var d=i[o];(d.name||d.names)&&d.rules?a(this,d,d.name):console.warn(d)}var u,p=this.form.onsubmit;this.form.onsubmit=(u=this,function(e){try{return u.validate(e)&&(p===undefined||p())}catch(t){}})};function n(e,t){var i;if(!(e.length>0)||'radio'!==e[0].type&&'checkbox'!==e[0].type)return e[t];for(i=0,elementLength=e.length;i<elementLength;i++)if(e[i].checked)return e[i][t]}function a(t,i,n){for(var a in t.fields[n]={name:n,display:i.display||n,rules:i.rules,id:null,element:null,type:null,value:null,checked:null},i)i.hasOwnProperty(a)&&/^regexp\_/.test(a)&&(e[a]=i[a])}function s(e){return'string'==typeof e?e:e.value}return i.prototype={validate:function(e){if(this._passes)return this;for(var t in this.handles.ok=!0,this.handles.evt=e,this.errors=[],this.fields)if(this.fields.hasOwnProperty(t)){var i=this.fields[t]||{},a=this.form[i.name];a&&a!==undefined&&(i.id=n(a,'id'),i.element=a,i.type=a.length>0?a[0].type:a.type,i.value=n(a,'value'),i.checked=n(a,'checked'),this._validateField(i))}return'function'==typeof this.callback&&this.callback(this,e),this.errors.length>0&&(e&&e.preventDefault?e.preventDefault():event&&(event.returnValue=!1)),this},passes:function(){return this._passes=!0,this},_validateField:function(i){for(var n=i.rules.split('|'),a=!i.value||''===i.value||i.value===undefined,s=0,l=n.length;s<l;s++){var r=n[s],o=e.rule.exec(r),c=null,d=!1;if(o&&(r=o[1],c=o[2]),(!a||-1!==n.indexOf('required'))&&('function'==typeof t[r]&&(t[r].apply(this,[i,c])||(d=!0)),e[r]&&/^regexp\_/.test(r)&&(e[r].test(i.value)||(d=!0)),d)){var u,p,f=i.display.split('|')[s]&&i.display.split('|')[s].replace('{{'+i.name+'}}',i.value);for(p=0;p<this.errors.length;p+=1)i.element===this.errors[p].element&&(u=this.errors[p]);var m=u||{id:i.id,display:i.display,element:i.element,name:i.name,message:f,messages:[],rule:r};m.messages.push(f),u||this.errors.push(m)}}return this}},i}()},586:function(e,t,i){(function(t,n){i(550);var a=i(463),s=i(512),l=i(470).confirm,r=i(465),o=i(541),c=o.validateNumeric,d=o.errRenderer,u=o.authMethods,p=i(508),f=i(476),m=i(502),v=i(468).get,h=i(496);function b(e){return!('string'!=typeof e||!e.length)||(a.notify.error(r('setting/msg_twofactorauth_invalid_param')),!1)}var g=i(587),_=g.SmsVerifyTpl,y=g.dynamicVerifyTpl,w=g.otpPushVerifyTpl,k=g.otpCodeVerifyTpl,x=g.authToggleTpl,j=s.create({initialize:function(e){if(!a.isPlainObject(e)||null==e.$wrap)return{};this.verifyType=e.verifyType?e.verifyType:1,this.model=e.model,this.next=a.isFunction(e.onSuccess)?e.onSuccess:a.noop,this.errorCb=a.isFunction(e.onError)?e.onError:a.noop,this.$wrap=e.$wrap,this.$footer=e.$footer,this.$main=this.$wrap.find('.j-verify-main'),this.$error=this.$wrap.find('.j-error'),this.trans=e.verifyTrans||'update_second_auth',this.tempSid=e.tempSid||null},submit:a.noop,cancel:function(){this._destroy()},_focusInput:function(e,t){if(!e||!e.length)return!1;t=a.isFunction(t)?t:a.noop,e.off('focus').on('focus',(function(){e.off('keyup.enter').on('keyup.enter',(function(e){13===e.keyCode&&t(e)}))})).off('blur').on('blur',(function(){e.off('keyup.enter')})),setTimeout((function(){e.trigger('focus')}),200)},_renderError:function(e){var t=this.$error,i=t.html();this.errorTimeoutId&&clearTimeout(this.errorTimeoutId),e&&e.length&&t.html(e),t.removeClass('f-dn'),this.errorCb(e),this.errorTimeoutId=setTimeout((function(){t.addClass('f-dn'),e&&e.length&&t.html(i)}),3e3)},_doUnbind:function(e){p.prepareUpdateAuth({tempSid:this.tempSid,newType:u.DISABLED}).then(t.ary(p.updateAuth,1,{tempSid:this.tempSid})).then(e,d(this))},_destroy:function(){this.$main.html(''),this.$error.html('')}}),S=j.extend({initialize:function(e){S.superclass.initialize.call(this,e),this._render()},submit:function(){var e=this,t=e.$main.find('.j-input-pwd').val().trim();if(!t)return e._renderError(r('setting/msg_authkeyNull')),!1;if(t.length!==e.model.codeLimit)return e._renderError(r('setting/lbl_twofactorauth_dynamic_verify_error')),!1;if(2===e.verifyType)n.wmCall({url:'/XT5/jsp/setting.jsp',func:'unbindAuthKey'},{authkeyid:e.model.authkeyid,authkeypwd:t}).then((function(){e.next(),e._destroy()}),d(e));else if(1===e.verifyType){if(!b(e.tempSid))return!1;p.validateAuth({tempSid:e.tempSid,verifyCode:t,trans:e.trans}).then((function(){e.next(e.tempSid),e._destroy()}),d(e))}return!1},_render:function(){var e=this;this.$main.html(y(this.model)),this._focusInput(this.$main.find('.j-input-pwd'),(function(){e.submit()})),1===this.verifyType&&p.trigger({trans:this.trans}).then((function(t){e.tempSid=t.tempSid,b(e.tempSid)}),d(e))}});S.authType=u.DYNAMIC;var C=j.extend({initialize:function(e){var i=this;C.superclass.initialize.call(this,e),this.toggleConfirm=e.toggleConfirm||t.noop,this.model.deviceInfo=this.model.deviceInfo||{},this.model.deviceInfo.model=this.model.deviceInfo.model||r('setting/lbl_twofactorauth_otp_bind_device_other'),this.patternEnum={PUSH:1,CODE:2},this.pattern=this.patternEnum.PUSH,this.cancelSubscribe=null,this.$verfiyToggle=a(x()).off('click').on('click',(function(){i.render(i.pattern===i.patternEnum.PUSH?i.patternEnum.CODE:i.patternEnum.PUSH)})),this.$footer.prepend(this.$verfiyToggle),this.render(this.pattern),this.triggerOtpAuth()},submit:function(){var e;return this.pattern!==this.patternEnum.CODE||((e=a.trim(this.$main.find('.j-authcode').val())).length&&c(e)||this._renderError(),this._doSubmit(e)),!1},cancel:function(){this._doCancelSubscribe(),C.superclass.cancel.call(this)},render:function(e){var t=this;t.$main.addClass('otp-verify-wrap');var i=(t.pattern=e)===t.patternEnum.PUSH;t.toggleConfirm(i),t.$error.addClass('f-dn').html(r('setting/lbl_twofactorauth_otp_'+(i?'push':'code')+'_verify_error')),i?(t.$main.html(w(t.model)),t.$main.off('click','.j-send-auth').on('click','.j-send-auth',(function(){t._doCancelSubscribe(),t.triggerOtpAuth();var e=t.$main.find('.j-send-auth').hide(),i=t.$main.find('.j-send-auth-count').show();h(a(),i,10,r('login/resend'),(function(){e.show(),i.hide()}))}))):(t.$main.html(k(t.model)),t._focusInput(t.$main.find('.j-authcode'),(function(){t.submit()})))},triggerOtpAuth:function(){var e=this;function t(t){if(t.payload.trans!==e.trans)return e._renderError(r('setting/msg_twofactorauth_invalid_param')),!1;p.queryValidateStage({tempSid:e.tempSid,trans:e.trans}).then((function(t){'VALIDATED'!==t.stage?e._renderError(r('setting/msg_twofactorauth_invalid_forbidden')):e._afterValidate()}),d(e))}p.trigger({trans:this.trans}).then((function(i){if(!b(i.tempSid))return!1;e.tempSid=i.tempSid,e.cancelSubscribe=m.subscribeOtpAuth(v('user.dnemail'),e.tempSid,t)}),d(e))},_doSubmit:function(e){var t=this;if(!b(this.tempSid))return!1;this._doCancelSubscribe(),p.validateAuth({tempSid:this.tempSid,verifyCode:e,trans:this.trans}).then((function(){t._afterValidate()}),d(t))},_afterValidate:function(){var e=this;2===this.verifyType?this._doUnbind((function(){e.tempSid=null,e.next(),e._destroy()})):(this.next(this.tempSid),this._destroy())},_doCancelSubscribe:function(){null!=this.cancelSubscribe&&this.cancelSubscribe(),this.cancelSubscribe=null},_destroy:function(){this.$main.removeClass('otp-verify-wrap'),this._doCancelSubscribe(),C.superclass._destroy.call(this)}});C.authType=u.OTP;var T=j.extend({initialize:function(e){T.superclass.initialize.call(this,e),this.toggleConfirm=a.isFunction(e.toggleConfirm)?e.toggleConfirm:a.noop,this.$desc=null,this.$btnSend=null,this.clearSendAgain=null,this._render()},submit:function(){var e=a.trim(this.$main.find('.j-input-code').val()).toUpperCase();return e.length?e.length!==this.model.codeLimit?(this._renderError(r('setting/lbl_twofactorauth_sms_verify_code_invalid')),!1):(this._validateVerifyCode(e),!1):(this._renderError(r('setting/lbl_twofactorauth_sms_verify_code_blank')),!1)},_render:function(){var e=this;this.$main.addClass('sms-verify-wrap'),this.$main.html(_(a.extend({},this.model,{cellNumber:this._formatMobileSafe(this.model.cellNumber)}))),this.$desc=this.$main.find('.j-desc'),this.$btnSend=this.$main.find('.j-send'),this._focusInput(this.$main.find('.j-input-code'),(function(){e.submit()})),this.toggleConfirm(!0),this.$btnSend.on('click',(function(){if(e.$btnSend.hasClass('disabled'))return!1;e._sendVerifyCode().fin((function(t){e._renderDesc(!t),e.toggleConfirm(!t),t&&e._sendAgainCountdown()}))})),this.$btnSend.trigger('click')},_renderDesc:function(e){var t=this.model.cellNumber;(e='boolean'==typeof e&&e)?this.$desc.html(r('setting/lbl_smsSentFail',{mobile:this._formatMobileSafe(t)})):this.$desc.html(r('setting/lbl_smsAlreadySent',{mobile:this._formatMobileSafe(t)})),this.$desc.attr('data-failed',e)},_sendVerifyCode:function(){return f.sendVerifyCode(t.pick(this.model,['cellNumber']))['catch'](d(this,r('setting/lbl_twofactorauth_sms_send_error')))},_sendAgainCountdown:function(){this.clearSendAgain=h(this.$btnSend,this.$main.find('.j-send-text'),this.model.sendAgainTimeout,r('login/resend'))},_validateVerifyCode:function(e){var t=this;f.setSMSAttrs({attrs:{cellNumber:t.model.cellNumber},verifyCode:e}).then((function(){t.next(),t._destroy()})).catchCode('FA_INVALID_VERIFY_CODE',(function(){t._renderError(r('setting/lbl_invalidCode'))}))},_formatMobileSafe:function(e){return null!=e?(e=e.toString().replace(/\D+/g,'')).substr(0,4)+'****'+e.substr(e.length-4):''},_destroy:function(){this.clearSendAgain&&this.clearSendAgain(),this.$main.removeClass('sms-verify-wrap'),T.superclass._destroy.call(this)}}),$=T.extend({initialize:function(e){$.superclass.initialize.call(this,e)},_sendVerifyCode:function(){var e=this;return(3===e.verifyType?p.prepareUpdateAuth({tempSid:e.tempSid,newType:u.SMS,cellNumber:e.model.cellNumber}):p.trigger({trans:e.trans})).then((function(t){var i=t.tempSid;b(i)&&(e.tempSid=i)}),d(e,r('setting/lbl_twofactorauth_sms_send_error')))},_validateVerifyCode:function(e){var t=this;if(!b(this.tempSid))return!1;(3===t.verifyType?p.updateAuth({tempSid:t.tempSid,verifyCode:e}):p.validateAuth({tempSid:t.tempSid,verifyCode:e,trans:t.trans})).then((function(e){2===t.verifyType?t._doUnbind((function(){t.next(t.tempSid),t._destroy()})):(t.next(t.tempSid),t._destroy())}),d(t))}});function A(e){var t=e.confirmCb,i=e.verifyType,n=e.verifyTrans,a=e.authType,s=e.authModel,o=e.tempSid;l(g(),{width:480,title:r('setting/lbl_twofactorauth_'+(2===i?'unbind':'verify')+'_title'),afterRender:function(){var e=this,l=e.$('[data-role=message]').addClass('m-setting-twofactorauth-verifybox'),r=e.$('[data-role=foot]'),c=e.$('[data-role=confirm]'),d=function(){var e={model:s,onSuccess:p,onError:f,$wrap:l,$footer:r,verifyType:i||1,verifyTrans:n||'update_second_auth'};switch(a){case u.DYNAMIC:return new S(e);case u.OTP:return e.toggleConfirm=m,new C(e);case u.SMS:return e.tempSid=o,e.toggleConfirm=m,new $(e);case'CellNumber':return new T(e)}}();function p(i){t(i),e.hide()}function f(){}function m(e){c.toggleClass('disabled',!!e)}e.on('confirm',(function(){return!c.hasClass('disabled')&&d.submit()})).after('hide',d.cancel.bind(d))}})}e.exports={initVerify:function(e){var i=e.next;p.initAuthData().then((function(n){var a=n.type;if(a&&a!==u.DISABLED&&a!==u.AUTH_DEVICE){var s=t.assign(p.allModels()[a],n);A({verifyType:e.verifyType,verifyTrans:e.verifyTrans,authType:a,authModel:s,confirmCb:i})}else i(null)}))},initVerifyWithModel:function(e){var t=e.model;t&&A({tempSid:e.tempSid||'',verifyType:e.verifyType,authType:t.type,authModel:t,confirmCb:e.next})},verifyTypes:{VERIFY:1,UNBIND:2,UPDATE:3}}}).call(this,i(464),i(466))},587:function(e,t,i){e.exports=i(469)('<div class="verify-wrap j-verify-wrap"> <div class="verify-main j-verify-main"></div> <div class="verify-error j-error f-dn"></div> </div>',{SmsVerifyTpl:'<p class="verify-desc">{{ i18n "setting/lbl_twofactorauth_sms_verify_desc" }}</p> <p class="verify-desc-sub mg-top-10 j-desc">{{ i18n "setting/lbl_twofactorauth_sms_verify_init_tip" mobile=cellNumber }}</p> <div class="u-form mg-top-10"> <div class="u-form-item verify-input"> <label class="u-form-label">{{ i18n "setting/lbl_twofactorauth_sms_binding_code" }}</label> <input type="text" class="u-input j-input-code" maxlength="{{ codeLimit }}" placeholder=\'{{ i18n "setting/lbl_twofactorauth_sms" }}\' /> <button class="u-btn u-btn-default btn-send-code j-send"> <span class="j-send-text">{{ i18n "setting/lbl_twofactorauth_sms_send" }}</span> </button> </div> </div>',dynamicVerifyTpl:'<p class="verify-desc">{{ i18n "setting/lbl_twofactorauth_dynamic_verify_desc" }}</p> <div class="u-form mg-top-10"> <div class="u-form-item"> <label class="u-form-label">{{ i18n "setting/lbl_twofactorauth_dynamic_verify_bind_id" }}</label> <span class="u-form-text address-text">{{ authkeyid }}</span> </div> <div class="u-form-item verify-input"> <label class="u-form-label">{{ i18n "setting/lbl_twofactorauth_dynamic_verify_code" }}</label> <input type="text" class="u-input j-input-pwd" maxlength="{{ codeLimit }}" placeholder=\'{{ i18n "setting/lbl_Authkeypwd" }}\' /> </div> </div>',otpPushVerifyTpl:'<p class="verify-desc">{{ i18n "setting/lbl_twofactorauth_otp_push_verify_desc" }}</p> <p class="verify-desc-sub mg-top-10">{{ i18n "setting/lbl_twofactorauth_otp_push_verify_desc_sub" }} <a href="javascript:void(0);" class="link j-send-auth">{{ i18n "login/resend" }}</a> <a class="j-send-auth-count f-dn"></a> </p>',otpCodeVerifyTpl:'<p class="verify-desc">{{ i18n "setting/lbl_twofactorauth_otp_code_verify_desc" }}</p> <div class="u-form mg-top-10"> <div class="u-form-item"> <label class="u-form-label">{{ i18n "setting/lbl_twofactorauth_otp_bind_device" }}</label> <span class="u-form-text address-text">{{ deviceInfo.model }}</span> </div> <div class="u-form-item verify-input"> <label class="u-form-label">{{ i18n "setting/lbl_twofactorauth_otp_binding_code" }}</label> <input type="text" class="u-input j-authcode" maxlength="{{codeLimit}}" /> </div> </div>',authToggleTpl:'<a href="javascript:void(0);" class="link" style="padding-left: 10px;">{{i18n "setting/lbl_twofactorauth_otp_auth_toggle"}}</a>'})},588:function(e,t,i){var n=i(463),a=i(497),s=i(467);function l(e,t){return{module:'module.setting.security.logindevices.altPwdService',msg:e,meta:t}}e.exports={listAltPwdList:function(){var e=n.Deferred();return a.xhr.simpleCall({query:{func:'user:listAppPwds',sid:s.getSid()}},(function(t){e.resolve(t)}),(function(t,i,n){e.reject(l('list alternative passwords failed',n))})),e.promise()},deleteAltPwd:function(e){var t,i,r=n.Deferred();if(!n.isPlainObject(e))return r.reject(l('invalid params object type required!',e));if(t=e.ids,n.isArray(t))for(var o=0;o<t.length;++o){if(i=parseInt(t[o],10),isNaN(i))return r.reject(l('invalid params: ids shall be int type of array'),e);t[o]=i}else{if(t=parseInt(t,10),isNaN(t))return r.reject(l('invalid params: ids shall be int type of array'),e);e.ids=[t]}return a.xhr.simpleCall({query:{func:'user:deleteAppPwds',sid:s.getSid()},data:e},(function(e){r.resolve(e)}),(function(e,t,i){r.reject(l('delete alternative password failed',i))})),r.promise()},addAltPwd:function(e){var t=n.Deferred();return n.isPlainObject(e)?(a.xhr.simpleCall({query:{func:'user:addAppPwd',sid:s.getSid()},data:e},(function(e){t.resolve(e)}),(function(e,i,n){t.reject(l('add alternative password failed',n))})),t.promise()):t.reject(l('invalid params object type required!',e))}}},652:function(e,t,i){(function(e,t){i(918);var n=i(463),a=i(526),s=i(494),l=i(472),r=i(471),o=i(510);i(538),i(486);var c=i(465),d=i(482),u=i(467),p=i(521),f=i(474),m=i(539),v=i(468).get,h=i(488).bytesToSize,b=i(507).formatFileType,g=i(493),_=i(634),y=i(582).save,w=i(522),k=c('file/lbl_accessory_dealings'),x=l.extend({},(function(){var i,s,l=this,r='date',h=!0,b='',x='',S='detail',C=0,T=0,$=new Set;l.events={'click [data-acc-action]':[function(e,i,s){var r=i.closest('[data-acc-id],.u-poptip').data()||{},c=r.accId,d=r.name,u=i.attr('href');switch(t.stop(s,0),e){case'toUserAuth2':return void g.box({});case'more':return void function(e,t){new o({parentNode:l.$(),trigger:e,triggerType:'click',content:n('<ul class="u-menu mfl-acc-submenu"/>').html(e.closest('.item-toolbar').find('span.j-hidden-tool').get().map((function(e){return'<li>'+n(e).html()+'</li>'}))),arrowPosition:1,effect:'fade'}).showOnce().$().data(t)}(i,r);case'savenf':return void _([c]);case'savexnf':return void y([c]);case'toCompose':return void N([c]);case'preview':if('IMG'===m.checkFile(d).type)return void a([{src:u,alt:d}],{beforeShow:t.noop})}open(u+'&mode='+e)},'{{data.accAction}}'],'click .j-back-btn':function(){s.trigger('clearKeyword'),F('')},'click .mfl-acc-item i.checkbox':[function(e){P(e.closest('.mfl-acc-item'),e),l.$('.mfl-acc-listhead i.checkbox').toggleClass('checkbox-checked',$.size>=i),E()},n],'click .mfl-acc-listhead i.checkbox':[function(e){l.$('.mfl-acc-item').each((function(t,i){P(n(i),e)})),E()},n],'click [data-order]':[function(e){h=r===e?!h:'date'===e,r=e,M()}],'click :not(.disabled)[data-mode]':[function(e){S=e,M()}],'click [data-action]':[function(e,i,n){var a=t.map($);switch(e){case'download':var s=i.siblings('.j-download-fake'),l=a.reduce((function(e,t){return e+'&part='+t}),'');s.attr('href',s.attr('data-href')+l),s[0].click();break;case'send':N(a);break;case'toNF':_(a.reverse());break;case'toXNF':y(a.reverse())}}]},delete u.getCurrentState().param.view;var A=v('user.supportnf')&&v('file.savetonf'),I=v('file.ispermitpacagedownload'),D=v('mail.enablewebmailcompose');function M(t){var a=l.$('.j-acc-wrap');t||(T=0),l.$('[data-mode]').removeClass('disabled'),l.$('[data-mode='+S+']').addClass('disabled'),function(e){e.html(!u.getFolderLockedStatus().isAuth&&j.skipFolderTipsTpl())}(a),a[0]&&function(e){'securityLevel'===r&&(r='attn');return p.getAccList({start:e.current*e.limit,limit:e.limit,returnTotal:!0,order:r,filter:{attn:b,attType:x},desc:h})}({current:T,limit:20}).then((function(s,o){C=o.total,t||l.$('.j-toolbar-pagination').pagination({total:C||1,limit:20,currentPage:T,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:function(e){T=e,M(!0)}}),$.clear(),i=s.length,E(),function(t,i){function a(e){return{href:e.href||'javascript:void(0);',title:e.title||'',icon:e.icon||'',action:e.action||''}}(i||[]).forEach((function(t){var i=[],s=e.wmURL({url:'/mbox-data',part:t.partId,mid:t.id});v('user.allowdownloadattachment')&&i.push(a({href:s,title:c('common/download'),icon:'icondownload',action:'download'})),m.getPreviewStatus().isAvailable&&m.checkFilePermit(t.attn,t.attsize)&&i.push(a({href:s,title:c('common/preview'),icon:'iconeye',action:'preview'})),D&&i.push(a({title:c('common/send'),icon:'iconemail',action:'toCompose'})),A&&i.push(a({title:c('common/op_to_netfolder'),icon:'iconsave',action:'savenf'})),t.allowAddToXNF&&i.push(a({title:c('common/op_to_xnffolder'),icon:'iconyin',action:'savexnf'})),t.toolbarMeta=[].concat(i),t.toolbarLength=n.isArray(t.toolbarMeta)?t.toolbarMeta.length:0})),t.append(j(S+'ListTpl',{title:k,lists:i,sort:{order:r,desc:h},enableSecurityLevel:d.enabled})).customRadioCheckbox()}(a,s)})).onFail((function(){n.notify.error(c('file/msg_list_att_fail'))}))}function E(){l.$('[data-action]').attr('disabled',!$.size)}function F(e){l.$('.j-back-btn').toggleClass('f-dn',!e),b=e,M()}function P(e,t){var i=t.hasClass('checkbox-checked');e.toggleClass('checked',i).find('i.checkbox').toggleClass('checkbox-checked',i);var n=e.data();n&&$[i?'add':'delete'](''+n.accId)}function N(e){f.compose({ctype:'attach_part',part:e})}l.after('render',(function(){var e,t;l.$('.mfl-toolbar').html(j.toolbarTpl({sid:u.getSid(),permitSaveToNF:A,permitDownloadPackage:I,permitSaveToXNF:!1,permitSendMail:D})),e=v('file.attsort'),t=l.$('.j-toolbar-filter-type'),e.length?t.dropdown({type:'radio',data:e,callback:function(e){x=e.value||'',M()}}):t.remove(),E(),s=new w({element:l.$('.j-select-wrapper'),placeholder:c('file/msg_search',{name:k})}).on('submit',F),M(),l.subscribe('component.userauth2','auth2Unlocked',M.bind(0,!1)),n.notify.loading('hide')})),l.before('destroy',(function(){s&&s.destroy()}))})),j=i(919).helpers({GetFileFriendlySize:function(e){return!e||e<0?'0K':h(e,0)},GetFileIco:function(e,t){return e&&t?t+b(e):''},GetFileFrom:function(e){var t;return e?t=(t=/^"?(.+)" </.exec(e))?t[1]:e:''},GetSortTypeIcon:function(e,t,i){var n;return n=e&&t&&t===e?i?'<i class="iconfont iconmovedown"></i>':'<i class="iconfont iconmoveup"></i>':'',new s.SafeString(n)},DepartSLFromFilename:function(e){return d.deTagSender(e)[2]}});r.module({name:'file.accessory',template:j},x)}).call(this,i(466),i(464))},653:function(e,t,i){(function(e,t){i(920);var n=i(463);i(538);var a=i(654),s=i(472),l=i(471),r=i(467),o=i(474),c=i(493).init,d=s.extend({},(function(){var i,s=this,l=e.wmURL({url:'XT5/nf/list.jsp'});function d(){var e=r.getFolderLockedStatus(!0).isAuth,t=i.find('.mfl-pnf-auth2lock'),n=i.find('.mfl-pnf-wrap');t.toggleClass('f-dni',e),n.toggleClass('f-dni',!e),e?u():c(t,d)}function u(e){e&&t.stop(e,0),i.mask(),i.find('iframe').attr('src',l).on('load',(function(){var e,t;e=n(this),(t=e.contents()).find('.xt5NfSendToCompose').off('click',m).on('click',m),t.find('.xt5NfSendToShare').off('click',f).on('click',f),t.find('#headControlArea [name="action:goBackToPNF"]').off('click',u).on('click',u),i.mask('destroy')}))}delete r.getCurrentState().param.view,s.after('render',(function(){i=s.$('.mfl-pnf-main'),d(),s.onMessage('fileSavedToNF',d).subscribe('component.userauth2','auth2Unlocked',d),n.notify.loading('hide')}));var p=function(e){return n(e.target).closest('.nffile').data()},f=t.fn(a,r.getConfig('user.uid'),p);function m(e){t.stop(e,0),o.compose({ctype:'attach',mid:p(e).mid})}}));l.module({name:'file.personalnf',template:i(924)},d)}).call(this,i(466),i(464))},654:function(e,t,i){(function(t,n){i(921);var a=i(922),s=a.a,l=a.b,r=i(463),o=i(470),c=o.alert,d=o.confirm,u=i(655),p=i(465),f=i(473),m=i(507).truncateName;e.exports=function(e,i,a){var o,v,h,b=i(a),g=b.name,_=b.fid,y=b.mid;function w(i,n){o.set('message',l({ico:n?'created':'exist',pwd:i.password,url:(v=i,t.wmFullURL({url:'common/nfFile.jsp',sid:[],share_link:v.share_link,uid:e}))})),h=new u(o.$('.j-copy-btn')[0]).on('success',(function(){o.$('.j-copy-success').show()})).on('error',(function(e){console.error('copy error',e)}))}y=y&&y.replace(/.*:/,''),c('',{events:{'click [data-action]':[{del:function(){d(p('file/msg_tips_share_cancel_desc'),{title:p('file/lbl_cancel_share'),onConfirm:function(){t.wmCall('nf:deleteShareLink',n.assign({uid:e},n.pick(v,['share_link_id']))).then((function(){r.notify(p('file/msg_tips_share_cancel_success'))})),o.hide()}})},create:function(){t.wmCall('nf:getOrCreateShareLink',{mid:y,fid:_,uid:e}).then(w)}}]},subClass:'u-nfshare-box',title:f.h(p('file/lbl_share_filename'),m(g,20)),closeTpl:!0,confirmTpl:null,height:270,width:416,afterShow:function(){o=this}}).then((function(){h&&h.destroy()})),t.wmCall({url:'/XT5/jsp/file.jsp',func:'file:getShareLinkInfo',file_id:y||_,net_disk_uid:e,type:y?'file':'folder'}).then((function(e){e.isExist?w(e.shareInfo):o.set('message',s())}))}}).call(this,i(466),i(464))},655:function(e,t,i){var n=i(923),a=i(512),s=i(525),l=i(463),r=i(639),o=a.create({Implements:s,initialize:function(e,t){this.resolveOptions(t),this.listenClick(e)},resolveOptions:function(e){e=e||{},this.action='function'==typeof e.action?e.action:this.defaultAction,this.target='function'==typeof e.target?e.target:this.defaultTarget,this.text='function'==typeof e.text?e.text:this.defaultText},listenClick:function(e){this.trigger=l(e).on('click',l.proxy(this.onClick,this))},onClick:function(e){var t=e.delegateTarget||e.currentTarget;if(r.OIE)return r.setText(this.text(t))?this.emit('success'):this.emit('error'),!1;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new n({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})},defaultAction:function(e){return c('action',e)},defaultTarget:function(e){var t=c('target',e);if(t)return document.querySelector(t)},defaultText:function(e){return c('text',e)},destroy:function(){this.trigger.off('click'),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}});function c(e,t){var i='data-clipboard-'+e;if(t.hasAttribute(i))return t.getAttribute(i)}e.exports=o},656:function(e,t,i){(function(e,t){i(925);var n=i(654),a=i(463),s=i(472),l=i(471),r=i(468).get,o=i(467),c=i(474),d=s.extend({},(function(){var i=this,s=r('file.enfuid'),l=e.wmURL({url:'XT5/nf/enfList.jsp?&uid='+s+'&nav_type=enf'});function d(e){t.stop(e,0),c.compose({ctype:'attach',uid:s,mid:u(e).mid})}delete o.getCurrentState().param.view,i.after('render',(function(){var e=i.$('.mfl-enf-wrap');e.mask(),e.find('iframe').attr('src',l).on('load',(function(){a(this).contents().on('click','.xt5NfSendToCompose',d).on('click','.xt5NfSendToShare',p),e.mask('destroy')})),a.notify.loading('hide')}));var u=function(e){return a(e.target).closest('.nffile').data()},p=t.fn(n,s,u)}));l.module({name:'file.enterprisenf',template:i(926)},d)}).call(this,i(466),i(464))},657:function(e,t,i){(function(e,t){i(927);var n=i(463),a=i(472),s=i(471),l=i(468).get,r=i(470).alert,o=i(465),c=i(467),d=i(474),u=a.extend({},(function(){var i=this,a=e.wmURL({url:'XT5/nf/trsFileList.jsp?fid='+l('file.trsfid')});function s(){var e=i.$('.mfl-trs-wrap'),t=e.find('iframe');e.mask(),t.off('load').attr('src',a).on('load',(function(){!function(e){e.contents().off('click','.xt5TrsSendToCompose').on('click','.xt5TrsSendToCompose',u).off('click','.xt5TrsToComposeBatch').on('click','.xt5TrsToComposeBatch',p)}(t),e.mask('destroy')}))}function u(e){t.stop(e,0),f(n(this).closest('.nffile').data().mid)}function p(){var e=n(this).closest('body').find('.nffile[data-avssafe=true]:has(tr.selected)').get();e[0]?e.some((function(e){return!n(e).data().complete}))?r(o('nf/error_file_not_uploaded')):f(e.map((function(e){return n(e).data().mid}))):r(o('nf/error_send_mail'))}function f(e){d.compose({ctype:'trsAttach',mid:e})}delete c.getCurrentState().param.view,i.after('render',(function(){i.onMessage('trsUpload trsDestroy',s),s(),n.notify.loading('hide')}))}));s.module({name:'file.transitcenter',template:i(928)},u)}).call(this,i(466),i(464))},660:function(e,t,i){var n=i(468),a=i(467).getUser(),s=n.get('user.modifyAlias')||{},l=!!s.maxLength,r=l&&a.email===a.primary_email;e.exports={config:s,enableModify:r,enable:l&&(s.keepEntry||r)}},662:function(e,t,i){(function(t){var n=i(466),a=i(485);e.exports={all:a.of((function(){return n.wmCall('user:listEntrustMaillist').then(t.prop('list')).ignoreCode('FA_FORBIDDEN').onFail([])})),getEntrustMailListAttrs:n.wmBind('user:getEntrustMaillistAttrs'),setEntrustMailListAttrs:n.wmBind('user:setEntrustMaillistAttrs')}}).call(this,i(464))},916:function(e,t,i){(function(e){i(917),i(652),i(653),i(656),i(657);var t=i(472),n=i(471),a=i(519),s=i(465),l=i(467),r=l.getConfig('file')||{},o=e.mapFilter([['personalnf',r.ispermitnf&&{title:s('main/appname_NF'),icon:'iconmyfile'}],['enterprisenf',r.ispermitenf&&{title:s('main/appname_ENF'),icon:'iconcompanyfile'}],['transitcenter',r.ispermittrs&&{title:s('main/appname_BNF'),icon:'iconhubfile'}],['accessory',r.ispermitattmgr&&{title:s('file/lbl_accessory_dealings'),icon:'iconaccfile'}]],(function(t){var i=t[0],a=t[1];return a&&e.assign(a,{id:'file.'+i,module:n.module('file.'+i)})})),c=t.extend({},(function(){var t=this;t.after('render',(function(){var n=l.getFolderLockedStatus(!0).isAuth,s=l.getCurrentState(),r=s.module;delete s.param.view,r='file.'+(r.split('.')[1]||(n?'personalnf':'enterprisenf')),e.objBy(o,'id')[r]||(r=o[0].id),t.before('destroy',(function(){c.destroy()})),t.subscribe('dispatcher','url:changed',(function(e){var t=e.message.newState,i=t.module,n=t.param;c.switchTo(i)&&(delete n.view,l.setCurrentState({module:i,param:n}))}));var c=new a({element:t.$(),classPrefix:'j-file',onlyRenderActive:!0,activeTriggerClass:'nav-sb-current',activeTabId:r,tabs:o}).on('render',i(477).render).on('refresh',i(477).refresh).render()}))}));n.module({name:'file',template:i(929)(o)},c)}).call(this,i(464))},919:function(e,t,i){e.exports=i(469)('<div class="mfl-wrapper"> <div class="main-wrapper mfl-acc-main"> <aside class="mfl-toolbar"></aside> <section class="mfl-acc-wrap j-acc-wrap u-scroll"></section> </div> </div>',{toolbarTpl:'<div class="u-btns j-toolbar-filter-type"> <span class="u-btn u-btn-default" data-dropdown="switchSort"> <span class="btntxt">{{i18n "common/op_view"}}</span> <i class="iconfont icondown"></i> </span> </div> <div class="u-input-control f-wa"> <div class="u-btns"> {{#if permitDownloadPackage}} <button class="u-btn u-btn-default" data-action="download">{{i18n "common/download"}}</button> {{/if}} {{#if permitSendMail}} <button class="u-btn u-btn-default" data-action="send">{{i18n "common/send"}}</button> {{/if}} <a data-href="../s?sid={{sid}}&func=mbox%3apackMessage" target="_blank" class="f-dn j-download-fake"></a> </div> {{#if permitSaveToNF}} <button class="u-btn u-btn-default" data-action="toNF">{{i18n "common/op_to_netfolder"}}</button> {{/if}} {{#if permitSaveToXNF}} <button class="u-btn u-btn-default" data-action="toXNF">{{i18n "common/op_to_xnffolder"}}</button> {{/if}} </div> <span class="u-btn u-btn-default f-dn j-back-btn">{{i18n "main/bt_back"}}</span> <div class="u-btns"> <button class="u-btn u-btn-default" data-mode=thumbnail title="{{i18n \'nf/view_thumbnail\'}}"><i class="iconfont iconblock"></i></button> <button class="u-btn u-btn-default" data-mode=detail title="{{i18n \'nf/view_detail\'}}"><i class="iconfont iconlist"></i></button> </div> <div class="mfl-toolbar-filter-name j-select-wrapper"></div> <div class="mfl-toolbar-pagination j-toolbar-pagination"></div>',skipFolderTipsTpl:'<div class="u-alert u-alert-warning"> <strong><i class="iconfont iconring"></i></strong> {{i18n "file/msg_att_mgr_skip_locked"}} <a class="link" data-acc-action="toUserAuth2">{{i18n "file/msg_att_mgr_auth2_do"}}</a> </div>',detailListTpl:'<div class="mfl-acc-list"> <div class="mfl-acc-listhead"> <table class="u-table u-table-row"> <thead> <tr> {{#if lists}} <th class="col-chk"> <span> <input type="checkbox" class="u-input" name="chargeOther" /> </span> &nbsp; <a href="javascript:void(0);" data-order="attn">{{title}}</a> {{GetSortTypeIcon \'attn\' sort.order sort.desc}} </th> {{#if enableSecurityLevel}} <th class="col-securityLevel"> {{i18n "common/lbl_attach_level"}} </th> {{/if}} <th class="col-size"> <a href="javascript:void(0);" data-order="attsize">{{i18n "file/lbl_email_size"}}</a> {{GetSortTypeIcon \'attsize\' sort.order sort.desc}} </th> <th class="col-date"> <a href="javascript:void(0);" data-order="date">{{i18n "file/lbl_email_date"}}</a> {{GetSortTypeIcon \'date\' sort.order sort.desc}} </th> <th class="col-subject"> <a href="javascript:void(0);" data-order="subject">{{i18n "file/lbl_email_subject"}}</a> {{GetSortTypeIcon \'subject\' sort.order sort.desc}} </th> <th class="col-from"> <a href="javascript:void(0);" data-order="from">{{i18n "file/lbl_email_send"}}</a> {{GetSortTypeIcon \'from\' sort.order sort.desc}} </th> {{else}} <th class="col-chk">{{i18n "file/lbl_accessory_dealings"}}</th> {{#if enableSecurityLevel}} <th class="col-securityLevel">{{i18n "common/lbl_attach_level"}}</th> {{/if}} <th class="col-size">{{i18n "file/lbl_email_size"}}</th> <th class="col-date">{{i18n "file/lbl_email_date"}}</th> <th class="col-subject">{{i18n "file/lbl_email_subject"}}</th> <th class="col-from">{{i18n "file/lbl_email_send"}}</th> {{/if}} </tr> </thead> </table> </div> <div class="mfl-acc-lists mfl-acc-details"> {{#if lists}} <table class="u-table u-table-row"> <tbody> {{#each lists}} <tr class="mfl-acc-item" data-acc-id="{{id}}/{{partId}}" data-name="{{attn}}"> <td class="col-chk"> <span> <input type="checkbox" class="u-input j-item-chk" /> </span> </td> <td class="col-name"> <i class="file-small-icon {{GetFileIco attn \'icon-small-\'}}"></i> {{#if attn}} <span title="{{attn}}">{{attn}}</span> {{else}} <span>&nbsp;</span> {{/if}} </td> <td class="col-tool"> <span class="item-toolbar"> {{#each toolbarMeta}} {{#if (lt @index 2)}} <a href="{{href}}" data-acc-action="{{action}}" title="{{title}}"><i class="iconfont {{icon}}"></i></a> {{^}} <span class="f-dni j-hidden-tool"> <i class="iconfont {{icon}} left"></i> <a href="{{href}}" data-acc-action="{{action}}" title="{{title}}">{{title}}</a> </span> {{/if}} {{/each}} {{#if (ge toolbarLength 3)}} <a href="javascript:void(0);" data-acc-action="more" title="{{i18n \'common/more\'}}"><i class="iconfont iconsliderh"></i></a> {{/if}} </span> </td> {{#if ../enableSecurityLevel}} <td class="col-securityLevel"> {{DepartSLFromFilename attn}} </td> {{/if}} <td class="col-size"> {{#if attsize}} {{GetFileFriendlySize attsize}} {{else}} &nbsp; {{/if}} </td> <td class="col-date"> {{#if sentDate}} {{GetDateYMDHm sentDate}} {{else}} &nbsp; {{/if}} </td> <td class="col-subject" title="{{subject}}"> {{#if subject}} {{subject}} {{else}} &nbsp; {{/if}} </td> <td class="col-from" title="{{from}}"> {{#if from}} {{GetFileFrom from}} {{else}} &nbsp; {{/if}} </td> </tr> {{/each}} </tbody> </table> {{else}} {{{i18n "file/msg_list_att_blank"}}} {{/if}} </div> </div>',thumbnailListTpl:'<div class="mfl-acc-list"> <div class="mfl-acc-listhead"> <div class="list-title"> {{#if lists}} <span> <input type="checkbox" class="u-input" name="chargeOther" /> </span> &nbsp; {{/if}} {{title}} </div> </div> <div class="mfl-acc-lists mfl-acc-tns"> {{#if lists}} <ul class="mfl-acc-tns-main"> {{#each lists}} <li class="mfl-acc-item" data-acc-id="{{id}}/{{partId}}" data-name="{{attn}}"> <span class="tn-ico file-big-icon {{GetFileIco attn \'icon-big-\'}}"></span> <span class="tn-title">{{attn}}</span> <span class="tn-chk"> <input type="checkbox" class="u-input j-item-chk" /> </span> <span class="item-toolbar"> <span class="mask"></span> {{#if (le toolbarLength 2)}} <span>&nbsp;</span> {{#each toolbarMeta}} <a href="{{href}}" data-acc-action="{{action}}" title="{{title}}"><i class="iconfont {{icon}}"></i></a> {{/each}} <span>&nbsp;</span> {{^}} {{#each toolbarMeta}} <a href="{{href}}" data-acc-action="{{action}}" title="{{title}}"><i class="iconfont {{icon}}"></i></a> {{/each}} {{/if}} <span class="left-fix"></span> </span> </li> {{/each}} </ul> {{else}} {{{i18n "file/msg_list_att_blank"}}} {{/if}} </div> </div>'})},922:function(e,t,i){e.exports=i(469)('',{a:'<div class="nfshare-box-content"> <div class="nfshare-create-link"> <div class="nfshare-create-desc"> <i class="iconfont iconinformation"></i> <span>{{i18n "file/lbl_share_desc"}}</span> </div> </div> <div class="f-tac"> <button class="u-btn u-btn-primary btn-create" data-action=create>{{i18n "file/lbl_create_link"}}</button> </div> </div>',b:'<div class="nfshare-box-content"> <div class="nfshare-top"> <i class="iconfont iconpass"></i> <span>{{i18n (join "file/msg_tips_share_link_" ico)}}</span> <button class="u-btn u-btn-default f-fr f-mgr btn-cancel" data-action=del>{{i18n "file/lbl_cancel_share"}}</button> </div> <div class="nfshare-middle"> <div class="u-form-item"> <label class="u-form-label">{{i18n "file/lbl_share_link"}}</label> <input type="text" class="u-input share-link" readonly value="{{url}}"> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "file/lbl_share_code"}}</label> <input type="text" class="u-input share-code" readonly value="{{pwd}}"> <span class="f-mgl f-dn j-copy-success">{{i18n "file/msg_tips_share_copy_success"}}</span> </div> </div> <div class="nfshare-bottom"> <span class="gray">{{i18n "file/msg_tips_share_file_desc"}}</span> <button class="u-btn u-btn-primary f-mgr f-fr j-copy-btn" title="{{i18n \'file/lbl_copy_info\'}}" data-clipboard-action="copy" data-clipboard-text="{{i18n \'prop:file/msg_tips_share_link_template\' 0=url 1=pwd}}"> {{i18n "file/lbl_copy_info"}} </button> </div> </div>'})},923:function(e,t,i){var n=i(512),a=i(463);function s(e){var t;if('INPUT'===e.nodeName||'TEXTAREA'===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute('contenteditable')&&e.focus();var i=window.getSelection(),n=document.createRange();n.selectNodeContents(e),i.removeAllRanges(),i.addRange(n),t=i.toString()}return t}var l=function(e,t){return t&&function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e,t),e},r=n.create({initialize:function(e){this.resolveOptions(e),this.initSelection(),this.initPropCheck()},resolveOptions:function(e){e=e||{},this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=''},initSelection:function(){this.text?this.selectFake():this.target&&this.selectTarget()},initPropCheck:function(){l(this,[{key:'action',set:function(){var e=arguments.length<=0||arguments[0]===undefined?'copy':arguments[0];if(this._action=e,'copy'!==this._action&&'cut'!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}}]),l(this,[{key:'target',set:function(e){if(e!==undefined){if(!e||'object'!=(void 0===e?'undefined':typeof e)||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if('copy'===this.action&&e.hasAttribute('disabled'))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if('cut'===this.action&&(e.hasAttribute('readonly')||e.hasAttribute('disabled')))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}])},selectFake:function(){var e='rtl'==document.documentElement.getAttribute('dir');this.removeFake(),this.fakeHandler=document.body.addEventListener('click',a.proxy(this.removeFake,this)),this.fakeElem=document.createElement('textarea'),this.fakeElem.style.fontSize='12pt',this.fakeElem.style.border='0',this.fakeElem.style.padding='0',this.fakeElem.style.margin='0',this.fakeElem.style.position='fixed',this.fakeElem.style[e?'right':'left']='-9999px',this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+'px',this.fakeElem.setAttribute('readonly',''),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=s(this.fakeElem),this.copyText()},removeFake:function(){this.fakeHandler&&(document.body.removeEventListener('click'),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},selectTarget:function(){this.selectedText=s(this.target),this.copyText()},copyText:function(){var e;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)},handleResult:function(e){e?this.emitter.emit('success',{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit('error',{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},clearSelection:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},destroy:function(){this.removeFake()}});e.exports=r},924:function(e,t,i){e.exports=i(469)('<div class="mfl-wrapper"> <div class="main-wrapper mfl-pnf-main"> <div class="mfl-pnf-auth2lock f-dni"></div> <section class="mfl-pnf-wrap jfl-pnf-wrap u-scroll f-dni"> <iframe scrolling="no" frameborder="0" src=""></iframe> </section> </div> </div>',{})},926:function(e,t,i){e.exports=i(469)('<div class="mfl-wrapper"> <div class="main-wrapper mfl-enf-main"> <section class="mfl-enf-wrap jfl-enf-wrap u-scroll"> <iframe scrolling="no" frameborder="0" src=""></iframe> </section> </div> </div>',{})},928:function(e,t,i){e.exports=i(469)('<div class="mfl-wrapper"> <div class="main-wrapper mfl-trs-main"> <section class="mfl-trs-wrap jfl-trs-wrap u-scroll"> <iframe scrolling="no" frameborder="0" src=""></iframe> </section> </div> </div>',{})},929:function(e,t,i){e.exports=i(469)('<section class="m-file"> <div class="nav-main"> <aside class="g-sidebar"> <div class="fl-m-nav-bg"></div> <ul class="m-nav j-file-nav"> {{#each this}} <li> <a class="m-nav-trigger" href="javascript:void(0)" data-trigger={{id}} title="{{title}}"> <span> <i class="iconfont {{icon}}"></i> {{title}} </span> </a> </li> {{/each}} </ul> </aside> <article class="fl-g-content"> <div class="fl-g-content-bg"></div> <div class="fl-g-content-main j-file-content"></div> </article> </div> </section>',{})},941:function(e,t,i){i(942);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(466),o=i(465),c=i(468).get,d=a.extend({Implements:l,events:{'click .j-list-item':'_handleTrigger','click .j-targetToMain':'_handleTargetToMain'},attrs:{className:'',frameMode:null},Statics:{DEFAULT_TITLE:o('appcenter/my_app'),SYS_APPS:[{id:'logs',label:o('main.Service'),disMode:'inner',icon:'iconsreachm',disabled:!c('user.enableselfservice')},{id:'quarantine',label:o('appcenter/quarantine_Centre'),disMode:'inner',icon:'iconquarantinemail',disabled:!c('user.enableQuarantine')},{id:'skins',label:o('main/SkinCentre'),disMode:'inner',background:'#5a81ef',icon:'icontie'}]},setup:function(){var e;this.model={sysApps:d.SYS_APPS,intgApps:(e=c('appcenter.externallinks')||[],n.each(e,(function(e,t){t.background&&(t.background='url("'+t.background+'")')})),c('appcenter.enableaq')&&e.push({disMode:'newWin',id:'aq',label:o('main/appname_AQ'),url:r.wmURL({url:'common/ext/archRouter.jsp'}),icon:'iconsreachm'}),e),cloudApps:[]}},render:function(){var e=this;d.superclass.render.call(this),e.element.hide(),n.notify.loading(),e._preRender(),e.toggleList(),r.wmCall({url:'/XT5/jsp/appcenter.jsp',func:'getCloudAppList'}).then((function(t){n.each(t,(function(e,t){t.logo?(t.background='url("data:image/jpg;base64,'+t.logo+'")',t.icon=''):t.icon='iconunknownapp',t.label=t.name,t.url=t.appUrl,t.disMode='newWin'})),e.model.cloudApps=t||[],t.length>0&&e._renderCloudAppsList(),e.toggleList()}))},destroy:function(){d.superclass.destroy.call(this)},_preRender:function(){this.element.show(),n.notify.loading('hide'),this.$('.j-sys-list').html(this.compile(this.$('#listItemsTpl').html(),this.model.sysApps)),this.$('.j-intg-list').html(this.compile(this.$('#listItemsTpl').html(),this.model.intgApps))},_renderCloudAppsList:function(){this.$('.j-cloud-list').html(this.compile(this.$('#listItemsTpl').html(),this.model.cloudApps))},_handleTrigger:function(e){var t=e.target||e.srcElement,a=n(t).closest('a'),s=a.data('dismode'),l=a.data('label');switch(s){case'inner':i(477).go(a.data('module'));break;case'mainFrame':this.set('frameMode',{title:l,url:a.data('url')});break;case'newWin':window.open(a.data('url'));break;case'popWin':window.open(a.data('url'),'',a.data('features'))}},toggleList:function(){var e=n.map(this.model,(function(e,t){return 0===e.length?'appcenter-type-hidden'.replace(/type/,t.slice(0,-4)):null})).join(' ');this.element.removeClass((function(e,t){return(t.match(/\bappcenter-\S+-hidden/g)||[]).join(' ')})).addClass(e)},_handleTargetToMain:function(e){this.set('frameMode',null)},_onRenderFrameMode:function(e){e?(this.$('.j-desc').text(e.title),this.$('.j-cloud-app iframe').attr('height',this.element.height()),this.$('.j-cloud-app iframe').attr('src',e.url),this.element.addClass('appcenter-iframe-mode')):(this.$('.j-desc').text(d.DEFAULT_TITLE),this.$('.j-cloud-app iframe').attr('src',''),this.element.removeClass('appcenter-iframe-mode'))}});s.module({name:'appcenter',template:i(943)},d)},943:function(e,t){e.exports='<section class="m-appcenter">\n  <div class="title">\n    <span class="target j-targetToMain"><i class="iconfont iconbackup"></i></span>\n    <span class="j-desc">{{i18n "appcenter/my_app"}}</span>\n  </div>\n\n  <div class="content">\n    <div class="group group-sys">\n      <div class="group-desc">\n        <i class="iconfont iconsystemapp"></i>\n        <span>{{i18n "appcenter/sys_app"}}</span>\n      </div>\n      <ul class="group-list j-sys-list"></ul>\n    </div>\n\n    <div class="group group-intg">\n      <div class="group-desc">\n        <i class="iconfont iconotherapp"></i>\n        <span>{{i18n "appcenter/intg_app"}}</span>\n      </div>\n      <ul class="group-list j-intg-list"></ul>\n    </div>\n\n    <div class="group group-cloud">\n      <div class="group-desc">\n        <i class="iconfont iconspreadapp"></i>\n        <span>{{i18n "appcenter/cloud_app"}}</span>\n      </div>\n      <ul class="group-list j-cloud-list"></ul>\n    </div>\n  </div>\n\n  <div class="cloud-container j-cloud-app">\n    <iframe src="" width="100%" height="100%" frameborder="0"></iframe>\n  </div>\n\n  {{#raw}}\n  <script type="text/x-handlebars-template" id="listItemsTpl">\n    [[#each .]]\n    [[#unless disabled]]\n    <li class="list-item j-list-item">\n        <a href="javascript:void(0)" data-label="[[label]]" data-module="[[id]]" data-dismode="[[disMode]]" data-url="[[url]]" data-features="[[features]]">\n          <i class="icon-app iconfont [[#if icon]] [[icon]] [[else]] [[#unless background]]iconunknownapp [[/unless]] [[/if]]"\n             [[#if background]] style="background:[[background]]" [[/if]]></i>\n          <span class="list-item-label">\n            [[label]]\n          </span>\n        </a>\n    </li>\n    [[/unless]]\n    [[/each]]\n  <\/script>\n  {{/raw}}\n</section>\n\n'},944:function(e,t,i){(function(e){i(945);var t=i(463),n=i(472),a=i(471),s=i(480),l=i(476),r=i(468).get,o=i(465),c=n.extend({Implements:s,events:{'click [data-action]:not(.m-theme-item.selected)':'_dispatchAction'},render:function(){c.superclass.render.call(this),this._initView()},_initView:function(){var e=this;l.getFaces().then((function(t){var i=t[0],n=t[1];e.facesModel={faces:i.faces,skins:n.skins,locales:n.locales,currentFace:r('context.face'),currentLocale:r('context.locale')||'zh_CN',currentSkin:r('context.skin')||'blue'},e._generateView()}))},_dispatchAction:function(e,i){switch(t(i).data('action')){case'change':this._changeFaceSettings(i);break;case'back':this._handleReturn()}},_handleReturn:function(){i(477).go('appcenter')},_generateView:function(){var e=this.compile(this.$('#facesettpl').html(),this.facesModel);this.$('div.content-wrapper').html(e)},_changeFaceSettings:function(i){var n=this,a=t(i).data('type');t(i).hasClass('selected')||(t.notify.success(o('setting/msg_faceUpdateSuccess')),setTimeout((function(){var i=t(document.getElementsByTagName('head')[0]).find('.skin-scheme').eq(0),s=t('<link type="text/css" rel="stylesheet" />'),c=e.pv()+'/style/dist/'+a+'/skin.css';s.on('load',(function(){i.attr('href',c),s.remove(),n.facesModel.currentSkin=a,n.facesModel.faces[r('context.face')].preferredSkin=a,n.publish('changed',n.facesModel),n._generateView(),l.changeFacesettings({skin:a}).then((function(e){e&&e.changed?t.notify.success(o('setting/msg_faceUpdateDone')):t.notify.error(o('setting/msg_faceUpdateFailed'))}))})).on('error',(function(){return t.notify.error(o('setting/msg_faceUpdateFailed'))})),i.after(s),s.attr('href',c)}),1e3))}});a.module({name:'skins',template:i(946)},c)}).call(this,i(478))},946:function(e,t){e.exports='<section class="m-skin-set">\r\n  <div class="u-m-title">\r\n    <div class="f-fl">\r\n      <p data-action="back">\r\n        <label>\r\n          <span class="icon-back"></span>\r\n          <span class="f-csp">{{i18n "appcenter/tab_skin_center"}}</span>\r\n        </label>\r\n      </p>\r\n    </div>\r\n  </div>\r\n  <div class="content-wrapper">\r\n\r\n  </div>\r\n  {{#raw}}\r\n  <script id="facesettpl" type="text/x-handlebars-template">\r\n    <div class="u-theme-container">\r\n      [[#each skins]]\r\n      <div class="m-theme-item f-ib f-csp [[#compare @key \'==\' ../currentSkin]]selected[[/compare]]" data-type="[[@key]]" data-action="change">\r\n        <img src="5d61e4c0/style/img/skins/[[@key]]/thumbnail.png" alt="[[this]]" />\r\n        <div class="u-skin-desc [[@key]]">[[this]] [[#compare @key \'==\' ../currentSkin]] [[i18n \'appcenter/skin_is_in_use\']] [[/compare]]</div>\r\n        [[#compare @key \'==\' ../currentSkin]]\r\n        <div class="u-picked-icon "></div>\r\n        [[/compare]]\r\n      </div>\r\n      [[/each]]\r\n    </div>\r\n  <\/script>\r\n\r\n  {{/raw}}\r\n\r\n</section>'},947:function(e,t,i){(function(e){i(486),i(948);var t=i(463),n=i(471),a=i(523),s=i(470).confirm,l=i(466),r=i(465),o=i(522),c=i(950),d=a.extend({},(function(){var n,a,c,d,u=this,p=0;function f(e){p=0,e&&(c=d=null),u.$('.j-deliver,.j-delete').attr('disabled',!0),u.sendMessage('quarantine','view:reload',null)}function m(i){var n=r('appcenter/btn_quarantine_'+i);s(r('appcenter/msg_quarantine_confirm',{op:n}),(function(){u.element.mask(),l.wmCall('quarantine:'+i,{tids:e.map(u.$('.j-list td > .checkbox-checked').toArray(),(function(e){return t(e).prev('input[type=checkbox]').data('tid')}))}).then((function(a){var s=a.total,l=a.fails,o=r('appcenter/msg_quarantine_msg',{op:n,total:s,failNum:Object.values(l).length}),u=e.sumBy(l,(function(e){return[5011,5012,5013].includes(e)}));u&&(o+=' '+r('appcenter/msg_quarantine_handled',{num:u})),t.notify.success(o),c=i,d=l,f()})).onFail(t.notify.error.bind(0,r('appcenter/msg_quarantine_failed',{op:n}))).either((function(){u.element.mask('hide')}))}))}function v(e){n=e?[{field:'keyword',operator:'contains',operand:e}]:[],u.sendMessage('quarantine','view:reload',null)}u.events={'click [data-action]':[{back:function(){i(477).go('appcenter')},refresh:f,deliver:m,'delete':m}],'change.crc .j-checkbox-all':function(e,i){u.$('.j-checkbox').each((function(e,n){t(n).prop('checked')!==t(i).prop('checked')&&t(n).trigger('click')}))},'change.crc .j-checkbox':function(e,i){var n=t(i);n.closest('tr').toggleClass('checked'),n.prop('checked')?p+=1:p-=1,u.$('.j-deliver,.j-delete').attr('disabled',0===p)}},u.pageSizeOptions=[10,[20,!0],50,100],u.after('render',(function(){u.element.customRadioCheckbox(),u.$('.j-search-view').data('init',!0),(a=new o({element:u.$('.j-select-wrapper'),placeholder:r('appcenter/lbl_quarantine_hint')})).on('submit',v).on('clear',(function(){n=[]})),v()})),u.before('destroy',(function(){a&&a.destroy()})),u.requestData=function(i){return l.wmCall('quarantine:search',e.assign({conditions:n},i)).then((function(t){var i=u.$('.j-search-view');i.data('init')&&i.data('init',!1).removeClass('f-dn');var n=t.data;return e.isEmpty(d)||(n.forEach((function(e){e.errorCode=d[e.tid]})),n.errorAction=c),l.resolve(n,t)})).catchCode('FS_QUARANTINE_ERROR',t.notify.error.bind(0,r('appcenter/msg_quarantine_failed',{op:r('appcenter/btn_quarantine_query')})))}}));n.module({name:'quarantine',template:c},d)}).call(this,i(464))},950:function(e,t,i){e.exports=i(469)('<section class="m-quarantine"> <div class="hd"> <div class="hd-tt"> <p data-action="back"> <label> <i class="iconfont iconbackup"></i> <span class="f-csp">{{i18n \'appcenter/quarantine_Centre\'}}</span> </label> </p> </div> <div class="hd-reload"> <span class="u-btn u-btn-default u-btn-round" data-action="refresh"> <i class="iconfont iconrevocation"></i> </span> </div> </div> <div class="operation"> <div class="u-btns"> <button type="button" class="u-btn u-btn-primary j-deliver" data-action="deliver" disabled> {{i18n \'appcenter/btn_quarantine_deliver\'}} </button> <button type="button" class="u-btn u-btn-default j-delete" data-action="delete" disabled> {{i18n \'appcenter/btn_quarantine_delete\'}} </button> <div class="f-ib j-select-wrapper"></div> </div> </div> <div class="search-view f-dn j-search-view"> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"></div> </div> <div class="lst-ct j-list"></div> </div> </div> </section>',{logsListTpl:'<table> <tr> <th style="width: 30px"><input type="checkbox" class="j-checkbox-all"></th> <th>{{i18n \'appcenter/lbl_quarantine_receive_time\'}}</th> <th>{{i18n \'appcenter/lbl_quarantine_subject\'}}</th> <th>{{i18n \'appcenter/lbl_quarantine_sender\'}}</th> <th>{{i18n \'appcenter/lbl_quarantine_sender_ip\'}}</th> {{#if list.errorAction}}<th>{{i18n (join \'appcenter/lbl_quarantine_error_\' list.errorAction)}}</th>{{/if}} </tr> {{#each list}} <tr> <td><input type="checkbox" class="j-checkbox" data-tid="{{tid}}"></td> <td>{{receivetime}}</td> <td data-collapse>{{subject}}</td> <td>{{sender}}</td> <td>{{ip}}</td> {{#if ../list.errorAction}} <td class="error"> {{if$ errorCode (i18n (join \'pub/repost_email_fail_\' errorCode) defaultValue=(i18n \'pub/repost_email_fail_0\'))}} </td> {{/if}} </tr> {{/each}} </table>'})},951:function(e,t,i){i(952);var n=i(499),a=i(467).getCurrentState,s=i(468).get,l=i(465);var r=i(953);n('logs',{i18nPrefix:'appcenter/tab_%_query'},(function(){var e=this;e.events={'click .hd [data-action]':[{back:function(){i(477).go('appcenter')},reload:function(){e.sendMessage(a().module,'view:reload',null)}}]},e.after('render',(function(){s('user.enableselfservice')?(e.$().prepend(r()),e.subscribe('dispatcher','view:changed',(function(t){var i=t.message.newState.module;'logs.send'!==i&&'logs.receive'!==i||e.sendMessage(i,'view:auth',null)}))):e.$().html(l('common/selfservice_forbid'))}))}))},953:function(e,t,i){e.exports=i(469)('<div class="hd"> <div class="hd-tt"> <p data-action="back"> <label> <i class="iconfont iconbackup"></i> <span class="f-csp">{{i18n \'main.Service\'}}</span> </label> </p> </div> <div class="hd-reload"> <span class="u-btn u-btn-default u-btn-round" data-action="reload"> <i class="iconfont iconrevocation"></i> </span> </div> </div>',{})},954:function(e,t,i){i(486);var n=i(471),a=i(523),s=i(479),l=i(465),r=i(473).h,o=i(466),c=a.extend({requestData:o.wmBind('user:listLoginHistory',{ipFormat:'{0} ({1})'})});n.module({name:'logs.login',template:i(955).helpers({parseResult:function(e){var t=e.result,i=e.cnt,n=e.c,a=e.logintime,o='<span class="label-'+(1===t?'success':'fail')+'">'+l('appcenter/msg_login_result_'+t)+'</span>  ';return i>1&&2===t&&(o+=r(l('appcenter/msg_login_detail_'+(n.ban?3:2)),[i,n.ban])),i>1&&1===t&&(o+=r(l('appcenter/msg_login_detail_1'),[i,s(a).format('HH:mm:ss')])),o}})},c)},955:function(e,t,i){e.exports=i(469)('<section class="m-llogin ct-view grid-row"> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "prop:appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"> </div> </div> <div class="lst-ct j-list"></div> </div>  </section>',{logsListTpl:'<table> <tr> <th>{{i18n "appcenter/lbl_login_time"}}</th> <th>{{i18n "appcenter/lbl_login_result"}}</th> <th>{{i18n "appcenter/lbl_login_method"}}</th> <th>{{i18n "appcenter/lbl_login_ip"}}</th> </tr> {{#each list}} <tr> <td>{{GetDateYMDHm lastlogintime}}</td> <td>{{{parseResult this}}}</td> <td>{{i18n (join \'mbox/login_type_\' logintype)}}</td> <td>{{ip}}</td> </tr> {{/each}} </table>'})},956:function(e,t,i){(function(e){i(486);var t=i(463),n=i(471),a=i(523),s=i(468).get,l=i(578),r=i(465),o=i(474),c=a.extend({withAuth:1},(function(){var i=this;i.events={'click [data-toggle]':[function(e,t){t.siblings('i').toggleClass('iconunfold iconcollapse'),i.$('tr[data-index='+e+']:gt(0)').toggle()}],'click [data-recall]':[function(t,n){var a=n.data(),s=a.mid,r=a.to,o={mid:s,tid:t,rcpts:e.array(r)};l(o).truthy().then(i._fetchData.bind(i))}]};var n=function(e,i,n){return t('<a>',{'data-recall':e.tid,'data-mid':e.msgid,'data-to':n,'class':'link',text:i}).prop('outerHTML')};i.requestData=function(t){return o.listDeliveryHistory(e.assign({group:!0},t)).onRTN((function(e){e.forEach((function(e){var t;(e.all=[e].concat(e.group||[])).forEach((function(i){var a=o.getDSInfoHtml(i);i.dsHtml=a[0],i.recallable&&0===i.rclResult&&(509!==i.result||s('mail.enableRecallReadMail'))&&(i.recall=n(e,r('mbox/bt_recall'),e.group&&(i.to||'')),t=1)})),e.recallAll=t&&n(e,r('mbox/bt_recallAll'))}))}))}}));n.module({name:'logs.send',template:i(957)},c)}).call(this,i(464))},957:function(e,t,i){e.exports=i(469)('<section class="m-lsend ct-view grid-row"> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"></div> </div> <div class="lst-ct j-list"></div> </div>  </section>',{logsListTpl:'<table> <tr> <th>{{{i18n "mbox/mail_time"}}}</th> <th>{{i18n "mbox/mail_subject"}}</th> <th>{{i18n "mbox/mail_to"}}</th> <th>{{i18n "mbox/mail_sent_state"}}</th> <th>{{i18n "mbox/mail_op"}}</th> </tr> {{#each list}} {{#if group}} <tr data-index={{@index}}> <td>{{GetDateYMDHm modtime}}</td> <td title="{{subj}}">{{subj}}</td> <td> <div> <label > <i class="iconfont iconunfold"></i> <a class=link data-toggle={{@index}}> {{i18n "mbox/mail_allto"}} ({{math group.length \'+\' 1}}) </a> </label> </div> </td> <td></td> <td>{{{recallAll}}}</td> </tr> {{#each all}} <tr data-index={{@../index}} class=f-dn> <td></td> <td></td> <td>{{#if to_name}}"{{to_name}}"{{/if}} {{to}}</td> <td>{{{dsHtml}}}</td> <td>{{{recall}}}</td> </tr> {{/each}} {{^}} <tr data-index={{@index}}> <td>{{GetDateYMDHm modtime}}</td> <td data-collapse>{{subj}}</td> <td>{{#if to_name}}"{{to_name}}"{{/if}} {{to}}</td> <td>{{{dsHtml}}}</td> <td>{{{recall}}}</td> </tr> {{/if}} {{/each}} </table>'})},958:function(e,t,i){i(486);var n=i(471),a=i(523),s=i(466),l=i(464),r=i(474),o=a.extend({withAuth:1},(function(){var e=this,t=-1;e.events={'click [data-fid]':[function(i,n){n.siblings().removeClass('active').end().addClass('active'),t=i,e.reload()}]},e.requestData=function(e){return r.fdrList().then((function(i){var n={0:[2,3,4],'-1':[2,3,4,5,6]}[t],a=n?l.difference(l.map(i,'id'),n):+t;return s.wmCall('mbox:listMessages',l.assign({fid:a,order:'receivedDate',desc:!0,returnTotal:!0},e))}))}}));n.module({name:'logs.receive',template:i(959)},o)},959:function(e,t,i){e.exports=i(469)('<section class="m-lreceive ct-view grid-row"> <div class="v-filter"> <span class="label">{{i18n "appcenter/lbl_receive_source"}}：</span> <ul class="groups"> <li data-fid="0" class="active"><span>{{i18n "mbox/alt_all_receive"}}</span></li> <li data-fid="-1"><span>{{i18n "mbox/alt_inbox_person"}}</span></li> <li data-fid="5"><span>{{i18n "mbox/alt_junkMails"}}</span></li> <li data-fid="6"><span>{{i18n "mbox/alt_virus_folder"}}</span></li> </ul> </div> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"></div> </div> <div class="lst-ct j-list"></div> </div>  </section>',{logsListTpl:'<table> <tr> <th>{{i18n "mbox/receive_time"}}</th> <th>{{i18n "mbox/receive_subject"}}</th> <th>{{i18n "mbox/receive_from"}}</th> <th>{{i18n "mbox/receive_storage"}}</th> </tr> {{#each list}} <tr> <td>{{receivedDate}}</td> <td data-collapse>{{subject}}</td> <td>{{from}}</td> <td>{{lookup (folder$ fid) \'name\'}}</td> </tr> {{/each}} </table>'})},960:function(e,t,i){(function(e){i(486);var t=i(471),n=i(523),a=i(465),s=i(466),l=6,r=[0,5,105],o=[1,8,101,102,154],c={OTH:[l].concat(r,o),CUS:[2,3,4,7,9,10,11,103,104,106,150,151,152,153,155]},d=n.extend({},(function(){var t=this;t.events={'click [data-type]':[function(e,n){n.siblings().removeClass('active').end().addClass('active'),i=(c[e]||[]).join(),t.reload()}]};var i='';t.requestData=function(t){return s.wmCall('user:listDelmsgHistory',e.assign({loginType:i},t)).onRTN(u)}}));function u(e){e.forEach((function(e){var t,i;e.note=a('mbox/delete_info_'+(t=e.logintype||0,i=e.deletetype,t===l?'recall':1===i?'auto':r.includes(t)?'sys':o.includes(t)?'web':'cus'))}))}t.module({name:'logs.delete',template:i(961)},d)}).call(this,i(464))},961:function(e,t,i){e.exports=i(469)('<section class="m-ldelete ct-view grid-row"> <div class="v-filter"> <span class="label">{{i18n "appcenter/lbl_receive_source"}}：</span> <ul class="groups"> <li data-type="ALL" class="active"><span>{{i18n "mbox/alt_all_delete"}}</span></li> <li data-type="CUS"><span>{{i18n "mbox/alt_plugins_delete"}}</span></li> <li data-type="OTH"><span>{{i18n "mbox/bt_others_delete"}}</span></li> </ul> </div> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"></div> </div> <div class="lst-ct j-list"></div> </div>  </section>',{logsListTpl:'<table> <tr> <th>{{i18n "mbox/delete_time"}}</th> <th>{{i18n "mbox/delete_subject"}}</th> <th>{{i18n "mbox/delete_from"}}</th> <th>{{i18n "mbox/delete_information"}}</th> </tr> {{#each list}} <tr> <td>{{GetDateYMDHm deletetime}}</td> <td data-collapse>{{subj}}</td> <td>{{from}}</td> <td>{{note}}</td> </tr> {{/each}} </table>'})},962:function(e,t,i){i(486);var n=i(471),a=i(523),s=i(466),l=a.extend({requestData:s.wmBind('user:listTrsFileDownloadHistory')});n.module({name:'logs.trs',template:i(963)},l)},963:function(e,t,i){e.exports=i(469)('<section class="m-ltrs ct-view grid-row"> <div class="v-lst"> <div class="lst-hd"> <div class="page-total"> <span class="page-size j-page-size" data-dropdown="view"> <label>{{i18n "appcenter/lbl_log_per_page_default"}}</label> <span class="iconfont icondown"></span> </span> <span class="total j-total"></span> </div> <div class="pagination j-pagination"></div> </div> <div class="lst-ct j-list"></div> </div>  </section>',{logsListTpl:'<table> <tr> <th>{{i18n "mbox/download_time"}}</th> <th>{{i18n "mbox/download_ip"}}</th> <th>{{i18n "mbox/download_user"}}</th> <th>{{i18n "mbox/download_name"}}</th> <th>{{i18n "mbox/download_size"}}</th> <th>{{i18n "mbox/download_cnt"}}</th> <th>{{i18n "mbox/download_transmitted"}}</th> </tr> {{#each list}} <tr> <td>{{time}}</td> <td>{{ip}}</td> <td>{{user}}</td> <td>{{name}}</td> <td>{{size$ size 2}}</td> <td>{{cnt}}</td> <td>{{size$ transmitted 2}}</td> </tr> {{/each}} </table>'})},964:function(e,t,i){(function(e){i(558);var t=i(463),n=i(472),a=i(471),s=i(519),l=i(465),r=i(467),o=r.getCurrentState,c=r.setCurrentState,d=i(468).get,u=n.extend({},(function(){var n,r=this;function u(e){r.$('a[data-trigger]').attr('class',(function(){return t(this).data().trigger===e?'curSelectedNode':''}))}function f(){r.sendMessage(n.current().id,'view:active')}function m(e){var t=n.current(),i=e.module;if(i!==t&&i.startsWith('setting.')){var s=i.split('.');3===s.length&&(i='setting.'+s[1]),c(e),n.find(i)?n.switchTo(i):n.addTab({id:i,replaceId:'setting*',title:' ',module:a.module(i)}),u(i)}}r.events={'click a[data-trigger]':[function(t,i,n){e.stop(n,0),m({module:t})}]},r.after('render',(function(){var t,c,v;t={calendar:!d('calendar.enable'),labs:!d('setting.supportLabs')},c=e.map(i(557).setting,(function(e,i){return{id:'setting.'+i,title:t[i]?'':l('setting.nav_'+i),module:a.module('setting.'+i)}})),v='setting.'+(o().module.split('.')[1]||'account'),(n=new s({element:r.$().addClass('m-setting').html(p(e.filter(c,'title'))),classPrefix:'m-setting',activeTabId:v,activeTriggerClass:'curSelectedNode ',onlyRenderActive:!0,tabs:c})).render(),u(v),n.on('render',(function(e){m(o()),i(477).render(e)})),n.on('refresh',(function(e){i(477).refresh(e),f()})),r.subscribe('dispatcher','url:changed',(function(e){m(e.message.newState)})),r.onMessage('view:active',f)})),r.before('destroy',(function(){n&&n.destroy()}))})),p=i(965);a.module({name:'setting'},u)}).call(this,i(464))},965:function(e,t,i){e.exports=i(469)('<aside class="sgsidebar"> <div class="sgsidebar-bg"></div> <ul class="nav ztree"> {{#each this}} <li><a title=\'{{title}}\' data-trigger="{{id}}">{{title}}</a></li> {{/each}} </ul> <ul class="m-setting-nav f-dn"></ul> </aside> <article class="sgmain"> <div class="sgmain-bg"></div> <div class="m-setting-content"></div> </article>',{})},966:function(e,t,i){i(967);var n=i(499),a=i(468).get,s=a('setting'),l=s.enableOpProfile,r=s.enableExternalAuth,o=s.externalAuthUrl;n('setting.account',{className:'m-sgaccount',overrides:{personal:l,signature:a('user.supportSignature'),password:!r||o&&{id:'externalauth'},externalauth:0,alias:i(660).enable}})},968:function(e,t,i){(function(e,t){i(969),i(509),i(572);var n=i(463),a=i(472),s=i(471),l=i(470),r=l.alert,o=l.confirm,c=i(479),d=i(497),u=i(465),p=i(467),f=i(658),m=i(970),v=i(468),h=i(585),b=i(484),g=a.extend({},(function(){var a=this;a.events={'click form .radio, form :input':function(){a.$('.j-form-submit').prop('disabled',!1)},'click [data-action]':[function(e){k('edit'===e)}],'focus .datepicker':[function(e){e.datepicker()},n],'click .j-form-submit':function(){a.$('#editAccount').submit(),a.formInvalid||function(){var t=i(481).useFileAPI,s=a.$('form[name=\'profile\']').serializeJSON();s.birthday=s.birthday&&c(s.birthday).format('YYYY-MM-DD HH:MM:SS'),s.anniversary=s.anniversary&&c(s.anniversary).format('YYYY-MM-DD HH:MM:SS');var r=a.$('img.j-avatar').attr('src');e.all([p.updateUser(s),l&&(t?e.wmCall('user:setAttrs',{avatarChangeStatus:r}):e.wmCall('user:addHeadImageStd',{temp:0}))]).then((function(){n.notify(u('setting/msg_savesucceed')),new b('app').publish('profile:changed'),k(),l=!1}))}()}};var s,l,g=function(){return v.get('setting.enableForceSenderName')?p.getConfig('user.allemails')[0].name:''},y=p.getConfig('context.locale');function w(){a.element.mask(),e.when(m.getUserSchema(),p.getUserAvatar()).then((function(e,c){var v={name:'area',label:u('setting/lbl_location'),type:'select',values:[],value:''},b=0,w=0,k=0,x=0,j=0,S=0,C=!1,T={emailAddr:{label:u('setting/lbl_emailAddress'),value:p.getUser().email}},$=!1,A=!1;if(n.each(e,(function(t,i){switch(i.name){case'true_name':k=t,$=!!i.value,T.true_name={label:i.label,value:i.value};break;case'nick_name':x=t,A=!!i.value,T.nick_name={label:i.label,value:i.value};break;case'gender':T.gender={value:i.value},i.type='radio';break;case'address':case'remarks':i.type='textarea';break;case'province':b=t,j=i.value,v.values.push(i);break;case'city':w=t,S=i.value,v.values.push(i);break;case'security_level':case'user_security_role':case'sender_security_level':i=n.extend({},i),e[t]=i,i.value=(i.values||[])[i.value]||i.value}})),g()&&(T.forceSenderName=g()),2===v.values.length&&(v.value=f.out(j,S,y),e.splice(b,1,v),e.splice(w,1),C=!0),s){if(g()&&e.splice(1,0,{readonly:!0,value:g(),label:u('setting/lbl_forceSenderName'),name:'forceSenderName'}),a.$('.u-profile-edit').html(_.profiletpl2({avtUrl:c,schema:e})),C){var I=a.$('select.province'),D=a.$('select.city');f.init(I,D,j,S,y)}a.element.customRadioCheckbox(),function(e){var i=[];e.forEach((function(e){var n=e.name,a=e.length,s={name:n},l=[],r=[];a&&'gender'!==n&&(l.push('max_length('+a+')'),r.push(u('setting/msg_max_length_err',{length:a})));var o=d.when(n,[[['alt_email'],d.Email],[['anniversary','birthday'],/^\d{4}-\d{1,2}-\d{1,2}$/],[['mobile_number','home_phone','fax_number','company_phone'],/^[0-9\-+()（）\s]+$/]]);if(o){l.push('regexp_'+n);var c=d.when(n,[[['mobile_number','home_phone','fax_number','company_phone'],'phone_number']])||n;r.push(u('setting/msg_'+c+'_err')),s['regexp_'+n]=o}!e.readonly&&l.length&&i.push(t.assign(s,{rules:l.join('|'),display:r.join('|')}))})),new h('editAccount',i,(function(e){a.formInvalid=e.errors.length>0,a.formInvalid&&(a.$('#editAccount').find('.u-form-item').removeClass('error'),e.errors.forEach((function(e){n(e.element).parent().addClass('error').children('.u-form-explain').html(e.message)})))}))}(e),function(e){var t=i(481).useFileAPI;a.$('.j-avt-change').on('click',(function(){o(_.avtTpl({avtUrl:e,sid:p.getSid()}),{onConfirm:function(){var e=t?a.$('div.j-cnt-cropper > img').cropper('getCroppedCanvas',{width:132,height:132}).toDataURL('image/jpeg'):a.$('.j-preview-avatar').attr('src');a.$('img.j-avatar').attr('src',e),l=!0},title:u('setting/lbl_uploadAvatar'),effect:'fade',parentNode:'div.profile'}),a.$('.j-avt-upload').change((function(){var e,i,s,l;t?((e=n(this).prop('files')).length>0&&(i=e[0]),d.file.isAllowableUploadImage(i)?(a.$('div.avt-tips').empty(),s=window.URL.createObjectURL(i),l=n('<img src="'+s+'"/>'),a.$('div.j-cnt-cropper').empty().html(l),l.cropper({aspectRatio:1,preview:'div.j-preview',minContainerWidth:200,minContainerHeight:200,zoomable:!1})):r(u('setting/msg_invalidImageType'))):m.addAvatar(n(this)).then((function(){p.getUserAvatar(!0).then((function(e){a.$('.j-preview-avatar').attr('src',e)}))})).catchCode(['FA_ATTR_SIZE_EXCEEDED','FA_FILE_SIZE_EXCEEDED'],(function(){return r(u('pref/imageSizeExceeded'))})).onFail((function(e){var t=e.code;r(u('common/FA_OTHER_CODE',{code:t}))}))}))}))}(c)}else $&&e.splice(k,1),!$&&A&&e.splice(x,1),a.$('div.u-profile').html(_.profiletpl(t.assign(T,{schema:e,avtUrl:c})))})).either((function(){a.element.mask('hide')}))}function k(e){s=!!e,a.$('div.u-profile').toggleClass('f-dn',s),a.$('div.u-profile-edit').toggleClass('f-dn',!s),w()}a.after('render',w)})),_=i(971).helpers({GetDateYMD:function(e){return e?c(e).format('YYYY-MM-DD'):''}});s.module({name:'setting.account.personal',template:_},g)}).call(this,i(466),i(464))},970:function(e,t,i){(function(t){e.exports={getUserSchema:function(){return t.wmCall('user:getSchema',{id:'Personal',withValue:!0})},addAvatar:function(e){return t.mFormData({func:'user:addHeadImageStd',temp:1},{files:e})}}}).call(this,i(466))},971:function(e,t,i){e.exports=i(469)('<section class="m-personal content-wrapper"> <div class="profile j-personal u-scroll"> <div class="u-profile"></div> <div class="u-profile-edit f-dn"></div> </div> </section>',{avtTpl:'<div class="u-avatar-dialog"> <form id="uploadform" action="jsp/mformdata.jsp?sid={{sid}}&temp=1&func=user:addContactAvatarStd" enctype="multipart/form-data" method="post"> <div class="avt-tips">{{i18n "pref/personal/upload_avatar_tips"}}</div> <div class="avt-content"> <div class="cnt-cropper j-cnt-cropper"> </div> <div class="cnt-preview"> <div class="u-btn u-btn-primary"> <span>{{i18n "pref/personal/select_local_image"}}</span> <input type="file" class="avt-upload j-avt-upload" name="signImgFile"/> </div> <div class="avt-preview j-preview"> <img alt="avatar" src="{{avtUrl}}" class="j-avatar j-preview-avatar"/> </div> </div> </div> <div class="avt-size"> {{i18n "pref/personal/upload_avatar_button_tips"}} </div> </form> </div>',profiletpl:'<div class="u-btns-top"> <button data-action="edit" class="u-btn u-btn-default">{{i18n \'setting/op_edit\'}}</button> </div> <div class="m-detail-box"> <div class="m-avatar u-img u-img-round"> <img alt="avatar" class="j-avatar" src="{{avtUrl}}"/> </div> <div class="m-list"> <div class="list-group"> <h4 class="nick-name-title"> {{#and true_name true_name.value}} {{true_name.value}} {{^}} {{#and nick_name nick_name.value}} {{nick_name.value}}( {{nick_name.label}} ) {{^}} {{emailAddr.value}}( {{emailAddr.label}} ) {{/and}} {{/and}} </h4> {{#and gender gender.value}} <i class="iconfont {{#compare gender.value \'==\' \'1\'}}iconwomen{{^}}iconman{{/compare}}"></i> {{/and}} <table> {{#if forceSenderName}} <tr> <td>{{i18n "setting/lbl_forceSenderName"}}：&nbsp;</td> <td>{{forceSenderName}}</td> </tr> {{/if}} {{#each schema}} {{#compare name \'!=\' \'gender\'}} <tr> <td>{{label}}：&nbsp;</td> <td> {{#in type \'date,radio\'}} {{#compare type \'==\' \'date\'}} {{#if value}}{{GetDateYMD value}}{{else}}{{i18n \'setting/msg_itemUnset\'}}{{/if}} {{/compare}} {{#compare type \'==\' \'radio\'}} {{#each values}} {{#compare @key \'==\' ../value}}{{this}}{{/compare}} {{/each}} {{/compare}} {{^}} {{#if value}}{{value}}{{else}}{{i18n \'setting/msg_itemUnset\'}}{{/if}} {{/in}} </td> </tr> {{/compare}} {{/each}} </table> </div> </div> </div>',profiletpl2:'<form method="post" name="profile" class="u-form" id="editAccount" onsubmit="return false"> <div class="u-btns-top"> <button class="u-btn u-btn-primary j-form-submit" disabled>{{i18n \'setting/op_save\'}}</button> <button class="u-btn u-btn-default" data-action="cancel">{{i18n \'setting/op_cancel\'}}</button> </div> <div class="title dotted"> <h4>{{i18n "setting/lbl_userGeneralInfo"}}</h4> </div> <div class="grid-row"> <div class="grid-col2 u-avatar u-img u-img-round"> <img alt="avatar" class="j-avatar" src="{{avtUrl}}"/> <div> <a class="avt-change j-avt-change f-csp">{{i18n "setting/lbl_changeAvatar"}}</a> </div> </div> <div class="grid-col7"> {{#each schema}} <div class="u-form-item"> <label class="u-form-label">{{label}}：</label> {{#in type \'radio,textarea,select\'}} {{#compare type \'==\' \'radio\'}} {{#each values}} <span class="f-ib f-mgl"> <input type="radio" class="u-input" name="{{../name}}" id="{{../name}}_{{@key}}" value="{{@key}}" {{#compare @key \'==\' ../value}}checked{{/compare}}/> <label for="{{../name}}_{{@key}}">{{this}}</label> </span> {{/each}} {{/compare}} {{#compare type \'==\' \'textarea\'}} <textarea name="{{name}}" class="u-input {{#if readonly}}z-disabled{{/if}}" {{#if readonly}}disabled{{/if}}>{{value}}</textarea> {{/compare}} {{#compare type \'==\' \'select\'}} {{#each values}} <select name="{{name}}" class="{{name}} u-input {{#if readonly}}z-disabled{{/if}}" {{#if readonly}}disabled{{/if}}></select> {{/each}} {{/compare}} {{^}} <input type=\'text\' class=\'u-input {{#compare type "==" "date"}}datepicker{{/compare}} {{#if readonly}}z-disabled{{/if}}\' name=\'{{name}}\' value=\'{{#compare type "==" "date"}}{{GetDateYMD value}}{{^}}{{value}}{{/compare}}\'{{#if readonly}}disabled{{/if}} /> {{#compare name \'==\' \'forceSenderName\'}} <span class="f-db">{{i18n "setting/lbl_forceSenderNameDescription"}}</span> {{/compare}} {{/in}} <span class="u-form-explain f-dn"></span> </div> {{/each}} </div> </div> </form>'})},972:function(e,t,i){(function(e){i(973);var t=i(463),n=i(472),a=i(471),s=i(470),l=s.alert,r=s.confirm,o=i(547),c=i(467),d=i(476),u=i(649),p=i(466),f=i(465),m=i(488).bytesToSize,v=i(473).h,h=i(468),b=h.get,g=h.set,_=n.extend({},(function(){var i,n,a=this;a.after('render',e.ary(y,0)),a.events={'click [data-action]':[{createSign:function(){if(h()>=_)return l(v(f('pref/signature/overflow'),_));T({isHtml:1===c.getUser().edit_mode}),setTimeout((function(){a.$('.j-sign-name').focus()}),500)},deleteSign:function(i){var s=i.data().sid;r(v(f('setting/msg_signatureDeleteConfirm'),n[s].name),(function(){u.deleteSignature(s).then((function(){i.closest('.u-switchable-content').remove(),delete n[s],a.$('#signNotify').html(v(f('setting/msg_signatureOverView'),[h(),_])).removeClass('maxLimit'),a.$('[data-action=createSign]').attr('disabled',!1),t.notify.success(f('setting/msg_signatureRemoveSuccess')),a.publish('signs:refresh',{}),a.$('#btn-group').toggle(!e.isEmpty(n)),j()}))}))},editSign:function(e){return T(n[e.data().sid])},saveSign:$.bind(0,1),updateSign:$.bind(0,0),getSign:function(e){e.toggleClass('z-current').parent().next('.panel-body').toggleClass('f-dn')},setDefault:function(e){var i=!(e=e.closest('.panel-head')).hasClass('default-sign');u.updateSignature({id:e.data().sid,isDefault:i}).then((function(){a.$('.panel-head').removeClass('default-sign'),e.toggleClass('default-sign',i),t.notify.success(f('pref/signature/'+(i?'setsigndefault':'cancelsigndefault')))}))},cancel:function(){x(),C()}},t],'click :not(.checked)[data-position]':[function(e,i){var n={signature_position:e};c.updateUser(n).then((function(){a.$('.signature_position_img').removeClass('checked'),i.addClass('checked'),t.notify.success(f('setting/msg_prefUpdateSuccess')),g('setting.signatureRelated','1'===e)}))}]};var s,h=function(){return e.filter(n,e.not('isPublic')).length},_=b('setting.maxSignLimit');function y(t){a.$().mask(),p.when(d.optAttrs('signature_position'),u.getSignatures()).then((function(i,s){var l=s.findIndex(e.prop('isDefault'));l>=0&&s.unshift(s.splice(l,1)[0]),n=e.objBy(s,'id'),a.$('.j-signature-box').html(w({signPref:i,signatures:s,privateSignCount:h(),maxSignLimit:_})),a.$('[data-sign-id='+(t||s[0]&&s[0].id)+']').click(),t&&a.publish('signs:refresh',null),C()})).either((function(){a.$().mask('hide')}))}function x(){a.$('.main-wrapper').toggleClass('toggled')}function j(){u.getSignImageSpareSize().then(S)}function S(e){null!=e&&(s='<span class=spare-size>'+v(f('setting/msg_signatureImageSpareSize'),m(e,1))+'</span>'),a.$('.spare-size').replaceWith(s)}function C(){u.clearUnReferencedImages().then(j)}function T(e){a.$('.m-edit-sign').html(k(e)),S(),o([a,function(e){return i=e}],'#sg-sign-editor',[e.isHtml,function(e){a.$('input[name=isHtml]').val(e)}],0,{imagePluginInfo:function(){return s},uploadJson:{url:'XT5/jsp/upload.jsp?func=user:addSignatureImage'},filePostName:'signImgFile',items:1,afterUpload:function(e){return j(),p.wmURL({func:'user:getSignImageData',hashId:e})}}),x(),a.$('[name=localUrl]').attr('name','signImgFile')}function $(s){i.sync();var r=a.$('form[name=editSign]').serializeJSON({defaultType:'+B'});(function(a){var s=a.name.trim();if(s)if(i.isEmpty())l(f('pref/signature/content_empty'));else{if(a.id&&n[a.id].name.trim()===s||!e.map(n,'name').map(t.trim).includes(s))return!0;l(f('pref/signature/name_exist'))}else l(f('setting/msg_signatureNameEmpty'))})(r)&&u[s?'createSignature':'updateSignature'](r).then((function(e){y(s?e[0]:r.id),x(),t.notify.success(f(s?'setting/msg_signatureCreateSuccess':'setting/msg_signatureUpdateSuccess'))}))}})),y=i(974),w=y.signListTpl,k=y.editSignTpl;a.module({name:'setting.account.signature',template:y},_)}).call(this,i(464))},974:function(e,t,i){e.exports=i(469)('<section class="m-signature"> <div class="main-wrapper"> <div class="content-wrapper"> <div class="grid-col12 j-signature-box"></div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask" /> <![endif]--\x3e <div class="panel m-edit-sign"></div> </div> </section>',{signListTpl:'<div class="title dotted"> <h4>{{i18n "pref/preference/signature_setting"}}</h4> </div> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{i18n "pref/preference/signature_position_text"}}</label> </div> <div class="u-form-value"> <div class="u-form-explain"> <div class="signature_position signature_position_0"> <a>{{i18n "pref/preference/signature_position_v_0"}}</a> <span class="signature_position_img{{if$ (eq signPref/signature_position 0) \' checked\'}}" data-position=0> <i class="iconfont iconchoose"></i> </span> </div> <div class="signature_position signature_position_1"> <a>{{i18n "pref/preference/signature_position_v_1"}}</a> <span class="signature_position_img{{if$ (eq signPref/signature_position 1) \' checked\'}}" data-position=1> <i class="iconfont iconchoose"></i> </span> </div> </div> </div> </div> <div class="title dotted"> <h4>{{i18n "pref/preference/signature_setting"}}</h4> </div> <div> <div class="u-notify-top"> <button class="u-btn u-btn-primary j-toggle-panel" data-action="createSign" {{if$ (eq privateSignCount maxSignLimit) \'disabled\'}}> {{i18n "setting/op_addSignature"}} </button> <span id="signNotify" class="signNotify {{if$ (eq privateSignCount maxSignLimit) \'maxLimit\'}}"> {{{i18n "prop:setting/msg_signatureOverView" 0=privateSignCount 1=maxSignLimit }}}</span> </div> <div class="sign-box f-cb"> <div class="sign-category"> <ul> {{#each signatures}} <li class="u-switchable-content u-switchable-nav"> <div class="panel-head u-switchable-trigger f-usn {{if$ isPublic \'modify\'}} {{if$ isDefault \'default-sign\'}}" data-sid="{{id}}" data-role="trigger"> <i class="iconchoose iconfont j-default" data-action="setDefault" data-sid="{{id}}"></i> <a data-action="getSign" data-sign-id="{{id}}" data-type="{{if$ isPublic \'public\'}}"> {{#if isPublic}}<span class="public-sign"> {{i18n "setting/lbl_publicSignature"}}</span>{{/if}} <span class="signContent" title="{{name}}">{{name}}</span> <span class="default-sign-text">( {{i18n \'setting/lbl_default_sign_text\'}} )</span> </a> {{#if (not isPublic)}} <div class="sign-opr"> <a class="link f-mgr" data-action="deleteSign" data-sid="{{id}}">{{i18n "pref/signature/btn_del"}}</a> <a class="link f-mgr" data-action="editSign" data-sid="{{id}}">{{i18n "pref/signature/btn_update"}}</a> </div> {{/if}} </div> <div class="sign-overview panel-body u-switchable-panel f-dn" data-role="panel"> <div id="panel_{{id}}" class="sign-content u-scroll"> {{#if isHtml}} {{{content}}} {{^}} <pre>{{content}}</pre> {{/if}} </div> </div> </li> {{/each}} </ul> </div> </div> </div>',editSignTpl:'<div class="u-btns-top"> <button type="button" data-action="{{if$ id \'updateSign\' \'saveSign\'}}" class="u-btn u-btn-primary" >{{i18n "setting/op_confirm"}}</button> <button type="reset" data-action="cancel" class="u-btn u-btn-default">{{i18n "setting/op_cancel"}}</button> </div> <h4 class="sub-header"> {{i18n (join \'setting/\' (if$ id \'lbl_editSignature\' \'op_addSignature\'))}} <span class=spare-size></span> </h4> <form name="editSign" class="u-form" onsubmit="return false;"> {{#if id}}<input type="hidden" name="id:number" value="{{id}}"/>{{/if}} <div class="u-form-item"> <label class="u-form-label">{{i18n "setting/lbl_signatureName"}}&nbsp;:</label> <input type="text" class="u-input j-sign-name" name="name" value="{{name}}" /> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "setting/lbl_signatureContent"}}&nbsp;:</label> <textarea name="content" id="sg-sign-editor">{{content}}</textarea> </div> <input type="hidden" name="isHtml" /> </form>'})},975:function(e,t,i){(function(e,t){i(976);var n=i(472),a=i(471),s=i(498),l=i(466),r=i(465),o=i(485),c=i(467),d=i(468).get,u=i(476),p=i(479),f=i(586),m=i(977),v=i(555),h=n.extend({},(function(i,n){var a,h=this,g=b.helpers({countDown:function(e){return p().add(e,'days').format('YYYY-MM-DD')+r('setting/lbl_expiry')}}),_=g.passSetTpl,y=g.passEditTpl,w={isEnablePasswordAge:d('setting.enablePasswordAge')},k=null;function x(){h.$().mask(),l.wmCall('user:getPasswordPolicy',{attrIds:['passwordExpiryTime']}).then((function(t){var i=t.passwordExpiryTime,n=i&&p(i).subtract(7,'days').isBefore(Date.now(),'day');e.assign(w,t,i&&{expiry:p(i).format('YYYY-MM-DD')}),h.$('.j-pwd-info').html(_(w)),n||h.$('.expiry_notify').remove(),a=a||new m({parentNode:h.$('.j-altpwd-wrap')})})).either((function(){h.$().mask('hide')}))}function j(e){h.$('.main-wrapper').attr('class','main-wrapper switched-'+e)}i()(n),x(),h.before('destroy',(function(){a&&a.destroy()})),h.$().on('click','[data-action=editPwd]',(function(){f.initVerify({next:function(i){k=i,u.auth2continue(c.getLockOpValues().updatePwd).then((function(){var i=y(w);h.$('.j-pwd-edit').html(i),s({trigger:h.$('[name^=passwordAge]'),style:{width:230}}),function(){var i=['oldPassword','newPassword','rePassword'].map((function(e){return h.$('input[name^='+e+']')})),n=v(i,a.bind(i));function a(e,t){i[t].parent().toggleClass('error',!!e).find('.notify').html(e),this===i&&(s[0].disabled=!!e)}h.$('[data-action=cancel]').click(e.fun(j));var s=h.$('[data-action=changePwd]').click((function(){n((function(i){i||function(i,n){u.changePassword(i).then((function(){t.notify.success(r('pref/password/successMod')),o.setItem('cm_setting',e.pick(i,['passwordAge']),null,!0),x(),j()})).catchCode('FA_USER_IN_GRAYLIST',(function(){t.notify.error(r('error/FA_USER_IN_GRAYLIST'))})).catchCode('FA_UNAUTHORIZED',(function(){n(r('pref/password/failedMod'),0)})).catchCode('FA_INVALID_BIND_DEVICE',(function(){t.notify.error(r('pref/password/lbl_trust_device_change_fail'))}))}(e.assign(h.$('form[name=changePwd]').serializeJSON(),{tempSid:k}),a)}))}))}(),j('edit')}))},verifyType:f.verifyTypes.VERIFY,verifyTrans:'change_password'})}))})),b=i(979);a.module({name:'setting.account.password',template:b},h)}).call(this,i(464),i(463))},977:function(e,t,i){(function(t){var n=i(463),a=i(465),s=i(479),l=i(472),r=i(480),o=i(588),c=i(505),d=i(510),u=i(655);function p(e,t){this.pwds=this.format(e),this.updateCb=n.isFunction(t)?t:n.noop}p.prototype.format=function(e){for(var t,i=0;i<e.length;++i)(t=e[i]).id=parseInt(t.id,10),t.name=t.name?t.name:a('setting/lbl_altpwd_name_null'),t.access=t.access?s(t.access).format('YYYY-MM-DD'):a('setting/lbl_altpwd_last_date_null'),t.create=t.create?s(t.create).format('YYYY-MM-DD HH:mm'):a('setting/lbl_altpwd_last_date_null');return e},p.prototype.add=function(e){var t=this.pwds;if(!n.isPlainObject(e)||!e.id)return!1;e.id=parseInt(e.id,10);for(var i=0;i<t.length;++i)if(t[i].id===e.id)return!1;this.pwds.push(this.format([e])[0]),this.updateCb('add',e)},p.prototype.remove=function(e){var t,i=this.pwds;if(null==e)return!1;for(e=parseInt(e,10),t=0;t<i.length&&i[t].id!==e;++t);t<i.length&&(i.splice(t,1),this.updateCb('remove',e))},p.prototype.clean=function(){this.pwds.length>0&&(this.pwds=[],this.updateCb('clean'))};var f=l.extend({Implements:r,pwdSet:null,supportAltPwd:!1,config:{sizeMax:6},attrs:{name:'setting.account.password.altpwd',template:i(978)},events:{'click .j-item-action':'_handlePwdActionClick','click .j-clean-pwd':'cleanPwdList'},setup:function(){f.superclass.setup.call(this),n.extend(this.config,i(549)()),this.render()},render:function(){f.superclass.render.call(this),this.supportAltPwd=this.config.supportAlternativePassword,this._doRender()},destroy:function(){this.pwdSet&&this.pwdSet.clean(),f.superclass.destroy.call(this)},_initStore:function(e){var t=this;e=n.isFunction(e)?e:n.noop,o.listAltPwdList().then((function(i){t.pwdSet=new p(i,n.proxy(t._pwdSetUpdateObserver,t)),e.call(t)}),(function(e){console.log(e.msg)}))},_doRender:function(){this.supportAltPwd?(this._toggleElement(),this._initStore(this._renderPwdSet)):(this._toggleElement(),this._renderForbidden())},_renderForbidden:function(){var e=this.$('#disableTpl').html();this.$('.j-main').empty().html(this.compile(e))},_renderPwdSet:function(){var e,t=this,i=this.$('#mainTpl').html(),a=[];this.$('.j-main').empty().html(this.compile(i)),e=this.$('.j-pwd-list'),n.each(this.pwdSet.pwds,(function(e,i){a.push(t._compilePwdItemTpl(i))})),a=a.join(''),e.prepend(a),this._updateAddItemBtn(),this._updateCleanBtn()},_toggleElement:function(e){(e='boolean'==typeof e&&e)?this.element.addClass('f-dn'):this.element.removeClass('f-dn')},_compilePwdItemTpl:function(e){var t=this.$('#itemTpl').html();return this.compile(t,e)},cleanPwdList:function(e){var i=this,s=[],l=0,r=this.pwdSet&&this.pwdSet.pwds||[];for(t.stop(e,0);l<r.length;++l)s.push(parseInt(r[l].id,10));s.length&&c.confirm(a('setting/lbl_altpwd_clean_confirm_content'),(function(){o.deleteAltPwd({ids:s}).then((function(){i.pwdSet&&i.pwdSet.clean()}),(function(e){n.notify.error(e.msg)}))}),n.noop,{title:a('setting/lbl_altpwd_clean_confirm_title'),confirmTpl:a('setting/lbl_altpwd_clean_confirm_button')})},_handlePwdActionClick:function(e){switch(t.stop(e,0),n(e.currentTarget).attr('data-action')){case'add':this._handleAddPwd(e);break;case'remove':this._handleRemovePwd(e)}},_handleAddPwd:function(e){var i,s,l=this;if(n(e.currentTarget).hasClass('disabled'))return!1;(i=new c({width:378,title:a('setting/lbl_altpwd_generate_title'),message:this.compile(this.$('#generateInputTpl').html(),{}),confirmTpl:a('setting/lbl_altpwd_generate')})).after('show',(function(){i.element.addClass('m-setting-password-altpwd-addbox f-cf'),i.set('subClass','adding');var r=(s=i.$('[data-role=message]')).find('.j-input-name'),c=i.$('[data-role=confirm]'),p=s.find('.j-error');function f(e){null!=f.timeoutId&&clearTimeout(f.timeoutId),p.html(e).removeClass('f-dn'),f.timeoutId=setTimeout((function(){p.html('').addClass('f-dn')}),5e3)}r.on('keyup',(function(){n(this).val().length?c.removeClass('disabled'):c.addClass('disabled')})),c.addClass('disabled'),i.on('confirm',(function(){var n,s;return t.stop(e,0),!c.hasClass('disabled')&&((n=r.val()).length?(s={name:n,logintype:'default',desc:''},o.addAltPwd(s).then((function(e){s.id=e.id,s.pwd=e.pwd,s.create=new Date,l.pwdSet.add(s),function(e){var t,n,s;function r(e){!0===e?n=new d({zIndex:999,trigger:t,content:a('setting/lbl_altpwd_password_copy_tip'),inViewport:!0,arrowPosition:1}).after('hide',(function(){this.set('content',a('setting/lbl_altpwd_password_copy_tip'))})):(n.set('content',e),n._setAlign())}i.set('subClass','done').set('width',500).set('message',l.compile(l.$('#generateSuccessTpl').html(),e)).set('cancelTpl',!1).set('confirmTpl',a('setting/lbl_altpwd_done')).off('confirm').on('confirm',(function(){i.hide()})).after('hide',(function(){s&&s.destroy()})),t=i.$('.j-copy-pwd'),r(!0),s=new u(t[0]).on('success',(function(){r(a('setting/lbl_altpwd_password_copy_success'))})).on('error',(function(){r(a('setting/lbl_altpwd_password_copy_fail'))}))}(s)}),(function(e){f(e.msg)})),!1):f(a('setting/lbl_altpwd_generate_name_empty')))}))})).show().after('hide',(function(){this.destroy()}))},_handleRemovePwd:function(e){var t=this,i=n(e.target).closest('.j-altpwd-item').attr('data-pwdId');c.confirm(a('setting/lbl_altpwd_delete_confirm_info'),(function(){o.deleteAltPwd({ids:i}).then((function(){n.notify.success(a('setting/lbl_altpwd_delete_success')),t.pwdSet.remove(i)}),(function(){n.notify.error(a('setting/lbl_altpwd_delete_fail'))}))}),!1)},_insertPwdItemDom:function(e){var t=this.$('.j-pwd-list'),i=this._compilePwdItemTpl(e);t.prepend(i)},_removePwdItemDom:function(e){var t,i=this.$('.j-pwd-list').find('.j-altpwd-item'),a=0;if(null==e)return!1;n.isArray(e)||(e=[e]),t=e.length,i.each((function(){var i=n(this);if(a>=t)return!1;n.each(e,(function(e,t){if(i.attr('data-pwdId')==t)return i.remove(),++a,!1}))}))},_updateAddItemBtn:function(){var e,t=this.$('.j-add-item');this.pwdSet&&this.pwdSet.pwds.length>=this.config.sizeMax?(t.addClass('disabled'),e=new d({trigger:t,content:a('setting/msg_altpwd_generate_oversize'),inViewport:!0,arrowPosition:11}),t.data('disabledTip',e)):((e=t.data('disabledTip'))&&(e.destroy&&e.destroy(),t.data('disabledTip',null)),t.removeClass('disabled'))},_updateCleanBtn:function(){var e=this.$('.j-clean-pwd');this.pwdSet&&this.pwdSet.pwds.length?e.removeClass('disabled'):e.addClass('disabled')},_pwdSetUpdateObserver:function(e,t){if('string'!=typeof e)return!1;switch(e){case'add':this._insertPwdItemDom(t);break;case'remove':this._removePwdItemDom(t);break;case'clean':this.$('.j-pwd-list').find('.j-altpwd-item').remove()}this.publish('altpwdChange',this.pwdSet&&this.pwdSet.pwds?this.pwdSet.pwds.length:0),this._updateAddItemBtn(),this._updateCleanBtn()},templateHelpers:{SubPwd:function(e,t){return e.substr(4*(t-1),4)}}});e.exports=f}).call(this,i(464))},978:function(e,t){e.exports='<div class="m-setting-password-altpwd">\r\n  <div class="title">\r\n    <h4>\r\n      {{ i18n "setting/msg_altpwd_title" }}\r\n    </h4>\r\n    <a href="javascript:void(0);" class="f-fr clean-pwd j-clean-pwd">{{ i18n \'setting/lbl_altpwd_clean\' }}</a>\r\n  </div>\r\n  <div class="altpwd-main-wrap">\r\n    <div class="j-main"></div>\r\n    <ul class="altpwd-introduction">\r\n      <li>{{ i18n \'setting/lbl_altpwd_intro1\' }}</li>\r\n      <li>{{ i18n \'setting/lbl_altpwd_intro2\' }}</li>\r\n      <li>{{ i18n \'setting/lbl_altpwd_intro3\' }}</li>\r\n      <li>{{ i18n \'setting/lbl_altpwd_intro4\' }}</li>\r\n    </ul>\r\n  </div>\r\n\r\n  {{#raw}}\r\n\r\n  \x3c!-- 禁用模板 --\x3e\r\n  <script type="text/x-handlebars-template" id="disableTpl">\r\n    <p>{{ i18n "setting/msg_altpwd_disable" }}</p>\r\n  <\/script>\r\n\r\n  <script type="text/x-handlebars-template" id="mainTpl">\r\n    <ul class="altpwd-list f-cf j-pwd-list">\r\n      <li class="altpwd-item add-item j-add-item j-item-action" data-action="add">\r\n        <i class="iconfont iconadd"></i>\r\n      </li>\r\n    </ul>\r\n  <\/script>\r\n\r\n  \x3c!-- 专用密码：列表item 模板 --\x3e\r\n  <script type="text/x-handlebars-template" id="itemTpl">\r\n    <li class="altpwd-item _panel _panel-xs j-altpwd-item" data-pwdId="[[id]]">\r\n      <div class="_panel-body">\r\n        <p class="pwd-info-name f-ellipsis">[[i18n "setting/lbl_altpwd_name"]][[name]]</p>\r\n        <p class="pwd-info-last">[[i18n "setting/lbl_altpwd_last_date"]][[access]]</p>\r\n      </div>\r\n      <div class="_panel-footer">\r\n        <span class="pwd-info-create">[[i18n "setting/lbl_altpwd_create_time"]][[create]]</span>\r\n        <div class="f-fr">\r\n          <a href="javascript:void(0);" class="item-action j-item-action" data-action="remove">&#91;[[ i18n "setting/op_remove"]]&#93;</a>\r\n        </div>\r\n      </div>\r\n    </li>\r\n  <\/script>\r\n\r\n  <script type="text/x-handlebars-template" id="generateInputTpl">\r\n    <div>\r\n      <label><strong>[[i18n "setting/lbl_altpwd_name"]]</strong></label>\r\n      <input type="text" class="u-input j-input-name" value="" maxlength="20" placeholder="[[i18n \'setting/lbl_altpwd_name_placeholder\']]" />\r\n    </div>\r\n    <div class="j-error generate-error f-dn"></div>\r\n  <\/script>\r\n\r\n  <script type="text/x-handlebars-template" id="generateSuccessTpl">\r\n    <p class="pwd-head module-desc">\r\n      <i class="dot"></i>\r\n      <span class="text">[[i18n "setting/lbl_altpwd_password_info_title" name=name]]</span>\r\n    </p>\r\n    <div class="pwd-value">\r\n      <input type="text" class="u-input" value="[[ SubPwd pwd 1 ]]" readonly>\r\n      <span></span>\r\n      <input type="text" class="u-input" value="[[ SubPwd pwd 2 ]]" readonly>\r\n      <span></span>\r\n      <input type="text" class="u-input" value="[[ SubPwd pwd 3 ]]" readonly>\r\n      <span></span>\r\n      <input type="text" class="u-input" value="[[ SubPwd pwd 4 ]]" readonly>\r\n      <button class="u-btn u-btn-default j-copy-pwd copy-pwd" data-clipboard-text="[[pwd]]" data-clipboard-action="copy">\r\n        [[i18n "setting/lbl_altpwd_password_copy_title"]]\r\n      </button>\r\n    </div>\r\n    <p class="pwd-instruction">[[[i18n "setting/lbl_altpwd_password_desc"]]]</p>\r\n  <\/script>\r\n\r\n  {{/raw}}\r\n</div>'},979:function(e,t,i){e.exports=i(469)('<section class="m-password"> <div class="main-wrapper"> <div class="content-wrapper f-cf"> <div class="j-pwd-info"></div> <div class="altpwd-wrap j-altpwd-wrap"></div> </div> \x3c!--[if lt IE 9]> <div class="sg-mask"></div> <![endif]--\x3e <div class="panel u-scroll edit-panel u-pass-edit"> <div class="j-pwd-edit"></div> </div> </div> </section>',{passSetTpl:'<div class="u-pass-info"> <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label f-mgr">{{i18n "pref/password/userid"}}</label> </div> <div class="u-form-value account"> {{dnEmail}} </div> </div> <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_accountPassword"}}</label> <button class="u-btn u-btn-default" data-action="editPwd">{{i18n "setting/op_update_pwd"}}</button> </div> {{#if isEnablePasswordAge}} <div class="u-form-item"> <label class="u-form-label f-mgr">{{i18n "setting/lbl_passwordExpiryTime"}}</label> <div class="item-value"> {{#if expiry}} {{expiry}} {{else if passwordAge}} {{i18n "prop:setting/lbl_expiry_after_days" 0=passwordAge}} {{^}} {{i18n "setting/lbl_expiry_forever"}} {{/if}} <span class=expiry_notify>{{i18n "setting/lbl_changePwdBeforeExpiryNotify"}}</span> </div> </div> {{/if}} </div>',passEditTpl:'<form action="#" method="post" name="changePwd" class="u-form" onsubmit="return false;"> <div class="u-btns-top"> <button type="button" data-action="changePwd" disabled class="u-btn u-btn-primary">{{i18n "setting/op_save"}}</button> <button type="reset" class="u-btn u-btn-default " data-action="cancel">{{i18n "setting/op_cancel"}}</button> </div> <h4>{{i18n "setting/lbl_passwordSet"}}</h4> <div class="u-form-item"> <label class="u-form-label">{{i18n "pref/password/curpass"}}</label> <input type="password" class="u-input" name="oldPassword"> <div class="notify f-dn"></div> </div> <div class="u-form-item f-pr"> <label class="u-form-label">{{i18n "pref/password/newpass"}}</label> <input type="password" class="u-input" name="newPassword"> <div class="notify f-dn"></div> </div> <div class="u-form-item"> <label class="u-form-label">{{i18n "setting/lbl_confirmPassword"}}</label> <input type="password" class="u-input" name="rePassword:skip"> <div class="notify f-dn"></div> </div> {{#if (and isEnablePasswordAge (eq passwordAge 0))}} <div class="u-form-item"> <label class="u-form-label">{{i18n "pref/password/passworkage"}}</label> <select class="u-input" name="passwordAge:number"> <option value=0> {{i18n "pref/password/passworkage_forever"}}</option> <option value=7> {{i18n "pref/password/passworkage_1w"}} ({{countDown 7}})</option> <option value=30> {{i18n "pref/password/passworkage_1m"}} ({{countDown 30}})</option> <option value=90> {{i18n "pref/password/passworkage_3m"}} ({{countDown 90}})</option> <option value=180>{{i18n "pref/password/passworkage_6m"}} ({{countDown 180}})</option> <option value=365>{{i18n "pref/password/passworkage_12m"}} ({{countDown 365}})</option> </select> <span class="expiry_desc">{{i18n \'setting/lbl_changePwdBeforeExpiry\'}}</span> </div> {{/if}} </form>'})},980:function(e,t,i){var n=i(472),a=i(471),s=i(468).get;a.module({name:'setting.account.externalauth',template:'<iframe src="'+s('setting.externalAuthUrl')+'" width="100%" height="98%">'},n)},981:function(e,t,i){(function(e){i(982);var t=i(463),n=i(472),a=i(471),s=i(480),l=i(475),r=i(465),o=i(467),c=i(585),d=i(660),u=d.config,p=d.enableModify,f=u.updateTimes||{},m=f.max,v=f.current,h=u.enableAllowDomains,b=u.email||'',g=+u.maxLength,_=-1===m?0:m-v,y=n.extend({Implements:s,attrs:{aliasId:{getter:function(){return b.length>0?b.split('@')[0]:''},readOnly:!0},aliasDomain:{getter:function(){var e=o.getUser().primary_email;return b.length>0?b.split('@')[1]:e.split('@')[1]},readOnly:!0}}},(function(i){var n=this,a=!1,s=-1===m||_>0;function d(i){var s,r={aliasId:n.get('aliasId'),aliasDomain:n.get('aliasDomain'),allOrgDomains:i,maxUserAliasLength:g,enableAllowDomains:h,enableModifyAlias:p},o=n.compile(n.$('#aliasSetTpl').html(),r);n.$('.j-alias-content').html(o),u(),s=function(e,t){var i=e.attr(t);return void 0!==i&&!1!==i&&i},n.$('.j-alias-content').find('form').each((function(i,n){if(!1===s(t(n),'validator'))return!0;var r=[];t(n).find('input').each((function(i,n){var a=s(t(n),'validator-rules'),o=s(t(n),'validator-display')||'';!1!==a&&r.push(e.assign({name:t(n).attr('name'),rules:a,display:o},'regexp_email'===a?{regexp_email:l}:{}))})),r.length&&new c(t(n).attr('id')||t(n).attr('name'),r,(function(e){(a=e.errors.length>0)?e.errors.forEach((function(e){return t(e.element).closest('.j-form-item').addClass('error').find('.j-form-explain').html(e.message)})):f()}))})),n.$('.j-input-alias-id').on('propertychange input',f)}function u(){var e=n.compile(n.$('#tipTpl').html(),{enableUpdate:s,maxAliasUpdateTimes:m,maxUserAliasLength:g,remainUpdateTimes:_});n.$('.j-form-tip').html(e),s&&p||['.j-btn-save','.j-input-alias-id','.j-select-domain'].forEach((function(e){return n.$(e).prop('disabled',!0)}))}function f(){n.$('.j-form-item').removeClass('error').find('.j-form-explain').html('')}n.events={'click [data-action]':function(e,i){switch(t(i).data('action')){case'save':l=n.$('.j-input-alias-id').val(),c=n.$('.j-alias-form').data('domain'),n.$('.j-input-alias-email').val(l+'@'+c),n.$('.j-alias-form').trigger('submit'),!a&&(s={attrs:{alias_attrs:n.$('.j-input-alias-email').val().trim()}},o.updateAccountAttrs(s).then((function(){var e=r('pref/personal/alias_registered_succeed').replace('{0}',s.attrs.alias_attrs);t.notify.success(e),-1!==m&&(_--,u())}),(function(e){var i,n=e.code;(i=r('error/'+n))==='error/'+n&&(i=r('pref/personal/'+n)),'ALIAS_UPDATE_TIMES_OVERFLOW'===n&&(i=r('pref/personal/alias_update_times_overflow')),t.notify.error(i)})));break;case'reset':!function(){n.$('.j-input-alias-id').val(n.get('aliasId')),h&&n.$('.j-select-domain').val(n.get('aliasDomain'));f()}()}var s,l,c},'change .j-select-domain':function(e,i){n.$('.j-alias-form').data('domain',t(i).val())}},n.render=function(){i('render')(),h?o.allOrgDomains.get(d):d()}}));a.module({name:'setting.account.alias',template:i(983)},y)}).call(this,i(464))},983:function(e,t){e.exports='<section class="m-alias content-wrapper">\r\n  <div class="operation">\r\n    <div class="u-btns-top f-ib">\r\n      <button type="button" class="u-btn u-btn-primary j-btn-save" data-action="save">{{i18n "setting/op_save"}}</button>\r\n      <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button>\r\n      <span class="alias-message">{{i18n \'pref/alias_update_desc\'}}</span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="content j-alias-content"></div>\r\n\r\n  {{#raw}}\r\n  <script id="aliasSetTpl" type="text/x-handlebars-template">\r\n    [[#if enableModifyAlias]]\r\n    <form class="j-alias-form" method="post" onsubmit="return false" data-domain="[[aliasDomain]]" name="editAlias" validator>\r\n      <div class="u-form-item j-form-item">\r\n        <label class="u-form-label">[[i18n \'setting/lbl_alias\']]: </label>\r\n        <div class="u-form-value">\r\n          <input type="text" class="u-input j-input-alias-id" name="aliasId" value="[[aliasId]]"\r\n                 [[#compare maxUserAliasLength \'!=\' 0]] validator-rules="max_length([[maxUserAliasLength]])" validator-display="{{i18n \'pref/personal/FA_ALIAS_LENGTH_MORE\'}}"[[/compare]]\r\n          />\r\n          <span>@</span>\r\n          [[#if enableAllowDomains]]\r\n          <select name="domain" class="j-select-domain">\r\n            [[#each allOrgDomains]]\r\n            <option title="[[this]]" [[#compare ../aliasDomain \'==\' this]]selected[[/compare]]>[[this]]</option>\r\n            [[/each]]\r\n          </select>\r\n          [[else]]\r\n          <label>[[aliasDomain]]</label>\r\n          [[/if]]\r\n          <span class="u-form-tip j-form-tip"></span>\r\n          <span class="u-form-explain j-form-explain f-db"></span>\r\n        </div>\r\n        <input type="hidden" class="j-input-alias-email" name="aliasEmail" validator-rules="regexp_email" validator-display="{{i18n \'setting/msg_invalid_email_address\'}}"/>\r\n      </div>\r\n    </form>\r\n    [[else]]\r\n    <span class="alias-not-modify-tip f-ib">[[i18n \'pref/personal/alias_update_main_account_only\']]</span>\r\n    [[/if]]\r\n  <\/script>\r\n\r\n  <script id="tipTpl" type="text/x-handlebars-template">\r\n    ([[#if enableUpdate]]\r\n    [[#compare maxUserAliasLength \'>\' 0]]\r\n    [[i18n \'pref/personal/maxAliasLength\']]: [[maxUserAliasLength]]\r\n    [[/compare]]\r\n    [[#compare maxAliasUpdateTimes \'!=\' -1]]\r\n    [[i18n \'pref/personal/remainAliasUpdateTimes\']]: [[remainUpdateTimes]]\r\n    [[/compare]]\r\n    [[else]]\r\n    [[i18n \'pref/personal/moreAliasUpdateTimes\']]\r\n    [[/if]])\r\n  <\/script>\r\n  {{/raw}}\r\n</section>\r\n'},984:function(e,t,i){i(499)('setting.display',{mainClassName:'m-sgdisplay'})},985:function(e,t,i){(function(e){var t=i(463),n=i(472),a=i(471),s=i(480),l=i(470).alert,r=i(467),o=i(476),c=i(468).get,d=i(465),u={},p=n.extend({Implements:s,templateHelpers:{translateI18N:function(e,t){t=null==t?u.defaultValues[e]:t;var i=u.recommendValues[e]===t?'('+d('pref/preference/recommendation')+')':'';return'maxlist'===e||'display_list'===e||'replyf'===e?d('setting.'+e+'_v_'+t)+i:'addo'===e?d('setting.'+e+'_v'):d('pref/preference/'+e+'_v_'+t)+i},formattedChosen:function(e,t){var i=e.value,n='maxlist'==e.key||'replyf'==e.key;return null!=i?i==t?n?'selected':'checked':'':u.defaultValues[e.key]==t?n?'selected':'checked':''}},events:{'click [data-action]':'_dispatchAction'},setup:function(){u.defaultValues=r.getReservedUserAttrValues(),u.recommendValues=r.getReservedUserAttrRecommendValues(),u.allKeys=r.getReservedUserAttrKeys()},render:function(){p.superclass.render.call(this),this._initView(),this._initModuleEvent()},_initView:function(){var i=this;e.when(o.getFaces(),o.optAttrs('time_zone,firstpage')).then((function(e,n){var a=e[0],s=e[1];for(var l in i.facesModel={faces:a.faces,skins:s.skins,locales:s.locales,currentFace:c('context.face'),currentLocale:c('context.locale')||'zh_CN',currentSkin:s.preferredSkin||'blue'},i.preferModel={},n)if(n.hasOwnProperty(l)){var r={label:d('pref/preference/'+l+'_text'),key:l,value:n[l]};'time_zone'===l&&(r.value=c('setting.timezoneid')),i.preferModel[l]=r}i.$('.j-general-form').html(i.compile(t('#generalSetTpl').html(),t.extend(i.preferModel,i.facesModel))),i.element.customRadioCheckbox()}))},_initModuleEvent:function(){var e=this;e.subscribe('skins','changed',(function(t){e.facesModel=t.message}))},_dispatchAction:function(e,i){switch(t(i).data('action')){case'save':this._changeFaceSettings();break;case'reset':this._initView()}},_changeFaceSettings:function(){var i=this,n=this.$('.j-general-form').serializeJSON({defaultType:'+I'}),a=n.other,s=i.facesModel.faces[a.face];a.skin=s.preferredSkin||s.skins[0],delete n.other,e.when(r.updateUser(n),o.changeFacesettings(a)).then((function(e,a){t.notify(d('setting/msg_prefUpdateSuccess')),t.each(n,(function(e,t){i.preferModel[e].value=t})),a&&a.changed&&l(d('setting/msg_prefOtherUpdateSuccess'),(function(){location.href=a.mainURL}))}))}});a.module({name:'setting.display.general',template:i(986)},p)}).call(this,i(466))},986:function(e,t){e.exports='<section class="m-general content-wrapper">\r\n    <div class="operation">\r\n      <div class="u-btns-top">\r\n        <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button>\r\n        <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button>\r\n      </div>\r\n    </div>\r\n  <form action="" class="j-general-form">\r\n\r\n  </form>\r\n\r\n  {{#raw}}\r\n  <script id="generalSetTpl" type="text/x-handlebars-template">\r\n\r\n    [[#if firstpage]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[firstpage.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="firstpage"  value="0" [[formattedChosen firstpage 0]]/>\r\n            [[translateI18N \'firstpage\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="firstpage"  value="1" [[formattedChosen firstpage 1]]/>\r\n            [[translateI18N \'firstpage\' 1]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">{{i18n "setting/face"}}：</label>\r\n      </div>\r\n\r\n      <div class="u-form-value j-face-switch">\r\n        [[#each faces]]\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="other[face]" id="face_[[@key]]" value="[[@key]]" [[#compare @key "==" ../currentFace]] checked [[/compare]]/>&nbsp;[[this.name]]\r\n          </label>\r\n        </div>\r\n        [[/each]]\r\n      </div>\r\n    </div>\r\n\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">{{i18n "setting/language"}}：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <select name="other[locale]" class="j-locale-switch">\r\n          [[#each locales]]\r\n          <option value="[[@key]]" [[#compare @key "==" ../currentLocale]] selected [[/compare]]>[[this]]</option>\r\n          [[/each]]\r\n        </select>\r\n      </div>\r\n    </div>\r\n\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">{{i18n \'setting/timezone_text\'}}：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <select name="time_zone:string">[[[tzOptions time_zone.value]]]</select>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  <\/script>\r\n\r\n  {{/raw}}\r\n\r\n</section>'},987:function(e,t,i){i(988);var n=i(463),a=i(472),s=i(471),l=i(480),r=i(467),o=i(476),c=i(465),d={},u=a.extend({Implements:l,templateHelpers:{translateI18N:function(e,t){t=null==t?d.defaultValues[e]:t;var i=d.recommendValues[e]===t?'('+c('pref/preference/recommendation')+')':'';return'maxlist'===e||'display_list'===e||'replyf'===e?c('setting.'+e+'_v_'+t)+i:'addo'===e?c('setting.'+e+'_v'):c('pref/preference/'+e+'_v_'+t)+i},formattedChosen:function(e,t){var i=e.value,n='maxlist'==e.key||'replyf'==e.key;return null!=i?i==t?n?'selected':'checked':'':d.defaultValues[e.key]==t?n?'selected':'checked':''}},events:{'click [data-action]:not(.m-preview-type.checked)':'_dispatchAction','change.crc .j-toggle':'_handleToggle'},setup:function(){this.config=i(989)(),d.defaultValues=r.getReservedUserAttrValues(),d.recommendValues=r.getReservedUserAttrRecommendValues(),d.allKeys=r.getReservedUserAttrKeys(),this._initModuleEvent()},_initModuleEvent:function(){var e=this;e.onMessage('view:refresh',(function(){e._initView()}),null)},render:function(){u.superclass.render.call(this),this._initView()},_initView:function(){var e=this;o.optAttrs(d.allKeys).then((function(t){for(var i in e.preferModel={enableFastPreviewLayout:e.config.enableFastPreviewLayout},t)if(t.hasOwnProperty(i)){var a={label:c('pref/preference/'+i+'_text'),key:i,value:t[i]};'list_brief_text'===i&&(a.enable=e.config.enableListBriefText),e.preferModel[i]=a}e.$('.j-list-form').html(e.compile(n('#listSetTpl').html(),e.preferModel)),e.element.customRadioCheckbox()}))},_dispatchAction:function(e,t){switch(n(t).data('action')){case'save':this._changeListSettings();break;case'reset':this._initView();break;case'change':this._changePreviewLayout(t)}},_handleToggle:function(e){n(e.target).prop('checked',n(e.target).siblings('.u-switch-onoff').hasClass('checkbox-checked'))},_changePreviewLayout:function(e){this.$('.m-preview-type').removeClass('checked'),n(e).addClass('checked').find('[name=preview_layout]').prop('checked',!0)},_changeListSettings:function(){var e=this,t=e.$('.j-list-form').serializeJSON({defaultType:'+I'}),i=r.getUser().preview_layout;r.updateUser(t).then((function(){var a=r.getUser().preview_layout;i===a?e.sendMessage('mail.list','view:refresh',{start:0}):i&&a&&e.sendMessage('mail.previewlayout','view:refresh'),n.each(t,(function(t,i){e.preferModel[t].value=i})),n.notify(c('setting/msg_prefUpdateSuccess'))}))}});s.module({name:'setting.display.list',template:i(990)},u)},989:function(e,t,i){var n=i(467);e.exports=function(){return{face:n.getConfig('context.face'),locale:n.getConfig('context.locale'),skin:n.getConfig('context.skin'),enableFastPreviewLayout:n.getConfig('mail.enableFastPreviewLayout'),timezoneId:n.getConfig('setting.timezoneid'),enableListBriefText:n.getConfig('user.enablelistbrieftext'),allEmails:n.getConfig('user.allemails'),timezoneValues:n.getConfig('setting.timezonevalues')}}},990:function(e,t){e.exports='<section class="m-list-display content-wrapper">\r\n  <div class="operation">\r\n    <div class="u-btns-top">\r\n      <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button>\r\n      <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button>\r\n    </div>\r\n  </div>\r\n  <form action="" class="j-list-form">\r\n\r\n  </form>\r\n\r\n  {{#raw}}\r\n  <script id="listSetTpl" type="text/x-handlebars-template">\r\n\r\n    [[#if maxlist]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/maxlist_text"]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <select name="maxlist">\r\n          <option value="10"  [[formattedChosen maxlist 10]]> [[translateI18N \'maxlist\' 10]] </option>\r\n          <option value="20"  [[formattedChosen maxlist 20]]> [[translateI18N \'maxlist\' 20]] </option>\r\n          <option value="50"  [[formattedChosen maxlist 50]]> [[translateI18N \'maxlist\' 50]] </option>\r\n          <option value="100" [[formattedChosen maxlist 100]]> [[translateI18N \'maxlist\' 100]] </option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    \x3c!--读信窗口 0=默认 1=上下布局 2=左右布局--\x3e\r\n    [[#if preview_layout]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/preview_layout"]]：</label>\r\n      </div>\r\n      <div class="u-form-value preview_layout">\r\n        <div class="m-preview-type icon_layout_normal [[formattedChosen preview_layout 0]]" data-action="change">\r\n          <span>[[i18n \'setting/preview_layout_0\']]</span>\r\n          <input type="radio" name="preview_layout" class="radio" value="0" [[formattedChosen preview_layout 0]] >\r\n          <i class="iconfont iconchoose f-dn"></i>\r\n        </div>\r\n        [[#if enableFastPreviewLayout]]\r\n        <div class="m-preview-type icon_layout_bottom [[formattedChosen preview_layout 1]]" data-action="change">\r\n          <span>[[i18n \'setting/preview_layout_1\']]</span>\r\n          <input type="radio" name="preview_layout" class="radio" value="1" [[formattedChosen preview_layout 1]] >\r\n          <i class="iconfont iconchoose f-dn"></i>\r\n        </div>\r\n        [[/if]]\r\n        <div class="m-preview-type icon_layout_right [[formattedChosen preview_layout 2]]" data-action="change">\r\n          <span>[[i18n \'setting/preview_layout_2\']]</span>\r\n          <input type="radio" name="preview_layout" class="radio" value="2" [[formattedChosen preview_layout 2]] >\r\n          <i class="iconfont iconchoose f-dn"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    \x3c!--列表显示样式 0=标准模式/1=邮件会话模式 --\x3e\r\n    [[#if display_list]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/display_list"]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <span class="switch-box">\r\n          <input type="checkbox" name="display_list" role="switchBtn" class="checkbox j-toggle" value="1" data-unchecked-value="0" [[formattedChosen display_list 1]] >\r\n        </span>\r\n        <i class="iconfont iconinformation display-list-tip" title="[[[i18n \'setting/display_list_tip\']]]"></i>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n     \x3c!--正文摘要--\x3e\r\n    [[#if list_brief_text.enable]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/list_brief_text"]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n          <span class="switch-box">\r\n              <input type="checkbox" name="list_brief_text" role="switchBtn" class="checkbox j-toggle" value="1" data-unchecked-value="0" [[formattedChosen list_brief_text 1]] >\r\n         </span>\r\n         <span class="recommend-text">[[i18n "setting/recommend_open"]]</span>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    \x3c!--显示邮件大小--\x3e\r\n    [[#if display_size]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[display_size.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n          <span class="switch-box">\r\n              <input type="checkbox" name="display_size" role="switchBtn" class="checkbox j-toggle" value="1" data-unchecked-value="0" [[formattedChosen display_size 1]] >\r\n         </span>\r\n         <span class="recommend-text">[[i18n "setting/recommend_close"]]</span>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n     \x3c!--字号行高--\x3e\r\n    [[#if list_style]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[list_style.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="list_style"  value="1" [[formattedChosen list_style 1]]/>\r\n            [[translateI18N \'list_style\' 1]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="list_style"  value="0" [[formattedChosen list_style 0]]/>\r\n            [[translateI18N \'list_style\' 0]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if clock_system]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/clock_system"]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="clock_system"  value="1" [[formattedChosen clock_system 1]]/>\r\n            [[translateI18N \'clock_system\' 1]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="clock_system"  value="0" [[formattedChosen clock_system 0]]/>\r\n            [[translateI18N \'clock_system\' 0]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if search_ordering_rule]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[i18n "setting/search_ordering_rule"]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="search_ordering_rule"  value="0" [[formattedChosen search_ordering_rule 0]]/>\r\n            [[translateI18N \'search_ordering_rule\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="search_ordering_rule"  value="1" [[formattedChosen search_ordering_rule 1]]/>\r\n            [[translateI18N \'search_ordering_rule\' 1]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n  <\/script>\r\n\r\n  {{/raw}}\r\n\r\n</section>'},991:function(e,t,i){var n=i(499),a=i(468).get;n('setting.delivery',{className:'m-sgdelivery',overrides:{forward:a('user.enableforward'),autoreply:a('user.enableautoreply'),template:a('mail.enablemailtemplate')}})},992:function(e,t,i){(function(e){i(993);var t=i(463),n=i(464),a=i(547).K,s=i(472),l=i(471),r=i(468).get,o=i(467),c=i(476),d=i(465),u=o.getReservedUserAttrValues(),p=o.getReservedUserAttrRecommendValues(),f='default',m=-1,v=i(994).helpers({translateI18N:function(e,t){t=null==t?u[e]:t;var i=p[e]===t?'('+d('pref/preference/recommendation')+')':'';return'maxlist'===e||'display_list'===e||'replyf'===e?d('setting.'+e+'_v_'+t)+i:'addo'===e?d('setting.'+e+'_v'):'save_sent'===e||'aftersend_saveaddr'===e||'displaysender'===e||'when_sendmail'===e?d('setting.'+e+'_text'):d('pref/preference/'+e+'_v_'+t)+i},formattedChosen:function(e,t){var i=e.key,n=e.value;return(null!=n?n:u[i])==t?'maxlist'===i||'replyf'===i?'selected':'checked':''}}),h=s.extend({},(function(){var i,s=this;function l(){e.when(c.optAttrs(o.getReservedUserAttrKeys()),c.getFaces()).then((function(e,l){var o=l[2];((e=n.mapValues(e,(function(e,t){return{label:d('pref/preference/'+t+'_text'),key:t,value:e}}))).default_sender_address||{}).options=[{addr:'',text:d('pref/preference/default_sender_address_v_')}].concat(r('user.allemails')),i=o,e.default_font={enable:r('user.enableDefaultFont'),key:'default_font',value:{family:o.family||f,size:o.size||m}},e.familyList=[{value:f,label:d('setting/default_font_family')}],t.each(a.lang('fontname.fontName'),(function(t,i){e.familyList.push({value:t,label:i})})),e.sizeList=[{value:m,label:d('setting/default_font_size')}],a.options.fontSizeTable.forEach((function(t){e.sizeList.push({value:t.replace('px',''),label:t})}));var c=s.$('.j-compose-form').html(v.composeSetTpl(e));c.find('*').change(),c.customRadioCheckbox()}))}s.events={'click [data-action]':function(n,a){switch(t(a).data('action')){case'save':!function(){var n,a=s.$('.j-compose-form').serializeJSON({defaultType:'+I'});'default_family'in a&&([['default_family','family',f],['default_size','size',m]].forEach((function(e){var t=e[0],n=e[1],s=e[2];a[t]!==s?i[n]=a[t]:delete i[n],delete a[t]})),n=c.changeFacesettings({options:i}));e.when(o.updateUser(a),n).then((function(){t.notify(d('setting/msg_prefUpdateSuccess'))}))}();break;case'reset':l()}},'change input[name=edit_mode]':function(){s.$('.disable-mask').toggle(s.$('input[name=edit_mode]').is('[value=0]:checked'))},'change [role=default_font]':function(){var e=s.$('select[name="default_family"]').val(),t=s.$('select[name="default_size"]').val();s.$('.j-preview-font').css('font-family',e===f?'':e).css('font-size',t<0?'':t+'px')}},s.after('render',l)}));l.module({name:'setting.delivery.compose',template:v},h)}).call(this,i(466))},994:function(e,t,i){e.exports=i(469)('<section class="m-compose-set content-wrapper"> <div class="operation"> <div class="u-btns-top"> <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button> <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button> </div> </div> <form action="" class="j-compose-form"> </form> </section>',{composeSetTpl:'{{#with default_sender_address}} <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{label}}：</label> </div> <div class="u-form-value"> <select name="default_sender_address"> {{#each options}} <option value="{{addr}}" {{if$ (eq ../value addr) \'selected\'}}>{{if$ text text addr}}</option> {{/each}} </select> </div> </div> {{/with}} {{#if edit_mode}} <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{edit_mode.label}}：</label> </div> <div class="u-form-value"> <div> <label> <input type="radio" name="edit_mode" value="1" {{formattedChosen edit_mode 1}}/> {{translateI18N \'edit_mode\' 1}} </label> </div> <div> <label> <input type="radio" name="edit_mode" value="0" {{formattedChosen edit_mode 0}}/> {{translateI18N \'edit_mode\' 0}} </label> </div> </div> </div> {{/if}} {{#if default_font.enable}} <div class="u-form-item"> <div class="disable-mask"></div> <div class="f-fl"> <label class="u-form-label">{{i18n \'setting/edit_mode_set_font\'}}：</label> </div> <div class="u-form-value"> <select role="default_font" name="default_family"> {{#each familyList}} <option value="{{value}}" {{#compare ../default_font.value.family \'==\' value}}selected{{/compare}}>{{label}}</option> {{/each}} </select> <select role="default_font" name="default_size"> {{#each sizeList}} <option value="{{value}}" {{#compare ../default_font.value.size \'==\' value}}selected{{/compare}}>{{label}}</option> {{/each}} </select> </div> <div class="j-preview-font font-pre-view">{{i18n \'setting/font_preview_text\'}}</div> </div> {{/if}} <div class="u-form-item"> <div class="f-fl"> <label class="u-form-label">{{translateI18N \'when_sendmail\'}}：</label> </div> <div class="u-form-value"> {{#if save_sent}} <div> <label> <input type="checkbox" name="save_sent" value="1" data-unchecked-value="0" {{formattedChosen save_sent 1}}/> {{translateI18N \'save_sent\'}} </label> </div> {{/if}} {{#if aftersend_saveaddr}} <div> <label> <input type="checkbox" name="aftersend_saveaddr" value="1" data-unchecked-value="0" {{formattedChosen aftersend_saveaddr 1}}/> {{translateI18N \'aftersend_saveaddr\'}} </label> </div> {{/if}} {{#if displaysender}} <div> <label> <input type="checkbox" name="displaysender" value="0" data-unchecked-value="1" {{formattedChosen displaysender 0}}/> {{translateI18N \'displaysender\'}} : {{@config.user.name}} </label> </div> {{/if}} </div> </div>'})},995:function(e,t,i){var n=i(463),a=i(472),s=i(471),l=i(480),r=i(467),o=i(476),c=i(465),d={},u=a.extend({Implements:l,templateHelpers:{translateI18N:function(e,t){t=null==t?d.defaultValues[e]:t;var i=d.recommendValues[e]===t?'('+c('pref/preference/recommendation')+')':'';return'maxlist'===e||'display_list'===e||'replyf'===e?c('setting.'+e+'_v_'+t)+i:'addo'===e?c('setting.'+e+'_v'):c('pref/preference/'+e+'_v_'+t)+i},formattedChosen:function(e,t){var i=e.value,n='maxlist'==e.key||'replyf'==e.key;return null!=i?i==t?n?'selected':'checked':'':d.defaultValues[e.key]==t?n?'selected':'checked':''}},events:{'click [data-action]':'_dispatchAction'},setup:function(){d.defaultValues=r.getReservedUserAttrValues(),d.recommendValues=r.getReservedUserAttrRecommendValues(),d.allKeys=r.getReservedUserAttrKeys()},render:function(){u.superclass.render.call(this),this._initView()},_initView:function(){var e=this;o.optAttrs(d.allKeys).then((function(t){for(var i in e.preferModel={},t)if(t.hasOwnProperty(i)){var a={label:c('pref/preference/'+i+'_text'),key:i,value:t[i]};e.preferModel[i]=a}e.$('.j-reply-form').html(e.compile(n('#replySetTpl').html(),e.preferModel)),e.element.customRadioCheckbox()}))},_dispatchAction:function(e,t){switch(n(t).data('action')){case'save':this._changeListSettings();break;case'reset':this._initView()}},_changeListSettings:function(){var e=this,t=e.$('.j-reply-form').serializeJSON({defaultType:'+I'});r.updateUser(t).then((function(){n.notify(c('setting/msg_prefUpdateSuccess')),n.each(t,(function(t,i){e.preferModel[t].value=i}))}))}});s.module({name:'setting.delivery.reply',template:i(996)},u)},996:function(e,t){e.exports='<section class="m-reply-set content-wrapper">\r\n  <div class="operation">\r\n    <div class="u-btns-top">\r\n      <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button>\r\n      <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button>\r\n    </div>\r\n  </div>\r\n  <form action="" class="j-reply-form">\r\n\r\n  </form>\r\n\r\n  {{#raw}}\r\n  <script id="replySetTpl" type="text/x-handlebars-template">\r\n\r\n    [[#if addo]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[addo.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="checkbox" name="addo"  value="0" data-unchecked-value="1" [[formattedChosen addo 0]]/>\r\n            [[translateI18N \'addo\']]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if replyf]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[replyf.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <select name="replyf">\r\n          <option value="0" [[formattedChosen replyf 0]]> [[translateI18N \'replyf\' 0]] </option>\r\n          <option value="1" [[formattedChosen replyf 1]]> [[translateI18N \'replyf\' 1]] </option>\r\n          <option value="2" [[formattedChosen replyf 2]]> [[translateI18N \'replyf\' 2]] </option>\r\n          <option value="3" [[formattedChosen replyf 3]]> [[translateI18N \'replyf\' 3]] </option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if reply_all_mode]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[reply_all_mode.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="reply_all_mode" value="0" [[formattedChosen reply_all_mode 0]]/>\r\n            [[translateI18N \'reply_all_mode\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="reply_all_mode" value="1" [[formattedChosen reply_all_mode 1]]/>\r\n            [[translateI18N \'reply_all_mode\' 1]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n  <\/script>\r\n\r\n  {{/raw}}\r\n</section>'},997:function(e,t,i){var n=i(463),a=i(472),s=i(471),l=i(480),r=i(467),o=i(476),c=i(465),d={},u=a.extend({Implements:l,templateHelpers:{translateI18N:function(e,t){t=null==t?d.defaultValues[e]:t;var i=d.recommendValues[e]===t?'('+c('pref/preference/recommendation')+')':'';return'maxlist'===e||'display_list'===e||'replyf'===e?c('setting.'+e+'_v_'+t)+i:'addo'===e?c('setting.'+e+'_v'):c('pref/preference/'+e+'_v_'+t)+i},formattedChosen:function(e,t){var i=e.value,n='maxlist'==e.key||'replyf'==e.key;return null!=i?i==t?n?'selected':'checked':'':d.defaultValues[e.key]==t?n?'selected':'checked':''}},events:{'click [data-action]':'_dispatchAction'},setup:function(){d.defaultValues=r.getReservedUserAttrValues(),d.recommendValues=r.getReservedUserAttrRecommendValues(),d.allKeys=r.getReservedUserAttrKeys()},render:function(){u.superclass.render.call(this),this._initView()},_initView:function(){var e=this;o.optAttrs(d.allKeys).then((function(t){for(var i in e.preferModel={},t)if(t.hasOwnProperty(i)){var a={label:c('pref/preference/'+i+'_text'),key:i,value:null!=t[i]?t[i]:d.defaultValues[i]};e.preferModel[i]=a}e.$('.j-read-form').html(e.compile(n('#readSetTpl').html(),e.preferModel)),e.element.customRadioCheckbox()}))},_dispatchAction:function(e,t){switch(n(t).data('action')){case'save':this._changeListSettings();break;case'reset':this._initView()}},_changeListSettings:function(){var e=this,t=e.$('.j-read-form').serializeJSON({defaultType:'+I'});r.updateUser(t).then((function(){n.notify(c('setting/msg_prefUpdateSuccess')),n.each(t,(function(t,i){e.preferModel[t].value=i}))}))}});s.module({name:'setting.delivery.read',template:i(998)},u)},998:function(e,t){e.exports='<section class="m-read-set content-wrapper">\r\n  <div class="operation">\r\n    <div class="u-btns-top">\r\n      <button type="button" class="u-btn u-btn-primary" data-action="save">{{i18n "setting/op_save"}}</button>\r\n      <button type="button" class="u-btn u-btn-default" data-action="reset">{{i18n "setting/op_cancel"}}</button>\r\n    </div>\r\n  </div>\r\n  <form action="" class="j-read-form">\r\n\r\n  </form>\r\n\r\n  {{#raw}}\r\n  <script id="readSetTpl" type="text/x-handlebars-template">\r\n\r\n    [[#if newwindowtoreadletter]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[newwindowtoreadletter.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="newwindowtoreadletter"  value="0" [[formattedChosen newwindowtoreadletter 0]]/>\r\n            [[translateI18N \'newwindowtoreadletter\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="newwindowtoreadletter"  value="1" [[formattedChosen newwindowtoreadletter 1]]/>\r\n            [[translateI18N \'newwindowtoreadletter\' 1]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if afterdel]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[afterdel.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="afterdel"  value="0" [[formattedChosen afterdel 0]]/>\r\n            [[translateI18N \'afterdel\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="afterdel"  value="1" [[formattedChosen afterdel 1]]/>\r\n            [[translateI18N \'afterdel\' 1]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if op_readreceipt]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[op_readreceipt.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="op_readreceipt"  value="0" [[formattedChosen op_readreceipt 0]]/>\r\n            [[translateI18N \'op_readreceipt\' 0]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="op_readreceipt"  value="1" [[formattedChosen op_readreceipt 1]]/>\r\n            [[translateI18N \'op_readreceipt\' 1]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="op_readreceipt"  value="2" [[formattedChosen op_readreceipt 2]]/>\r\n            [[translateI18N \'op_readreceipt\' 2]]\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n\r\n    [[#if subject_refw_prefix_expand]]\r\n    <div class="u-form-item">\r\n      <div class="f-fl">\r\n        <label class="u-form-label">[[subject_refw_prefix_expand.label]]：</label>\r\n      </div>\r\n      <div class="u-form-value">\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="subject_refw_prefix_expand"  value="1" [[formattedChosen subject_refw_prefix_expand 1]]/>\r\n            [[translateI18N \'subject_refw_prefix_expand\' 1]]\r\n          </label>\r\n        </div>\r\n        <div>\r\n          <label>\r\n            <input type="radio" name="subject_refw_prefix_expand"  value="0" [[formattedChosen subject_refw_prefix_expand 0]]/>\r\n            [[translateI18N \'subject_refw_prefix_expand\' 0]] <span style="color:#999">[[translateI18N \'subject_refw_prefix_expand\' 2]]</span>\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    [[/if]]\r\n  <\/script>\r\n  {{/raw}}\r\n</section>'},999:function(e,t,i){(function(e){i(1e3);var t=i(463),n=i(472),a=i(471),s=i(470).confirm,l=i(465),r=i(473),o=i(475),c=i(476),d=i(467),u=i(468).get,p=d.getLockOpValues().autoReply,f=i(1001),m=n.extend({attrs:{disabledAddButton:{value:null,setter:function(e){e?this.$('.j-button-add').attr('disabled',!0):this.$('.j-button-add').removeAttr('disabled')}}}},(function(){var i=this;function n(){i.element.mask(),c.optAttrs('forwardactive,keeplocal,forwarddes').then((function(e){e.forwarddes&&(i.state.forwarddes=e.forwarddes.split(','));var t=u('user.maxForwardMailCount');i.$('.j-forward-set').html(f.forwardSetTpl({forwarddes:i.state.forwarddes,maxForwardMailCount:t,keeplocal:e.keeplocal,forwardactive:e.forwardactive||0})).customRadioCheckbox(),i.set('disabledAddButton',i.state.forwarddes.length>=t)})).either((function(){i.element.mask('hide')}))}function a(e){i.$('.j-list').toggle(),e.find('i').toggleClass('iconunfold iconcollapse')}function m(){var e=i.$('.j-new-rule').val();e?o.test(e)?i.state.forwarddes.includes(e)?k(r.h(l('setting/msg_itemsExistForwardList'),e)):u('user.allemails').some((function(t){return t.addr===e}))?k(l('setting/msg_errExceptOwnMail')):v(e):k(l('setting/msg_errorEmailFormat')):k(l('setting/msg_inputEmpty'))}function v(a,s){c.auth2continue(p).then((function(){var r;a&&i.state.forwarddes.push(a),s&&(r=i.state.forwarddes.indexOf(s))>-1&&i.state.forwarddes.splice(r,1),d.updateUser(e.assign({forwarddes:i.state.forwarddes.join(',')},i.state.forwarddes.length?{}:{forwardactive:0})).then((function(){t.notify.success(l('setting/msg_forwardRuleSaveSuccessful')),n()}))}))}function y(){var e=i.$('#forward').serializeJSON({defaultType:'+I',checkboxUncheckedValue:0});delete e.forwarddes,e.forwardactive=i.$('#toggle').prop('checked')?parseInt(i.$('input[name="forwardactive"]:checked').val()):0,d.updateUser(e).then((function(){t.extend(i.state,e),e.forwardactive?t.notify.success(l('setting/msg_forwardEnableSuccessful')):t.notify.success(l('setting/msg_forwardDisableSuccessful'))}))}function w(e){var t=e.data('item-name');s(r.h(l('setting/msg_confirmContactDel'),t),v.bind(0,null,t))}function k(e){i.$('.u-list-modify').find('.u-error-alert').html(e).end().addClass('error')}function x(t){[e.noop,g.bind(0,i.$('#keeplocal')),function(){_(i.$('#keeplocal')),b(i.$('#forwardactive_1')),h(i.$('#forwardactive_3'))}][t](),y()}i.events={'click [data-action]':[function(e,t){({listToggle:a,add:m,update:y,remove:w})[e](t)}],'change.crc #toggle':function(){var e=i.$('#toggle'),t=e.is(':checked');c.auth2continue(p).then((function(){h(i.$('#forwardactive_1'),t),h(i.$('#keeplocal'),t),!t&&b(i.$('#forwardactive_3')),i.$('.disable-mask').toggleClass('f-dn'),y()}),h.bind(0,e,!t))},'change.crc #forwardactive_1':x.bind(0,1),'change.crc #forwardactive_3':x.bind(0,2),'change.crc #keeplocal':x.bind(0,0)},i.state={forwarddes:[]},i.after('render',n)})),v=i(489),h=v.rcCheck,b=v.rcUncheck,g=v.rcOn,_=v.rcOff;a.module({name:'setting.delivery.forward',template:f},m)}).call(this,i(464))}}]);
//# sourceMappingURL=S.c2f53.js.map