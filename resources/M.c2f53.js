(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{531:function(e,a,t){(function(a){t(509);var i=t(815),n=i.tipTpl,s=i.dialogTpl,l=t(479),o=t(465),r=t(510),c=t(470).confirm;e.exports=function(e,t,i,d){var f=i.trigger,m=i.deferDate,p=l(m||0),u=(m=p>0?p.format('YYYY-MM-DD'):'')?p.startOf('day').diff(l().startOf('day'),'days'):0,v=[o('mail/today'),o('mail/tomorrow'),o('mail/theDayAfterTmr')];function g(){var e;c(s({dayLang:v,days:u,other:v[u]?'':m}),{title:o('mail/defer_dialog_title'),afterShow:function(){var a=(e=this.$('[name=other]').datepicker({startDate:new Date}).click((function(){return a.prop('checked',!0).change()}))).prev();this.$().customRadioCheckbox()},onConfirm:function(){h(this.$('[name=defer]:checked').val(),e.val())}})}function h(a,i){i=(i=a?l().add(a,'days').startOf('day'):i&&l(i))?i.toDate():undefined,e.mark('defer',t,i,(function(e){d&&d({flags:{deferHandle:!!(i^e)},defer:i||new Date(0)})}))}f?f.off().click(a.stop(m?function(){var e=new r({arrowPosition:1,inViewport:!0,trigger:f,content:n({overdue:u<0,deferDate:v[u]||m}),events:{'click .j-defer-op':[function(a){({edit:g,complete:h})[a](),e.hide()}]}}).showOnce()}:g)):g()}}).call(this,t(464))},544:function(e,a,t){(function(a){var i=t(489),n=i['default'],s=i.rcCheck;t(486),t(816);var l=t(817),o=t(463),r=t(536),c=t(498),d=t(571),f=t(484),m=t(468),p=m.get,u=m.detachMode,v=t(466),g=t(465),h=t(475),b=t(473).h,_=t(482),y=t(470),w=y.alert,j=y.confirm,x=y.prompt,k=t(531),M=t(477).go,C=t(467),T=C.getUser,S=t(474),D=S.flush,A=t(487),$=t(476),E=r.extend({},(function(e,i,r,m,y){var E=this,L=i.sendMessage,F=(i.handleSelect||a.noop).bind(i);E.events={'click span[data-btn]':[le],'change.crc .j-switch-btn':[le,'setting:{{prop.name}}:{{if$ prop.checked 1 0}}'],'click .j-setting-menu [data-action]':[le,'setting:{{data.action}}']},e()({element:r});var R=i.name.split('.')[1],I=i.state.param,q=I.mboxa||'',z=('search'!==R&&I).fid,P=function(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.includes(z)},U=S.isExpandThreadMid.bind(0,z),O=function(e){return a.assign({mboxa:q,expandThreadMid:U()},e)},N=('list'!==R&&'search'!==R&&I).mid,B=E._params={action:''},H=a.once((function(){var e,t;Fe(),E.$('[data-dropdown]:not([role=dropdown])').each((function(e,a){var t=(a=o(a)).data().dropdown;if('move'===t){if(2===z)return void a.remove();Q(t,a,{callback:ve,search:{hint:g('main/folder_search')},minWidth:287})}else Q(t,a,{type:/^(select|view|sort)$/.test(t)?'radio':'',beforeShow:function(){E.$('li[value="'+t+':'+xe()[t]+'"]').dropdown('check')},callback:le.bind(0,0)})})),J(),n(E.$()),E.$('span.j-selectmail :checkbox').on('change.crc',(function(){E.$('li[value="select:'+(this.checked?'curPage':'none')+'"]').click()})).next().click(a.stop(1)),e=E.pubsub=new f,t=e.subscribe,E.on('mail:select',(function(e){'check'===e?(s(E.$('.j-selectmail input[type=checkbox]'),Ee()),ae(['more'])):Le(e)})).on('mail:refresh',(function(){le('refresh')})).on('mail:view',(function(e){le('view:'+e)})),t('mail','fdr:changed',ae.bind(0,['move']))})),W=a.assign({},i.config),Y=[z].concat(4!==z?[2]:[],p('mail.enableMoveTo.!')||[]),V=E.validFid=function(e){var a=t(542)(e),i=a[1],n=a[2],s=i>0&&n===q;return[i,!s||Y.includes(i),s]};function Q(e,t,i){function n(e){t.dropdown(a.assign({},i,{data:e}))}'move'===e?S.vdrList().then((function(e){n(a.mapFilter(e,(function(e){var t=V(e.id),i=t[0],n=t[1];return t[2]&&a.assign({disabled:n},e,{id:i})})))})):n(ie(e))}function J(){var e=T(),a={user:e,previewLayout:e.preview_layout!==undefined&&'search'!==R,displayList:e.display_list!==undefined&&'search'!==R,enableListBriefText:W.enableListBriefText&&('search'!==R||I.pattern)};n(G.$().html(l.settingTemplate(a)))}var X,K,G=new d({trigger:E.$('.j-setting'),triggerType:'click',parentNode:E.$(),align:{baseXY:['-265','100%']}});E.show=function(e,a){var t,n;return X=e,K=a,H(),t=i._params.start||0,n=X&&t?t/K:0,E.$('#pagination').pagination({total:X,limit:K,currentPage:n,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!N,callback:function(e){B.action='pagination',m({start:e*K})}}),I.selectAll&&Le('all'),E.$().removeClass('f-dn'),E};var Z=E.selectNone=Le.bind(0,'none'),ee=E.resetSelect=function(){E.$('[data-dropdown=select]').dropdown('clear')};function ae(e){Fe(),a.iter(e,(function(e){Q(e,E.$('[data-dropdown='+e+']'))}))}var te=function(e){return S.getMailMenu(e)},ie=function(e){var t=te(e);switch(e){case'view':ne(e,t),-2===z&&delete t.mail,2===z&&delete t.reply,-3===z&&a.remove(t.flag,(function(e){return'view:noflagged'===e.value}));break;case'sort':3===z?delete t.from:delete t.to;break;case'mark':ne(e,t),t.vip&&p('mail.enableVipMessage')?-1===z&&t.vip.splice(0,1):delete t.vip,(!p('mail.enableTopMail')||z<0)&&delete t.top,W.enableDeferMail&&t.defer?'thread'===R&&t.defer.splice(0,1):delete t.defer,N&&function(e){var t=i._params.mail,n=t.flags||{},s=0;if(a.isEmpty(e))return;a.isArray(e.mail)&&e.mail.length>1&&e.mail.splice(0,1);a.isArray(e.priority)&&a.isArray(e.priority[0].children)&&(3===t.priority?s=1:t.priority>3&&(s=2),e.priority[0].children.splice(s,1));a.isArray(e.top)&&e.top.splice(n.top?0:1,1);a.isArray(e.vip)&&e.vip.length>1&&e.vip.splice(n.vip?0:1,1)}(t);break;case'more':t.filter=se(t.filter),t.other=se(t.other),t.forward=se(t.forward),t.reply=se(t.reply);break;case'read-more':t.filter=se(t.filter),t.other=se(t.other);break;case'thread-more':t=se(t)}return W.enableMailMemo||delete t['mail-memo'],t};function ne(e,t){var i=W.mailFlaggedColorCount,n=W.enableMailFlagged,s=W.enableUpdateMailStatus,l=t.flag;if(n&&s&&a.isArray(l)){var o=function(e){return/:label0$/.test(e.value)},r=[l.find(o),l.findIndex(o)],c=r[0],d=r[1];'mark'===e&&c.children.shift(),i<=1?l.splice(d,1):c.children.splice('mark'===e?i-1:i),'view'===e&&(c.children=c.children.map((function(e){return a.assign(e,{value:'view:'+e.value})})))}else delete t.flag}function se(e){var t=T(),n=i._params.mail,s=!!n&&n.sMimeServerEncrypted,l=!!n&&n.sMimeClientEncrypted,o=!n||!(n.ctrls&&n.ctrls['CM-SECURITY']&&!_.enabledDirectFwd),r=n?n.isDecodeMail:'';s||l||(r=!0);var c=W.enableSpamForwhand,d=W.enableDelete,f=W.shareMailBoxFolder,m=W.enableCompose,p=W.enableReply,u=W.enableForwardd,v=W.enableForward,g=W.enableForwarda,h=W.enableRealDelete,b=W.enableScheduleInvitation,y=m&&!P(4,5,6,7),w={'more:report':!P(2,3,5)&&c&&!f&&!U(),'more:reject':!P(2,3)&&!f&&!U(),'more:notJunk':P(5)&&c&&!f&&!U(),'more:filter':!P(2)&&!f&&!U(),'more:mailMemo':!f,'more:delete':!P(4)&&t.preview_layout&&d&&!f,'more:sendagain':!P(2)&&!(P(3)&&n&&0===t.preview_layout)&&y&&r,'more:forward':!P(2)&&v&&!U()&&r,'more:forwardd':!P(2)&&u&&!U()&&r,'more:forwarda':!P(2)&&g&&!s,'more:realdelete':(!P(4)||P(4)&&n&&t.preview_layout)&&h&&!f,'more:mail_event':b,'more:reply':!P(2)&&p&&r&&!U(),'more:replyall':!P(2)&&p&&r&&!U(),'forward:forwardd':u&&!l&&o,'forward:forwarda':g&&!s&&!l},j=function(e){return e.value in w?w[e.value]?e:0:e};return a.mapFilter(e,(function(e){return e.children&&(e.children=e.children.filter(j))[0]?e:j(e)}))}function le(e,t){e=(t=a.isPlain(t)?t:{}).value=t.value||e;var n=/(\w*)(?::(.*))?/.exec(e),s=n[1],l=n[2];B.action=e;var o=xe();switch(s){case'select':Le(l);break;case'sort':case'view':if(o[s]=l,t.isSame)break;case'refresh':!function(e){var t,i=e.view,n=e.sort,s=/^(defer):(.*)/.exec(i)||[0,i],l=s[1],o=s[2],r=S.flags2(l);if(r){var c,d=r.flags||{};delete r.flags,'replied'!==l&&'forwarded'!==l||(d.draft=!1),t={filterFlags:d,filter:o?(c={},c[l]=o,c):r,action:i}}n=n.split(':'),m(a.assign({start:0,order:n[0],desc:'desc'===n[1]},t))}(o);break;case'delete':me();break;case'mark':je(l);break;case'label0':je(e);break;case'setting':!function(e){var a=e.split(':'),t=a[0],n=a[1];if(G.hide(),'moresetting'===t)return void C.go('setting.display.list');if(n=+n,T()[t]!==n){var s;if(T()[t]=n,J(),'preview_layout'===t){var l=n?'mail.previewlayout':'mail.list';n&&L('mail','view:close',{id:/read/}),L('mail','view:change',{module:l,param:{fid:I.id}})}else'list_style'===t?i.$('.j-mail-list,.j-mail-totals,.j-listtt,.j-select-count').toggleClass('user-fs12',1===n):m({start:0});C.updateUser((s={},s[t]=n,s)).then((function(){L('setting.display.list','view:refresh',null)}))}}(l);break;case'encoding':!function(e){N&&i.mail(N)._read({encoding:e})}(l);break;case'defer':$e('mark')&&function(e,a){v.resolve(a||Se()).then((function(t){function i(){a||Z()}'set'===e?k(E,t,{},i):'setComp'===e&&(je('defer',t),i())}))}(l);break;case'decryptServerEncrypted':W.openSMIMEKeyPass?function(){var e='<div>'+g('mail/msg_signed_tip')+'</div><div><input type="password" size="40" value="" onkeypress="if(event.keyCode==13) {return false;}" autocomplete="off" tabindex="1"></div>';x(e,(function(e){v.wmCall('user:authenticateSmimeKeyPass',{smimeKeyPass:e}).then((function(){I.supportSMIME=!0,i.render()})).catchCode('FA_UNAUTHORIZED',(function(){w(g('mail.safe_mail_pwd_error'))}))}))}():(I.supportSMIME=!0,i.render());break;case'decryptClientEncrypted':i._handleDecryptCAMail();break;default:oe(l||s)}}var oe=E.mailOp=function(e,t){(re[e]||a.noop)(e,t)},re={},ce=function(e){return function(t,i){var n=ge(),s=n[0],l=n[1];1===(i=a.array(i||N||Ae(l))).length?e(i[0]):Ie(t,s,i[0])}},de=function(e){return function(t,i){var n=ge(),s=n[0],l=n[1],o=!(N&&i)&&U();v.resolve(i||Se(l)).then((function(i){i[0]?e(a.array(i),o):Ie(t,s)}))}},fe=function(e){return de((function(t){v.resolve(I.selectAll?S.getMessageInfos({mboxa:q,ids:t}).then((function(e){return a.map(e,'from')})):t.map((function(e){return De(e).from}))).then((function(i){return e(t,a.flatten(a.unique(a.filter(a.flatten(i))).map(h.parse)))}))}))};function me(){N?4===z?ue():ye(4,[N]):'search'===R?$e('delete')&&Se().then((function(e){var t=a.groupBy(e,(function(e){return 4==+i.$('.j-mail[mid="'+e+'"]').attr('fid')?0:1}),[[],[]]),n=t[0],s=t[1];s[0]&&S.updateMailAttrs(s,{fid:4},{mboxa:q}).then((function(){be('delete',4,s.length)})).onFail((function(){_e('delete')})),n[0]&&S.realDeleteMails(n,{mboxa:q}).then((function(){o.notify.success(g('mail/msg_realdelete_mail',{count:n.length})),D()})).onFail((function(){o.notify.error(g('mail/msg_realdelete_mail_failed'))}))})):4===z?pe():he(4)}function pe(){function e(){o.notify.success(g('mbox/del_message_succ')),D()}'list'===R&&I.selectAll&&!q?j(g('mail/confirm_purge_mail'),(function(){$.doEmptyFolder(z,!0).then(e)})):$e('realdelete')&&Se().then((function(a){j(g('mail/confirm_purge_mail'),(function(){S.realDeleteMails(a,O()).then(e)}))}))}function ue(){j(g('mail/confirm_purge_mail'),(function(){S.realDeleteMails(N,O()).then((function(){o.notify.success(g('mbox/del_message_succ')),we()}))}))}re.filter=fe((function(e,t){if(1===e.length){var i=a.map(t,'address').join(',');j(l.filterTemplate({from:i,detachMode:u}),{title:g('common/op_filter'),onConfirm:function(){var a=this,t=a.$('#folder').val(),n=a.$('#folderName').val().trim(),s=function(t){return function(e,a,t){$.mailRuleAdd({operator:'and',name:'rule_autoCreate_'+Math.ceil(100*Math.random()+100)+'_from_'+t,conditions:[{field:'from',operator:'=',operand:t,ignoreCase:!0,forAddress:!0,listOfValues:!0}],actions:[{type:'move',target:a}]}).then((function(t){e?ye(a,e):S.updateMailAttrs([],{},{rule:'@'+t}).then(D)})).catchCode('FA_OVERFLOW',(function(){w(g('mail/msg_beyondMaxRuleLimit'))}))}(!a.$('#toAllEmails').is(':checked')&&e,t,i)};'newFolder'===t&&n?$.createFolders([{name:n,parent:+a.$('#folderParent').val()}]).then((function(e){D(),s(e[0])})):s(+t)},afterShow:function(){var e=this,t={parentNode:e.$('.j-filter'),trigger:e.$('#folder'),width:'222'};n(e.$());var s=c(t).on('change',(function(){'newFolder'===s.getValue()?e.$('.create-folder').removeClass('f-dn'):e.$('.create-folder').addClass('f-dn')}));c(a.assign(t,{trigger:e.$('#folderParent')})),e.$('.j-filter-page').click((function(){e.hide(),M('setting.filter.letter',{type:'create',emailaddr:i})}))}})}else M('setting.filter.letter')})),re.mail_event=ce((function(e){M('calendar',{mid:e,historyUrl:'calendar'}),S.readMessage({mboxa:q,mid:e}).then((function(e){var t=setInterval((function(){var i=o('.j-calendar iframe');if(i[0]){clearInterval(t);var n=a.unique(a.mapFilter([].concat(e.from,e.to,e.cc,e.bcc),(function(e){return e&&h.parseAddress(e)}))).join(',');i.attr('src',v.wmURL({url:'XT5/cal/eventEdit.jsp?func=add',name:e.subject,attendees:n}))}}),100)}))})),re.reject=fe((function(e,a){j(g('mail/msg_confirm_reject_mail')+'<br><br><label class=f-usn><input type=checkbox checked>'+g('mail/msg_confirm_reject_mail.delete')+'</label>',{afterShow:function(){n(this.$())},onConfirm:function(){this.$(':checked')[0]&&me(),Ce('refuselist','reject',a)}})})),re.report=fe((function(e,a){j(l.reportTemplate(),{onConfirm:function(){var t=this;return S.updateMailAttrs(e,{fid:5},O({reportType:'spam'})).then((function(){t.$('#addToRefuseList').is(':checked')?Ce('refuselist','report',a):(o.notify.success(g('mbox/reportJunk_succeed')),we())}))},afterShow:function(){n(this.$()),c({parentNode:this.$('.j-report'),trigger:this.$('#spamType')})}})})),re.notJunk=fe((function(e,t){var i=a.filter((T().refuselist||'').split(/,\s*/));j(l.notJunkTemplate(),{onConfirm:function(){var n=this;return S.updateMailAttrs(e,{fid:1},{reportType:'notspam'}).then((function(){var e=a.difference(i,a.map(t,'address'));function s(){n.$('#addToWhiteList').is(':checked')?Ce('safelist','notJunk',t):o.notify(g('mbox/reportNotJunk_succeed')),we()}e.length<i.length?C.updateUser({refuselist:e.join(',')}).then(s):s()}))},afterShow:function(){n(this.$())}})})),re.addToAddressbook=ce((function(e){var a=(De(e)||{}).rcpts||[];a[0]&&A.createOrUpdatePabContacts(a).then((function(e){var a=e.added||[],t=e.existed||[],i=function(e){return(e[2]?[e[0],e[1],'...']:e).join(',')};a.length?o.notify.success(b(g('common/added_user_address'),i(a))):t.length&&o.notify.warning(b(g('common/aready_exists_address'),i(t)))})).onFail((function(){o.notify.error(g('common/add_user_address_fail'))}))})),re.mailMemo=i.handleMailMemo;var ve=E.moveTo=function(e){N?ye(e.id||e,[N]):he(e.id||e)};function ge(e){if(!N){if(2===e)return['draft',!0];if(4!==e)return['~draft',!1]}return['']}function he(e){var t=4===e?'delete':'move',i=setTimeout(a.fun(o.notify,[g('mail/msg_'+t+'..'),{forever:!0}]),1e3),n=ge(e),s=n[0];function l(a,i){be(t,e,a,s,i)}Se(n[1]).then((function(a){function i(){return S.updateMailAttrs(a,{fid:e},O()).then((function(e){var a=e.length;s?Se().then((function(e){l(a,e.length-a)})).onFail((function(){_e(t)})):l(a)})).onFail((function(){_e(t)}))}return a[0]?3===z&&a.some((function(e){return(De(e).composeExtra||{}).autoDel}))?j(g('mail/msg_list_move_autodel_notify')).truthy().then(i):i():(n=g('mail/msg_list_'+t+'_select_'+s),o.notify.error(n),void Z());var n})).fin(a.fun(clearTimeout,[i]))}function be(e,a,t,n,s){var l=S.getCacheFolder(a+q).name,r=b('<a style=color:#fff class=f-tdn href="#mail.list?fid='+(a+q)+'">{0}</a>',l),c=g(s>0?'mail/msg_list_move_'+n+'_success':4===a?'mail/msg_'+e+'_mail':'mail/msg_'+e+'_mail_to',{count:t,remains:s,dist:r});o.notify(c,{bodyIsHTML:!0,extBtn:[g('mail/op_recover'),function(){S.recoverOpStack('move','list'===R?z:0).then(D)}]}),N?we():(Z(),i.state&&L('mail.previewlayout','reset'),D())}function _e(e,a){o.notify.error(g('mail/msg_'+e+'_'+(a||'mail')+'_failed'))}function ye(e,t){var i=4===e?'delete':'move',n=t.map(De),s=function(){S.updateMailAttrs(t,{fid:e},O()).then((function(){be(i,e,1)}),(function(e){e&&'FA_FORBIDDEN'===e.code?w(g('error/FA_FORBIDDEN')):(_e(i),v.rethrow())}))};if(2===e){if(a.mapFind(n,a.not('flags.draft')))return void _e(i,'~draft')}else if(4!==e&&a.mapFind(n,'flags.draft'))return void _e(i,'draft');3===z&&a.mapFind(n,'composeExtra.autoDel')?j(g('mail/msg_list_move_autodel_notify'),s):s()}function we(){N&&m({}),D()}var je=E.mark=function(e,t,i,n){var s=('thread'===R?!t:U())&&!/^(flag|label|vip|defer)/.test(e),l=setTimeout((function(){o.notify.success(g('mail/msg_updating'),{forever:!0})}),1e3);v.resolve(t||$e('mark')&&Se()).then((function(a){var l=O({expandThreadMid:s}),o=i;return a&&S.markOp(R,a,e,l,o,(function(e){t||Z(),n&&n(e)}))})).fin(a.fun(clearTimeout,[l]))};var xe=function(){return y?{sort:y.order+':'+(y.desc?'desc':'asc'),view:y.action}:{}};function ke(e){var a=De(e.mid),t=a.config&&a.config.supportSMIME,i=t&&a.sMimeServerEncrypted,n=t&&a.sMimeClientEncrypted,s=e.ctype;i&&(e.isDecodeMail=a.isDecodeMail||!1),a.mailCipherEncrypted&&(e.mailCipherPassword=a.mailCipherPassword),n?S.compose(e,{sMimeClientEncrypted:!0,attachId:'caAttachments_'+N,content:a.content,isSigned:a.isSigned,isEncrypted:a.isEncrypted}):u?M('mail.compose',e):S.compose('forwardd'===s?{}:e,'forwardd'===s?e:{ctype:s})}re.prev=re.next=function(e){return E.$('#pagination [rel='+e+']').click()},re['delete']=me,re.realdelete=function(){N?ue():pe()},a.assign(re,a.mapValues({print:'public/mailprint.jsp',header:'XT5/mbox/viewheader.jsp',source:'mbox-data?mode=text',mailDownload:'mbox-data?mode=download'},(function(e){return ce((function(a,t){e.includes('data')&&!Me(a)||window.open(v.wmURL({url:e,mid:a,mboxa:q,part:t}))}))}))),re.createTopic=ce((function(e){o('.m-lunkr').data().self.load({mid:e},N?'webMailNewTopic':'webMailNewTopic2')})),re.forwarda=de((function(e,a){Me(e,'forwarda',ke.bind(0,{mid:e,mboxa:q,ctype:'forwarda',expandThreadMid:a}))})),a.assign(re,a.mapValues({reply:0,'reply-attach':0,replyall:0,'replyall-attach':0,forward:0,forwardd:0,sendagain:'edit'},(function(e,a){return ce((function(t){var n={ctype:e||a,mid:t,mboxa:q};i._params.defaultAccount&&(n.defaultAccount=i._params.defaultAccount),Me(t)&&ke(n)}))})));var Me=function(e,t,i){var n=function(e){return a.get(De(e),'flags.webReadOnly')};if(!(e=a.array(e)).some(n))return i?i():1;i&&e.some((function(e){return!n(e)||De(e).threadMessageCount>1}))?j(g('mail/msg_select_webreadonly_list',{action:Re(t)||t}),i):w(g('mail/msg_select_webreadonly'))};function Ce(e,t,i){var n,s=[],l=a.filter((T().refuselist||'').split(/,\s*/)),r=a.filter((T().safelist||'').split(/,\s*/)),c=[],d=[];i.length&&(i.forEach((function(e){var a=e.address;-1!==o.inArray(a,l)&&-1===o.inArray(a,c)&&c.push(a),-1!==o.inArray(a,r)&&-1===o.inArray(a,d)&&d.push(a),-1===o.inArray(a,l)&&-1===o.inArray(a,r)&&s.push(a)})),s.length>0?'refuselist'===e?function(e,t,i,n){var s=a.filter((T().refuselist||'').split(/,\s*/)),l=p('user.allemails')||[],r='report'===n?g('mbox/reportJunk_succeed')+' ':'',c={timeout:5e3,extBtn:['['+g('mbox/show_detail')+']',function(){Te({refuseList:f,existRefuseList:t,existSafeList:i,existUserEmails:d})}]},d=[],f=a.mapFilter(e,(function(e){return l.includes(e)?void d.push(e):e}));f.length?C.updateUser({refuselist:a.unique(s.concat(f)).join(',')},!0).then((function(){o.notify.success(r+g('mbox/reject_by_mailfrom_succeed'),c),L&&L('setting.security.blacklist','list:reload')})):o.notify.warning(r+g('mbox/reject_by_mailfrom_fail'),c)}(o.unique(s),c,d,t):'safelist'===e&&function(e,t,i,n){var s='notJunk'===n?g('mbox/reportNotJunk_succeed')+' ':'',l=a.unique(a.filter((T().safelist||'').split(/,\s*/)).concat(e)).join(',');C.updateUser({safelist:l}).then((function(){o.notify(s+g('mbox/addToSafeList_succeed'),{timeout:5e3,extBtn:['['+g('mbox/show_detail')+']',function(){Te({whiteList:e,existRefuseList:t,existSafeList:i})}]}),L&&L('setting.security.blacklist','list:reload')}))}(o.unique(s),c,d,t):('refuselist'===e?n=g(d.length?'mail/contact_exist_whitelist':'mail/contact_exist_refuselist'):'safelist'===e&&(n=g(c.length?'mail/contact_exist_refuselist':'mail/contact_exist_whitelist')),n&&('report'===t&&(n=g('mbox/reportJunk_succeed')+' '+n),'notJunk'===t&&(n=g('mbox/reportNotJunk_succeed')+' '+n),o.notify.warning(n,{timeout:5e3,extBtn:['['+g('mbox/show_detail')+']',function(){Te({existRefuseList:c,existSafeList:d})}]}))))}function Te(e){w(l.addToRefuselistDetails(e))}function Se(e){return N?v.resolve([N]):I.selectAll?function(){var a=o.extend(!0,{},I,y,{nocache:!0,start:0,limit:X,refresh:!0});return o.extend(!0,'search'===R?{flags:a}:a.filter,null!=e&&{flags:{draft:!!e}}),('search'===R?S.searchMails:S.getMailList)(a)}().then((function(e){return a.map(e,'id')})):v.resolve(Ae(e))}re.pack=de((function(e,a){var t=S.packMessages.bind(0,{mboxa:q,mids:e,expandThreadMid:a});'thread'===R&&a?Me(i.threadMails.keys(),g('common/op_pack_thread'),t):Me(e,'pack',t)}));var De=function(e){return(N?i.mail(e):S.cachedMails(R).find((function(a){return a.id===e})))||{}},Ae=function(e){return a.mapFilter(i.$('.j-mail input:checked').get(),(function(a){return(null==e||e^!o(a).data('draft'))&&o(a).val()}))};function $e(e){return N||Ae()[0]||Ie(e)}function Ee(){return F('count')>=Math.max(1,i.$('.j-mail').length)}function Le(e){switch(e){case'all':return F(e,X);case'curPage':return F('current');case'none':case'inverse':ee();case'unread':case'read':return F(e)}}function Fe(){var e=function(){var e=Ae().map(De),t=a.some(e,'flags.signed')||a.some(e,'flags.encrypted'),i=_.enabledDirectFwd||!a.some(e,'ctrls.CM-SECURITY');return[!!e[0],!!e[1],t,i]}(),t=e[0],n=e[1],s=e[2],l=e[3],o=E.$('div.j-tgbtns');o.children('span').attr('disabled',!t).end().children('.u-btns').children('span').attr('disabled',!t);var r=!(n||s),c=i.config;a.assign(W,c,a.pickBy({enableCompose:r,enableReply:r,enableForward:r,enableForwardd:r&&l},a.not()),{enableForwarda:c.enableForward&&!s}),n&&o.find('[data-btn=createTopic]').attr('disabled',!0)}re['cmd:a']=function(){F(Ee()?'none':'current')};var Re=function(e){return(a.flatten(Object.values(te('more'))).find((function(a){return a.value==='more:'+e}))||{}).name};function Ie(e,a,t){o.notify.error(b(g('mail/msg_select_'+(t?'one':a||'')),Re(e)||g('common/operate')))}}));e.exports=E}).call(this,t(464))},579:function(e,a,t){(function(a,i,n,s){var l=t(488).bytesToSize,o=t(507).formatFileType,r=t(475),c=t(473),d=t(479),f=t(467).getUser,m=t(468).get,p=t(474),u=t(487).patchNameOfEmail;function v(e,t){n.iter(['attachments','trsAttachments'],(function(i){n.iter(e[i]=t[i]||[],(function(e){e.fileType=o(e.filename=e.filename||e.name),e.formatSize=l(e.estimateSize||e.size||e.contentLength,2),e.attachExpiryTime=function(e){var t,i,n;if(!e)return;e=d(e),t=d(),i=e.diff(t,'days'),n=t.isAfter(e)?a('mbox/mail_expiry_a_2').replace('{0}',e.format('YYYY-MM-DD HH:mm')):0===i?a('mbox/mail_expiry_a_1').replace('{0}',e.format('HH:mm')):a('mbox/mail_expiry_a_0').replace('{0}',e.format('YYYY-MM-DD HH:mm'));return n}(e.expiryTime)}))}))}function g(e,t){var i;return t=t||5,{remain:i=(i=(e=e||[]).length-t)>0?i:0,stillContacts:i?a('mail/still_contacts').replace('{0}',i):'',contacts:e.slice(0,t)}}e.exports={readMessage:function(e){return p.readMessage(e).then((function(t){return u().then((function(i){return i&&[t.from,t.to,t.cc,t.bcc].forEach((function(e){e&&e.forEach((function(a,t){e[t]=''+i(r.of(a))}))})),function(e,t){var i=s.extend({},t),l=i.xFrom=r.of((i.from=i.from||[])[0]),o=l.address,f=r.of(i.headers.From).address;f&&o!==f&&(l.address=f+' ('+o+')');i.to=i.to||[],i.cc=i.cc||[],i.bcc=i.bcc||[],i.sender=t.headers&&s.isArray(t.headers.Sender)?t.headers.Sender[0]:'',i.isSenderMode=!t.delegatedSender&&''!==i.sender&&i.sender!==i.from&&null==i.sender.match(/@$/),i.isSenderMode&&(i.senderMessage=a('mbox/mail_forwardBy').replace('{0}',i.sender));t.encpwd&&(i.showEncpwd=a('mbox/read_mail_encpwd_tip').replace('{0}',t.encpwd));v(i,t),i.to.length>5&&(i.partto=g(i.to,5));i.cc.length>5&&(i.partcc=g(i.cc,5));i.bcc.length>5&&(i.partbcc=g(i.bcc,5));i.rcpts=i.from.concat(i.to,i.cc),i.calendar&&(i.calendar=function(e,t){var i=t.calendar,s=i.meetingRequestStatus,l=i.meetingRequestMethod,o=i.meetingRequest,r=i.isAttendee,f=i.isOrganizer,p=i.attendees,u={2:a('mail/op_tentative'),3:a('mail/op_accept'),4:a('mail/op_decline')},v=i.isMembers=r||f;i.enableMeetingOps=!v&&!e;var g=i.isMeetingRequest='request'===l,h=i.enableMeetingAction=g&&r&&!e;'reply'===l&&(i.replyStatusDisplay=c(a('cal/event_status_'+s),i.meetingRequestAttendee));h&&u[s]&&(i.participationDisplay=c(a('cal/event_participation_display'),u[s]));var b=o.attendees=p||o.attendees||[];b.length>5&&(o.partAttendees=b.slice(0,5),o.stillAttendees=c(a('cal/msg_stillattendees'),b.length-5));v&&!p&&4!==i.meetingRequestStatus&&(i.expiredDetail=a('cal/event_detail_info'));i.isExpired&&(i.expiredInfo=a('mail/meeting_request_subject_featured_update'));'cancel'===l&&(i.expiredInfo=a('mail/meeting_request_subject_featured_cancel'));return function(e){var t=e.meetingRequest||{},i=d(t.start),s=t.duration||0,l=t.allDayEvent,o=t.recurrence||{},r=d(i.valueOf()+1e3*s-(l&&s>0&&!(s%86400)?1:0)),f=!r.diff(i,'days');e.startDateYMD=i.format('YYYY-MM-DD'),l&&n.isEmpty(o)&&(e.allDayEventDate=s>86400?i.format('LL')+'-'+r.format('LL'):i.format('LL')+' '+i.format('dddd'));if(n.isEmpty(o))e.eventTime=l?a('cal/info_event_isallday'):f?i.format('LLLL')+' - '+r.format('LT'):i.format('LLLL')+' - '+r.format('LLLL');else{var p=function(e,a){return n.filter(a).join(e)},u=o.monthOfYear,v=o.dayOfMonth,g=c(a('cal/recurrence'+o.type),['',u,v,p(', ',n.times(7,(function(e){return o.dayOfWeek&1<<e&&a('cal/lb_day'+(e+1)+'_medium')}))),d.months(u-1)]);e.eventTime=p(', ',[i.format('LL')+(o.until?' - '+d(o.until).format('LL'):''),g,p(' ',[l?a('cal/lb_all_day'):i.format('LT')+' - '+r.format('LT'),!o.until&&!o.occurrences&&a('cal/info_event_recurrence_forever')])])}var h=m('setting'),b=h.timezoneid,_=h.timezonevalues;e.timeZone=(/\(UTC([+-]..:..)?\)/.exec('('+_[b]+')')||[''])[0].replace(':','')}(i),i}(e,i));return i}(e.mboxa,t)}))})).catchCode('FA_MAIL_NOT_FOUND',(function(e){throw e.message=a('error/FA_MAIL_NOT_FOUND'),e}))},getThreadMessageInfos:function(e,t){return i.wmCall('mbox:getThreadMessageInfos',{id:e,mboxa:t,order:'date',summaryWindowSize:2147483647}).catchCode('FA_ID_NOT_FOUND').then((function(e,t){if(!e||!e[0])throw n.create(t,{code:'FA_MAIL_NOT_FOUND',message:a('error/FA_MAIL_NOT_FOUND')});return function(e){return u().then((function(a){var t=f().email;return e.forEach((function(e){var i=r.of(e.from);a&&a(i);var n=i.address;e.isFromCurUser=n===t,e.formatFrom={true_name:i.trueName,emailAddress:n}})),(e[e.length-1]||{}).lastMessage=!0,e}))}(e)}))},decryptMessage:function(e,t){return i.wmCall('mbox:decryptMessage',e).onFail((function(e){var n=e&&{FA_EMPTY_PASSWORD:'read_mail_err_password_empty',FA_INVALID_PASSWORD:'read_mail_err_password_invalid'}[e.code];t&&n&&(t.html(a('mbox/'+n)).show(),i.abort())}))},formatAttachments:v}}).call(this,t(465),t(466),t(464),t(463))},580:function(e,a,t){e.exports=t(469)('<section class="m-read j-mail-read"> <div class="toolbar f-cf j-toolbar"></div> <div class="j-module-content"></div> </section>',{toolbartpl:'<div id="pagination" class="f-fr"></div> {{>auditBtn}} {{>recallBtn}} {{#if isSent}} <span class="u-btn u-btn-default" data-btn="sendagain">{{i18n "mbox/send_again"}}</span> {{/if}} {{#if autoDelMail.expired}} <span class="u-btn u-btn-default disabled">{{i18n "mbox/bt_overdue"}}</span> {{else if autoDelMail}} <span class="u-btn u-btn-default" data-btn="destroy">{{i18n "mbox/autoDel_sysDialog_title"}}</span> {{/if}} {{>decodeBtn}} \x3c!-- [回复|回复全部] [转发] --\x3e {{#if config.enableReply}}<div class="u-btns">{{>replyBtn}}</div>{{/if}} {{>forwardBtn}} \x3c!-- [移动到|标记为] [更多] [删除] [创建讨论] --\x3e <div class="u-btns">{{>moveBtn}}{{>markBtn}}{{>moreBtn}}</div> {{>deleteBtn}} {{>topicBtn}}',moveBtn:'{{#if (and config.enableUpdateMailStatus config.enableMoveTo)}} <span class="u-btn u-btn-default" data-dropdown="move">{{i18n "common/op_move"}} {{>icoDown}}</span> {{/if}}',markBtn:'{{#if config.enableUpdateMailStatus}} <span class="u-btn u-btn-default" data-dropdown="mark">{{i18n "common/op_mark"}} {{>icoDown}}</span> {{/if}}',deleteBtn:'{{#if config.enableDelete}}<span class="u-btn u-btn-default" data-btn="delete"> {{i18n (if$ (eq fid 4) \'common/op_realdelete\' \'common/op_delete\')}} </span>{{/if}}',topicBtn:'{{#if @config.user.enableLunkr}}<span role="toLunkr" class="u-btn u-btn-default" data-btn=createTopic>{{i18n "common/op_createTopic"}}</span>{{/if}}',directforwardtpl:'<div class="u-alert u-alert-warning u-alert-dismissible j-forward"> <span class="close iconfont icondelword" data-action="close"></span> <span>{{i18n "mail/msg_direct_forward" from=from time=time}}</span> </div>',sspTpl:'<div class="u-alert u-alert-warning u-alert-dismissible"> <span class="close iconfont icondelword" data-action="close"></span> <span>{{{msg}}}</span> &nbsp; <a class="link" data-action="original">{{i18n "mbox/sspurl_message_original"}}</a> {{#if (ne fid 5)}} <a class="link" data-action="spam">{{i18n "mbox/move_spam"}}</a> {{/if}} {{#if (ne fid 4)}} <a class="link" data-action="delete"> {{i18n "common/op_delete"}}</a> {{/if}} </div>',maintpl:'<div class="j-main mail"> <div class="j-read-alert f-pr"></div> <div class="mail-top j-mail-top f-pr"> <div class="top-bar"> <div class="f-tar"> {{#unless isNestedMsg}} {{#if @config.mail.enableVipMessage}} {{#if config.enableUpdateMailStatus}} <span class="f-pr f-csp" data-btn="vip"> <i class="iconfont {{if$ flags.vip \'iconstar vip\' \'iconstarline\'}} j-mail-vip" title="{{i18n (if$ flags.vip \'mail/list_cancel_vip\' \'mail/list_set_vip\')}}"></i> </span> {{^}} {{#if flags.vip}} <span class="f-pr f-csp"> <i class="iconfont iconstar vip" title="{{i18n \'mbox/mail_flag_vip\'}}"></i> </span> {{/if}} {{/if}} {{/if}} {{#if config.enableMailFlagged}} {{#if config.enableUpdateMailStatus}} <span class="mail-flagged f-pr f-csp" data-dropdown="flag-color"> <i class="iconfont{{#if flags.flagged}} iconflatcolor flagged label0-{{label0}}{{^}} iconflat{{/if}} j-mail-flagged" title="{{i18n \'mbox/mail_flag_flagged_true\'}}"></i> <i class="iconfont icondown"></i> </span> {{^}} {{#if flags.flagged}} <span class="mail-flagged f-pr f-csp"> <i class="iconfont iconflatcolor flagged label0-{{label0}}" title="{{i18n \'mbox/mail_flag_flagged\'}}"></i> </span> {{/if}} {{/if}} {{/if}} {{#if config.enableDeferMail}} {{#if config.enableUpdateMailStatus}} {{#if flags.deferHandle}} <span class="j-defer f-pr f-csp" deferDate="{{defer}}"> <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="state-icon icon-mDEFER"></i> </span> {{^}} <span class="j-defer f-pr f-csp"> <i title="{{i18n \'mail/list_set_defer\'}}" class="iconfont iconclock"></i> </span> {{/if}} {{^}} {{#if flags.deferHandle}} <span class="f-pr f-csp" deferDate="{{defer}}"> <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="state-icon icon-mDEFER"></i> </span> {{/if}} {{/if}} {{/if}} {{/unless}} {{#if (and (not isNestedMsg) config.enableMailDealings config.permWebmailMailSearch (not config.shareMailBoxFolder))}} <a class="iconfont iconemailcontacts" href="javascript:void(0)" title=\'{{i18n "mbox/mail_dealings"}}\' data-type="dealings"></a> {{/if}} <a class="iconfont iconnewtab" href="{{detachUrl \'mail.read\' .}}" target="_blank" title=\'{{i18n "mbox/mail_blank"}}\'></a> {{#unless isNestedMsg}} {{#if config.enableScheduleInvitation}} <a href="javascript:void(0)" title=\'{{i18n "mbox/mail_event"}}\' data-type="mail_event">{{i18n "mbox/mail_event"}}</a> {{/if}} {{/unless}} </div> <div class="f-tar"> <span title=\'{{i18n "mail/sent_date"}}{{sentDate}}\'>{{sentDate}}</span> </div> </div> <div class="mail-top-info"> <h3 class="mail-subject j-mail-subject {{#if flags.flagged}} flagged label0-{{label0}}{{/if}}"> <span class="icon"><i class="j-sourceIcon iconfont {{sourceIcon}}" title="{{sourceMsg}}"></i></span> {{if$ (and config.enableSecurityLevel ctrls) (translateSL ctrls.CM-SECURITY)}} {{subject}} </h3> <div class="short-info j-short-info"> <span class="receiver"> {{#if delegatedSender}} <span class="delegate-mail" title="{{i18n \'prop:mail/read_delegate_send\' 0=delegatedSender}}">{{i18n "mail/read_delegate_mail"}}</span> {{/if}} <a class="j-u-email f-csp" addr="{{hemail from.[0] \'addr\'}}">{{hemail from.[0] "name"}}</a> <span>{{i18n "mbox/send_to"}}</span> {{#each to}} <a class="j-u-email f-csp" addr="{{hemail this \'addr\'}}">{{hemail this "name"}}</a> {{#unless @last}},{{/unless}} {{/each}} </span> <span class="j-attach-wrap attach-info f-dn {{if$ (eq isDecodeMail false) \'f-dni\'}}"> <span>{{i18n \'mbox/op_contains\'}}</span> <a class="attach-icon j-view-attach" title="{{i18n \'mbox/mail_viewatta\'}}" href="javascript:void(0)"> <i class="iconfont iconacc"></i> <span class="attach-desc j-attach-desc">{{countAttachment this}}</span> <span class="attach-desc">{{i18n \'mail/attachments_desc\'}}</span> </a> </span> </div> <div class="full-info j-full-info f-dn"> <table class="u-table u-table-row"> <tr> <td class="info-item">{{i18n "mbox/mail_from"}} :</td> <td> {{#if delegatedSender}} <span class="delegate-mail" title="{{i18n \'prop:mail/read_delegate_send\' 0=delegatedSender}}">{{i18n "mail/read_delegate_mail"}}</span> {{/if}} {{#if from}} <span class="u-email j-u-email" addr="{{hemail from.[0] \'addr\'}}" data-true-name="{{hemail from.[0] \'name\'}}"> <span class="name">{{hemail xFrom \'nameOnly\'}}</span> <span class="address">{{hemail xFrom \'addrWithQuote\'}}</span> </span> {{/if}} {{#if delegatedSender}} <span>({{i18n "prop:mail/read_delegate_send" 0=delegatedSender}})</span> {{/if}} {{#if isSenderMode}}({{senderMessage}}){{/if}} </td> </tr> <tr> <td class="info-item">{{i18n "mbox/mail_to"}} :</td> <td> {{#if partto}} <div class="j-contacts"> {{#each partto.contacts}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">{{partto.stillContacts}}</a></span> </div> {{/if}} <div class="j-contacts {{#if partto}}f-dn{{/if}}"> {{#each to}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} {{#if partto}} <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">{{i18n "mail/mail_hidemsg"}}</a></span> {{/if}} </div> </td> </tr> {{#if cc}} <tr> <td class="info-item">{{{i18n "mbox/mail_cc"}}} :</td> <td> {{#if partcc}} <div class="j-contacts"> {{#each partcc.contacts}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">{{partcc.stillContacts}}</a></span> </div> {{/if}} <div class="j-contacts {{#if partcc}}f-dn{{/if}}"> {{#each cc}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} {{#if partcc}} <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">{{i18n "mail/mail_hidemsg"}}</a></span> {{/if}} </div> </td> </tr> {{/if}} {{#if bcc}} <tr> <td class="info-item">{{{i18n "mbox/mail_bcc"}}} :</td> <td> {{#if partbcc}} <div class="j-contacts"> {{#each partbcc.contacts}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">{{partbcc.stillContacts}}</a></span> </div> {{/if}} <div class="j-contacts {{#if partbcc}}f-dn{{/if}}"> {{#each bcc}} <span class="u-email j-u-email" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} {{#if partbcc}} <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">{{i18n "mail/mail_hidemsg"}}</a></span> {{/if}} </div> </td> </tr> {{/if}} <tr class="j-attach-wrap j-full-attach-wrapper f-dn {{if$ (eq isDecodeMail false) \'f-dni\'}}"></tr> {{#if config.enableMailMemo}} <tr class="{{#unless memo}}f-dn{{/unless}} j-mail-memo"> <td class="info-item">{{i18n "mail/memo"}} :</td> <td class="j-memo-box"></td> </tr> {{/if}} </table> </div> </div> <div class="mail-divider"> <a href="javascript:void(0)" class="u-btn u-btn-default u-btn-round f-fr" data-type="toggleBrief"> <i class="iconfont icondown"></i> </a> </div> </div> <div class="mail-sent-state j-sent-state f-dn"></div> {{#with autoDelMail}} <div class="auto-del-state f-cf">{{>autoDelStateTableTpl}}</div> {{/with}} {{#if mailCipherEncrypted}} <div class="mail-cipher-encrypted j-mailCipherEncrypted"> {{#if mailCipherPassword}} <div class="decryption-success"> <span class="iconfont iconunlock"></span> {{i18n "mbox/read_mail_cipher_decrypted_tip"}} </div> {{^}} <div class="no-decryption"> <div class="lock-item"><span class="iconfont iconlock"></span></div> <div class="action-item"> <input type="password" placeholder=\'{{i18n "mail/read_mail_password_prompt"}}\' class="u-input" name="password" id="password" maxlength="6" /> </div> <div class="decryption-msg"> {{#if showEncpwd}}<div class="encpwd">{{showEncpwd}}</div>{{/if}} <span class="j-decryption-error decryption-error f-dn"></span> </div> <div class="action-item"> <span class="u-btn u-btn-primary j-decrypt-submit">{{i18n "main/bt_submit"}}</span> </div> <div class="label-item">{{{cipherEncryptedMsg}}}</div> <div class="label-item">{{i18n "mail/read_mail_cipher_encrypted_tip_1"}}</div> </div> {{/if}} </div> {{/if}} {{#if needToAudit}} <div class="mail-audit-action j-audit-action"> <span>{{i18n \'mail/lbl_auditTip\'}}</span> </div> <div class="mail-audit-info j-mail-audit-info"></div> {{/if}} <div class="j-meeting-request meeting-request"></div> <div class="mail-content"> {{#if sMimeClientEncrypted}} <div class="j-ca-notify"> {{#if isIE}} {{{i18n \'mail/encrypt_notify\'}}} {{^}} {{{i18n \'mail/ca_not_support\'}}} {{/if}} </div> {{/if}} </div> <div class="mail-attachments-wrap j-mail-attachments-wrap"></div> </div> <footer class="quick-reply j-quick-reply" mid="{{mid}}" > {{#if (and (not isNestedMsg) (not flags.webReadOnly))}} {{>quickReplyTpl}} <div class="j-toolbar-footer u-btns"></div> {{/if}} </footer>',quickReplyTpl:'{{#if (and config.enableQuickReply (not flags.webReadOnly))}} <span class="quick-reply-default f-fl {{if$ (eq isDecodeMail false) \'f-dn\'}}" data-type="open-quick-reply">{{i18n "mail/quick_reply_to"}}</span> <form class="quick-reply-item j-reply-form f-dn" action=""> <textarea name="replyContent" class="reply-textarea" rows="6"></textarea> <span class="u-btn u-btn-primary" data-type="send">{{i18n "common/send"}}</span> <span class="u-btn u-btn-default" data-type="cancel">{{i18n "common/cancel"}}</span> {{#if config.enableReply}} <span class="f-fr"><a href="javascript:void(0)" data-type="compose">{{i18n "mbox/switch_to_full_mode"}}</a></span> {{/if}} </form> <div class="quick-reply-item f-dn j-reply-sending"> <span class="reply-state reply-sending">{{i18n "mbox/reply_sending"}}</span> </div> <div class="quick-reply-item f-dn j-reply-result"> <span class="reply-state reply-success j-reply-success">{{i18n "mbox/reply_succ"}}</span> <span class="reply-state reply-fail j-reply-fail">{{i18n "mbox/reply_fail"}}</span> <a href="javascript:void(0)" data-type="open-quick-reply">{{i18n "mbox/reply_again"}}</a> <a class="f-dn" href="javascript:void(0)" data-type="compose">{{i18n "mbox/switch_to_full_mode"}}</a> </div> {{/if}}',sentstatetpl:'<div class="f-cf"> <span><i class="iconfont iconmark"></i>{{rcptStatus.message}}</span> <a href="javascript:void(0)" class="j-sent-detail-show" data-type="showSentDetail">{{{i18n "mbox/show_detail"}}}</a> <span class="j-sent-detail f-dn"> <a href="javascript:void(0)" class="j-sent-detail-hide" data-type="hideSentDetail">{{{i18n "mbox/hide_detail"}}}</a> <a href="javascript:void(0)" class="j-sent-detail-refresh" data-type="refreshSentDetail">{{{i18n "mbox/refresh"}}}</a> </span> <span class="j-sent-detail-short">{{{msgDetail}}}</span> <span class="f-fr state-pagination f-dn j-sent-pagination"></span> </div> <div class="sent-detail f-dn"> {{#if sendingMsg}} <div class="state-sending">{{sendingMsg}}</div> {{/if}} </div>',meetingRequestTpl:'<strong class="f-db meeting-item">{{replyStatusDisplay}}</strong> <div class="meeting-box f-cf {{#or expiredDetail expiredInfo}}meeting-box-disabled{{/or}}"> <h4 class="meeting-box-decorate"></h4> <div class="meeting-header"> <div class="subject f-ellipsis">{{meetingRequest.name}}{{expiredInfo}}</div> <div class="details">{{expiredDetail}}</div> </div> <div class="meeting-content"> <table> <tbody> {{#if allDayEventDate}} <tr class="date-info"> <td><span class="item-icon"></span></td> <td class="meeting-item">{{i18n "cal/info_event_date"}}:</td> <td> {{#if isMembers}} <a href="javascript:void(0)" data-action="goCal" data-caldate="{{startDateYMD}}">{{allDayEventDate}}</a> {{^}} {{allDayEventDate}} {{/if}} </td> </tr> {{/if}} <tr class="time-info"> <td><span class="item-icon"></span></td> <td class="meeting-item">{{i18n "cal/info_event_time"}}:</td> <td>{{timeZone}} {{#if isMembers}} <a href="javascript:void(0)" data-action="goCal" data-caldate="{{startDateYMD}}">{{eventTime}}</a> {{^}} {{eventTime}} {{/if}} </td> </tr> <tr class="place-info"> <td><span class="item-icon"></span></td> <td class="meeting-item">{{i18n "cal/info_event_place"}}:</td> <td>{{meetingRequest.location}}</td> </tr> <tr class="description-info"> <td><span class="item-icon"></span></td> <td class="meeting-item">{{i18n "cal/info_event_description"}}:</td> <td> {{#if (eq meetingRequest.bodyType 0)}} <div class="description-item f-pre">{{meetingRequest.body}}</div> {{^}} <pre class="description-item">{{meetingRequest.bodyType}}</pre> {{/if}} </td> </tr> <tr class="attendees-info"> <td><span class="item-icon"></span></td> <td class="meeting-item">{{i18n "cal/info_event_attendees"}}:</td> <td > <a href="mailto:{{hemail meetingRequest.organizer \'addr\'}}" title="{{meetingRequest.organizer}}"> {{hemail meetingRequest.organizer "name"}} </a> ({{i18n "cal/info_event_organizer"}}) {{#if meetingRequest.partAttendees}} <div class="part-attendees j-attendees"> {{#each meetingRequest.partAttendees}} <a href="mailto:{{hemail this.email \'addr\'}}" title="{{this.email}}">{{hemail this.email "name"}}</a>, {{/each}} ... <a class="f-db" href="javascript:void(0)" data-action="toggleAttendees">{{meetingRequest.stillAttendees}}</a> </div> {{/if}} <div class="all-attendees {{#if meetingRequest.partAttendees}}f-dn{{/if}} j-attendees"> {{#each meetingRequest.attendees}} <a href="mailto:{{hemail this.email \'addr\'}}" title="{{this.email}}">{{hemail this.email "name"}}</a>, {{/each}} {{#if meetingRequest.partAttendees}} <a class="f-db" href="javascript:void(0)" data-action="toggleAttendees">{{i18n "cal/msg_hidemsg"}}</a> {{/if}} </div> </td> </tr> </tbody> </table> </div> <div class="meeting-footer f-cf"> {{#if enableMeetingAction}} <div class="f-fl participation-display"> <i class="iconfont iconinformation"></i> <div class="details {{#unless participationDisplay}}f-dn{{/unless}}"> <span class="j-participation-display">{{{participationDisplay}}}</span> <span class="j-modify-msg"></span> <a href="javascript:void(0)" data-action="modify">{{i18n "mail/op_modify"}}</a> </div> <span class="j-accept-state accept-state {{#if participationDisplay}}f-dn{{/if}}">{{i18n \'mail/accept_invitation\'}}</span> </div> <div class="j-meeting-btn f-fr {{#if participationDisplay}}f-dn{{/if}} meeting-btns"> <span class="u-btn u-btn-primary u-btn-accept" data-action="accept">{{i18n "mail/op_accept"}}</span> <span class="u-btn u-btn-primary u-btn-tentative" data-action="tentative">{{i18n "mail/op_tentative"}}</span> <span class="u-btn u-btn-default u-btn-decline" data-action="decline">{{i18n "mail/op_decline"}}</span> </div> {{/if}} {{#if enableMeetingOps}} <div id="actionLinkTR"> <div class="f-fl participation-display"> <i class="iconfont iconinformation"></i> <a href="javascript:void(0)" class="j-view-cal {{#unless calUid}} f-dn{{/unless}}" data-action="viewCal"> {{i18n \'cal/info_event_participation_toview\'}} </a> </div> <div class="f-fr meeting-btns"> <span class="j-add-cal u-btn u-btn-primary{{#if calUid}} f-dn{{/if}}" data-action="addCal"> {{i18n \'cal/info_event_participation_toadd\'}} </span> {{#if meetingRequest.organizer}} <span class="u-btn u-btn-primary" data-action="forwardCal" data-organizer="{{meetingRequest.organizer}}"> {{i18n \'cal/info_event_participation_introduct\'}} </span> {{/if}} <span class="j-del-cal u-btn u-btn-default{{#unless calUid}} f-dn{{/unless}}" data-action="deleteCal"> {{i18n \'cal/event_participation_del\'}} </span> </div> </div> {{/if}} </div> </div>',sentstatetabletpl:'<table class="u-table sent-state-table"> <thead> <tr> <th>{{i18n "mbox/true_name"}}</th> <th>{{i18n "mbox/mail_to"}}</th> <th>{{i18n "mbox/mail_sent_state"}}</th> <th>{{{i18n "mbox/mail_time"}}}</th> </tr> </thead> <tbody> {{#each deliverys}} <tr class="j-delivery-item" data-type="{{dsTextKey}}"> <td>{{to_name}}</td> <td>{{to}}</td> <td>{{{dsHtml}}}</td> <td>{{modtime}}</td> </tr> {{/each}} </tbody> </table>',autoDelStateTableTpl:'<div class=desc> <table> <tr> <td>{{i18n "mbox/autoDel_subject"}}</td> <td>{{@root.subject}}</td> </tr> <tr> <td>{{i18n "mbox/autoDel_readLimit"}}</td> <td>{{readLimit}}</td> </tr> <tr> <td>{{i18n "mbox/autoDel_expiryDate"}}</td> <td>{{LLDate expiryDate}}</td> </tr> <tr> <td>{{i18n "mbox/autoDel_detail"}}</td> <td><a class="f-csp j-auto-del-state-refresh">{{i18n "mbox/autoDel_refresh"}}</a></td> </tr> </table> </div> <div class=details> <table class="u-table"> <thead> <tr> <th>{{i18n "mbox/autoDel_addressee_name"}}</th> <th>{{i18n "mbox/autoDel_addressee_email"}}</th> <th>{{i18n "mbox/autoDel_addressee_state"}}</th> <th>{{i18n "mbox/autoDel_addressee_remain"}}</th> </tr> </thead> <tbody> {{#each details}} <tr> <td>{{name}}</td> <td>{{addr}}</td> <td><i class="{{icon}}"></i> {{iconMsg}}</td> <td>{{remain}}</td> </tr> {{/each}} </tbody> </table> </div>',CApluginInjectTpl:'<div role="CAcomposePlugin"> <object classid="clsid:A996E48C-D3DC-4244-89F7-AFA33EC60679" id="oCAPICOM"></object> <object type="application/x-cmplugin"> <param name="onload" value="pluginLoaded"> </object> </div>',footerToolbarTpl:'{{>auditBtn}}{{>decodeBtn}}{{>recallBtn}}{{>replyBtn}}{{>forwardBtn}}{{>moreBtn}}',icoDown:'<span class="iconfont icondown"></span>',auditBtn:'{{#if needToAudit}} <span class="u-btn u-btn-default j-audit" data-action="pass">{{i18n \'mbox/audit_pass\'}}</span> <span class="u-btn u-btn-default j-audit" data-action="reject">{{i18n \'mbox/audit_reject\'}}</span> {{/if}}',decodeBtn:'{{#if config.supportSMIME}} {{#if sMimeServerEncrypted}} <span class="u-btn u-btn-default" {{#if isDecodeMail}}disabled{{/if}} data-btn="decryptServerEncrypted">{{i18n "mbox/bt_decode_mail"}}</span> {{/if}} {{#if sMimeClientEncrypted}} <span class="u-btn u-btn-default j-ca-decrypt" data-btn="decryptClientEncrypted" {{#unless isIE}}disabled{{/unless}} {{#if isDecodeMail}}disabled {{/if}}>{{i18n "mbox/bt_decode_mail"}}</span> {{/if}} {{/if}}',recallBtn:'{{#if recallMail.enableRecallMail}} <span class="u-btn u-btn-default {{#if recallMail.disabledRecall}}disabled{{/if}}" data-btn="recall">{{recallMail.message}}</span> {{/if}}',replyBtn:'{{#if config.enableReply}} {{#if (and attachments.[0] @config.mail.enableReplyWithAttachments)}} <span class="u-btn u-btn-default" {{if$ (eq isDecodeMail false) \'disabled\'}} data-dropdown="reply">{{i18n "common/op_reply"}}{{>icoDown}}</span> <span class="u-btn u-btn-default" {{if$ (eq isDecodeMail false) \'disabled\'}} data-dropdown="reply-all">{{i18n "common/op_replyall"}}{{>icoDown}}</span> {{^}} <span class="u-btn u-btn-default" {{if$ (eq isDecodeMail false) \'disabled\'}} data-btn="reply">{{i18n "common/op_reply"}}</span> <span class="u-btn u-btn-default" {{if$ (eq isDecodeMail false) \'disabled\'}} data-btn="replyall">{{i18n "common/op_replyall"}}</span> {{/if}} {{/if}}',forwardBtn:'{{#if config.enableForward}} <span class="u-btn u-btn-default" {{if$ (eq isDecodeMail false) \'disabled\'}} data-btn="forward">{{i18n "common/op_forward"}}</span> {{/if}}',moreBtn:'<span class="u-btn u-btn-default" data-dropdown="read-more">{{i18n "common/op_more"}}{{>icoDown}}</span>'})},626:function(e,a,t){(function(a,i,n){var s=t(472),l=t(474),o=s.extend({handleSelect:t(818)},(function(){var e=this;e.events({'click .j-mark':[a.stop((function(e,a){e=e||'flagged';var i=a.closest('.j-mail');t().mark(i.hasClass(e)?'no'+e:e,i.attr('mid'))}))],'click .j-select-count .j-cancel':a.stop((function(){t().selectNone()}),0)});var t=function(){return e.toolbar};e._editDraft=function(s,o,r){var c=s.id;if(e.config.enableCompose){t().mark(':read',c),r.removeClass('unread').addClass('read');var d=a.mapFind(i('[data-view-name*=compose]').get(),(function(e){return(a.get(e=i(e).data().self,'_params.composeInfo.draftId')||'').replace(/@.*/,'')===c&&e}));if(d)return void e.sendMessage('mail','view:switchTo',{target:d.get('tabId')});var f={ctype:'draft',mid:c,mboxa:o};l.compose(f,f)}else i.notify.error(n('mail/FA_MBOX_TARGET_READ_ONLY'))}}));e.exports=o}).call(this,t(464),t(463),t(465))},627:function(e,a,t){e.exports=t(469)('<div class="m-mllist"> <div class="list-bg"></div> <div class="m-mllist-row"> <div class="j-module-top"> <div class="j-autoforward message-tip u-alert-warning u-alert-dismissible f-ellipsis f-dn"></div> <div class="j-autoreply message-tip u-alert-warning u-alert-dismissible f-ellipsis f-dn"></div> <div class="j-common-tip message-tip u-alert-warning u-alert-dismissible f-ellipsis"></div> <div class="toolbar j-toolbar f-dn"></div> <div class="mail-totals j-mail-totals"></div> <div class="j-select-count select-count f-dn"> <span class="j-desc desc"></span> <a class="j-cancel cancel" href="javascript:void(0);">{{i18n "common/cancel"}}</a> </div> </div> </div> <div class="m-mllist-row mllist-list-row"> <div class="j-module-content mllist-list u-scroll"> <div class="j-maillist mllist-height"></div> </div> <div class="j-nlist nlist-wrap"></div> </div> </div>',{toolbartpl:'<span class="u-btn u-btn-default u-btn-round f-fr j-setting" ><i class="iconfont iconset"></i></span> <div id="pagination" class="f-fr"></div> <div class="u-btns" data-dropdown="select"> <span class="u-btn u-btn-default j-selectmail"> <input type="checkbox" name="checkAll" /> <span class="iconfont icondown"></span> </span> </div> <div class="u-btns j-viewbtns"> <span class="u-btn u-btn-default j-sort" data-dropdown="sort">{{i18n "common/op_sort"}}<span class="iconfont icondown"></span></span> <span class="u-btn u-btn-default" data-dropdown="view">{{i18n "common/op_view"}}<span class="iconfont icondown"></span></span> </div> <div class="f-ib j-tgbtns"> <span class="u-btn u-btn-default" data-btn=defer:setComp disabled>{{i18n "mail/deferCompleted"}}</span> {{#if config.enableDelete}} <span class="u-btn u-btn-default" data-btn=delete disabled>{{i18n "common/op_delete"}}</span> {{/if}} <div class="u-btns"> {{#if config.enableUpdateMailStatus}} {{#if config.enableMoveTo}} <span class="u-btn u-btn-default" data-dropdown="move" disabled>{{i18n "common/op_move"}}<span class="iconfont icondown"></span></span> {{/if}} <span class="u-btn u-btn-default" data-dropdown="mark" disabled>{{i18n "common/op_mark"}}<span class="iconfont icondown"></span></span> {{/if}} {{#if config.enableSendMail}} <span class="u-btn u-btn-default" data-dropdown="more" disabled>{{i18n "common/op_more"}}<span class="iconfont icondown"></span></span> {{/if}} </div> {{#if @config.user.enableLunkr}} <span role="toLunkr" class="u-btn u-btn-default" data-btn=createTopic disabled>{{i18n "common/op_createTopic"}}</span> {{/if}} </div> <span class="u-btn u-btn-default" data-btn=refresh>{{i18n "common/op_refresh"}}</span>',mailtotaltpl:'<div class="totals-info"> {{name}}( <span class="all-mail"> {{i18n \'mail/message_totals\'}}<span class=number>{{count}}</span>{{i18n \'mail/message_letters\'}} </span> <span>{{{listStatus}}}</span> ) </div>',listStatusTpl:'{{#if count}} <span class="{{className}}"><span class="number">{{count}}</span>{{i18n \'mail/message_letters\'}}</span> {{{operations}}} {{/if}}',unreadStatusTpl:'<a href="javascript:void(0)" data-action="view:unread">{{i18n \'mail/unread_message_count\'}}</a> {{#if operable}}, <a href="javascript:void(0)" data-action="mark:allread">{{i18n \'mail/marked_allread\'}}</a>{{/if}}',deferredStatusTpl:'<a href="javascript:void(0)" data-action="view:defer::1">{{i18n \'mail/today_deferred_message_count\'}}</a> , <a href="javascript:void(0)" data-action="mark:alldone">{{i18n \'mail/marked_alldone\'}}</a>',autoforwardtpl:'<span class="close iconfont icondelword j-close"></span> {{{i18n "mail/hint_message_forward" email=forwardEmail}}}',autoreplytpl:'<span class="close iconfont icondelword j-close"></span> {{{i18n "mail/hint_message_autoreply"}}}',listGroupTpl:'<div class="j-mail-group-wrap" {{#if id}}data-group-id="{{id}}"{{/if}}> {{#if id}} <div class="list-group-title f-csp j-listtt {{if$ list_style \'user-fs12\'}}" data-id="{{id}}"> <i class="iconfont iconcollapse f-fr"></i> <span class="j-select-group">{{name}} (<span class="j-group-length">{{list.length}}</span>)</span> </div> {{/if}} <div toggle-list="{{id}}" class="j-list-group-body"> {{#if displaySummary}} <ul class="list-wrap j-mail-list {{if$ list_style \'user-fs12\'}}"></ul> {{^}} <table class="u-table j-mail-list {{if$ list_style \'user-fs12\'}}"> <tbody></tbody> </table> {{/if}} </div> </div>',listItemTpl:'{{#if _meta.displaySummary}} <li class="list-item j-mail {{#if flags.read}}read{{^}}unread{{/if}} {{#if flags.flagged}}flagged label0-{{#if label0Filter}}{{ label0Filter }}{{^}}{{ label0 }}{{/if}}{{/if}} {{#if flags.vip}}vip{{/if}} {{#if summary}} display-summary{{/if}}" mid="{{id}}" index="{{index}}" fid="{{fid}}"> <div class="item-content mail-info"> <div class="info-desc"> <div class="info-desc-left"> <div class="desc-flag"> {{> vipTpl}} {{> flagTpl}} {{> deferTpl}} </div> <div class="desc-text"> <span class="icon"><i class="j-priorityIcon iconfont {{priorityIcon}}" title="{{priorityMsg}}"></i></span> <span class="subject" title="{{subject}}">{{{ formattedOutput.subject }}}</span> </div> </div> <div class="info-desc-right"> <span class="desc-time" title=\'{{i18n "mail/receive_time"}}{{formatReceivedDate}}\'>{{formatReceivedDate}}</span> {{#if display_size}}<span class="desc-size">{{display_size}}</span>{{/if}} </div> </div> <div class="info-summary"> <p class="summary-text"> {{> fromtoTpl}} {{#if summary}} <span class="fromto">: </span> <span class="summary">{{summary}}</span> {{/if}} </p> <div class="summary-stat"> <div class="summary-stat-bg"></div> {{#or flags.attached flags.linkAttached}}<span class="stat-attach" title="{{i18n \'mail/list_have_attach\'}}"><i class="iconfont iconacc"></i></span>{{/or}} {{#if memo}}<span class="j-memo-tip stat-memo" data-memo="{{memo}}"><i class="iconfont iconremarks"></i></span>{{/if}} {{#if (gt threadMessageCount 1)}}<span class="stat-thread">{{threadMessageCount}}</span>{{/if}} </div> </div> <div class="info-icon"> <span><i class="j-normalIcon iconfont {{icon}}" title="{{iconMsg}}"></i></span> </div> </div> <div class="item-chk check-col" title="{{iconMsg}}"> {{#if backgroundColor}}<span class="pop-marker pop-marker-sum pop-marker-bg{{backgroundColor}}"></span>{{/if}} <input type="checkbox" name="mid" data-draft="{{flags.draft}}" data-fid="{{fid}}" value="{{id}}" from="{{from}}"/> </div> <div class="item-active-border"></div> <div class="item-divider"></div> </li> {{^}} {{#unless _meta.layoutType2}} <tr class="j-mail {{#if flags.read}}read{{^}}unread{{/if}} {{#if flags.flagged}}flagged label0-{{#if _meta.label0Filter}}{{ _meta.label0Filter }}{{^}}{{ label0 }}{{/if}}{{/if}} {{#if flags.vip}}vip{{/if}}" mid="{{id}}" fid="{{fid}}" index="{{index}}"> <td class="active-border"></td> <td class="check-col"> {{#if backgroundColor}}<span class="pop-marker pop-marker-bg{{backgroundColor}}"></span>{{/if}} <input type="checkbox" name="mid" data-draft="{{flags.draft}}" data-fid="{{fid}}" value="{{id}}" from="{{from}}"/> </td> <td class="ico"><i class="iconfont {{icon}} j-normalIcon" title="{{iconMsg}}"></i><i class="j-priorityIcon iconfont {{priorityIcon}}" title="{{priorityMsg}}"></i></td> <td class="{{displayType}}"> {{> fromtoTpl}} </td> <td class="mark-icons"> {{> vipTpl}} {{> flagTpl}} </td> <td class="subject-item"> {{#if memo}}<span class="j-memo-tip" data-memo="{{memo}}"><i class="iconfont iconremarks"></i></span>{{/if}} <span class="subject f-ib f-ellipsis" title="{{subject}}">{{{ formattedOutput.subject }}}</span> {{#if (gt threadMessageCount 1)}}<strong class="thread-num icon">{{threadMessageCount}}</strong>{{/if}} </td> <td class="defer"> {{> deferTpl}} </td> <td class="attach"><i {{#or flags.attached flags.linkAttached}} class="iconfont iconacc" title="{{i18n \'mail/list_have_attach\'}}"{{/or}}></i></td> <td class="time">{{formatReceivedDate}}</td> {{#if display_size}}<td class="size">{{display_size}}</td>{{/if}} </tr> {{^}} <tr class="left-layout j-mail {{if$ flags.read \'read\' \'unread\'}} {{#if flags.flagged}}flagged label0-{{#if _meta.label0Filter}}{{ _meta.label0Filter }}{{^}}{{ label0 }}{{/if}}{{/if}} {{#if flags.vip}}vip{{/if}}" mid="{{id}}" fid="{{fid}}" index="{{index}}"> <td class="f-pr {{if$ _meta.list_style \'user-fs12\'}}"> <div class="active-border"></div> <div class="check-col" title="{{iconMsg}}"> {{#if backgroundColor}}<span class="pop-marker pop-marker-bg{{backgroundColor}}"></span>{{/if}} <span class="mail-check f-ib"><input type="checkbox" name="mid" data-draft="{{flags.draft}}" data-fid="{{fid}}" value="{{id}}" from="{{from}}"/></span> </div> <div class="tr-item f-pr"> <span class="item-"></span> </div> <div class="tr-item f-pr" style="height: 22px"> <span class="item-from f-ib"> <span class="from f-ellipsis"> {{> fromtoTpl}} </span> <span class="item-from-icon"> {{#or flags.attached flags.linkAttached}}<span class="attach f-ib" title="{{i18n \'mail/list_have_attach\'}}"><i class="iconfont iconacc"></i></span>{{/or}} {{#if memo}}<span class="j-memo-tip f-ib" data-memo="{{memo}}"><i class="iconfont iconremarks"></i></span>{{/if}} {{#if (gt threadMessageCount 1)}}<strong class="thread-num icon">{{threadMessageCount}}</strong>{{/if}} </span> </span> <span class="time-size f-ib"> <span class="time f-ib">{{formatReceivedDate}}</span> {{#if display_size}}<span class="size f-ib">{{display_size}}</span>{{/if}} </span> </div> <div class="tr-item f-pr"> <span class="ico mail-state f-ib"><i class="iconfont {{icon}} j-normalIcon" title="{{iconMsg}}"></i><i class="j-priorityIcon iconfont {{priorityIcon}}" title="{{priorityMsg}}"></i></span> <span class="subject f-ib f-ellipsis" title="{{subject}}">{{{ formattedOutput.subject }}}</span> <span class="attach-flag f-ib"> <span class="defer f-ib"> {{> deferTpl}} </span> <span class="mark-icons f-ib"> {{> vipTpl}} {{> flagTpl}} </span> </span> </div> </td> </tr> {{/unless}} {{/if}}',deferTpl:'{{#if _meta.config.enableDeferMail}} <span class="flag-defer {{if$ flags.deferHandle \'\' \'unflag\'}}"> {{#if flags.deferHandle}} <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="state-icon icon-mDEFER {{if$ _meta.config.enableUpdateMailStatus \'j-defer\'}}"></i> {{^}} {{#if _meta.config.enableUpdateMailStatus}} <i title="{{i18n \'mail/list_set_defer\'}}" class="j-defer iconfont iconclock"></i> {{/if}} {{/if}} </span> {{/if}}',flagTpl:'{{#if @config.mail.label0Count}} {{#if _meta.config.enableUpdateMailStatus}} <span class="u-flag j-flag j-mark {{if$ flags.flagged \'\' \'unflag\'}}"> {{#if flags.flagged}} <i title="{{i18n \'mail/list_cancel_flag\'}}" class="iconfont iconflatcolor"></i> {{^}} <i title="{{i18n \'mail/list_set_flag\'}}" class="iconfont iconflat"></i> {{/if}} </span> {{^}} <span class="u-flag {{if$ flags.flagged \'\' \'unflag\'}}"> {{#if flags.flagged}} <i class="iconfont iconflatcolor"></i> {{/if}} </span> {{/if}} {{/if}}',vipTpl:'{{#if @config.mail.enableVipMessage}} {{#if _meta.config.enableUpdateMailStatus}} <span data-action="vip" class="u-flag j-mark {{if$ flags.vip \'\' \'unflag\'}}"> {{#if flags.vip}} <i title="{{i18n \'mail/list_cancel_vip\'}}" class="iconfont iconstar vip"></i> {{^}} <i title="{{i18n \'mail/list_set_vip\'}}" class="iconfont iconstarline"></i> {{/if}} </span> {{^}} <span class="u-flag {{if$ flags.vip \'\' \'unflag\'}}"> {{#if flags.vip}} <i class="iconfont iconstar vip"></i> {{/if}} </span> {{/if}} {{/if}}',fromtoTpl:'{{#if delegatedSender}} <span class="delegate-mail" title="{{i18n \'prop:mail/read_delegate_send\' 0=delegatedSender}}">{{i18n "mail/read_delegate_mail"}}</span> {{/if}} {{#each contactList}} <span class="fromto j-{{../displayType}}" data-email="{{address}}">{{trueName}}</span> {{#if (not @last)}} <span class="fromto">,</span> {{/if}} {{/each}}',nlisttpl:'<div class="nlist"> {{#if action}} <div class="h4">"{{name}}" </div> {{/if}} <div class="h3">"{{name}}" {{i18n "mbox/no_message"}}</div> {{#if message}} <div> {{{message}}} {{#if link}} <a href="javascript:void(0)" class="link">({{link}})</a> {{/if}} </div> {{/if}} </div>',nslisttpl:'<div class="nlist"> <div class="h4">{{{desc}}}</div> <a href="javascript:void(0);" class="link"><i class="iconfont iconrevocation"></i> {{i18n \'mail/list_refresh\'}}</a> </div>',tipsTpl:'<span class="close iconfont icondelword j-close"></span> {{{message}}}'})},629:function(e,a,t){(function(a){t(630);var i=t(464),n=t(463),s=t(474),l=t(579),o=t(467),r=o.getUser,c=o.updateUser,d=o.detachURL,f=o.getCurrentState,m=o.setCurrentState,p=t(468).detachMode,u=t(477).go,v=t(465),g=t(473),h=t(483),b=h.text2html,_=h.html2text,y=t(472),w=t(469),j=t(470),x=j.alert,k=j.confirm,M=t(482),C=t(829),T=w('<br><br>{{sentDate}} <a href="mailto:{{from}}">{{from}}</a> '+v('mbox/reply_info_wrote')+'<blockquote name=replyContent style="padding-left: 1ex;margin: 0 0 0 0.8ex;border-left: 1px solid #ccc;"><div>'),S=t(831),D=t(580),A=t(631),$=function(e){return[].concat(e.attachments,e.trsAttachments)},E={updateAuditMail:function(e){e.isAuditMail=!i.isEmpty(e.orgauditinfo),e.needToAudit=e.isAuditMail&&null==e.orgauditinfo.auditstatus,e.isAuditMail&&(e.attachments[0]||{}).isMsg&&(e.part=e.attachments[0].id)},setupQuickReply:function(e){var a=(e=e||this.$()).find('.j-toolbar-footer');if(a.contents().filter((function(){return 3===this.nodeType})).remove(),a.find('.u-btn').css('float','none'),a.is('td'))return;var t=n('<table class=j-footer-bar style="width:100%"><tr><td style="width:100%"><td nowrap style="padding-left:6px"></td></tr></table>');t.find('td:first').html(e.find('.quick-reply-default').detach()),t.find('td:last').addClass(a.attr('class')).html(a.html()).toggle(!a.is(':empty')),a.replaceWith(t)},load:function(e){var t=this;n.notify.loading(),e.fin((function(e,i){n.notify.loading('hide'),e||(i&&'FA_MAIL_NOT_FOUND'===i.code&&s.flush(),t.close&&a.caught(v('mail/read_init_fail'),t.close))}))},_rerender:q};function L(e){return'mail.read'!==e.name}function F(e,a){var t=L(e)?a.closest('.j-mail-info'):e.$();return[L(e)?e.mail(t.data('mid')):e._params.mail,t]}function R(e){var a=F(this,e),t=a[0],i=a[1];!function(e,a,t){a[0]&&e.scrollTo(a,t||0)}(this.$('.j-main'),i.find('.j-mail-attachments-wrap')),function(e,a,t,i){void 0===a&&(a='#e6e6e6');void 0===t&&(t=3);void 0===i&&(i=100);var n=0,s='',l=function(){I&&(clearInterval(I),I=null)};l(),I=setInterval((function(){s=++n%2==0?'':a,e.css('background',s),n===2*t&&l()}),i)}($(t)[0]?i.find('.j-tab-trigger.z-current > a'):i.find('.j-mail-attachments-wrap .attach-title'))}e.exports=y.Auto.extend(E,(function(e,o){var p=this;p.events({'click .j-view-attach':[R,n],'click .j-quick-reply [data-type]':[function(e,a){a=a.closest('.j-quick-reply');var l=L(p)?a.data().mid:y,o=p.mail(l),r=L(p)?n():p.$('.j-main'),c=a.find('textarea'),d=c.val(),u=function(e){return s.quickReplyMessage(i.assign(function(e,a){var t=T({sentDate:e.sentDate,from:e.from[0]}),n={quoteHTMLStart:b(a)+t,quoteTextStart:a+_(t),id:e.id,mboxa:j},s=e.mainPartData,l=s.extended,o=s.content;l&&i.assign(n,{quoteHTMLBody:o,quoteTextBody:_(o,!1)});return n}(o,d),e))};switch(e){case'open-quick-reply':if(a.find('.quick-reply-item,.j-footer-bar').slideUp(200),a.find('.j-reply-form').slideDown(200).find('textarea').focus(),r.addClass('mail-reply-open'),L(p)){var g=f();g.param.replyMid=l,m(g)}break;case'cancel':w();break;case'compose':u();break;case'send':d?(a.find('.j-reply-form').slideUp(200),a.find('.j-reply-sending').show(),r.removeClass('mail-reply-open'),u({action:'deliver'}).fin((function(e,t,i){e&&c.val(''),a.find('.j-reply-success').toggle(e),a.find('.j-reply-fail').html(e?'':t).toggle(!e),a.find('.quick-reply-item').slideUp(200),a.find('.j-reply-result').slideDown(200),'FA_NO_RECEIPT'===i&&(a.find('[data-type=open-quick-reply]').hide(),a.find('[data-type=compose]').show())}))):x(v('mail/confirm_input_content'))}a.find('[data-type]').off('mousedown').on('mousedown',i.stop(0)),t(481).LE8?r.off('mousedown').on('mousedown',h):c.off('blur').on('blur',h);function h(){a.is(':visible')&&('send'===e||'cancel'===e||w())}function w(){a.find('.quick-reply-item').slideUp(200),a.find('.j-footer-bar').slideDown(200),r.removeClass('mail-reply-open'),L(p)&&p.$('.j-quick-reply').each((function(){n(this).pin('setPosition')}))}}]}),p.helpers={translateSL:function(e){var a=M.i18n(e);return a?'['+a+']':''},detachUrl:function(e,a){return d(e,i.assign({mid:a.id},i.pick(a,['fid','mboxa','start'])))},countAttachment:function(e){return $(e).length},firstAttachment:function(e){return $(e)[0]}},p.close=i.fn(q,[],{},{});var h=(p.state=f()).param,y=h.mid,w=h.rootid,j=h.mboxa,E='fid'in h&&(h.fid=+h.fid);function I(e,a){L(p)?p.moveMail(e,a):p.toolbar.moveTo(a)}h.id=y,t(545)(p),e()(i.assign({},o,{name:p.name+':'+(w||y),className:h.embed?'m-read-embed':h.shared?'m-read-shared':''})),p.initEvents=function(e,o){var d=function(a,t){!1!==o.isDecodeMail&&('send'===a?p.$('.reply-textarea:focus').closest('.j-quick-reply').find('[data-type=send]').click():e(a,t))};p._initRead=function(e){return function(e,o){var d=F(p,o),f=d[0],m=d[1];return function(e,a){var t=i.map((e.cacsystag||'').split(';'),[/_.*/,'']),s=i.mapFind(v('mbox/cacTags').split('|'),(function(e,a,i){return!(a%2)&&t.includes(e)&&i[a+1]})),l=e.sspurl,o=s?l?g(v('mbox/sspurl_tips'),s):s:l&&v('mbox/sspurl_message_tips'),r=n(D.sspTpl({msg:o,fid:e.fid})),c=r.find('[data-action]').click((function(){switch(n(this).data().action){case'original':e._read({filterLinks:!1,filterImages:!1});break;case'spam':I(e.id,5);break;case'delete':k(v('mbox/confirm_delete'),i.fn(I,e.id,4));break;case'close':r.remove()}}));l||c.eq(1).remove(),o&&a.find('.j-read-alert').append(r)}(f,m),function(e,t,i){var l=e.id,o=i&&n.fn.find.bind(t.find('.j-meeting-request').html(D.meetingRequestTpl(i,p)).on('click','[data-action]',(function(){var e=n(this),t=e.data().action;switch(t){case'modify':o('.j-meeting-btn').show(),e.parent().addClass('f-dn');var i=g(v('mail/select_modify_state'),o('.j-participation-display b').html());o('.j-accept-state').html(i).show();break;case'toggleAttendees':e.closest('.j-attendees').hide().siblings('.j-attendees').show();break;case'viewCal':u('calendar',{historyUrl:'calendar',view:'MONTH',func:'resp'});break;case'goCal':u('calendar',{historyUrl:'calendar',view:'MONTH',fid:1,selectedDate:e.data('caldate')});break;case'forwardCal':s.compose({ctype:'forward',mid:l,mboxa:j,to:e.data('organizer')})}var d={tentative:2,accept:3,decline:4,addCal:r,deleteCal:c}[t];d&&(d.call?d():function(e,t){var i=v('mail/op_'+t);k(g(v('mail/event_confirm_participation'),i),(function(){a.when(a.wmCall('cal:replyMeetingRequest',{id:l,userAttendeeStatus:e}),s.updateMailAttrs(l,{partStat:e})).then((function(){o('.j-accept-state').hide().prev().removeClass('f-dn'),o('.j-participation-display').html(g(v('cal/event_participation_display'),i)),o('.j-participation-display b').html(i).show(),o('.j-meeting-btn').hide(),o('.j-modify-msg').html(v(4===e?'cal/event_participation_deleted':'cal/event_participation_added')).show()}))}))}(d,t))})));function r(){k(v('cal/event_confirm_participation_added'),(function(){a.wmCall('cal:addToMyCal',{id:l,mboxa:j}).then((function(e){e&&'FA_INVALID_REQUEST'===e.code?n.notify.error(v('cal/event_participation_illegal')):e&&'FA_INVALID_ATTENDEE'===e.code?n.notify.error(v('cal/event_participation_cancel')):e&&e.eventId&&(n.notify.success(v('cal/event_participation_added')),o('.j-add-cal').addClass('f-dn').siblings('.j-view-cal,.j-del-cal').removeClass('f-dn'))}))}))}function c(){k(v('cal/event_confirm_participation_delete'),(function(){a.wmCall('cal:delFromMyCal',{id:l,mboxa:j}).then((function(e){e&&'FA_INVALID_REQUEST'===e.code?n.notify.error(v('cal/event_participation_illegal')):e&&'FA_INVALID_ATTENDEE'===e.code?n.notify.error(v('cal/event_participation_cancel')):e&&e.declined&&(n.notify.success(v('cal/event_participation_deleted')),o('.j-add-cal').removeClass('f-dn').siblings('.j-view-cal,.j-del-cal').addClass('f-dn'))}))}))}}(f,m,f.calendar),f.id===y&&function(e,t){var i=e.requestReadReceipt,s=p.config.forceSendReadReceipt?2:i&&(r().op_readreceipt||0),l=a.wmBind('mbox:sendMDN',{id:e.id,dispositionInfo:{mode:s?'automatic':'manual',type:'displayed'}});switch(p._params.unread&&s){case 0:t.find('.j-read-alert').html(S.readReceiptTpl()),(o=p.$('.j-read-receipt')).find('[data-action]').click((function(e){'send'===(e=n(this).data().action)&&l().fin((function(e){e?n.notify(v('mail/read_send_receipt_success')):n.notify.error(v('mail/read_send_receipt_fail'))})),o.find('#receiptAlways').is(':checked')&&c({op_readreceipt:'send'===e?2:1}),o.remove(),delete p._params.unread}));break;case 2:l()}var o}(f,m),m.customRadioCheckbox(),t(632)(m,f,(function(e){!function(e,a,o){var r=e._read=function(a){return s.readMessage(i.assign({},h,{part:e.part},a,{mid:e.id})).onRTN(o)};e.isAuditMail&&e.part?r().then((function(t){l.formatAttachments(e,t),c(),L(p)||p._initToolbar(),function(t){a.find('.j-mail-audit-info').html(S.auditMailContactsTpl({tableData:['from','to','cc','bcc','subject'].map((function(e){return{label:v('mbox/mail_'+e),value:i.array(t[e]).join(', ')}}))})),p.$('.j-audit').click((function(){C(n(this).data().action,i.assign({subject:t.subject},e.orgauditinfo))}))}(t)})):(o(e),c());function c(){var i=$(e).length;i&&(a.find('.j-attach-desc').html(i),a.find('.j-attach-wrap').removeClass('f-dn'),a.find('.j-full-attach-wrapper').html(S.fullAttachWrapperTpl(e,p))),t(633)(a.find('.j-mail-attachments-wrap'),e,p.Smime)}e._initAttach=c}(f,m,e)}),e,L(p))}(d,e)},p.pubsub.off().onMessage('cmd',(function(e){var a=e.message;d(a)})).subscribe('mail','arrival',(function(e){var a=e.message,t=a.id,i=a.rootid,s=a.fid;if(L(p)&&i===p._params.mail.rootid){var l=p.$('.j-thread-tips');p.$('.thread-list').off('scroll.thread-in-mail').on('scroll.thread-in-mail',(function(e){n(this).height()+e.target.scrollTop>n('.j-thread-item[data-mid="'+t+'"]')[0].offsetTop&&(n(this).off('scroll.thread-in-mail'),l.data('unread',0).css('opacity',0))}));var o=l.data('unread')?l.data('unread')+1:1;return l.html(A.threadTipsInMailTpl({unreadCount:o},p)).data('unread',o).css('opacity',1),l.find('.close').off('click.thread-in-mail').on('click.thread-in-mail',(function(){n(this).off('click.thread-in-mail'),l.data('unread',0).css('opacity',0)})),void p._appendMail(t)}s===E&&(h.start++,p.initPrevAndNext())})),p.$('.j-main').off('scroll').on('scroll',(function(){n(document).trigger('hide.menu')}))},p._prevNext=function(e){var t=h.pView,n=h.start,l='search'===t?s.searchMails:s.list;return(null==n?a.resolve([]):l(i.assign({},h.condition||h,{start:(n||1)-1,limit:3,nocache:!0}))).then((function(t,n){var s=i.find(t,{id:y});return e&&i.reassign(e,s),a.resolve(t,s?n.total:0)}))},p.before('destroy',(function(){i.mapFilter(p.$('iframe').get(),'iFrameResizer',(function(e){e&&e.close()}))}))}));var I=null;function q(e,a,t){var s=t.start,l=this.state;if(l){var o,c=s>=0,d=n('#previewLayoutRead').has(this.$())[0];if(c||p||d||0!==r().afterdel){var f=this._params.start,m=i.map(e,'id').indexOf(a.id)+(s<f?-1:1);o=c?e[m]:e[m]||e[m-2],s=c?s:f}var v=l.param,g=v.pView,h=v.tabId,b=o&&'mail.'+(o.threadMessageCount>1?'thread':'read'),_=o&&i.assign(i.omit(l.param,['id','tabId','tabTitle']),i.pick(o,['rootid']),{mid:o.id,start:s,replaceId:h});d?this.sendMessage('mail.previewlayout','reset',o&&{module:b,param:_}):o?u(b,_):this.sendMessage('mail','view:close',{id:h,target:g})}}}).call(this,t(466))},631:function(e,a,t){e.exports=t(469)('<section class="m-thread j-mail-read"> <header class="toolbar f-cf f-dn j-toolbar"></header> <div class="thread-title f-cf"></div> <div class="j-main thread-list u-scroll"></div> <div class="thread-tips j-thread-tips"></div> </section>',{threadTipsInMailTpl:'<span class="msg-title">{{i18n "mail/msg_thread_in_mail"}}</span> <span class="msg-info">{{i18n "mail/msg_thread_in_mail_msg" count=unreadCount}}</span> <span class="iconfont icontabclose close"></span>',toolbarMenuTpl:'<div id="pagination" class="u-page u-page-round f-fr"></div> <span class="u-btn u-btn-default" data-btn="delete">{{i18n "common/op_delete_thread"}}</span> <div class="u-btns">{{>moveBtn}}{{>markBtn}}</div> <span class="u-btn u-btn-default j-toggle-thread" data-type="expand">{{i18n "common/op_expand_all"}}</span> <span class="u-btn u-btn-default" data-dropdown="thread-more">{{i18n "common/op_more"}}{{>icoDown}}</span>',threadTitleTpl:'<h2 class="{{#if flags.flagged}} flagged label0-{{label0}}{{/if}} f-ellipsis"> <span class="icon"><i class="j-sourceIcon iconfont {{sourceIcon}}" title="{{sourceMsg}}"></i></span> {{if$ ctrls (translateSL ctrls.[CM-SECURITY])}} {{subject}} </h2> <div class="tool"> {{#if @config.mail.enableVipMessage}} <span class="j-vip f-pr f-csp" data-mid="{{id}}"> {{#if flags.vip}} <i title="{{i18n \'mail/list_cancel_vip\'}}" class="iconfont iconstar vip"></i> {{^}} <i title="{{i18n \'mail/list_set_vip\'}}" class="iconfont iconstarline"></i> {{/if}} </span> {{/if}} {{#if config.enableMailFlagged}} <span class="mark-op mail-flagged f-pr" data-dropdown="flag-color"> <i class="iconfont{{#if flags.flagged}} iconflatcolor flagged label0-{{label0}}{{^}} iconflat{{/if}}" title="{{i18n \'mbox/mail_flag_flagged_true\'}}"></i> <i class="iconfont icondown"></i> </span> {{/if}} {{#if config.enableDeferMail}} <span class="j-defer f-csp" data-mid="{{id}}" deferDate="{{defer}}"> {{#if flags.deferHandle}} <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="deferred state-icon icon-mDEFER"></i> {{^}} <i title="{{i18n \'mail/list_set_defer\'}}" class="iconfont iconclock"></i> {{/if}} </span> {{/if}} <span class="j-newtab f-pr"> <a class="newtab iconfont iconnewtab" href="{{detachUrl \'mail.thread\' .}}" target="_blank" title=\'{{i18n "mbox/mail_blank"}}\'></a> </span> </div>',threadListTpl:'{{#each this}} {{#if hiddenCount}} <div class="toggle-other-thread j-toggle-other-thread"> <a class="toggle-btn j-toggle-item" data-type="hideItem" href="javascript:void(0)"> {{i18n "mail/show_hidden_toggle_mail" count=hiddenCount}} </a> <div class="double-line"></div><div class="double-line"></div> </div> {{/if}} <div class="j-thread-item thread-item f-cf" data-mid="{{id}}" lastMessage="{{#if lastMessage}}true{{/if}}"> <div class="arrow {{#if isFromCurUser}}arrow-right{{^}}arrow-left{{/if}}"><em class="arrow-em"></em><span class="arrow-span"></span></div> <div class="left f-cf"> <span class="from f-ib f-ellipsis grid-col3"> {{#if delegatedSender}} <span class="delegate-mail" title="{{i18n \'prop:mail/read_delegate_send\' 0=delegatedSender}}">{{i18n "mail/read_delegate_mail"}}</span> {{/if}} <strong>{{#if formatFrom.true_name}}{{formatFrom.true_name}}{{^}}{{formatFrom.emailAddress}}{{/if}}</strong> </span> <span class="summary f-ib f-ellipsis grid-col9">{{summary}}</span> </div> <div class="right"> <div class="f-fr f-tar"> {{#or flags.attached flags.linkAttached}} <span class="attached"><i class="iconfont iconacc"></i></span> {{/or}} <span class="date f-ellipsis" title=\'{{i18n "mail/sent_date"}}{{sentDate}}\'>{{sentDate}}</span> </div> <div class="item-flags-wrap f-fr"> <div class="item-flags"> {{#if @config.mail.enableVipMessage}} <span class="u-flag j-vip" data-value="{{or flags.vip}}" data-mid="{{id}}"> {{#if flags.vip}} <i title="{{i18n \'mail/list_cancel_vip\'}}" class="iconfont iconstar vip"></i> {{^}} <i title="{{i18n \'mail/list_set_vip\'}}" class="iconfont iconstarline"></i> {{/if}} </span> {{/if}} {{#if config.enableMailFlagged}} <span class="u-flag j-flag" data-value="{{or flags.flagged}}" data-mid="{{id}}"> {{#if flags.flagged}} <i title="{{i18n \'mail/list_cancel_flag\'}}" class="flagged iconfont iconflatcolor label0-{{label0}}"></i> {{^}} <i title="{{i18n \'mail/list_set_flag\'}}" class="iconfont iconflat"></i> {{/if}} </span> {{/if}} {{#if config.enableDeferMail}} <span class="j-defer" data-value="{{or flags.deferHandle}}" data-mid="{{id}}" deferDate="{{defer}}"> {{#if flags.deferHandle}} <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="deferred state-icon icon-mDEFER"></i> {{^}} <i title="{{i18n \'mail/list_set_defer\'}}" class="iconfont iconclock"></i> {{/if}} </span> {{/if}} </div> &nbsp; </div> </div> </div> <div class="j-mail-info thread-item-info f-dn" data-mid="{{id}}"></div> {{/each}}',threadInfoTpl:'<div class="mail-top j-mail-top"> <div class="arrow {{#if isFromCurUser}}arrow-right{{^}}arrow-left{{/if}}"><em class="arrow-em"></em><span class="arrow-span"></span></div> <div class="f-cf head"> <div class="f-ellipsis head-left j-toggle-item" data-type="curItem"> {{#if delegatedSender}} <span class="delegate-mail" title="{{i18n \'prop:mail/read_delegate_send\' 0=delegatedSender}}">{{i18n "mail/read_delegate_mail"}}</span> {{/if}} {{#if from}} <strong class="mail-form u-email-tip" addr="{{hemail from.[0] \'addr\'}}" data-true-name="{{hemail from.[0] \'name\'}}">{{xFrom}}</strong> {{/if}} {{#if delegatedSender}} <span>({{i18n "prop:mail/read_delegate_send" 0=delegatedSender}}</span>) {{/if}} {{#if isSenderMode}}({{senderMessage}}){{/if}} <span class="j-short-info"> <span class="send-to">{{i18n "mbox/send_to"}}</span> <a href="javascript:void(0)">{{to}}</a> </span> </div> <div class="f-fr head-right"> {{#if @config.mail.enableVipMessage}} <span class="u-flag j-vip f-csp" data-mid="{{id}}"> {{#if flags.vip}} <i title="{{i18n \'mail/list_cancel_vip\'}}" class="iconfont iconstar vip"></i> {{^}} <i title="{{i18n \'mail/list_set_vip\'}}" class="iconfont iconstarline"></i> {{/if}} </span> {{/if}} {{#if config.enableMailFlagged}} <span class="u-flag j-flag f-csp" data-mid="{{id}}"> {{#if flags.flagged}} <i title="{{i18n \'mail/list_cancel_flag\'}}" class="flagged iconfont iconflatcolor label0-{{label0}}"></i> {{^}} <i title="{{i18n \'mail/list_set_flag\'}}" class="iconfont iconflat"></i> {{/if}} </span> {{/if}} {{#if config.enableDeferMail}} <span class="j-defer f-csp" data-mid="{{id}}" deferDate="{{defer}}"> {{#if flags.deferHandle}} <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="deferred state-icon icon-mDEFER"></i> {{^}} <i title="{{i18n \'mail/list_set_defer\'}}" class="iconfont iconclock"></i> {{/if}} </span> {{/if}} {{#if enableDealings}} <a class="dealings iconfont iconemailcontacts j-dealings" data-mid="{{id}}" href="javascript:void(0)" title=\'{{i18n "mbox/mail_dealings"}}\'></a> {{/if}} {{#if config.enableMailMemo}} <span class="j-memo-tip f-ib{{#unless memo}} f-dn{{/unless}}"><i class="iconfont iconremarks"></i></span> {{/if}} <a class="j-attach-wrap attach-icon f-dn j-view-attach" title="{{i18n \'mbox/mail_viewatta\'}}" href="javascript:void(0)"> <i class="iconfont iconacc"></i>(<span class="attach-desc j-attach-desc">{{countAttachment this}}</span>) </a> <span title=\'{{i18n "mail/sent_date"}}{{sentDate}}\'>{{sentDate}}</span> <a class="iconfont icondown" href="javascript:void(0)" data-type="toggleBrief"></a> </div> </div> <div class="grid-row full-info j-full-info f-dn"> <div class="grid-col12"> <table class="u-table u-table-row"> <tr> <td class="info-item">{{{i18n "mbox/mail_subject"}}} :</td> <td> {{if$ ctrls (translateSL ctrls.[CM-SECURITY])}} {{subject}} </td> </tr> <tr> <td class="info-item">{{i18n "mbox/mail_to"}} :</td> <td> {{#if partto}} <div class="j-contacts"> {{#each partto.contacts}} <span class="u-email u-email-tip" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} <span>.. <a href="javascript:void(0)" data-type="toggleContact">{{partto.stillContacts}}</a></span> </div> {{/if}} <div class="j-contacts {{#if partto}}f-dn{{/if}}"> {{#each to}} <span class="u-email u-email-tip" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} {{#if partto}} <span><a href="javascript:void(0)" data-type="toggleContact">{{i18n "mail/mail_hidemsg"}}</a></span> {{/if}} </div> </td> </tr> {{#if cc}} <tr> <td class="info-item">{{{i18n "mbox/mail_cc"}}} :</td> <td> {{#if partcc}} <div class="j-contacts"> {{#each partcc.contacts}} <span class="u-email u-email-tip" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} <span>.. <a href="javascript:void(0)" data-type="toggleContact">{{partcc.stillContacts}}</a></span> </div> {{/if}} <div class="j-contacts {{#if partcc}}f-dn{{/if}}"> {{#each cc}} <span class="u-email u-email-tip" addr="{{hemail this \'addr\'}}" data-true-name="{{hemail this \'name\'}}"> <span class="name">{{hemail this \'nameOnly\'}}</span> <span class="address">{{hemail this \'addrWithQuote\'}}</span> </span> {{#unless @last}} <span class="divider">,</span> {{/unless}} {{/each}} {{#if partcc}} <span><a href="javascript:void(0)" data-type="toggleContact">{{i18n "mail/mail_hidemsg"}}</a></span> {{/if}} </div> </td> </tr> {{/if}} <tr class="j-attach-wrap j-full-attach-wrapper f-dn"></tr> {{#if config.enableMailMemo}} <tr class="{{#unless memo}}f-dn{{/unless}} j-mail-memo"> <td class="info-item">{{i18n "mail/memo"}} :</td> <td class="j-memo-box"></td> </tr> {{/if}} </table> </div> </div> </div> <div id="readContent" class="mail-content-read j-content-read"> <div class="j-read-alert"></div> <div class="j-meeting-request meeting-request"></div> {{#if mailCipherEncrypted}} <div class="mail-cipher-encrypted j-mailCipherEncrypted" data-mid="{{mid}}"> {{#if mailCipherPassword}} <div class="decryption-success"> <span class="iconfont iconunlock"></span> {{i18n "mbox/read_mail_cipher_decrypted_tip"}} </div> {{^}} <div class="no-decryption"> <div class="lock-item"><span class="iconfont iconlock"></span></div> <div class="action-item"> <input type="password" placeholder=\'{{i18n "mail/read_mail_password_prompt"}}\' class="u-input" name="password" id="password" maxlength="6" /> </div> <div class="decryption-msg"> <span class="j-decryption-error decryption-error f-dn"></span> </div> <div class="action-item"> <span class="u-btn u-btn-primary j-decrypt-submit">{{i18n "main/bt_submit"}}</span> </div> <div class="label-item">{{{cipherEncryptedMsg}}}</div> <div class="label-item">{{i18n "mail/read_mail_cipher_encrypted_tip_1"}}</div> </div> {{/if}} </div> {{/if}} {{#if needToAudit}} <div class="mail-audit-action j-audit-action"> <span>{{i18n \'mail/lbl_auditTip\'}}</span> </div> <div class="mail-audit-info j-mail-audit-info"></div> {{/if}} <div class="mail-content{{#if calendar}} calendar{{/if}}"> </div> <div class="mail-attachments-wrap j-mail-attachments-wrap"></div> </div> <footer data-mid="{{mid}}" class="quick-reply j-quick-reply"> {{>quickReplyTpl}} <div class="j-toolbar-footer u-btns"> {{>auditBtn}}{{>deleteBtn}}{{>replyBtn}}{{>forwardBtn}}{{>moreBtn}} </div> </footer>'})},801:function(e,a,t){(function(e){t(802);var a=t(530),i=t(464),n=t(506).decimalInt,s=t(463),l=t(472),o=t(471),r=t(519),c=t(511),d=t(493),f=t(470),m=f.alert,p=f.confirm,u=t(465),v=t(483).encode,g=t(473).h,h=t(477),b=h.render,_=h.refresh,y=t(467),w=y.go,j=y.getUser,x=y.getCurrentState,k=y.getFolderLockedStatus,M=y.setCurrentState,C=t(468).get,T=t(476),S=t(474),D=t(805);o.module({name:'mail',template:D},l.extend({},(function(t,l){var f,h,y=this;y.events={'click button.j-mlsb:not(.disabled)[data-op]':[{inbox:P,compose:function(){C('mail.enablesendmail')?S.compose():m(u('compose/fa_forbidden'))}}]};var A,$=x(),E=j();function L(){var e=f?i.objBy(f.getNodesByFilter(i.fn('open')),'id'):C('mail.openFDR_OTHER')?{'-4':1}:0,t=function(a){return a&&a.map((function(a){var n=a.stats['unread'+(S.isExpandThreadMid(a.id)?'Thread':'Message')+'Count']||0,s=t(a.children);return i.assign({},a,{open:!!e[a.id],uCnt:[n,n+i.sumBy(s,'uCnt.1')],children:s})}))};f=a('ztMail',S.vdrTree,t,F,(function(e,a){if(-4!==e&&-6!==e&&-7!==e&&!/^@/.test(e)){if(h.fid=e,a.auth2Locked&&!k().isAuth)return d.box({}),!1;W('mail.'+(j().preview_layout?'previewlayout':'list'),{id:e,fid:e,tabTitle:a.name,init:!0})}}),H,{addDiyDom:O},{onExpand:U,onCollapse:U})}function F(){h.fid&&B(h.fid)}$.module='mail.'+($.param.view=$.param.view||(0===E.firstpage?'welcome':'list')),$=q($),'list'!==(h=$.param).view&&'previewlayout'!==h.view||(h.fid=n(h.fid,1)),M($),t()(l),z($),y.render(),C('mail.enablewebmailcompose')&&y.$('button.btn-compose').removeClass('disabled'),L(),e.wmCall('user:offSiteRemind').then((function(e){if(e&&e.isOffSite){var a=s(window).height(),t=s(window).width();s.extend(e,{enableSelfService:C('user.enableselfservice')}),new c({template:D.offSiteRemindTpl(e),width:360,height:235,align:{baseXY:[t-365,a]}}).show();var i=s('.j-offSideRemind');i.animate({top:a-240+'px'},1500),i.find('a').click((function(){w('logs')})),setTimeout((function(){i.animate({top:a+'px'},1500,(function(){s(this).fadeOut()}))}),4500)}})),y.subscribe('dispatcher','url:changed view:changed',(function(e){var a,t=e.message.newState,i=q(t),n=i.module,s=i.param;/mail(\.|$)/.test(n)&&('mail.list'===n||'mail.previewlayout'===n?B(s.fid):(a?f.cancelSelectedNode(f.getNodeByParam('id',a)):f.cancelSelectedNode(),delete h.fid),M(i),'url:changed'!==e.topic&&t===i||W(n,s))})),y.onMessage('view:change',(function(e){var a=e.message;W(a.module,a.param)})),y.onMessage('view:close',(function(e){var a=e.message||{},t=a.id,n=a.target,s=I.getRenderedTabs(),l=t&&t.test?i.mapFilter(s,'sid',(function(e){return t.test(e)})):[t],o=n&&i.mapFind(s,'sid',(function(e){return e.startsWith(n)}));l.forEach((function(e){I.close(e,!!o)})),o&&I.switchTo(o)})),y.onMessage('view:switchTo',(function(e){var a,t=e.message||{},i=I.getRenderedTabs();t.target&&(s.each(i,(function(e,i){0===i.sid.indexOf(t.target)&&(a=i.sid)})),a&&I.switchTo(a))})),y.onMessage('tab:change',(function(e){var a=e.message,t=a.id,i=a.title;I&&I.refreshTab(t||I.current().sid,i)})),y.subscribe('mail','fdr:changed',L),y.onMessage('cmd',(function(e){'inbox'===e.message&&P()})),A={'^in:open':function(e,a,t,i){W(a&&S.isExpandThreadMid(t)?'mail.thread':'mail.read',{id:e,rootid:a,mid:e,tabTitle:i,start:0,unread:!0,fid:t})},'^in':function(e,a,t){y.publish('arrival',{fid:t,id:e,rootid:a})},'view:active':function(){y.sendMessage('mail.'+I.current().id,'view:active')}},y.onMessage(Object.keys(A).join(' '),(function(a){var t,n=a.event,s=a.message;e.resolve(/^\^in/.test(n)&&(t=s.mid,S.getMessageInfos({ids:[t]}).then(i.prop(0))).then((function(e){return[e.id,e.rootid,s.fid,s.sub]}))).then((function(e){A[n].apply(0,e||[])}))})),y.before('destroy',(function(){I.destroy(),f.destroy()}));var R,I=new r(i.assign((R=Y(h.view,h)[0],{tabs:(R.replaceId||'').includes('list')?[R]:[Y()[0],R],activeTabId:R.id}),{element:'article.mltabview',classPrefix:'mltabview',activeTriggerClass:'z-current',closeTriggerClass:'close',manageType:'close',generateTriggerMarkup:function(e,a){var t,i=s('<li>',{'data-trigger':e.sid,'class':a,title:e.title});i.append(s('<span>',{'class':'bar'})),t=s('<div>',{'class':'tab-body'}).appendTo(i),0===e.sid.indexOf('compose')&&t.append(s('<a>',{'class':'iconfont iconcreate create'}));t.append(s('<a>',{href:'javascript:void(0)',text:e.title,'trigger-title':'','class':0===e.sid.indexOf('compose')?'compose':''})),e.isDefault||t.append(s('<span>',{'class':'iconfont icontabclose close',title:u('main/bt_close')}));return i}})).on('render',(function(e){var a=x();a.param.vid=e,z(a)})).on('refresh',(function(e){var a=e.split(':')[0];'compose'===a||'read'===a||'thread'===a?y.sendMessage('mail.'+e,'view:active',{vid:e}):y.sendMessage('mail.'+a,'view:active',{}),_('mail.'+a,{vid:e})}));function q(e){var a,t=j();return'mail.list'===e.module&&t.preview_layout?a='previewlayout':'mail.previewlayout'!==e.module||t.preview_layout||(a='list'),a?{module:'mail.'+a,param:i.assign({},e.param,{view:a})}:e}function z(e){var a=e.module,t=e.param,n=j(),s=a.split('.')[1],l=t.vid;if(s){switch(s){case'welcome':t={};break;case'compose':t={id:t.id};break;case'list':t={fid:t.fid||t.id};break;case'previewlayout':t={fid:t.fid||t.id,layout:n.preview_layout};break;case'read':case'thread':t=i.pick(t,['fid','mid','mboxa','start']);break;case'search':t=S.makeSearchCondition(t)}t.vid=l,b(a,t)}}function P(){var a=S.getCacheFolder(1),t=j();e.wmCall('user:syncAutoSyncPOPAccounts').either((function(){S.flush(),W(t.preview_layout?'mail.previewlayout':'mail.list',{id:1,fid:1,title:a.name,tabTitle:a.name})}))}function U(e,a,t){t=t||e,y.$('#'+t.tId+'_span .unread').text(t.uCnt[t.open?0:1]||'')}function O(e,a){var t=a.id,i=a.tId,n=a.name,l=a.level,o=s('<span class="unread '+(1===t?'unread-inbox skin-primary-bg':'')+'"/>'),r=y.$('#'+i+'_a').find('#'+i+'_ico').before(y.$('#'+i+'_switch').css({marginLeft:12*l+12})).next().attr('fid',t).data('fid',t).width(y.$('.mlsidebar').width()-10-16-(12*l+12)).html([o,s('<div class=cnt>').html(N(a)+v(n))]).hover((function(){return function(e,a,t,i,n){var l,o,r,c,f=t.stats?t.stats.messageCount:0;if(t.isPop)return(c=e.find('.j-checkPOP')).length>0?c.show():(c=s('<i />',{'class':'j-checkPOP iconfont icondownload'}).off('click').on('click',(function(e){e.stopPropagation(),w('setting.advance.pop',{id:t.popId,action:'sync'})})),e.append(c)),void i.hide();switch(a){case-1:(o=e.find('.j-setting')).length>0?o.show():(o=s('<i />',{'class':'j-setting iconfont iconset'}).off('click').click((function(e){e.stopPropagation(),w('setting.filter.vip')})),e.append(o)),i.hide();break;case-4:l=e.find('.j-add'),o=e.find('.j-setting'),l.length>0&&o.length>0&&(l.show(),o.show()),0===o.length&&(o=s('<i />',{'class':'j-setting iconfont iconset',title:u('main/tip_set')}).off('click').click((function(e){e.stopPropagation(),w('setting.folder.folder')})),e.append(o)),0===l.length&&(l=s('<i />',{'class':'j-add iconfont iconadd',title:u('main/tip_add')}).off('click').click((function(e){e.stopPropagation(),w('setting.folder.folder',{panel:'create'})})),e.append(l)),i.hide();break;case-6:(o=e.find('.j-mbox-set')).length>0&&o.show(),0===o.length&&(o=s('<i />',{'class':'j-mbox-set iconfont iconset',title:u('main/tip_set')}).off('click').click((function(e){e.stopPropagation(),w('setting.advance.mboxshare')})),e.append(o)),i.hide();break;case 4:if(r=e.find('.j-trash'),!f)return r.hide(),!1;r.length>0?r.show():(r=s('<i />',{'class':'j-trash iconfont iconrecover',title:u('main/act_empty')}).off('click').on('click',(function(e){e.stopPropagation(),m()})),e.append(r)),i.hide()}function m(){t.auth2Locked&&!k().isAuth?d.box({successCb:m}):p(g(u('main/confirm_clean'),n),(function(){T.doEmptyFolder(a).then(S.flush)}))}}(r,t,a,o,n)}),(function(){return function(e,a){e.find('.iconfont').hide(),a.show()}(r,o)}));U(a)}function N(e){var a=k(),t=j(),i=(e.id+'').indexOf('@')>=0;if(a.lockedDefined&&!i){if(e.auth2Locked)return a.isAuth?'<i class="iconfont iconunlock"></i>':'<i class="iconfont iconlock"></i>';if(!1===e.auth2Locked||s.inArray(e.id+'',t.sec_folder)>-1)return'<i class="iconfont iconunlock"></i>'}return''}function B(e){h.fid=e,a.select(f,e)}function H(e,a){for(;a;a=a.getParentNode())U(a)}function W(e,a){var t=(/^mail(\.(\w+)|$)/.exec(e)||[])[2],n=I&&t?Y(t,a):[],s=n[0],l=n[1];if(s){var o=s.id,r={module:l,param:i.assign(a,{tabId:o})};if(o!==I.current().sid&&!I.switchTo(o))return void s.module.load((function(){M(r),I.addTab(s)}));y.sendMessage(l,'view:refresh',['list'].includes(t)?a:r)}}function Y(e,a){e=e||'welcome';var t=a||{},n=t.id,s=t.fid,l=t.mid,r=t.rootid,c=t.tabTitle;s=null!=s?s:n,l=n||l;var d=S.getCacheFolder(s).name,f={welcome:[,u('main/Home'),'list*|previewlayout',{}],list:[s,d,'list*|previewlayout*|welcome',{}],previewlayout:[s,d,'previewlayout*|list*|welcome',{}],search:[,u('main/mail_search')],read:[l,u('mail/empty_subject')],thread:[r||l],compose:[n,u('compose/lb_compose')],entrustmanager:[,u('main/Maillist')]}[e],m=f[0],p=f[1],v=f[2],g=f[3],h='mail.'+e;return[i.assign({id:m||0===m?e+':'+m:e,title:c||p||' ',module:o.module(h)},g||{isDefault:!1},{},v?{replaceId:v}:i.pick(a,['replaceId'])),h]}I.on('switched closed',(function(){var e=I.getRenderedLength()>1;y.$('.j-mltab').toggle(e),y.$('.j-mlcnt').toggleClass('multiple',e)})).render()})))}).call(this,t(466))},805:function(e,a,t){e.exports=t(469)('<section class="m-mail"> <aside class="mlsidebar"> <div class="mlsidebar-bg"></div> <div class="u-btns"> <button class="u-btn u-btn-default u-btn-large btn-compose j-mlsb disabled" type="button" data-op="compose"><i class="iconfont iconcreate"></i> <span class="title">{{i18n "main/mbt_compose"}}</span></button> <button class="u-btn u-btn-default u-btn-large btn-inbox j-mlsb" type="button" data-op="inbox" title="{{i18n \'main/mbt_inbox\'}}"><i class="iconfont iconinbox"></i></button> </div> <div class="wrapper u-scroll"> <ul class=ztree id=ztMail></ul> </div> </aside> <article class="mlmain mltabview"> <div class="u-tab u-tab-seamless u-tab-highlight j-mltab"> <ul class="mltabview-nav"></ul> </div> <div class="mltabview-content j-mlcnt"></div> </article> </section>',{offSiteRemindTpl:'<div class="u-box u-box-remind j-offSideRemind"> <div class="u-box-head"> <h3 class="u-box-head-title">{{i18n "main/offSiteRemind_title"}}</h3> </div> <div class="u-box-container"> <div class="u-info1"> <div class=\'title\'>{{i18n "main/offSiteRemind_lastLogin"}}</div> <div> <div class=\'detail\'>{{lastDate}} &nbsp;&nbsp;&nbsp;<span title="{{lastArea}}&nbsp;{{lastIP}}">{{lastArea}}</span></div> </div> <div class=\'title\'>{{i18n "main/offSiteRemind_currentLogin"}}</div> <div> <div class=\'detail\'>{{currentDate}} &nbsp;&nbsp;&nbsp;<span title="{{currentArea}}&nbsp;{{currentIP}}">{{currentArea}}</span></div> </div> </div> <div class=\'u-info2\'> {{i18n "main/offSiteRemind_content"}}{{#if enableSelfService}}<a href="javascript:void(0);">{{i18n "main/offSiteRemind_historyLink"}}</a>{{/if}} </div> </div> </div>'})},806:function(e,a,t){(function(e,a,i){t(807);var n=t(463),s=t(472),l=t(471),o=t(808),r=t(467),c=t(468).get,d=t(812),f=t(474),m=t(470).confirm,p=t(493),u=t(476),v=s.extend({},(function(){var s,l=this;function v(){var t=l.$('.j-header');e.when(d.getGreetings(),d.getLastLoginInfo(),d.getMboxInfo(),f.autoReplyOn()).then((function(e,s,o,c){var v,h=c[0],b=c[1];t.html(g.abstractTpl(a.assign({greetings:e},s,{},o,{lastLoginDate:s.lastLoginDate&&s.lastLoginDate.replace('Invalid date',''),autoReplyWelcomeTip:b&&g.autorepTpl(),enableAutoReply:h}))),b&&((v=l.$('.panel-autorep')).find('.j-close').click((function(){v.hide()})),v.find('a').click((function(){r.updateUser({autorepmode:0}).then((function(){l.sendMessage('setting.delivery.autoreply','view:change',{}),v.hide(),n.notify(i('main/auto_reply_close_success'))}))}))),r.getUserAvatar().then((function(e){t.find('.j-avatar').attr('src',e)})),o.canEmptyFolders.length&&l.$('.j-empty-btn').click((function(e){var a=n(e.target).data(),t=a.fid,s=a.name;function l(){m(i('main/confirm_clean').replace('{0}',s),(function(){u.doEmptyFolder(t).then(f.flush)}))}a.auth2locked&&!r.getFolderLockedStatus().isAuth?p.box({successCb:l}):l()})),d.getWeather().then((function(e){t.find('.panel-cnt').eq(0).append(g.weathertpl(e))}))}))}function h(){var e=l.$('.j-slide'),a=e.find('.j-slide-trigger').length,t=e.data('slideSize'),i=e.width(),n=e.height();!s||t&&t.width===i&&t.height===n||(s.set('triggerViewSize',[i/a,4]),s.set('panelViewSize',[i,n]),e.data('slideSize',{width:i,height:n}))}l.events={'click .container [data-trigger]':[function(e){if('mail.unread'===e){var a=f.makeSearchCondition({id:f.getFoldersMap().unread,read:!1});a.vid='search',t(477).go('mail.search',a)}else r.go(e)}]},l.after('render',(function(){var a;v(),a=l.$('.j-main'),e.resolve(c('user.enableBulletins')?d.getBulletins():[]).fin((function(e,t){var i,r;e&&t[0]?(a.prepend(g.bulletinsTpl(t)),t.length>1&&(i=t.length,r=l.$('.j-slide'),s=new o({element:'.j-slide',classPrefix:'u-slide',effect:'scrollx',triggerViewSize:[r.width()/i,4],panelViewSize:[r.width(),r.height()]}),n(window).off('resize.welcome').on('resize.welcome',h),setTimeout(h,500))):a.find('.j-features').addClass('z-expand')})),l.onMessage('slide:refresh',h),l.onMessage('view:refresh view:active',v),l.subscribe('mail','fdr:changed',v)})).before('destroy',(function(){s&&s.destroy(),n(window).off('resize.welcome')}))})),g=t(813);l.module({name:'mail.welcome',template:g},v)}).call(this,t(466),t(464),t(465))},808:function(e,a,t){var i=t(543);e.exports=i.extend({attrs:{autoplay:!0,circular:!0}})},812:function(e,a,t){(function(a){var i=t(479),n=t(468).get,s=t(467).getUser,l=t(474),o=t(465),r=t(466),c=t(478),d=t(473),f=t(475),m=t(488).bytesToSize,p=t(485);var u=function(e,t){return e?a.assign(e,{type:t,subject:e.subject||e.title}):[]};e.exports={getGreetings:function(){var e,a,t=s(),n=i(),l=60*n.hours()+n.minutes(),r=[300,570,720,810,1080,1380];return r[0]<l&&l<=r[1]?e=o('main/greet_0930'):r[1]<l&&l<=r[2]?e=o('main/greet_1200'):r[2]<l&&l<=r[3]?e=o('main/greet_1330'):r[3]<l&&l<=r[4]?e=o('main/greet_1800'):r[4]<l&&l<=r[5]?e=o('main/greet_2300'):(r[5]<l||l<=r[0])&&(e=o('main/greet_0500')),a=t.true_name||f.parseTrueName(t.email)||f.parseAddress(t.email),e=d(e,a)},getLastLoginInfo:function(){var e=i(n('user.lastdate'),'YYYY-MM-DD HH:mm:ss',c.localeMM()),a=e.format('LLLLLTS').replace(e.format('LT'),'');return{lastLoginDate:d(o('main/last_login_date'),a),lastLoginIP:n('user.lastip')||''}},getMboxInfo:function(){var e=l.getFoldersMap(),a={};return l.fdrList().then((function(t){var i=0,l=s().display_list?'unreadThreadCount':'unreadMessageCount',r=n('setting.messagesize'),c=n('setting.limitmessagesize'),f=n('setting.messagecount'),p=n('setting.limitmessagecount'),u=n('setting.archivemessagecount'),v=n('setting.archivemessagesize'),g=n('setting.archivelitequota');return t.forEach((function(a){a.id!==e.trash&&a.stats&&(i+=a.stats[l]||0)})),a.unreadMessageCount=i,r=r?parseInt(r,10):0,c=c?parseInt(c,10):1,a.messageSize=m(r,2),a.limitMessageSize=m(c,2),a.messageSizePercent=Math.round(r/c*100),f=f?parseInt(f,10):0,p=p?parseInt(p,10):1,a.messageCount=f,a.limitMessageCount=p,a.messageCountPercent=Math.round(f/p*100),a.canEmptyFolders=[],a.messageSizePercent>=100?a.warningMessageSize=o('main/mbox_warn_hquota'):a.messageSizePercent>=80&&(a.warningMessageSize=o('main/mbox_warn_squota'),t.forEach((function(t){[e.trash,e.junk,e.virus].includes(t.id)&&t.stats.messageCount>0&&a.canEmptyFolders.push(t)}))),a.supportArchiveLite=!1,a.supportArchiveLite&&(u=u?parseInt(u,10):0,v=v?parseInt(v,10):0,g=g?parseInt(g,10):1,a.archiveMessageCountInfo=d(o('main/al_stats_info'),u),a.archiveMessageSize=m(v,2),a.archiveLiteQuota=m(g,2),a.archiveMessageSizePercent=Math.round(v/g*100)/100,a.archiveMessageSizePercent>=100?a.warningArchiveMessageSize=o('main/arch_warn_hquota'):a.archiveMessageSizePercent>=80&&(a.warningArchiveMessageSize=d(o('main/arch_warn_squota'),o('main/arch_warn_clean')))),a}))},getBulletins:function(){return r.when(r.wmCall('global:getWelcomePageBulletin'),r.wmCall('global:getWelcomePageEmbedExternalColumn')).then((function(e,a){return[].concat(u(e[0],'bulletin')).concat(u(a[0],'external'))}))},getWeather:function(){var e=p.getItem('location',!0)||'';return r.wmCall({url:'/XT5/jsp/mail.jsp',func:'getWeather',location:e}).then((function(e){var a,t,i,n;return n=(t=(a=e.weather.results[0]).weather_data[0]).dayPictureUrl.substring(t.dayPictureUrl.lastIndexOf('/')+1),n=c.stylePath('img/weather/'+n),i=a.currentCity,t.pictureUrl=n,t.currentCity=i,p.setItem('location',e.location,432e5,!0),t})).ignoreCode('FA_NORESULT')}}}).call(this,t(464))},813:function(e,a,t){e.exports=t(469)('<div class="m-mlwelcome"> <div class="container"> <div class="header j-header"></div> <div class="main j-main">{{> featuresTpl}}</div> </div> <div class="footer small text-gray">{{{i18n "main/copyright"}}}</div> </div>',{autorepTpl:'<span class="close iconfont icondelword j-close"></span> {{{i18n "common/welcome_auto_reply_tip"}}}',abstractTpl:'<div class="panel-sbj"><div class="tag skin-primary-bg"></div>{{greetings}}</div> {{#if autoReplyWelcomeTip}} <div class="panel-autorep u-alert u-alert-warning">{{{autoReplyWelcomeTip}}}</div> {{/if}} <div class="panel-cnt"> <div class="abstract"> <div class="avatar"> <a href="javascript:void(0);" class="u-img u-img-round"> <img alt="avatar" class="j-avatar"> </a> </div> <div class="info"> <ul class="u-list u-list-horizontal j-link-trigger"> <li> <span class="headings">{{i18n "main/mbox_main_title"}}:</span> {{#if unreadMessageCount}} <a href="javascript:void(0);" class="link" data-trigger="mail.unread"><span class="mark">{{unreadMessageCount}}</span> {{i18n "mbox/unread_message_count"}}</a> {{/if}} {{#if enableAutoReply}} <span class="notify">{{i18n "mail/msg_autoreply_on"}}</span> <a href="javascript:void(0);" class="link" data-trigger="setting.delivery.autoreply"> <span class="link">{{i18n "common/op_set"}}</span></a> {{/if}} </li> </ul> <ul class="u-list u-list-horizontal"> <li> <span>{{i18n "main/mbox_capacity_size_total"}}: </span> <div class="u-progress u-progress-success"> <div class="u-progress-bar" style="width: {{messageSizePercent}}%;"></div> </div> <span class="text-success">{{messageSize}} / {{limitMessageSize}}</span> </li> <li> <a href="javascript:void(0);" class="link" data-trigger="setting.folder.folder">{{i18n "main/mbox_mng"}}</a> </li> {{#if warningMessageSize}} <li><a href="javascript:void(0);" class="link text-error">{{warningMessageSize}}</a></li> {{/if}} {{#each canEmptyFolders}} <li> <a href="javascript:void(0);" class="link j-empty-btn" data-fid="{{id}}" data-name="{{name}}" data-auth2locked="{{auth2Locked}}">{{i18n \'main/act_empty\'}}{{name}}</a> </li> {{/each}} </ul> <ul class="u-list u-list-horizontal"> <li> <span>{{i18n "main/mbox_message_size"}}: </span> <div class="u-progress u-progress-success"> <div class="u-progress-bar" style="width: {{messageCountPercent}}%;"></div> </div> <span class="text-success">{{i18n "prop:main/mbox_message_count" 0=messageCount}} / {{i18n "prop:main/mbox_message_count" 0=limitMessageCount}}</span> </li> <li> <a href="javascript:void(0);" class="link" data-trigger="setting.folder.folder">{{i18n "main/mbox_mng"}}</a> </li> {{#if (ge messageCountPercent 80)}} <li><a href="javascript:void(0);" class="link text-error">{{i18n "prop:main/mbox_warn_count" 0=(join messageCountPercent "%")}}</a></li> {{/if}} </ul> <ul class="u-list u-list-horizontal"> <li>{{lastLoginDate}}</li> <li>{{lastLoginIP}}</li> {{#if @config.user.enableselfservice}} <li><a href="javascript:void(0);" data-trigger="logs.login">{{i18n "main/ip_detail"}}</a></li> {{/if}} </ul> {{#if supportArchiveLite}} <ul class="u-list u-list-horizontal"> <li>{{i18n "main/mbox_main_title"}}: {{archiveMessageCountInfo}}</li> <li><a href="javascript:void(0);" class="link">{{i18n "main/al_save_email"}}</a></li> <li><a href="javascript:void(0);" class="link">{{i18n "main/al_mail_search"}}</a></li> <li>|</li> <li> <span>{{i18n "main/arch_capacity_size_total"}}: </span> <div class="u-progress u-progress-error"> <div class="u-progress-bar" style="width: {{archiveMessageSizePercent}}%;"></div> </div> <span class="text-success">{{archiveMessageSize}} / {{archiveLiteQuota}}</span> </li> {{#if warningArchiveMessageSize}} <li><a href="javascript:void(0);" class="link text-error">{{warningArchiveMessageSize}}</a></li> {{/if}} </ul> {{/if}} </div> </div> </div>',weathertpl:'<div class="weather"> <div class="weadesc"> <div class="temp">{{temperature}}</div> <span>{{weather}}/{{wind}}</span> <span class="place">{{currentCity}}</span> </div> <div class="weaimg"> <img src="{{pictureUrl}}" alt="weather" /> </div> </div>',bulletintpl:'<div class="panel-sbj"> <div class="tag skin-primary-bg"></div>{{subject}} <div class="date">{{date}}</div> </div> <div class="panel-cnt"> {{#if (eq type "bulletin")}} {{#if text}} <div class="content f-pre">{{text}}</div> {{^}} <div class="content">{{{html}}}</div> {{/if}} {{/if}} {{#if (eq type "external")}} <div class="content f-oh"> <iframe src="{{url}}" frameborder="0"></iframe> </div> {{/if}} {{#if (eq type "news")}} <div class="content"> <ul class="u-list u-list-img"> {{#each news}} <li> <div class="u-img u-img-border"> <img src="{{url}}" alt=""> </div> <div class="u-img-text"> <div class="u-img-date">{{date}}</div> <a href="javascript:void(0);" class="u-img-title">{{subject}}</a> <div class="u-img-desc">{{content}}</div> </div> </li> {{/each}} </ul> </div> {{/if}} </div>',bulletinsTpl:'<div class="bulletins"> {{#if (gt length 1)}} <div class="u-slide j-slide"> <ul class="u-slide-content" data-role="content"> {{#each this}} <li class="u-slide-panel">{{> bulletintpl}}</li> {{/each}} </ul> <ul class="u-slide-nav" data-role="nav"> {{#each this}} <li class="u-slide-trigger j-slide-trigger"></li> {{/each}} </ul> </div> {{^}} {{#each this}}{{> bulletintpl}}{{/each}} {{/if}} </div>',featuresTpl:'<div class="features j-features"> <div class="panel-sbj"> <div class="tag skin-primary-bg"></div> {{i18n "main/h2_news_title"}} </div> <div class="panel-cnt"> <ul class="u-list u-list-img"> {{#if @config.user.enableselfservice}} <li> <div class="u-img icon-feature icon-check"></div> <div class="u-img-text"> <a href="javascript:void(0);" class="u-img-title" data-trigger="logs">{{i18n "main/h2_news_self_service"}}</a> <div class="u-img-desc">{{{i18n "main/h2_news_self_service_tip_featured"}}}</div> </div> </li> {{/if}} {{#if @config.file.ispermittrs}} <li> <div class="u-img icon-feature icon-file"></div> <div class="u-img-text"> <a href="javascript:void(0);" class="u-img-title" data-trigger="file.transitcenter">{{i18n "main/h2_news_ts"}}</a> <div class="u-img-desc">{{{i18n "main/h2_news_ts_tip_featured"}}}</div> </div> </li> {{/if}} {{#if @config.calendar.enable}} <li> <div class="u-img icon-feature icon-schedule"></div> <div class="u-img-text"> <a href="javascript:void(0);" class="u-img-title" data-trigger="calendar">{{i18n "main/h2_news_calendar"}}</a> <div class="u-img-desc">{{{i18n "main/h2_news_calendar_tip"}}}</div> </div> </li> {{/if}} <li> <div class="u-img icon-feature icon-lock"></div> <div class="u-img-text"> <a href="javascript:void(0);" class="u-img-title" data-trigger="setting.security.auth2lock">{{i18n "main/h2_news_key"}}</a> <div class="u-img-desc">{{{i18n "main/h2_news_key_tip"}}}</div> </div> </li> </ul> {{#if @config.user.enableqrcode}} <div class="app"> <p>{{{i18n "main/h2_news_lunkr_promotion"}}}</p> <img src="https://lunkr.cn/res/qrcode/lunkr/200.png" alt="qrcode"> <div class="img-text"> <a href="https://lunkr.cn/dl?p=mail" target="_blank"> <span class="iconfont iconwindows"></span> PC </a> <a href="https://lunkr.cn/dl?p=ios" target="_blank"> <span class="iconfont iconapple"></span> iPhone </a> <a href="https://lunkr.cn/dl?p=android" target="_blank"> <span class="iconfont iconanroid"></span> Android </a> </div> </div> {{/if}} </div> </div>'})},814:function(e,a,t){(function(e){t(625);var a=t(530),i=t(464),n=t(463),s=t(489),l=s['default'],o=s.rcUncheck,r=t(515),c=t(471),d=t(465),f=t(482),m=t(542),p=t(473),u=t(483).encode,v=t(490).getUrlParamValue,g=t(493),h=t(531),b=t(544),_=t(477).go,y=t(467),w=t(504),j=t(476),x=t(474),k=t(487).patchNameOfEmail,M=t(626).extend({},(function(s,c){var M,T,S,D,A,$=this,E=y.getUser(),L=0;$.getCachedMails=function(){return A};var F={};$.events({'click .j-mail-totals a[data-action]':[function(e,a){var t=/(\w*):(.*)/.exec(e);switch(e=t[1],a=t[2],e){case'view':G.trigger('mail:view',a);break;case'mark':'allread'===a&&x.markUnreadMails({fid:q}).then((function(){n.notify.success(d('mail/msg_mark_all_unread_success')),ee({start:0})}),n.notify.error.bind(null,d('mail/msg_mark_all_unread_failed'))),'alldone'===a&&le({limit:-1,filter:{defer:':1'},filterFlags:x.flags2('defer')}).then((function(e){G.mark('defer',i.map(e,'id'))}))}}],'mousedown .j-mail':[function(e,t,i){var s,l,r,c=a('ztMail'),f=i.clientX,m=i.clientY,p=n('iframe'),u=p.contents(),v=u.add(document);if(n(i.target).closest('.defer,.j-mark,.mail-check,.check-col,.flag-defer,.j-subtract-prefix-subject')[0])return;1===i.which&&v.mousemove(g).mouseup((function b(e){var a=n(e.target);if(v.off('mousemove',g).off('mouseup',b),l){var i=h(a)[0];i?G.moveTo(i):r.click(),n('#ztMail a[treenode_a]').removeClass('disabled'),l.remove()}else!function(e){var a,t,i=A,s=e.attr('mid'),l=i.findIndex((function(e){return e.id===s})),o=i[l];if(!o)return!1;if(l+=F.start,$.$('.j-mail').removeClass('active'),e.addClass('active'),2===q)$._editDraft(o,z,e);else{if(a=P()&&o.threadMessageCount>=2?'mail.thread':'mail.read',E.newwindowtoreadletter)return window.open(y.detachURL(a,{mid:s,fid:q,mboxa:z,start:l})),!1;t=n.extend(!0,{fid:q,id:s,mid:s,unread:e.hasClass('unread'),tabTitle:o.subject,pView:'list',mboxa:z,rootid:o.rootid},F,{start:l}),'mail.read'===a&&$._params.defaultAccount&&n.extend(t,{defaultAccount:$._params.defaultAccount}),E.preview_layout?$.sendMessage('mail.previewlayout','reset',{module:a,param:t}):$.sendMessage('mail','view:change',{module:a,param:t})}}(t)}));function g(e){var i,v,g=n(e.target);if(l){var b=(i=g[0],v=u.has(i),v[0]&&p.eq(v.index(u))||n('<p>')).offset();l.css({left:e.clientX+2+b.left,top:e.clientY+2+b.top});var _=h(g),y=_[0],w=_[1];if(w[0]){w.children('a[treenode_a]').toggleClass('disabled',!y);var j=c.getNodeByTId(w.attr('id'));s&&s.is(w)||(a.expand(c,j),s&&s.children('a[treenode_a]').removeClass('disabled'),s=w)}}else{if(Math.sqrt(Math.pow(e.clientX-f,2)+Math.pow(e.clientY-m,2))<10)return;r=t.find('.check-col:not(:has(:checked))').click();var x=$.handleSelect('count'),k=d('mail/list_moving_'+(P()?'thread':'mail')+(x>1?'_multi':''),{len:x});l=n('<div class=u-mf-mail><div class=u-mouse-follow>'+k+'</div></div>').width(t.width()).append(t.clone().removeClass('selected').toggleClass('multiple',x>1)).appendTo($.$('.j-mail-list:last')),o(l.find(':checkbox')),l.find('.active-border').remove(),l.find('.f-pr').removeClass('f-pr')}}function h(e){var a=e.closest('[treenode]'),t=a[0]?G.validFid(a.find('span[id$=_span]').attr('fid')):[],i=t[0];return[!t[1]&&i,a]}}],'click .j-subtract-prefix-subject[data-subject]':[function(e,a,t){i.stop(t,0),a.closest('.subject').html(''+e)}],'click .j-listtt[data-id]':[function(e,a){var t=$.$('div[toggle-list="'+e+'"]');t.animate({height:'toggle'},{duration:200,complete:function(){var e=t.is(':visible');a.children('.iconfont').toggleClass('iconunfold',!e).toggleClass('iconcollapse',e)}})}],'click .j-select-group':[function(e,a,t){i.stop(t),$.handleSelect('item',a.closest('.j-mail-group-wrap').find('.j-mail input:checkbox'))}]}),$.state=y.getCurrentState();var R=m($.state.param),I=R[0],q=R[1],z=R[2],P=x.isExpandThreadMid.bind(0,I);i.assign($.state.param,{id:I,fid:q,mboxa:z}),$._params={};var U=t(545)($);s()(c);var O=c.toolbar||$.$('.j-toolbar'),N=c.autoForwardTip||$.$('div.j-autoforward'),B=c.autoReplyTip||$.$('div.j-autoreply'),H=c.commonTip||$.$('div.j-common-tip'),W=$.$('.j-module-content'),Y=$.$('.j-maillist'),V=$.$('.j-nlist');function Q(){if(U.enableSendMail){var a=(''+I+q).includes('@')||j.popAccounts.get((function(e){return e.some((function(e){return e.fid===q&&($._params.defaultAccount=e.username)}))}));e.when(a,x.autoReplyOn()).then((function(e,a){var t=a[0];e?N.hide():x.getAutoForwardInfo().then((function(e){!n.isEmptyObject(e)&&e.forwardList.length&&(N.show().html(C.autoforwardtpl({forwardEmail:u(e.forwardList.join(','))})),N.on('click','a',(function(){2===n(this).index()?j.setPrefOpHistoryRecord(e.recordItems).then((function(){N.hide()})):_(0===n(this).index()?'setting.filter.letter':'setting.delivery.forward')})),N.find('.j-close').on('click',(function(){N.hide()})))})),t&&!w.getInt('autoreply_notify',0)?(B.show().html(C.autoreplytpl()),B.on('click','a',(function(){1===n(this).index()&&_('setting.delivery.autoreply')})),B.find('.j-close').on('click',(function(){w.set('autoreply_notify',0),B.hide()}))):B.hide()}))}}function J(){var e=F.action,a=$.$('.j-mail-totals'),t=x.getCacheFolder(I).stats,i='all'===e,n=t&&i?P()?t.threadCount:t.messageCount:L,s=t&&i?C.listStatusTpl({count:P()?t.unreadThreadCount:t.unreadMessageCount,className:-5===q?'today-deferred-mail':'unread-mail',operations:-5===q?C.deferredStatusTpl():C.unreadStatusTpl({operable:!z})}):Z(e);a.html(C.mailtotaltpl({name:M,count:n,listStatus:s})).toggle(!(i&&!L||$.handleSelect('count'))).toggleClass('user-fs12',!!E.list_style)}function X(e){M=x.getCacheFolder(I).name,$.sendMessage('mail','tab:change',{id:'list:'+I,title:M||' '}),e?e.init?(ee({start:0,order:'receivedDate',desc:!0,action:'all',filterFlags:{},filter:{}}),H.show()):ee(e):ae()}function K(){$.pubsub.off()}$.after('render',(function(){var e;Q(),X({init:!0}),Y.off('click.check-col').on('click.check-col','.check-col',(function(a){var t,i,s,l,o=n(this);if(a.shiftKey&&e&&(t=e.closest('.j-mail').attr('index')),/checkbox/g.test(a.target.className)||o.find('.checkbox').trigger('click.crc'),l=o.closest('.j-mail'),o.hasClass('checkbox-checked')||o.find('.checkbox-checked').length>0){if($.handleSelect('item:checked',l.attr('mid')),i=o.closest('.j-mail').attr('index'),(t=t||-1)>=0)if(s=i,i>t)for(;s>t;)$.handleSelect('item:check',l),l=l.prev(),s--;else for(;s<t;)$.handleSelect('item:check',l),l=l.next(),s++;else o.closest('.j-mail').addClass('selected');e=o}else $.handleSelect('item:unchecked',l.attr('mid')),l.removeClass('selected'),e=null})),G.trigger('mail:select',$.state.param.selectAll?'all':'check')}));var G=$.toolbar=(O.html(C.toolbartpl({config:U})),-5===q?O.find('div.j-viewbtns').hide():O.find('[data-btn="defer:setComp"]').hide(),4===q&&O.find('[data-btn="delete"]').html(d('common/op_realdelete')),new b($,O,ee,F));function Z(e){return d('mail/list_nomail_'+e.replace(/:/g,'_'))}function ee(e){i.assign(F,i.pick(e,['start','action','filter','filterFlags']),{order:T=e.order||T,desc:S=null!=e.desc?!!e.desc:S}),$._params.start=F.start,n.notify.loading(),$.$().mask(),A?(A=null,K(),x.flush().then(ae)):ae()}function ae(){var a;a=E.preview_layout,x.getFolder(q).then((function(e){var t,i;if(1===q){var n=(x.getCacheFolder(i=-5).stats||{}).unreadMessageCount;t=n&&d('mail/hint_message_defer',{count:n})}else if(4===q||5===q||6===q){var s=e.keepPeriod;t=s>=0&&d(s?'mbox/hint_message_lifeTime':'mbox/hint_message_no_lifeTime',{count:s,folder:v('?'+d('mbox/hint_message_type'),q)})}H.html(t?C.tipsTpl({message:t}):'').find('.j-close').click(H.hide.bind(H)),i&&H.find('a').click((function(){return _(a?'mail.previewlayout':'mail.list',{fid:i})}))})),K(),le(F).then((function(a,t){L=t.total,x.formatMails(a,q),function(a){var t,s=F.start,o=F.action,c='receivedDate'===T&&S;A&&L||$.handleSelect('clean'),V.toggle(!L),J(),function(){var e=F.start||0,a=e?e/D:0,t=n('<div class=mllist-pagination-content />');W.find('.mllist-pagination').remove(),L&&W.append(n('<div class=mllist-pagination />').html(t)),L&&t.pagination({total:L,limit:D,currentPage:a,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,menuAlignCenter:!0,callback:function(e){G._params.action='pagination',ee({start:e*D})}})}(),L?(2===q?e.resolve():k()).then((function(e){t=e,A?function(){var e,t=function(e,a){a=a.map((function(e,t){return i.assign({},e,{beforeId:(a[t-1]||{}).id})}));var t=i.objBy(a,'id'),n=i.groupBy(e,(function(e){var a=e.id;return t[a]?1:0}),[[],[]]),s=n[0],l=n[1],o=[],c=[];return a.forEach((function(e,a){var t=l[a-o.length],n=function(e){return x.groupMailList([e],q)[0].id};if(t&&t.id===e.id&&n(t)===n(e)){var d=['threadMessageCount','flags','priority','label0','memo','defer'];r(i.pick(t,d),i.pick(e,d))||c.push(e)}else{var f=l.findIndex((function(a){return a.id===e.id}));f>=0&&(s.push(e),l.splice(f,1)),o.push(e)}})),[i.map(s,'id'),o,c]}(A,A=a),n=t[0],l=t[1],o=t[2],d=function(e){e.find('.j-listtt .j-group-length').text(e.find('.j-mail').length)};function f(e,a){return y(e,(function(e,t){var i=t.beforeId;i&&a.find('.j-mail[mid="'+i+'"]')[0]?a.find('.j-mail[mid="'+i+'"]').after(e):ne(a).prepend(e)})),d(a),a}n.forEach((function(e){var a=Y.find('.j-mail[mid="'+e+'"]'),t=$.state.param.selectAll;$.handleSelect('item:uncheck',a),$.state.param.selectAll=t;var i=a.closest('.j-mail-group-wrap');a.remove(),c&&!i.find('.j-mail')[0]?i.remove():d(i)})),c?x.groupMailList(l,q).forEach((function(a){var t=Y.find('.j-mail-group-wrap[data-group-id="'+a.id+'"]');t[0]||(t=ie(a),e?e.after(t):Y.prepend(t)),f(a.list,t),e=t[0]?t:e})):Y.prepend(f(l,ie()));y(o,(function(e,a){var t=Y.find('.j-mail[mid="'+a.id+'"]');e.toggleClass('selected',t.hasClass('selected')).toggleClass('active',t.hasClass('active')).find('input[type=checkbox]').rcCheck(t.find('input[type=checkbox]').is(':checked')),t.replaceWith(e)})),!Y.find('.j-mail')[0]&&s/D+1>Math.ceil(L/D)&&ee({start:s>0?s-D:0})}():(Y.empty(),Y.append((c?x.groupMailList(a,q):[{}]).map((function(e){var t=ie(e);return ne(t).append(y(e.list||a)),t}))),A=a,W.scrollTop(0)),te()})):(Y.empty(),'all'===o?(b=d(g='mail/empty_message_v_'+q),b=g===b?'':b,-1===q&&(b=d('mail/msg_vip'),m=d('mail/msg_vip_link'),v='setting.filter.vip'),V.html(C.nlisttpl({name:M,message:b,link:m})).find('.link').click((function(){_(v)}))):function(e){var a=p(d('mail/list_nomail'),[u(M),'<span class="mark">'+Z(e)+'</span>']);V.html(C.nslisttpl({desc:a})).find('a').click((function(e){i.stop(e),G.trigger('mail:refresh')}))}(o),A=a,te());var m,v,g,b;function y(e,a){return e.map((function(e,s){e.index=s,e.formattedOutput=function(e){var a=e.subject,t=e.subjectPrefixFormatted,i=e.ctrls,n=[];U.enableSecurityLevel&&i&&n.push(f.tag(i['CM-SECURITY']));a?t&&t.isSubtract?(n.push(u(t.prefixes)),n.push('<b class="j-subtract-prefix-subject subtract-prefix-subject" data-subject="'+u(a)+'">... </b>'),n.push(u(t.right))):n.push(u(a)):n.push(d('mail/empty_subject'));return{subject:n.join('')}}(e);var o=function(e,a){var t=F.filterFlags,s=!1;P()&&t&&'flagged'in t&&t.flagged&&'label0'in t&&(s=t.label0+'');e.contactList.forEach((function(e){e.trueName=(a?a(e):e).friendlyName()}));var o=n(C.listItemTpl(i.assign({},e,{_meta:{layoutType2:2===E.preview_layout,list_style:E.list_style,displaySummary:se(),label0Filter:s,config:U}})));l(o),$._ContactCards(o.find('.j-from, .j-to'),{pointPos:'20%'}),$._memos(o,[e.id,e.memo]),U.enableDeferMail&&h(G,e.id,{trigger:o.find('.j-defer'),deferDate:e.defer});return o}(e,t);return a&&a(o,e),o}))}}(a)})).catchCode('FA_NEED_AUTH2',(function(){g.box({successCb:ae})})).fin((function(){!function(){if(K(),$.onMessage('view:refresh',(function(e){X(e.message)})).onMessage('view:active',x.flush).subscribe('mail','changed',i.ary(X,0)),$.onMessage('notify:refresh',Q),$.onMessage('cmd',(function(e){var a=e.message;G.mailOp(a)})),t(481).IE){var e=0;W.off('scroll').on('scroll',(function(){e=W.scrollTop()})),$.subscribe('dispatcher','view:changed',(function(a){var t=a.message,i=t.newState,n=t.oldState;'mail.list'===i.module&&'mail.list'!==n.module&&W.scrollTop(e)}))}}(),n.notify.loading('hide'),$.$().mask('hide')}))}function te(){G.show(L,D)}$.updateSelectCountTip=function(e){J(),$.$('.j-select-count').toggle(!!e).toggleClass('user-fs12',!!E.list_style).find('.j-desc').html(d('mail/list_select_count',{count:e}))};var ie=function(e){return n(C.listGroupTpl(i.assign({list_style:E.list_style,displaySummary:se()},e)))},ne=function(e){return e.find('.j-mail-list'+(se()?'':' tbody'))},se=function(){return U.enableListBriefText&&E.list_brief_text};function le(e){return x.list(i.assign({limit:D=E.maxlist},e,{mboxa:z,fid:q}))}})),C=t(627).helpers({translateSL:function(e){return f.tag(e).trim()}});c.module({name:'mail.list',template:C},M)}).call(this,t(466))},815:function(e,a,t){e.exports=t(469)('',{dialogTpl:'<div id="deferDialogTpl" class="defer-dialog"> <div class="recent"> {{#each dayLang}} <div class="j-item item"> <label> <input type=radio name=defer value="{{@index}}" {{if$ (eq ../days @index) \'checked\'}}> {{this}} </label> </div> {{/each}} </div> <div class="j-item other"> <label> <input type=radio name=defer value="" {{if$ other \'checked\'}}> <input class=u-input name=other value="{{other}}" placeholder=\'{{i18n "mail/defer_date_hint"}}\'> </label> </div> </div>',tipTpl:'<div id="mailDeferTip" class="defer-memo-content"> <div> {{{i18n "mail/defer_msg_1" date=deferDate}}}{{if$ overdue (i18n \'mail/defer_msg_2\')}} <a href="javascript:void(0)" class="j-defer-op" data-action="edit"> {{i18n \'mail/defer_mod_link\'}} </a> </div> <div class="defer-memo-foot"> <span class="u-btn u-btn-primary j-defer-op" data-action="complete">{{i18n \'mail/deferCompleted\'}}</span> </div> </div>'})},817:function(e,a,t){e.exports=t(469)('',{reportTemplate:'<div class="report-dialog j-report"> <div class="spamType"> {{i18n "mail/msg_report_as"}}: <select name="spamType" id="spamType"> <option value="0">{{i18n "mail/msg_report_as_spam"}}</option> <option value="1">{{i18n "mail/msg_report_as_illegal"}}</option> <option value="2">{{i18n "mail/msg_report_as_other"}}</option> </select> </div> <div class="add"> <label> <input type="checkbox" name="addToRefuseList" id="addToRefuseList"/> {{i18n "mail/msg_report_add_refuselist"}} </label> </div> <div class="add">{{i18n "mail/msg_add_to_refuselist_tips"}}</div> </div>',notJunkTemplate:'<div class="notJunk-dialog j-notJunk"> <div class="move">{{i18n "mail/msg_notjunk_move"}}</div> <div class="add"> <label> <input type="checkbox" name="addToWhiteList" id="addToWhiteList"/> {{i18n "mail/msg_notjunk_add_whitelist"}} </label> </div> </div>',filterTemplate:'<div class="filter-dialog j-filter f-cf"> <div class="filter-item">{{i18n "common/mail_fast_filter_tip"}}</div> <div class="filter-item"> <label class="filter-label">{{i18n "mbox/mail_from"}} :</label> <span class="f-wwb ">{{from}}</span> </div> <div class="filter-item"> <label class="filter-label" for="folder">{{i18n "common/op_move"}} :</label> <select id="folder" name="folder"> {{fdrOptions mail=1 new=\'newFolder\'}} </select> </div> <div class="filter-item create-folder f-dn"> <label class="filter-label" for="folderName">{{i18n "common/folder_name"}} :</label> <input type="text" class="u-input" id="folderName" name="folderName" /> </div> <div class="filter-item create-folder f-dn"> <label class="filter-label" for="folderParent">{{i18n "common/position"}} :</label> <select id="folderParent" name="folderParent" > <optgroup data-max-options="6"> {{fdrOptions nest=1}} </optgroup> </select> </div> <div class="filter-rules f-cf"> <input type="checkbox" name="toAllEmails" id="toAllEmails"/><label for="toAllEmails">{{i18n "common/to_all_emails"}}</label> </div> <div class="filter-item"> {{#if detachMode}} {{i18n "common/detach_create_new_filter"}} {{else}} {{i18n "common/create_new_filter"}}<a class="hyperlinks j-filter-page" href="javascript:void(0)">{{i18n "common/create_new_filter_URL"}}</a> {{/if}} </div> </div>',addToRefuselistDetails:'{{#if refuseList}} <dl> <dt>{{i18n "mail/add_to_refuselist_succ"}}</dt> {{#each refuseList}} <dd>{{this}}</dd> {{/each}} </dl> {{/if}} {{#if whiteList}} <dl> <dt>{{i18n "mail/add_to_whitelist_succ"}}</dt> {{#each whiteList}} <dd>{{this}}</dd> {{/each}} </dl> {{/if}} {{#if existRefuseList}} <dl> <dt>{{i18n "mail/add_to_list_fail_reason_0"}}</dt> {{#each existRefuseList}} <dd>{{this}}</dd> {{/each}} </dl> {{/if}} {{#if existSafeList}} <dl> <dt>{{i18n "mail/add_to_list_fail_reason_1"}}</dt> {{#each existSafeList}} <dd>{{this}}</dd> {{/each}} </dl> {{/if}} {{#if existUserEmails}} <dl> <dt>{{i18n "mail/add_to_list_fail_reason_2"}}</dt> {{#each existUserEmails}} <dd>{{this}}</dd> {{/each}} </dl> {{/if}}',settingTemplate:'<div class="setting-menu j-setting-menu"> {{#if previewLayout}} <div class="setting-item f-cf"> <label>{{i18n "common/op_layout"}}</label> <div class="u-btns layout-btns f-fr"> <span class="u-btn u-btn-default{{if$ (not user.preview_layout) \' u-btn-primary\'}}" data-action="preview_layout:0"> {{i18n "common/op_layout_default"}} </span> <span class="u-btn u-btn-default{{if$ (eq user.preview_layout 1) \' u-btn-primary\'}}" data-action="preview_layout:1"> {{i18n "common/op_layout_ud"}} </span> <span class="u-btn u-btn-default{{if$ (eq user.preview_layout 2) \' u-btn-primary\'}}" data-action="preview_layout:2"> {{i18n "common/op_layout_lr"}} </span> </div> </div> {{/if}} <div class="setting-item f-cf"> <label>{{i18n "common/op_lineheight"}}</label> <div class="u-btns list-style-btns f-fr"> <span class="u-btn u-btn-default{{if$ (eq user.list_style 0) \' u-btn-primary\'}}" data-action="list_style:0"> {{i18n "common/op_lineheight_default"}} </span> <span class="u-btn u-btn-default{{if$ (eq user.list_style 1) \' u-btn-primary\'}}" data-action="list_style:1"> {{i18n "common/op_lineheight_compact"}} </span> </div> </div> <div class="setting-item group-bottom f-cf"> <label>{{i18n "common/op_maxlist"}}</label> <div class="u-btns max-list-btns f-fr"> <span class="u-btn u-btn-default{{if$ (eq user.maxlist 10) \' u-btn-primary\'}}" data-action="maxlist:10">10</span> <span class="u-btn u-btn-default{{if$ (eq user.maxlist 20) \' u-btn-primary\'}}" data-action="maxlist:20">20</span> <span class="u-btn u-btn-default{{if$ (eq user.maxlist 50) \' u-btn-primary\'}}" data-action="maxlist:50">50</span> <span class="u-btn u-btn-default{{if$ (eq user.maxlist 100) \' u-btn-primary\'}}" data-action="maxlist:100">100</span> </div> </div> <div class="setting-item group-top f-cf"> <label>{{i18n "common/op_size"}}</label> <span class="f-fr"> <input type="checkbox" name="display_size" role="switchBtn" class="checkbox j-switch-btn"{{if$ user.display_size \' checked\'}} /> </span> </div> {{#if enableListBriefText}} <div class="setting-item f-cf"> <label>{{i18n "common/op_summary"}}</label> <span class="f-fr"> <input type="checkbox" name="list_brief_text" role="switchBtn" class="checkbox j-switch-btn"{{if$ user.list_brief_text \' checked\'}} /> </span> </div> {{/if}} {{#if displayList}} <div class="setting-item f-cf"> <label>{{i18n "common/op_session"}}</label> <span class="f-fr"> <input type="checkbox" name="display_list" role="switchBtn" class="checkbox j-switch-btn"{{if$ user.display_list \' checked\'}} /> </span> </div> {{/if}} {{#if (not @global.CM.detachMode)}} <div class="more-setting" data-action="moresetting"> <label class="setting-item">{{i18n "common/op_moresetting"}}</label> </div> {{/if}} </div>'})},818:function(e,a,t){(function(a){var t=Symbol();e.exports=function(e,i){var n=this,s=l.bind(0,'.j-maillist .j-mail');function l(e,t){n.$(e).each((function(){var e=a(this),i=e.attr('mid'),n=t(e,i);n&&n(e,i)}))}var o=n[t]||(n[t]=new Set),r=o.has.bind(o),c=o.add.bind(o),d=o['delete'].bind(o),f=[!0,!1].map((function(e){return function(a){(a=(a.is('.j-mail')?a.find('input:checkbox'):a).rcCheck(e)).closest('.j-mail').toggleClass('selected',e),(e?c:d)(a.val())}})),m=f[0],p=f[1];function u(){return Math.max(+o.__total__||0,o.size)}if('count'===e)return u();var v=n.state.param||{},g=n.toolbar;switch('all'===e?(o.__total__=i,v.selectAll=!0):('clean'!==e&&'reset'!==e&&(delete o.__total__,v.selectAll=!1),g&&('clean'!==e||v.selectAll&&'pagination'===g._params.action||(g.resetSelect(),'clean'===e&&(delete o.__total__,v.selectAll=!1)),'item:checked'!==e&&'item:unchecked'!==e||g.resetSelect())),e){case'item:check':l(i,m);break;case'item:uncheck':l(i,p);break;case'item':l(i,i.not(':checked')[0]?m:p);break;case'item:checked':c(i);break;case'item:unchecked':d(i);break;case'all':case'current':s(m);break;case'unread':case'read':s((function(a){return a.hasClass(e)?m:p}));break;case'reset':s((function(e,a){return r(a)?m:p}));break;case'inverse':s((function(e,a){return r(a)?p:m}));break;case'none':case'clean':s(p),o.clear()}n.updateSelectCountTip(u()),n.toolbar&&n.toolbar.trigger('mail:select','check')}}).call(this,t(463))},823:function(e,a,t){(function(e,a,i){t(625),t(824);var n=t(471),s=t(483).encode,l=t(531),o=t(544),r=t(467),c=r.getCurrentState,d=r.getUser,f=t(474),m=t(825),p=t(626).extend({},(function(){var n,r=this;r.events({'click .j-subtract-prefix-subject[data-subject]':[function(e,t,i){a.stop(i),t.closest('span').html(u(e,p.pattern))}],'click .j-mail':[function(e){var t=r._params,i=e.attr('mid'),n=t.mboxa||'',s=f.cachedSearchMails(),l=a.map(s,'id').indexOf(i),o=s[l];o.flags.draft?r._editDraft(o,n,e):r.sendMessage('mail','view:change',{module:'mail.read',param:{mboxa:n,mid:i,tabTitle:o.subject,pView:'search',condition:t,start:l+t.start}})},e],'click .j-multi-select':[function(e){y(e.closest('.j-box-info'),!0)},e]});var p={},g=function(t){a.reassign(p,t.param),r._params=e.extend(!0,{},p)};g(r.state=c());var h=t(545)(r),b={};function _(){r.pubsub.off()}function y(e,a){a||e.find('.j-cdt-select input').rcUncheck(),e.toggleClass('toggled-multi-select',a)}function w(e,a){var t=e.find('.j-cdt .j-list-more');a=a||!!t.has('input:checked')[0],t.toggle(a),e.find('[data-action=more]').toggle(!a)}function j(t){var i=d().maxlist;!0===t&&r.$().empty(),t&&r.handleSelect('clean'),t=a.assign({},a.assign(r._params,t),{limit:i,refresh:!0,expandFrom:!!p.fromType&&!b.fromAddress}),e.notify.loading(),h.exec(),_(),m(t).then((function(t){var s,o=t[0],c=t[1],d=t[2];c?(x(o,c,i,d),(s=r.$('div.j-maillist')).customRadioCheckbox(),s.find('.j-content').off('click.check-col').on('click.check-col','.check-col',(function(a){a.stopPropagation();var t=e(this),i=t.find('input[type=checkbox]'),n=t.find('i.checkbox');/checkbox/g.test(a.target.className)||n.trigger('click.crc');var s=n.hasClass('checkbox-checked');r.handleSelect(s?'item:checked':'item:unchecked',i.val()),t.closest('tr').toggleClass('mail-selected',s)})),r.handleSelect('reset'),n.trigger('mail:select',p.selectAll?'all':'check'),r._memos(r.$(),(function(e){return[e.closest('.j-mail').attr('mid'),e.data('memo')]})),h.enableDeferMail&&r.$('.j-defer').each((function(){var a=e(this),t=a.closest('tr');l(n,t.attr('mid'),{trigger:a,deferDate:t.attr('deferDate')})}))):a.isEmpty(b)?r.$().html(M(!0)):x(o,c,i,d)})).fin((function(){_(),r.onMessage('view:refresh',(function(e){var a=e.from,t=e.message;t&&(/^mail\.read:/.test(a)||'mail'===a&&g(t)),j(!!t)})).subscribe('mail','changed',a.fun(j)),e.notify.loading('hide')}))}function x(t,i,s,l){for(var o=d(),c={conditions:!a.isEmpty(b)&&b,groupings:l,total:i,list:t,pattern:p.pattern,displaySummary:h.enableListBriefText&&o.list_brief_text&&p.pattern,list_style:o.list_style,config:h},f=v.asideTpl(c)+(i?v.listTpl(c):M());!r.$('.j-maillist').html(f)[0];)r.$().html(v.toolbarTpl(h)+v.containerTpl()),k();n.show(i,s),function(a,t){var i=r.$('.j-maillist .j-content'),s=e('<div>',{'class':'mllist-pagination'}),l=r._params.start||0,o=l?l/t:0;s.html('<div class="mllist-pagination-bg"></div><div class="mllist-pagination-content"></div>'),i.append(s),s.find('.mllist-pagination-content').pagination({total:a,limit:t,currentPage:o,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,menuAlignCenter:!0,callback:function(e){n&&(n._params.action='pagination'),j({start:e*t})}})}(i,s),function(){function t(e,a,t){b[e]=a,r._params[e]=t,j({start:0})}r.$('ul.j-cdt').on('click','a',a.stop((function(a){var i=e(a.delegateTarget).data().type,n=e(this).data(),s=n.action,l=n.name,o=n.val;'more'!==s?e(this).closest('.u-box-info').hasClass('toggled-multi-select')?e(this).prev('.j-cdt-select').find('.checkbox').click():t(i,l,({flagType:['flagged','noflagged'],attachType:['attached','noAttach']}[i]||0)[o?0:1]||o):w(e(this).closest('.j-box-info'),!0)}))),r.$('.j-group-toggle').click((function(){var a=e(this);if(a.closest('.j-multi-select')[0])return!1;!function(e){var a=e.find('.iconfont'),t=e.find('.j-box-container'),i=a.toggleClass('iconup').toggleClass('icondown').hasClass('iconup');t[i?'slideUp':'slideDown'](),i&&w(e)}(a.closest('.j-box-info'))})),r.$('div.j-cdt-btns span').click((function(){var i=e(this).index(),n=e(this).closest('.j-box-info');if(1===i)y(n,!1),w(n);else{var s=e(this).data().target,l=a.map(r.$('ul[data-type="'+s+'"] li:has(:checked) a'),(function(a){return e(a).data()}));if(l[0]){var o=a.map(l,'val');t(s,a.map(l,'name').join(', '),o.join(','))}}})),r.$('.j-cdtselected i').click(a.stop((function(){var a=e(this).closest('li').data().type;delete b[a],a in p?r._params[a]=p[a]||'':delete r._params[a],j({start:0})})))}(),r._ContactCards(r.$('.j-from, .j-to'),{pointPos:'20%'})}function k(){n&&n.destroy(),n=r.toolbar=new o(r,r.$('.j-toolbar'),j)}function M(e){return v.nTpl({desc:C(),showTip:e})}function C(){var e=r._params,t=f.makeSearchCondition(e),n={},l=[],o=function(e,a){return a&&l.push(i(e).replace(/__desc__|$/,'<span class="mark">"'+s(a)+'"</span>'))};o('mail/search_content_contains',t.pattern),o('mail/search_subject_contains',t.subject);var c=(t.fid&&f.getCacheFolder(t.fid)||{}).name;n.fid=o('mail/search_advance_fid',c),n.fromAddress=o('mail/search_advance_from',t.fromAddress||t.from),o('mail/search_advance_to',t.to);var d=(t.sentDate||'').replace(/ 23:59:59$/,'').split(':').map((function(e){return e&&i.get('mbox/date_option_'+e,e)})),m=d[0],p=d[1];if(m||p){var u=m&&p?i('mail/search_advance_sentDate_fromto',{from:m,to:p}):''===p?i('mail/search_advance_sentDate_from',{from:m}):p?i('mail/search_advance_sentDate_to',{to:p}):m;o('mail/search_advance_sentDate',u)}if(t.flagType)switch(t.flagType){case'flagged':o('',i('mbox/flagged_option_true'));break;case'noflagged':o('',i('mbox/flagged_option_false'));break;default:if(0===t.flagType.indexOf('label0:')){var v=t.flagType.split(':');o('mail/search_advance_flag',i('mbox/flagged_option_color'+v[1]))}}if(t.priority&&(n.priority=o('mail/search_advance_priority',i('mbox/grouping_priority_'+t.priority))),t.size)switch(t.size){case'0:102400':o('mail/search_advance_size',i('mbox/mail_size_1'));break;case'102400:10485760':o('mail/search_advance_size',i('mbox/mail_size_2'));break;case'10485760':o('mail/search_advance_size',i('mbox/mail_size_3'))}return a.iter(b,(function(e,a){var t={fromAddress:'mail/search_advance_from',fid:'mail/search_advance_fid',receivedDate:'mail/search_advance_date',priority:'mail/search_advance_priority'}[a];t&&!n[a]&&o(t,e)})),l.join(', ')}r.after('render',(function(){j(!0)})),r.updateSelectCountTip=function(e){r.$('.j-listtt').toggleClass('f-dn',!!e),r.$('.j-select-count').toggleClass('f-dn',!e).find('.j-desc').html(i('mail/list_select_count',{count:e}))}})),u=function(e,a){return a?s(e).replace(new RegExp(s(a),'gi'),(function(e){return['<span class="subject-highlight">',e,'</span>'].join('')})):s(e)},v=t(826).config({helpers:{highlightSubject:u},partials:a.pick(t(627),['fromtoTpl','mailtotaltpl'])});n.module({name:'mail.search',template:v},p)}).call(this,t(463),t(464),t(465))},825:function(e,a,t){(function(a){var i=t(465),n=t(475),s=t(473),l=t(474);e.exports=function(e){return l.searchMails(e).then((function(e,a){var t=a.mboxa,i=a.total,n=a.groupings;return n=o(n||0,s),l.formatMails(e),e.forEach((function(e){e.contactList.forEach((function(e){e.trueName=e.friendlyName()})),e.folderName=s(e.fid,e)})),[e,i,n];function s(e,a){return e+=t||'',a&&/@/.test(e)&&(a.fid=e),l.getCacheFolder(e).name}}))};var o=function(e,t){return a.mapFilter({fromAddress:[,function(e){return{name:n.of(e).friendlyName(),emailAddr:n.of(e).address}},'from_address'],fid:[,function(e){return{name:t(e)}}],receivedDate:[,'sentDate_{0}_','send_date'],priority:[,'priority_{0}'],attachType:['flags.attached','attached_{0}'],read:['flags.read','read_{0}'],flagType:['flags.flagged','flagged_{0}']},(function(t,n){var l=t[0],o=t[1],r=t[2],c=a.isFUN(o)?o:function(e){return{name:i('mbox/grouping_'+s(o,e))}},d=a.mapFilter(e[l||n],(function(e){return e.cnt&&a.assign({},e,{},c(e.val))}));return d[0]&&{type:n,name:i('mbox/grouping_'+(r||(l||n).replace('.','_'))),list:d}}))}}).call(this,t(464))},826:function(e,a,t){e.exports=t(469)('<div class="m-mlsearch m-mllist"></div>',{toolbarTpl:'<div class="m-mllist-row"> <div class="j-module-top"> <div class="toolbar j-toolbar"> <div class="u-btns" data-dropdown="select"> <span class="u-btn u-btn-default j-selectmail"> <input type="checkbox" name="checkAll" /> <span class="iconfont icondown"></span> </span> </div> <div class="f-ib j-tgbtns"> {{#if enableDelete}} <span class="u-btn u-btn-default" data-btn=delete disabled>{{i18n "common/op_delete"}}</span> {{/if}} <div class="u-btns"> {{#if enableUpdateMailStatus}} {{#if enableMoveTo}} <span class="u-btn u-btn-default" data-dropdown="move" disabled>{{i18n "common/op_move"}} <span class="iconfont icondown"></span></span> {{/if}} <span class="u-btn u-btn-default" data-dropdown="mark" disabled>{{i18n "common/op_mark"}} <span class="iconfont icondown"></span></span> {{/if}} {{#if enableSendMail}} <span class="u-btn u-btn-default" data-dropdown="more" disabled>{{i18n "common/op_more"}} <span class="iconfont icondown"></span></span> {{/if}} </div> </div> <span class="u-btn u-btn-default u-btn-round f-fr j-setting"><i class="iconfont iconset"></i></span> <div id="pagination" class="f-fr"></div> </div> </div> </div>',containerTpl:'<div class="m-mllist-row mllist-list-row"> <div class="list-bg"></div> <div class="j-maillist mllist-list u-scroll"></div> </div>',listTpl:'<div class="ctr-content j-content"> <div class="mail-totals j-listtt"> {{> mailtotaltpl name=(i18n \'mail/search_result\') count=total}} </div> <div class="j-select-count select-count f-dn"> <span class="j-desc desc"></span> <a class="j-cancel cancel" href="javascript:void(0);">{{i18n "common/cancel"}}</a> </div> <div class="list-body"> <table class="u-table j-mail-list{{#if list_style}} user-fs12{{/if}}"> <tbody> {{#each list}} <tr class="j-mail{{#if flags.read}} read{{^}} unread{{/if}}{{#if flags.flagged}} flagged label0-{{label0}}{{/if}}{{#and ../displaySummary summary}} display-summary{{/and}}" mid="{{id}}" {{#if flags.deferHandle}}deferDate="{{defer}}"{{/if}} > <td class="active-border"></td> <td class="check-col"><input type="checkbox" name="mid" data-draft="{{flags.draft}}" value="{{id}}" from="{{from}}"/></td> <td class="ico"><i class="iconfont {{icon}}"></i><i class="iconfont {{priorityIcon}}"></i></td> <td class="{{displayType}}"> {{> fromtoTpl}} </td> <td class="mark-icons {{#if ../config.enableMailFlagged}}j-mark{{/if}}">{{#if ../config.enableMailFlagged}}<i class="iconfont{{#if flags.flagged}} iconflatcolor{{^}} iconflat{{/if}}"></i>{{/if}}</td> <td class="subject"> <span class="text-gray f-fwn">[{{folderName}}]</span> {{#if memo}}<span class="j-memo-tip" data-memo="{{memo}}"><i class="iconfont iconremarks"></i></span>{{/if}} <span title="{{#if subject}}{{subject}}{{^}}{{i18n \'mail/empty_subject\'}}{{/if}}"> {{#unless subject}} {{i18n "mail/empty_subject"}} {{^}} {{#if subjectPrefixFormatted.isSubtract}} {{{ highlightSubject subjectPrefixFormatted.prefixes ../pattern }}} <b class="j-subtract-prefix-subject subtract-prefix-subject" data-subject="{{subject}}">... </b> {{{ highlightSubject subjectPrefixFormatted.right ../pattern }}} {{^}} {{{ highlightSubject subject ../pattern }}} {{/if}} {{/unless}} </span> {{#and ../displaySummary summary}}<div class="summary highlight f-ellipsis ">{{{summary}}}</div>{{/and}} </td> <td class="defer"> {{#if ../config.enableDeferMail}} {{#if flags.deferHandle}} <i title="{{i18n \'prop:mail/list_handle_defer\' 0=defer}}" class="j-defer state-icon icon-mDEFER"></i> {{^}} <i title="{{i18n \'mail/list_set_defer\'}}" class="j-defer iconfont iconclock"></i> {{/if}} {{/if}} </td> <td class="attach"><i class="iconfont{{#if flags.attached}} iconacc{{/if}}"></i></td> <td class="time">{{formatReceivedDate}}</td> {{#if display_size}}<td class="size">{{display_size}}</td>{{/if}} </tr> {{/each}} </tbody> </table> </div> </div>',asideTpl:'<div class="ctr-aside j-aside"> <div class="u-box"> <div class="u-box-head"> <h3 class="u-box-head-title">{{i18n "mail/groupings_title" count=total}}</h3> </div> <div class="u-box-container"> {{#if conditions}} <div class="u-box-content"> <ul class="u-list z-selected j-cdtselected"> {{#each conditions}} <li data-type="{{@key}}"> <a class=f-csp title="{{.}}">{{.}}</a> <i class="iconfont icontabclose"></i> </li> {{/each}} </ul> </div> {{/if}} {{#each groupings}} <div class="u-box u-box-info j-box-info"> {{#in type \'fromAddress,fid\'}} <div class="u-box-multi-select j-multi-select"> <span>+{{i18n \'common/multi_select\'}}</span> </div> {{/in}} <div class="u-box-head j-group-toggle"> <h3 class="u-box-head-title"><i class="iconfont icondown"></i> {{name}}</h3> </div> <div class="u-box-container j-box-container"> <div class="u-box-content"> <ul class="u-list j-cdt" data-type="{{type}}"> {{#each list}} <li class="{{#if (gt @index 4)}}f-dn j-list-more{{/if}}"> <div class="u-box-checkbox j-cdt-select" data-index="{{@index}}"><input type=checkbox></div> <a class=f-csp title="{{or emailAddr name}} ({{cnt}})" data-action="search" data-name="{{name}}" data-val="{{val}}"> {{name}} ({{cnt}}) </a> </li> {{#if (eq @index 5)}} <li class="u-box-more"><a data-action="more" class=f-csp>{{i18n "mbox/grouping_more"}}</a></li> {{/if}} {{/each}} </ul> <div class="u-box-select-btns j-cdt-btns"> <span class="u-btn u-btn-primary" data-target="{{type}}">{{i18n \'common/confirm\'}}</span> <span class="u-btn u-btn-default">{{i18n \'common/cancel\'}}</span> </div> </div> </div> </div> {{/each}} </div> </div> </div>',nTpl:'<div class="nlist"> <div class="h3">{{{i18n "mail/search_result_empty" desc=desc}}}</div> {{#if showTip}} <div>{{i18n "mail/search_tip"}}</div> <ul class="u-list"> <li>1. {{i18n "mail/search_change"}}</li> <li>2. {{i18n "mail/search_advance"}}</li> </ul> {{/if}} </div>'})},827:function(e,a,t){t(628);var i=t(464),n=t(463),s=t(471),l=t(466),o=t(465),r=t(475),c=t(485),d=t(473),f=t(483).encode,m=t(493),p=t(531),u=t(470),v=u.alert,g=u.confirm,h=t(578),b=t(479),_=t(544),y=t(504),w=t(477).go,j=t(467),x=t(474),k=t(487).patchNameOfEmail,M=t(579),C=t(629),T=t(635),S=C.extend({},(function(e,a){var s,u=this;u.events({'click :not(.disabled)[data-btn]':[Q],'click .j-mail-top a[data-type]':[Q],'click .j-decrypt-submit':function(){var e={id:A,part:S.part,autoName:!0,password:u.$('#password').val(),mboxa:$};u.$('#password').val()?M.decryptMessage(e,u.$('.j-decryption-error')).then((function(){S.mailCipherPassword=e.password,R()})):u.$('.j-decryption-error').html(o('mbox/read_mail_err_password_empty')).show()},'click .j-auto-del-state-refresh':i.stop(R,0)}),e()(a);var C,S=u.state.param,A=S.id,$=S.mboxa,E='mail.'+(S.pView||'list'),L=[],F={};function R(){u.load((u.config.checkCookie?l.resolve():j.generateSidCookie()).then(q.bind(0,U)))}u._params={fromView:E,mail:F,defaultAccount:S.defaultAccount},u.$().attr('mid',A),u.after('render',R),u.before('destroy',(function(){u.$().remove(),u.Smime&&u.Smime.attachments&&c.removeItem('caAttachments_'+A)}));var I=function(e){u._rerender(L,F,e)};var q=u.initPrevAndNext=function(e){return i.assign(u._params,S),u._prevNext(e&&F).then((function(a,s){if(L=a,C=s,e)return function(){var e={mid:A,mboxa:$,part:S.part,mailCipherPassword:S.mailCipherPassword||''};F.id=A,F.config=u.config,S.supportSMIME&&(F.supportSMIME=!0,e.supportSMIME=!0);return M.readMessage(e).then((function(e){i.assign(F,e,{isIE:t(481).IE,mid:A,start:S.start,sid:j.getSid(),mboxa:$});var a=F.rclStatus,s=F.recallable;if(u.updateAuditMail(F),F.flags.read||x.flush(),F.config.supportSMIME&&F.sMimeServerEncrypted&&(F.isDecodeMail=F.smimeStatus>=200,F.smimeAttachs=F.smimeStatus<200),F.config.supportSMIME&&F.sMimeClientEncrypted&&(F.isDecodeMail=!1),z()||u.sendMessage('mail','tab:change',{title:F.subject||o('mail/empty_subject')}),F.isSent=3===F.fid,F.isSent){F.recallMail={enableRecallMail:!1};var l=(F.composeExtra||0).autoDel;u.config.supportRecallMail&&s&&!l&&(F.recallMail.enableRecallMail=!0,F.rclStatus>0&&(F.recallMail.disabledRecall=!0),F.recallMail.message=o(1===a||2===a?'common/op_recalling':3===a||4===a||5===a?'common/op_recalled':'common/op_recall')),F.autoDelMail=l&&function(e){var a=F.to.concat(F.cc,F.bcc).map((function(a){var t=(a=r.of(a)).address;return i.assign({name:a.friendlyName(),addr:t},x.autoDelStat(e,t))}));return i.assign({expired:!i.some(a,'remain'),details:a},e)}(l)}F.mailCipherEncrypted&&(F.cipherEncryptedMsg=o('mbox/read_mail_cipher_encrypted_tip').replace('{0}','<span class="highlight ">"'+(f(r.parseTrueName(n.isArray(F.from)?F.from[0]:F.from))||F.from)+'"</span>')),F.previewLayout=z()})).catchCode('FA_NEED_AUTH2',(function(){m.box({successCb:R,cancelCb:i.noop}),l.abort()}))}().then(e);P()}))};function z(){return!!n('#previewLayoutRead').has(u.$())[0]}u.mail=function(e){if(A===e)return F};var P=u._initToolbar=function(){W(),s&&s.destroy(),s=u.toolbar=new _(u,u.$('.j-toolbar, .j-toolbar-footer'),I).show(C,1)};function U(){var e,a,t,l;x.formatTop(F),u.$('.j-module-content').html(D.maintpl(F,u)),G(K()),t=F.headers,l=u.$('.j-read-alert'),(e=t['Resent-From']&&t['Resent-From'][0]||'').length>0&&(a=b(t['Resent-Date']),l.append(D.directforwardtpl({from:e,time:a.format('ll')+' '+a.format('HH:mm:ss')},u)),l.on('click','span[data-action=close]',(function(){l.slideUp()}))),function(){var e=u.config.mailFlaggedColorCount,a=x.getMailMenu('flag-color'),t=x.getMailMenu('flag-labels').slice(1);e>1&&n.merge(a['label0-color'],t.slice(0,e-1));u.$('span[data-dropdown=flag-color]').dropdown({data:a,callback:J})}(),O(),u.config.enableMailMemo&&N(),Y(),P(),function(){if(u.config.enableDeferMail){var e=u.$('.j-defer');p(s,A,{trigger:e,deferDate:e.attr('deferDate')})}}(),function(){u.initEvents(Z,F),u.subscribe('mail','changed:'+A,(function(e){var a=e.message,t=a.flags||{};if(n.extend(!0,F,a),'flagged'in t){var s=!!t.flagged,l='flagged label0-'+(a.label0||0),o=i.times(9,(function(e){return'label0-'+e})).join(' ');u.$('.j-mail-subject').removeClass(o).toggleClass(l,s),u.$('.j-mail-flagged').removeClass(o).toggleClass('iconflatcolor '+l,s).toggleClass('iconflat',!s)}if('vip'in t){var r=!!t.vip;u.$('.j-mail-vip').toggleClass('iconstar vip',r).toggleClass('iconstarline',!r)}('vip'in t||'top'in t||'priority'in a)&&P(),'deferHandle'in t&&U(),'memo'in a&&N(),!1===t.read&&u.close()})),u.onMessage('view:active',(function(){O()}));var e=u.$('.j-read-alert,.j-mail-top,.j-sent-state');u.$('.j-main').on('scroll',(function(a){e.css('left',a.target.scrollLeft)}))}(),u._initRead()}function O(){u._ContactCards(u.$('.j-u-email'))}function N(){u._memos(u.$(),[A,F.memo])}function B(){u.$('.j-ca-notify').empty(),F.isDecodeMail=!0,z()?(u.$('.j-ca-decrypt').attr('disabled',!0),u.$('[data-btn=reply]').attr('disabled',!1),u.$('[data-btn=replyall]').attr('disabled',!1),u.$('[data-btn=forward]').attr('disabled',!1)):W()}function H(){F.trsAttachments=[],F._initAttach()}u._handleDecryptCAMail=function(){var e,a=n('[role=CAcomposePlugin]');0===a.length&&(e=D.CApluginInjectTpl(),a=n(e).appendTo(n('body'))),e=a.find('object')[1],n.get(l.wmURL({func:'mbox:getMessageData',mode:'text',mid:A}),(function(a){u.Smime=new T(e,a),u.Smime.invaild||(u.Smime.encrypted&&(n.notify.loading(o('mail/msg_handling_attach'),{position:'top-center'}),u.Smime.decryptMail()&&(F.content=u.Smime.mailContent,F.isEncrypted=!0,F.attachments=u.Smime.attachments,c.setItem('caAttachments_'+A,u.Smime.attachments),u.Smime.signed||(u.$('.j-mail-content').contents().find('body').html('<pre>'+F.content+'</pre>'),B(),H())),n.notify.loading('hide')),u.Smime.signed&&(n.notify.loading(o('mail/msg_handling_attach'),{position:'top-center'}),g(o('mail/signed_info_confirm'),(function(){var e=u.Smime.checkSign();u.Smime.encrypted||(F.content=u.Smime.mailContent,F.attachments=u.Smime.attachments,c.setItem('caAttachments_'+A,u.Smime.attachments),u.$('.j-mail-content').contents().find('body').html('<pre>'+F.content+'</pre>'),B()),e?(F.isSigned=!0,u.$('.j-ca-notify').html(o('mail/cert_info',e))):v(o('mail/msg_get_cert_fail')),H()})).then((function(){n.notify.loading('hide')}))))}))};var W=function(){u.$('.j-toolbar').html(z()?'':D.toolbartpl(F,u)),u.$('.j-toolbar-footer').html(z()?D.footerToolbarTpl(F,u):''),u.setupQuickReply()};function Y(e){var a={rcptStatus:X()},t=u.config.deliveryStatusKeepDays,s=u.$('.j-sent-state');if(!a.rcptStatus.type)return!1;s.mask(),l.when(k(),x.listDeliveryHistory({mid:A,mboxa:$})).then((function(l,c){if(c[0]){a.deliverys=c;var f=i.countBy(c,(function(e){e.to&&(e.to_name=(l||i.identity)(r(e.to_name,e.to)).friendlyName());var a=x.getDSInfoHtml(e),t=a[0],n=a[1];return e.dsHtml=t,e.dsTextKey=n,n}));a.msgDetail=[d(o('mbox/stat_msg_detail1'),' <a data-type=mail_sent_state_all class=f-csp>'+c.length+'</a> '),i.map(f,(function(e,a){return''+d(o('mbox/stat_msg_detail2'),[' <a data-type='+a+' class=f-csp>'+e+'</a> ',o('mbox/'+a)])})).join()].join('')}else{var m=b().diff(F.sentDate,'days');a.sendingMsg=m>t?d(o('mbox/sent_state_outdated'),t):o('mbox/sent_state_try_later')}u._params.stateData=a,s.html(D.sentstatetpl(a,u)).removeClass('f-dn'),function p(e){var a=u.$('.j-sent-state'),t=u._params.stateData,s=t&&t.deliverys||[],l=[];e?n.each(s,(function(a,t){t.dsTextKey===e&&l.push(t)})):l=s.slice();l.length>0&&(a.find('.sent-detail').html(D.sentstatetabletpl({deliverys:l},u)),function(e){var a=u.$('.j-sent-state');e.length>10?(a.find('.j-sent-pagination').pagination({total:e.length,limit:10,round:!0,prevText:o('common/prev_page'),nextText:o('common/next_page'),menu:!1,callback:function(e){var t=10*e,i=a.find('.sent-state-table tr.j-delivery-item'),s=[],l=[];i.each((function(e){e<t||e>t+9?s.push(this):l.push(this)})),n(s).addClass('f-dn'),n(l).removeClass('f-dn')}}),a.find('.sent-state-table').find('tr.j-delivery-item:gt(9)').addClass('f-dn')):a.find('.j-sent-pagination').empty()}(l));a.off('click.sentState').on('click.sentState','a[data-type]',(function(e){i.stop(e,0);var t,s=n(this),l=s.data('type');switch(0!==l.indexOf('mail_sent_state')&&0!==l.indexOf('mail_rcl_state')||(t=l,l='mail_sent_state'),l){case'showSentDetail':s.addClass('f-dn'),a.find('.j-sent-detail').removeClass('f-dn').end().find('.sent-detail').removeClass('f-dn').end().find('.j-sent-pagination').removeClass('f-dn');break;case'hideSentDetail':s.closest('.j-sent-detail').addClass('f-dn'),a.find('.j-sent-detail-show').removeClass('f-dn').end().find('.sent-detail').addClass('f-dn').end().find('.j-sent-pagination').addClass('f-dn');break;case'refreshSentDetail':Y(!0);break;case'mail_sent_state':p('mail_sent_state_all'===t?'':t),a.find('a[data-type=showSentDetail]').click()}}))}(),e&&s.find('a[data-type=showSentDetail]').click(),s.mask('hide')}))}var V={recall:function(){h({mid:A,mboxa:$})},destroy:function(){g(o('mbox/autoDel_sysDialog_message'),(function(){l.wmCall('mbox:destroyAutoDelMail',{mid:A}).then(R)}))},vip:function(){J((F.flags.vip?'no':'')+'vip')}};function Q(e,a,t){i.stop(t),(V[e]||i.noop)(e,a)}function J(e){s.mark((e.value||e).replace(/mark:/,''),A)}function X(){var e=F.flags,a=F.rclStatus,t='';return 3===a?t='RCPT_RECALLED_SUCC':5===a?t='RCPT_RECALLED_PART':e&&u.config.enableDeliveryStatus&&(e.rcptRead?t=e.rcptFailed?'RCPT_READ_FL':'RCPT_READ':e.rcptSucceed?t=e.rcptFailed?'RCPT_SUCC_FL':'RCPT_SUCC':e.rcptFailed?t='RCPT_FAIL':e.rcptQueued&&b(F.receivedDate).unix()>=b(u.config.deliveryStatusBeginTime).unix()&&(t='RCPT_QUEUED')),{type:t,message:o('main/alt_m_'+t)}}function K(){return y.getInt('brief_mode',1)}function G(e){e=null!=e?e:!K(),y.set('brief_mode',e?1:0),u.$('.j-short-info').toggle(!!e),u.$('.j-full-info').toggle(!e),u.$('.j-mail-top').toggleClass('u-thread',!e).find('[data-type=toggleBrief] .iconfont').attr('class','iconfont '+(e?'icondown':'iconup'))}function Z(e,a){s.mailOp(e,a)}V.mail_event=i.fn(Z,i),V.dealings=function(){w('mail.search',{vid:'search',dealings:r.parseAddress(i.array(F.from)[0])})},V.toggleBrief=i.fun(G),V.toggleContact=function(e,a){a.closest('.j-contacts').hide().siblings('.j-contacts').show()},u.handleMailMemo=function(){G(0),u.$('.memo-edit').click()}})),D=t(580);s.module({name:'mail.read',template:D},S)},829:function(e,a,t){(function(a){t(830);var i=t(463),n=t(500),s=t(465),l=t(466),o=t(475),r=t(514),c=t(469)('<table class=\'u-table audit-table\'>\n   <tr>\n     <td>{{i18n \'pub/sender\'}}:</td>\n     <td>{{from}}</td>\n   </tr>\n   <tr>\n     <td>{{i18n \'pub/receiver\'}}:</td>\n     <td>{{to}}</td>\n   </tr>\n   <tr>\n     <td>{{i18n \'pub/subject\'}}:</td>\n     <td>{{subject}}</td>\n   </tr>\n   <tr>\n     <td>{{i18n \'pub/auditee_type\'}}:</td>\n     <td>{{i18n (join \'pub/auditee_type_\' auditeetype)}}</td>\n   </tr>\n   <tr>\n     <td>{{i18n \'pub/auditee\'}}:</td>\n     <td>{{auditee}}</td>\n   </tr>\n   <tr>\n     <td>{{i18n \'pub/auditer\'}}:</td>\n     <td>{{auditer}}</td>\n   </tr>\n   {{#if isReject}}\n   <tr>\n     <td>{{i18n \'pub/audit_reason\'}}:</td>\n     <td>\n       <textarea class=\'j-reject-desc\'></textarea>\n     </td>\n   </tr>\n   {{/if}}\n</table>'),d=['from','to','auditer','auditee'];e.exports=function(e,t){r.lookup({uid:a.unique((''+d.map((function(e){return t[e]}))).split(',')),returnAttrs:['true_name']}).then((function(a){f(e,t,a)}))};var f=n.define({title:s('pub/audit_title'),subClass:'audit-box'},(function(e,t,r,f){var m=this,p='reject'===t,u=r.auditeetype,v=a.assign({isReject:p},r);function g(){p&&m.element.find('.j-reject-desc').focus()}d.forEach((function(e){v[e]=r[e].split(',').map((function(e){return new o((f[e]||{}).true_name,e)}))})),e()({message:c(v),afterShow:g,onConfirm:function(){var e={auditAction:p?2:1},a=m.element.find('.j-reject-desc').val();if(a)e.desc=a;else if(p)return n.alert(s('pub/audit_reason_required'),g),!1;return['hostId','tid','auditer','auditee','regionId'].forEach((function(a){e[a]=r[a.toLowerCase()]})),['checksum','auditeeType'].forEach((function(a){e[a]=+r[a.toLowerCase()]})),m.element.mask(),l.wmCall('pub:audit',e).then((function(){i.notify.success(s('pub/audit_succeed',{action:s('pub/AUDIT_RESULT_DESC_'+(p?3:0)+'_'+u)}))})).onFail((function(e){var a=e.code;i.notify.error(s.get('pub/'+a,s('error/'+a)))})).either((function(){m.element.mask('destroy'),m.hide()})),!1}})}))}).call(this,t(464))},831:function(e,a,t){e.exports=t(469)('',{fullAttachWrapperTpl:'<td class="info-item">{{i18n \'mbox/mail_attached\'}} :</td> <td class="attach-info"> <b class="j-attach-desc">{{countAttachment this}}</b> {{i18n \'mail/attachments_number\'}}( {{#with (firstAttachment this)}} <span class="file-small-icon icon-small-{{fileType}}"></span> <span class="file-name f-ellipsis" title="{{filename}}"> {{filename}} {{if$ (ge (countAttachment ../this) 2) (i18n \'mbox/andsoon\')}} </span> ) {{/with}} <a class="view-attach-btn j-view-attach" title="{{i18n \'mbox/mail_viewatta\'}}" href="javascript:void(0)"> {{i18n \'mbox/mail_viewatta\'}} </a> </td>',auditMailContactsTpl:'<div class="original-mail-info-tip">{{i18n "mbox/original_mail_info"}}</div> <div class="info-wrapper"> <table> {{#each tableData}} {{#if value}} <tr> <td class="info-item-label">{{label}} :</td> <td class="info-item-value"><span title="{{value}}">{{value}}</span></td> </tr> {{/if}} {{/each}} </table> </div>',readReceiptTpl:'<div class="u-alert u-alert-warning u-alert-dismissible j-read-receipt"> <span class="close iconfont icondelword" data-action="close"></span> <span>{{i18n "mbox/need_read_receipt"}}</span> <label>{{i18n "mbox/need_read_receipt_auto"}} <input type="checkbox" id="receiptAlways" name="receiptAlways"></label> <a class="j-receipt link" data-action="send">{{i18n "mbox/need_read_receipt_yes"}}</a> <a class="j-receipt link" data-action="cancel">{{i18n "mbox/need_read_receipt_no"}}</a> </div>'})},900:function(e,a,t){(function(e,a){t(901),t(902);var i=t(463),n=t(471),s=t(465),l=t(475),o=t(473),r=t(483).encode,c=t(482),d=t(470).confirm,f=t(493),m=t(531),p=t(544),u=t(477).go,v=t(467),g=t(474),h=t(579),b=t(629).extend({},(function(t,n){var b,_=this;_.events({'click .j-toggle-thread[data-type]':[function(e,a){'expand'===e?(a.data('type','collapse').html(s('common/op_collapse_all')),_.$('.j-toggle-other-thread').hide(),_.$('.j-thread-item').each((function(){Y(i(this).data('mid'))}))):'collapse'===e&&(a.data('type','expand').html(s('common/op_expand_all')),_.$('.j-mail-info').hide().siblings('.j-thread-item').show(),_.$('.j-toggle-other-thread').show().siblings('.other-thread').hide())}],'click .j-main .j-thread-item[data-mid]':[Y],'click .j-main .j-toggle-item[data-type]':[function(e,a){'curItem'===e?a.parents('.j-mail-info').hide().prev('.j-thread-item').show():'hideItem'===e&&a.parents('.j-toggle-other-thread').hide().siblings('.other-thread').show();_.$('.j-quick-reply').each((function(){i(this).pin('setPosition')}))}],'click .j-flag, .j-vip[data-mid]':[function(a,t,i){e.stop(i);var n=t.is('.j-vip')?'vip':'flagged',s=t.is('.thread-title *'),l=(s?E:B(a)).flags[n]?'no'+n:n;b.mark(l,s?0:a)}],'click .j-defer[data-mid]':[function(a,t,i){e.stop(i),_.config.enableDeferMail&&(m(b,a,{trigger:t,deferDate:t.attr('deferDate')}),t.click())}],'click .j-dealings[data-mid]':[function(a,t,i){e.stop(i);var n=B(a);if(!n)return!1;u('mail.search',{vid:'search',dealings:l.parseAddress(e.array(n.from)[0])})}],'click .j-mail-top a[data-type]':[function(a,t,i){switch(e.stop(i),a){case'toggleBrief':ae(t);break;case'toggleContact':t.closest('.j-contacts').hide().siblings('.j-contacts').show()}}],'click .j-decrypt-submit':[function(e){var a=e.parents('.j-mailCipherEncrypted'),t=a.find('.j-decryption-error'),i=a.data('mid')||T,n=a.find('#password').val(),l={id:i,part:C.part,autoName:!0,password:n};n?h.decryptMessage(l,t).then((function(){H(i,{mailCipherPassword:n,isLoaded:!1,attachments:{}}),H(i,{attachments:[]}),Y(i)})):t.html(s('mbox/read_mail_err_password_empty')).show()},i],'click .j-footer-bar [data-btn]':[function(e,a){var t=a.closest('.j-mail-info').data().mid;'delete'===e?Z(t,4):te(e,t)}]}),t()(n);var M,C=_.state.param,T=C.id,S=C.rootid,D=C.mboxa,A='mail.'+(C.pView||'list'),$=[],E={},L=_.threadMails=new Map;_._params={fromView:A,mail:E},_.$().attr('mid',T);var F=_.$('.j-main');function R(){_.load(v.generateSidCookie().then(P.bind(0,(function(){e.iter(L,(function(e){delete e.isLoaded})),I()}))))}function I(){_.initEvents(te,E),e.iter(L,(function(a,t){return _.subscribe('mail','changed:'+t,(function(a){var n=a.message,l=n.flags||{},r=Object.keys(l)[0];H(t,n);var c='flagged'===r;(t===T||c)&&(t===T&&i.extend(!0,E,n),c&&(E.flags[r]=e.some(L,'flags.'+r)),W()),function(a,t,n){var l=!!t.flags[n],r={flagged:['.j-flag',i('<i>').attr('title',s(l?'mail/list_cancel_flag':'mail/list_set_flag')).attr('class',l?'flagged iconfont iconflatcolor label0-'+t.label0:'iconfont iconflat')],deferHandle:['.j-defer',i('<i>').attr('title',l?o.h(s('mail/list_handle_defer'),t.defer):s('mail/list_set_defer')).attr('class',l?'deferred state-icon icon-mDEFER':'iconfont iconclock'),{deferDate:t.defer}],vip:['.j-vip',i('<i>').attr('title',s(l?'mail/list_cancel_vip':'mail/list_set_vip')).attr('class',l?'iconfont iconstar vip':'iconfont iconstarline')]}[n]||[],c=r[0],d=r[1],f=r[2];c&&a.$('.j-thread-item[data-mid="'+t.id+'"], .j-mail-info[data-mid="'+t.id+'"]').find(c).attr(e.assign({'data-value':l},f)).html(d)}(_,B(t),r),('vip'in l||'top'in l||'priority'in n)&&O(),'memo'in n&&X(t),!1===l.read&&z()}))})),_.onMessage('view:refresh',W),_.onMessage('view:active',(function(e){e.message&&Q(e.message.vid)})),F.off().on('scroll',(function(e){var a=e.target.scrollLeft,t=_.$('.j-thread-item,.j-mail-top,.j-quick-reply');a>0?(F.addClass('thread-list-scroll'),_.$('.j-mail-info').addClass('thread-item-info-scroll')):(F.removeClass('thread-list-scroll'),_.$('.j-mail-info').removeClass('thread-item-info-scroll')),t.css('left',a)})),O(),W(),function(){var a,t=e.map(L),i=e.reversed(t),n=t.length,s=function(e,a){return!e.flags.read||!a},l=C.filterFlags||{},o='flagged'in l&&k(l.flagged,l.label0);if(!o&&n>=6){var r=e.sumBy(i,s);(a=n-Math.max(r,3))&&(t[a]=e.assign({hiddenCount:a},t[a]))}F.html(w(t,_));var c=F.find('.j-thread-item');i.find((function(e,t){var i=c.eq(n-1-t);if(o){var l=e.flags&&k(e.flags.flagged,e.label0);if(l&&o&l)return Y(e.id).then((function(){F.scrollTo(i.next('.j-mail-info'))})),!0}else s(e,t)?Y(e.id):a&&(i.addClass('f-dn other-thread'),a--)}))}()}_.after('render',R);var q=function(e){_._rerender($,E,e)},z=_.close;var P=_.initPrevAndNext=function(a){return e.assign(_._params,C),_._prevNext(a&&E).then((function(e,t){if($=e,M=t,a)return U(T).then(a);O()}))};function U(e){return i.notify.loading(),h.getThreadMessageInfos(e,D).onRTN(N).catchCode('FA_NEED_AUTH2',(function(){f.box({successCb:R,cancelCb:z,tip:s('common/lbl_user_auth2_thread_tip')}),a.abort()})).either((function(){i.notify.loading('hide')}))}function O(){b&&b.destroy(),b=_.toolbar=new p(_,_.$('.j-toolbar').toggle(!i('#previewLayoutRead').has(_.$())[0]).html(x(E,_)),q).show(M,1)}function N(a){var t=_.config,n={config:t,enableDealings:!C.part&&t.enableMailDealings&&t.permWebmailMailSearch};L.clear(),e.iter(a,(function(a){L.set(a.id,e.assign(a,n))})),e.assign(E,E.id?{}:i.extend(!0,{},B(T)),n)}_._appendMail=function(e){U(e).then((function(){F.append(w([B(e)],_))}))};var B=_.mail=L.get.bind(L);function H(e,a){B(e)?i.extend(!0,B(e),a):L.set(e,a)}function W(){g.formatTop(E),E.sid=v.getSid(),_.sendMessage('mail','tab:change',{id:'thread:'+(S||T),title:E.subject||s('mail/empty_subject')}),_.$('.thread-title').html(y(E,_)),function(){var a=_.config.mailFlaggedColorCount,t=g.getMailMenu('flag-color'),n=g.getMailMenu('flag-labels').slice(1);a>1&&i.merge(t['label0-color'],n.slice(0,a-1));_.$('[data-dropdown="flag-color"]').not('[role="dropdown"]').dropdown({data:t,callback:e.fn(G,0)})}()}function Y(e){var t=v.getUser(),i=B(e)||{},n={mid:e,part:C.part||'',mailCipherPassword:i.mailCipherPassword||''};return i.isLoaded?(V(e,!0),a.resolve()):h.readMessage(n).then((function(a){a.config=_.config,a.mid=e,a.sid=v.getSid(),a.memo=i.memo,a.isFromCurUser=l.parseAddress(a.from[0])===t.email,i.flags&&!i.flags.read&&g.flush(),a.flags.read=!0,a.isLoaded=!0,a.mailCipherEncrypted&&(a.cipherEncryptedMsg=s('mbox/read_mail_cipher_encrypted_tip').replace('{0}','<span class="highlight ">"'+r(l.parseTrueName(a.from[0])||a.from[0])+'"</span>')),H(e,a),V(e)}))}function V(a,t){var n=B(a),s=_.$('.j-mail-info[data-mid="'+a+'"]'),l=s.prev('.j-thread-item');if(t)return s.show(),l.hide(),void J(s);_.updateAuditMail(n),s.html(j(n,_)).show(),_.setupQuickReply(s),l.hide(),Q(s),X(n.mid),function(a,t){t.find('[data-dropdown]').not('[role=dropdown]').each((function(){var t=i(this).attr('data-dropdown');i(this).dropdown({parent:'body',data:'read-more'===t?K(a):g.getMailMenu(t),callback:e.fn(G,a)})}))}(n.mid,s),s.find('.j-quick-reply').pin({scrollElement:F,parentElement:'.j-mail-info',marginElement:'.j-mail-top'}),_._initRead(s).on('reposition.quickReply',e.fn(J,s))}function Q(a){a=e.isSTR(a)?_.$('.j-mail-info[data-mid="'+a+'"]'):a,_._ContactCards(a.find('.u-email-tip'))}function J(e){e.find('.j-quick-reply').each((function(){i(this).pin('setPosition')}))}function X(e){var a=(B(e)||{}).memo,t=_.$('.j-mail-info[data-mid="'+e+'"]');_._memos(t,[e,a])}function K(e){for(var a,t=g.getMailMenu('read-more')||[],n=0,s=B(e)||{};n<t.other.length;n++){if('more:forward'===(a=t.other[n]).value&&i.isArray(a.children)&&a.children.length&&i.each(a.children.splice(0),(function(e,t){if(t.value)switch(t.value){case'forward:forwardd':_.config.enableForward&&_.config.enableForwardd&&!s.sMimeServerEncrypted&&(!s.ctrls||!s.ctrls['CM-SECURITY']||c.enabledDirectFwd)&&a.children.push(t);break;case'forward:forwarda':_.config.enableForward&&!s.sMimeServerEncrypted&&a.children.push(t);break;default:_.config.enableForward&&a.children.push(t)}})),'more:mail_event'===a.value&&!_.config.enableScheduleInvitation){t.other.splice(n,1);break}'more:delete'===a.value&&t.other.splice(n,1)}for(n=0;n<t.filter.length;n++)if('more:notJunk'===(a=t.filter[n]).value||'more:report'===a.value&&!_.config.enableSpamForwhand){t.filter.splice(n,1);break}return t}function G(e,a){var t=a.id,n=a.value,l=e||T,o=n.split(':'),r=o[0],c=o[1];switch(r){case'reply':case'forward':case'viewMail':te(c,l);break;case'move':Z(l,t);break;case'label0':case'mark':b.mark('mark'===r?c:n,e);break;case'encoding':_.mail(l)._read({encoding:c});break;case'more':!function(e,a){switch(a){case'delete':Z(e,4);break;case'realdelete':!function(e){if(!e)return;d(s('mail/confirm_purge_mail'),(function(){g.realDeleteMails(e,{mboxa:D}).then((function(){i.notify.success(s('mbox/del_message_succ')),ee(e)}))}))}(e);break;case'mailMemo':!function(e){var a=_.$('.j-mail-info[data-mid="'+e+'"] .j-mail-top');ae(a,0),a.find('.memo-edit').click()}(e);break;default:te(a,e)}}(l,c)}}var Z=_.moveMail=function(e,a){g.updateMailAttrs(e,{fid:a}).then((function(){i.notify(s('mail/msg_'+(4===a?'delete':'move')+'_mail',{count:1})),ee(e)}))};function ee(e){_.sendMessage(A,'view:refresh'),e!==T?(L['delete'](e),I()):q({})}function ae(e,a){var t=e.closest('.j-mail-top'),i=t.find('.j-short-info'),n=t.find('.j-full-info');a=null!=a?!!a:i.is(':hidden'),i.toggle(a),n.toggle(!a),t.find('a[data-type=toggleBrief]').attr('class','iconfont '+(a?'icondown':'iconup')),t.find('.j-memo-tip').toggleClass('f-dn',!a||n.find('.j-mail-memo').hasClass('f-dn')),J(_.$())}function te(e,a){b.mailOp(e,a)}_.before('destroy',(function(){_.$('.j-quick-reply').each((function(){i(this).pin('destroy')})),_.$('[role=dropdown]').dropdown('destroy')}))})),_=t(631).config({partials:e.pickBy(t(580))}),y=_.threadTitleTpl,w=_.threadListTpl,j=_.threadInfoTpl,x=_.toolbarMenuTpl;function k(e,a){return a=parseInt(a,10),e?isNaN(a)||a<0||a>8?1023:1<<a:1024}n.module({name:'mail.thread',template:_},b)}).call(this,t(464),t(466))},902:function(e,a,t){var i=t(463),n={init:function(e){return this.each((function(){var a=i(this),t=i.extend(!0,i.fn.pin.defaults,e);a.data('pin.settings',t),a.attr('role','jqueryPin'),a.pin('initEvent')}))},initEvent:function(){var e,a=i(this),t=a.data('pin.settings')||{},n=t.scrollElement,s=t.delayTime;n.on('scroll.pin',(function(){e&&clearTimeout(e),a.hide(),e=setTimeout((function(){a.pin('setPosition'),a.fadeIn()}),s)})),i(window).on('resize.pin',(function(){a.pin('setPosition')})),a.pin('setPosition')},setPosition:function(){var e=i(this),a=e.data('pin.settings')||{},t=a.marginElement?e.prevAll(a.marginElement).outerHeight():a.marginTop,n=e.parents(a.parentElement)||e.parent(),s=i(window).outerHeight(),l=n.outerHeight(),o=n.offset()?n.offset().top:'',r=e.outerHeight();i.isEmptyObject(a)||(o+l>=s?e.css({bottom:l+o-s}):e.css({bottom:0}),o+r+t>s&&e.css({bottom:l-t-r}))},destroy:function(){var e=i(this),a=(e.data('pin.settings')||{}).scrollElement;a&&a.off('scroll.pin'),e.removeData('pin.settings').removeAttr('role'),i(window).off('resize.pin')}};i.fn.pin=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):i.isPlainObject(e)?n.init.apply(this,arguments):void i.error('Method'+e+'does not exist on jquery.pin')},i.fn.pin.defaults={marginTop:0,delayTime:300,scrollElement:i(window)}},903:function(e,a,t){t(904),t(584);var i=t(463),n=t(472),s=t(471),l=t(542),o=t(467),r=t(504),c=t(474),d=n.extend({},(function(e,a){var t,n,d=this,f=o.getUser(),m=o.getCurrentState(),p=m.param,u=l(p)[0];e()(a);var v=d.$('#previewLayoutRead'),g=d.$('#previewLayoutList');d.after('render',(function(){var e;d.$('.j-previewlayout-top').toggle(2===f.preview_layout).children().empty(),e=c.getCacheFolder(u).name,d.sendMessage('mail','tab:change',{id:'previewlayout:'+u,title:e||' '}),v.addClass('f-dn'),p.view='list',p.fid=u,b.destroy(),o.setCurrentState(m),b.render(g,2===f.preview_layout&&{toolbar:d.$('.j-preview-toolbar'),autoForwardTip:d.$('.j-message-content'),autoReplyTip:d.$('.j-autoreply-content'),commonTip:d.$('.j-common-tip')}).then((function(e){d._params=e._params,v.removeClass('f-dn')})),M(),d.pubsub.off().subscribe('dispatcher','view:changed',M).onMessage('view:refresh',(function(e){var a=(e&&e.message||{}).param;if(g.empty(),a){i.extend(!0,p,a);var t=l(a);u=t[0]}n=!1,d.render()})).onMessage('reset',_)}));var h,b=s.module('mail.list');function _(e){var a=e.message;h&&h.destroy(),h=a&&s.module(a.module),v.find('.j-mail-read').remove(),v.find('.j-email-unchecked').toggle(!h),h&&(o.setCurrentState(a),h.render(v))}function y(e,a){var n=1===f.preview_layout?'n':'w',s=w(e);v.add(g).attr('style',''),e.removeClass('up-down-layout left-right-layout').addClass(1===f.preview_layout?'up-down-layout':'left-right-layout'),a.resizable('instance')&&a.resizable('destroy'),a.resizable({handles:n,maxHeight:s.maxHeight,maxWidth:s.maxWidth,minWidth:400,minHeight:120,start:function(){v.find('.mail-content').each((function(){i(this).append('<div class="iframeCover" style="zindex:199;position:absolute;width:100%;top:0;left:0;height:'+i(this).height()+'px"></div>')}))},stop:function(a,t){r.set({key:'layout_ratio'+f.preview_layout,value:1===f.preview_layout?t.position.top/e.outerHeight():t.position.left/e.outerWidth()}),d.$('.iframeCover').remove()},resize:function(e,a){1===f.preview_layout?g.css({height:a.position.top}):g.css({width:a.position.left})}}),a.find('.ui-resizable-handle').addClass('w'===n?'ui-resizable-border-left ui-resizable-border-right':'ui-resizable-border-top ui-resizable-border-bottom').html('<i class="iconfont '+('w'===n?'iconsliderv':'iconsliderh')+'"></i>'),v.find('.j-mail-content').trigger('reposition.quickReply'),function(e,a){var n=i(window),s=w(e),l=-1;2===f.preview_layout?a.resizable({maxWidth:s.maxWidth}):1===f.preview_layout&&a.resizable({maxHeight:s.maxHeight});j(e),n.off('resize.previewLayout').on('resize.previewLayout',(function(e){clearTimeout(l),l=setTimeout((function(){t=!0,M()}),100),e.stopPropagation()}))}(e,a)}var w=function(e){return{maxWidth:.7*e.outerWidth(),maxHeight:e.outerHeight()-d.$('.j-toolbar').outerHeight()-120}};function j(e){var a=r.getFloat('layout_ratio'+f.preview_layout,0);if(1===f.preview_layout&&0!==a){var t=parseFloat(a)*e.outerHeight(),i=e.outerHeight()-t;v.css({top:t,height:i}),g.css({height:t})}if(2===f.preview_layout&&0!==a){var n=parseFloat(a)*e.outerWidth(),s=e.outerWidth()-n-10;v.css({left:n,width:s}),g.css({width:n})}}var x=i(window).width(),k=i(window).height();function M(){var e=d.$(),a=d.$('.j-resize-layout');if(!n&&e.is(':visible')&&(y(e,a),n=!0),t&&e.is(':visible')){var s=i(window),l=s.width(),o=s.height(),r=w(e);t=!1,x!==l&&2===f.preview_layout?(a.resizable({maxWidth:r.maxWidth}),x=l,j(e)):k!==o&&1===f.preview_layout&&(a.resizable({maxHeight:r.maxHeight}),k=o,j(e))}}d.before('destroy',(function(){i(window).off('resize.previewLayout')}))}));s.module({name:'mail.previewlayout',template:t(905)},d)},905:function(e,a,t){e.exports=t(469)('<div id="previewLayout" class="m-preview-layout"> <div class="m-preview-layout-row"> <div class="preview-layout-top j-previewlayout-top"> <div class="j-autoreply-content message-tip u-alert-warning f-ellipsis f-dn"></div> <div class="j-message-content message-tip u-alert-warning f-ellipsis f-dn"></div> <div class="j-common-tip message-tip u-alert-warning f-ellipsis"></div> <div class="j-preview-toolbar toolbar f-dn"></div> </div> </div> <div class="m-preview-layout-row preview-layout-content-row"> <div class="preview-layout-content j-previewlayout-content"> <div id="previewLayoutList" class="preview-layout-list preview-layout"></div> <div id="previewLayoutRead" class="j-resize-layout preview-layout-read preview-layout f-dn"> <div class="j-email-unchecked email-unchecked"> {{i18n "mail/layout_select_message"}} </div> </div> </div> </div> </div>',{})}}]);
//# sourceMappingURL=M.c2f53.js.map